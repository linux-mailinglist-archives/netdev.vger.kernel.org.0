Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id E84C7452ED9
	for <lists+netdev@lfdr.de>; Tue, 16 Nov 2021 11:17:10 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S233873AbhKPKUC (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Tue, 16 Nov 2021 05:20:02 -0500
Received: from www62.your-server.de ([213.133.104.62]:38926 "EHLO
        www62.your-server.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S233872AbhKPKTx (ORCPT
        <rfc822;netdev@vger.kernel.org>); Tue, 16 Nov 2021 05:19:53 -0500
Received: from sslproxy02.your-server.de ([78.47.166.47])
        by www62.your-server.de with esmtpsa (TLSv1.3:TLS_AES_256_GCM_SHA384:256)
        (Exim 4.92.3)
        (envelope-from <daniel@iogearbox.net>)
        id 1mmvWF-000Clo-IG; Tue, 16 Nov 2021 11:16:51 +0100
Received: from [85.1.206.226] (helo=linux.home)
        by sslproxy02.your-server.de with esmtpsa (TLSv1.3:TLS_AES_256_GCM_SHA384:256)
        (Exim 4.92)
        (envelope-from <daniel@iogearbox.net>)
        id 1mmvWF-0004pP-9d; Tue, 16 Nov 2021 11:16:51 +0100
Subject: Re: Clarification on bpftool dual licensing
To:     Martin Kelly <martin.kelly@crowdstrike.com>,
        "bpf@vger.kernel.org" <bpf@vger.kernel.org>,
        Alexei Starovoitov <ast@kernel.org>
Cc:     "netdev@vger.kernel.org" <netdev@vger.kernel.org>,
        "kernel-team@fb.com" <kernel-team@fb.com>,
        "David S. Miller" <davem@davemloft.net>,
        Andrii Nakryiko <andrii@kernel.org>
References: <54d3cb9669644995b6ae787b4d532b73@crowdstrike.com>
From:   Daniel Borkmann <daniel@iogearbox.net>
Message-ID: <0b80c79b-de0c-931c-262d-4da6e2add9f9@iogearbox.net>
Date:   Tue, 16 Nov 2021 11:16:50 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.7.2
MIME-Version: 1.0
In-Reply-To: <54d3cb9669644995b6ae787b4d532b73@crowdstrike.com>
Content-Type: text/plain; charset=utf-8; format=flowed
Content-Language: en-US
Content-Transfer-Encoding: 7bit
X-Authenticated-Sender: daniel@iogearbox.net
X-Virus-Scanned: Clear (ClamAV 0.103.3/26354/Mon Nov 15 10:21:07 2021)
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

On 11/15/21 7:20 PM, Martin Kelly wrote:
> Hi,
> 
> I have a question regarding the dual licensing provision of bpftool. I
> understand that bpftool can be distributed as either GPL 2.0 or BSD 2-clause.
> That said, bpftool can also auto-generate BPF code that gets specified inline
> in the skeleton header file, and it's possible that the BPF code generated is
> GPL. What I'm wondering is what happens if bpftool generates GPL-licensed BPF
> code inside the skeleton header, so that you get a header like this:
> 
> something.skel.h:
> /* this file is BSD 2-clause, by nature of dual licensing */

Fwiw, the generated header contains an SPDX identifier:

  /* SPDX-License-Identifier: (LGPL-2.1 OR BSD-2-Clause) */
  /* THIS FILE IS AUTOGENERATED! */

> /* THIS FILE IS AUTOGENERATED! */
> 
> /* standard skeleton definitions */
> 
> ...
> 
> s->data_sz = XXX;
> s->data = (void *)"\
> <eBPF bytecode, produced by GPL 2.0 sources, specified in binary>
> ";
> 
> My guess is that, based on the choice to dual-license bpftool, the header is
> meant to still be BSD 2-clause, and the s->data inline code's GPL license is
> not meant to change the licensing of the header itself, but I wanted to
> double-check, especially as I am not a lawyer. If this is indeed the intent,
> is there any opposition to a patch clarifying this more explicitly in
> Documentation/bpf/bpf_licensing.rst?

Not a lawyer either, but my interpretation is that this point related to "packaging"
of BPF programs from the bpf_licensing.rst would apply here (given this is what it
does after all):

   Packaging BPF programs with user space applications
   ===================================================

   Generally, proprietary-licensed applications and GPL licensed BPF programs
   written for the Linux kernel in the same package can co-exist because they are
   separate executable processes. This applies to both cBPF and eBPF programs.
