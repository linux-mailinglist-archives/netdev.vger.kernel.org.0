Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id ADD3732C3ED
	for <lists+netdev@lfdr.de>; Thu,  4 Mar 2021 01:51:57 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1353478AbhCDAJJ (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Wed, 3 Mar 2021 19:09:09 -0500
Received: from hqnvemgate24.nvidia.com ([216.228.121.143]:9625 "EHLO
        hqnvemgate24.nvidia.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1842503AbhCCIFp (ORCPT
        <rfc822;netdev@vger.kernel.org>); Wed, 3 Mar 2021 03:05:45 -0500
Received: from hqmail.nvidia.com (Not Verified[216.228.121.13]) by hqnvemgate24.nvidia.com (using TLS: TLSv1.2, AES256-SHA)
        id <B603f40d20003>; Tue, 02 Mar 2021 23:54:58 -0800
Received: from DRHQMAIL107.nvidia.com (10.27.9.16) by HQMAIL105.nvidia.com
 (172.20.187.12) with Microsoft SMTP Server (TLS) id 15.0.1497.2; Wed, 3 Mar
 2021 07:54:58 +0000
Received: from [172.27.14.101] (172.20.145.6) by DRHQMAIL107.nvidia.com
 (10.27.9.16) with Microsoft SMTP Server (TLS) id 15.0.1497.2; Wed, 3 Mar 2021
 07:54:54 +0000
Subject: Re: [PATCH] net/mlx5: use kvfree() for memory allocated with
 kvzalloc()
To:     angkery <angkery@163.com>, <saeedm@nvidia.com>, <leon@kernel.org>,
        <davem@davemloft.net>, <kuba@kernel.org>, <vladbu@nvidia.com>,
        <dlinkin@nvidia.com>, <dan.carpenter@oracle.com>
CC:     <netdev@vger.kernel.org>, <linux-rdma@vger.kernel.org>,
        <linux-kernel@vger.kernel.org>, Junlin Yang <yangjunlin@yulong.com>
References: <20210303024019.2245-1-angkery@163.com>
From:   Roi Dayan <roid@nvidia.com>
Message-ID: <0c195a3a-53cc-dbd2-f656-54a92e5a569b@nvidia.com>
Date:   Wed, 3 Mar 2021 09:54:52 +0200
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:78.0) Gecko/20100101
 Thunderbird/78.7.1
MIME-Version: 1.0
In-Reply-To: <20210303024019.2245-1-angkery@163.com>
Content-Type: text/plain; charset="utf-8"; format=flowed
Content-Language: en-US
Content-Transfer-Encoding: 7bit
X-Originating-IP: [172.20.145.6]
X-ClientProxiedBy: HQMAIL107.nvidia.com (172.20.187.13) To
 DRHQMAIL107.nvidia.com (10.27.9.16)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=nvidia.com; s=n1;
        t=1614758098; bh=jptEHTTqU5i9Rk44hkt2Xk1fTTxJd4Czd+BJtbXzJQg=;
        h=Subject:To:CC:References:From:Message-ID:Date:User-Agent:
         MIME-Version:In-Reply-To:Content-Type:Content-Language:
         Content-Transfer-Encoding:X-Originating-IP:X-ClientProxiedBy;
        b=EmeeFnPDOYL2h8bUEC9Ejsn5cAia9/0b8bJow1firBmPU8Lnu9e2HHmF6j1QKLtsv
         PL2ecK2g0MXdNSKzUl76YCTYujMMij+nY7Et/seSfa8ObdBrvt87pGFZdmMj7cX10M
         Fp3H/TklXsfwQRqgKsa27saB7qqZhqwyTtEqfSkso0PolQ2UegYcGYgUuToojwqlSb
         MKnEtV1eDr4AiUhCxcNNu+prlYGyzeoqOIoR3Tgh4xzZVqLnSKfMtyN7fYOX0InFKS
         sUikkrI1WERiorGXKfh4ujrXYOdTY18OpfFjY6a/heqDG15FccbG6bHErCeiYlUgel
         zY3qvb1m95ukQ==
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org



On 2021-03-03 4:40 AM, angkery wrote:
> From: Junlin Yang <yangjunlin@yulong.com>
> 
> It is allocated with kvzalloc(), the corresponding release function
> should not be kfree(), use kvfree() instead.
> 
> Generated by: scripts/coccinelle/api/kfree_mismatch.cocci
> 
> Signed-off-by: Junlin Yang <yangjunlin@yulong.com>
> ---
>   drivers/net/ethernet/mellanox/mlx5/core/esw/indir_table.c | 10 +++++-----
>   1 file changed, 5 insertions(+), 5 deletions(-)
> 
> diff --git a/drivers/net/ethernet/mellanox/mlx5/core/esw/indir_table.c b/drivers/net/ethernet/mellanox/mlx5/core/esw/indir_table.c
> index 6f6772b..3da7bec 100644
> --- a/drivers/net/ethernet/mellanox/mlx5/core/esw/indir_table.c
> +++ b/drivers/net/ethernet/mellanox/mlx5/core/esw/indir_table.c
> @@ -248,7 +248,7 @@ static int mlx5_esw_indir_table_rule_get(struct mlx5_eswitch *esw,
>   err_ethertype:
>   	kfree(rule);
>   out:
> -	kfree(rule_spec);
> +	kvfree(rule_spec);
>   	return err;
>   }
>   
> @@ -328,7 +328,7 @@ static int mlx5_create_indir_recirc_group(struct mlx5_eswitch *esw,
>   	e->recirc_cnt = 0;
>   
>   out:
> -	kfree(in);
> +	kvfree(in);
>   	return err;
>   }
>   
> @@ -347,7 +347,7 @@ static int mlx5_create_indir_fwd_group(struct mlx5_eswitch *esw,
>   
>   	spec = kvzalloc(sizeof(*spec), GFP_KERNEL);
>   	if (!spec) {
> -		kfree(in);
> +		kvfree(in);
>   		return -ENOMEM;
>   	}
>   
> @@ -371,8 +371,8 @@ static int mlx5_create_indir_fwd_group(struct mlx5_eswitch *esw,
>   	}
>   
>   err_out:
> -	kfree(spec);
> -	kfree(in);
> +	kvfree(spec);
> +	kvfree(in);
>   	return err;
>   }
>   
> 

thanks!

Reviewed-by: Roi Dayan <roid@nvidia.com>

