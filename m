Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 5A21015BCFE
	for <lists+netdev@lfdr.de>; Thu, 13 Feb 2020 11:44:24 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1729572AbgBMKoW (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Thu, 13 Feb 2020 05:44:22 -0500
Received: from mga18.intel.com ([134.134.136.126]:43512 "EHLO mga18.intel.com"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1729428AbgBMKoW (ORCPT <rfc822;netdev@vger.kernel.org>);
        Thu, 13 Feb 2020 05:44:22 -0500
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga001.jf.intel.com ([10.7.209.18])
  by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 13 Feb 2020 02:44:19 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,436,1574150400"; 
   d="scan'208";a="313693758"
Received: from orsmsx110.amr.corp.intel.com ([10.22.240.8])
  by orsmga001.jf.intel.com with ESMTP; 13 Feb 2020 02:44:19 -0800
Received: from orsmsx115.amr.corp.intel.com ([169.254.4.100]) by
 ORSMSX110.amr.corp.intel.com ([169.254.10.107]) with mapi id 14.03.0439.000;
 Thu, 13 Feb 2020 02:44:19 -0800
From:   "Boeuf, Sebastien" <sebastien.boeuf@intel.com>
To:     "sgarzare@redhat.com" <sgarzare@redhat.com>
CC:     "stefanha@redhat.com" <stefanha@redhat.com>,
        "netdev@vger.kernel.org" <netdev@vger.kernel.org>,
        "davem@davemloft.net" <davem@davemloft.net>
Subject: Re: [PATCH] net: virtio_vsock: Fix race condition between bind and
 listen
Thread-Topic: [PATCH] net: virtio_vsock: Fix race condition between bind and
 listen
Thread-Index: AQHV4k47o+FvdyeZdUa5OLpq2zu4PqgZZQkAgAAC0ACAAAitgIAABgwA
Date:   Thu, 13 Feb 2020 10:44:18 +0000
Message-ID: <1d4c3958d8b75756341548e7d51ccf42397c2d27.camel@intel.com>
References: <668b0eda8823564cd604b1663dc53fbaece0cd4e.camel@intel.com>
         <20200213094130.vehzkr4a3pnoiogr@steredhat>
         <3448e588f11dad913e93dfce8031fbd60ba4c85b.camel@intel.com>
         <20200213102237.uyhfv5g2td5ayg2b@steredhat>
In-Reply-To: <20200213102237.uyhfv5g2td5ayg2b@steredhat>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [10.252.24.191]
Content-Type: text/plain; charset="utf-8"
Content-ID: <9D061D4CDA7C264F814DD3C2289BF7B0@intel.com>
MIME-Version: 1.0
Content-Transfer-Encoding: base64
Sender: netdev-owner@vger.kernel.org
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

T24gVGh1LCAyMDIwLTAyLTEzIGF0IDExOjIyICswMTAwLCBTdGVmYW5vIEdhcnphcmVsbGEgd3Jv
dGU6DQo+IE9uIFRodSwgRmViIDEzLCAyMDIwIGF0IDA5OjUxOjM2QU0gKzAwMDAsIEJvZXVmLCBT
ZWJhc3RpZW4gd3JvdGU6DQo+ID4gSGkgU3RlZmFubywNCj4gPiANCj4gPiBPbiBUaHUsIDIwMjAt
MDItMTMgYXQgMTA6NDEgKzAxMDAsIFN0ZWZhbm8gR2FyemFyZWxsYSB3cm90ZToNCj4gPiA+IEhp
IFNlYmFzdGllbiwNCj4gPiA+IA0KPiA+ID4gT24gVGh1LCBGZWIgMTMsIDIwMjAgYXQgMDk6MTY6
MTFBTSArMDAwMCwgQm9ldWYsIFNlYmFzdGllbiB3cm90ZToNCj4gPiA+ID4gRnJvbSAyZjEyNzZk
MDJmNWExMmQ4NWFlYzVhZGMxMWRmZTFlYWI3ZTE2MGQ2IE1vbiBTZXAgMTcNCj4gPiA+ID4gMDA6
MDA6MDANCj4gPiA+ID4gMjAwMQ0KPiA+ID4gPiBGcm9tOiBTZWJhc3RpZW4gQm9ldWYgPHNlYmFz
dGllbi5ib2V1ZkBpbnRlbC5jb20+DQo+ID4gPiA+IERhdGU6IFRodSwgMTMgRmViIDIwMjAgMDg6
NTA6MzggKzAxMDANCj4gPiA+ID4gU3ViamVjdDogW1BBVENIXSBuZXQ6IHZpcnRpb192c29jazog
Rml4IHJhY2UgY29uZGl0aW9uIGJldHdlZW4NCj4gPiA+ID4gYmluZA0KPiA+ID4gPiBhbmQgbGlz
dGVuDQo+ID4gPiA+IA0KPiA+ID4gPiBXaGVuZXZlciB0aGUgdnNvY2sgYmFja2VuZCBvbiB0aGUg
aG9zdCBzZW5kcyBhIHBhY2tldCB0aHJvdWdoDQo+ID4gPiA+IHRoZQ0KPiA+ID4gPiBSWA0KPiA+
ID4gPiBxdWV1ZSwgaXQgZXhwZWN0cyBhbiBhbnN3ZXIgb24gdGhlIFRYIHF1ZXVlLiBVbmZvcnR1
bmF0ZWx5LA0KPiA+ID4gPiB0aGVyZQ0KPiA+ID4gPiBpcyBvbmUNCj4gPiA+ID4gY2FzZSB3aGVy
ZSB0aGUgaG9zdCBzaWRlIHdpbGwgaGFuZyB3YWl0aW5nIGZvciB0aGUgYW5zd2VyIGFuZA0KPiA+
ID4gPiB3aWxsDQo+ID4gPiA+IGVmZmVjdGl2ZWx5IG5ldmVyIHJlY292ZXIuDQo+ID4gPiANCj4g
PiA+IERvIHlvdSBoYXZlIGEgdGVzdCBjYXNlPw0KPiA+IA0KPiA+IFllcyBJIGRvLiBUaGlzIGhh
cyBiZWVuIGEgYnVnIHdlJ3ZlIGJlZW4gaW52ZXN0aWdhdGluZyBvbiBLYXRhDQo+ID4gQ29udGFp
bmVycyBmb3IgcXVpdGUgc29tZSB0aW1lIG5vdy4gVGhpcyB3YXMgaGFwcGVuaW5nIHdoZW4gdXNp
bmcNCj4gPiBLYXRhDQo+ID4gYWxvbmcgd2l0aCBDbG91ZC1IeXBlcnZpc29yICh3aGljaCByZWx5
IG9uIHRoZSBoeWJyaWQgdnNvY2sNCj4gPiBpbXBsZW1lbnRhdGlvbiBmcm9tIEZpcmVjcmFja2Vy
KS4gVGhlIHRoaW5nIGlzLCB0aGlzIGJ1ZyBpcyB2ZXJ5DQo+ID4gaGFyZA0KPiA+IHRvIHJlcHJv
ZHVjZSBhbmQgd2FzIGhhcHBlbmluZyBmb3IgS2F0YSBiZWNhdXNlIG9mIHRoZSBjb25uZWN0aW9u
DQo+ID4gc3RyYXRlZ3kuIFRoZSBrYXRhLXJ1bnRpbWUgdHJpZXMgdG8gY29ubmVjdCBhIG1pbGxp
b24gdGltZXMgYWZ0ZXINCj4gPiBpdA0KPiA+IHN0YXJ0ZWQgdGhlIFZNLCBqdXN0IGhvcGluZyB0
aGUga2F0YS1hZ2VudCB3aWxsIHN0YXJ0IHRvIGxpc3Rlbg0KPiA+IGZyb20NCj4gPiB0aGUgZ3Vl
c3Qgc2lkZSBhdCBzb21lIHBvaW50Lg0KPiANCj4gTWF5YmUgaXMgcmVsYXRlZCB0byBzb21ldGhp
bmcgZWxzZS4gSSB0cmllZCB0aGUgZm9sbG93aW5nIHdoaWNoDQo+IHNob3VsZCBiZQ0KPiB5b3Vy
IGNhc2Ugc2ltcGxpZmllZCAoSUlVQyk6DQo+IA0KPiBndWVzdCQgcHl0aG9uDQo+ICAgICBpbXBv
cnQgc29ja2V0DQo+ICAgICBzID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfVlNPQ0ssIHNvY2tl
dC5TT0NLX1NUUkVBTSkNCj4gICAgIHMuYmluZCgoc29ja2V0LlZNQUREUl9DSURfQU5ZLCAxMjM0
KSkNCj4gDQo+IGhvc3QkIHB5dGhvbg0KPiAgICAgaW1wb3J0IHNvY2tldA0KPiAgICAgcyA9IHNv
Y2tldC5zb2NrZXQoc29ja2V0LkFGX1ZTT0NLLCBzb2NrZXQuU09DS19TVFJFQU0pDQo+ICAgICBz
LmNvbm5lY3QoKDMsIDEyMzQpKQ0KPiANCj4gVHJhY2ViYWNrIChtb3N0IHJlY2VudCBjYWxsIGxh
c3QpOg0KPiAgIEZpbGUgIjxzdGRpbj4iLCBsaW5lIDEsIGluIDxtb2R1bGU+DQo+IFRpbWVvdXRF
cnJvcjogW0Vycm5vIDExMF0gQ29ubmVjdGlvbiB0aW1lZCBvdXQNCg0KWWVzIHRoaXMgaXMgZXhh
Y3RseSB0aGUgc2ltcGxpZmllZCBjYXNlLiBCdXQgdGhhdCdzIHRoZSBwb2ludCwgSSBkb24ndA0K
dGhpbmsgdGhlIHRpbWVvdXQgaXMgdGhlIGJlc3Qgd2F5IHRvIGdvIGhlcmUuIEJlY2F1c2UgdGhp
cyBtZWFucyB0aGF0DQp3aGVuIHdlIHJ1biBpbnRvIHRoaXMgY2FzZSwgdGhlIGhvc3Qgc2lkZSB3
aWxsIHdhaXQgZm9yIHF1aXRlIHNvbWUgdGltZQ0KYmVmb3JlIHJldHJ5aW5nLCB3aGljaCBjYW4g
Y2F1c2UgYSB2ZXJ5IGxvbmcgZGVsYXkgYmVmb3JlIHRoZQ0KY29tbXVuaWNhdGlvbiB3aXRoIHRo
ZSBndWVzdCBpcyBlc3RhYmxpc2hlZC4gQnkgc2ltcGx5IGFuc3dlcmluZyB0aGUNCmhvc3Qgd2l0
aCBhIFJTVCBwYWNrZXQsIHdlIGluZm9ybSBpdCB0aGF0IG5vYm9keSdzIGxpc3RlbmluZyBvbiB0
aGUNCmd1ZXN0IHNpZGUgeWV0LCB0aGVyZWZvcmUgdGhlIGhvc3Qgc2lkZSB3aWxsIGNsb3NlIGFu
ZCB0cnkgYWdhaW4uDQoNCj4gDQo+ID4gPiBJbiB0aGUgaG9zdCwgdGhlIGFmX3Zzb2NrLmM6dnNv
Y2tfc3RyZWFtX2Nvbm5lY3QoKSBzZXQgYSB0aW1lb3V0LA0KPiA+ID4gc28NCj4gPiA+IGlmDQo+
ID4gPiB0aGUgaG9zdCB0cnkgdG8gY29ubmVjdCBiZWZvcmUgdGhlIGd1ZXN0IHN0YXJ0cyBsaXN0
ZW5pbmcsIHRoZQ0KPiA+ID4gY29ubmVjdCgpDQo+ID4gPiBzaG91bGQgcmV0dXJuIEVUSU1FRE9V
VCBpZiB0aGUgZ3Vlc3QgZG9lcyBub3QgYW5zd2VyIGFueXRoaW5nLg0KPiA+ID4gDQo+ID4gPiBB
bnl3YXksIG1heWJlIHRoZSBwYXRjaCBtYWtlIHNlbnNlIGFueXdheSwgY2hhbmdpbmcgYSBiaXQg
dGhlDQo+ID4gPiBkZXNjcmlwdGlvbg0KPiA+ID4gKGlmIHRoZSBob3N0IGNvbm5lY3QoKSByZWNl
aXZlIHRoZSBFVElNRURPVVQpLg0KPiA+ID4gSSdtIGp1c3QgY29uY2VybmVkIHRoYXQgdGhpcyBj
b2RlIGlzIGNvbW1vbiBiZXR3ZWVuIGd1ZXN0IGFuZA0KPiA+ID4gaG9zdC4NCj4gPiA+IElmIGEN
Cj4gPiA+IG1hbGljaW91cyBndWVzdCBzdGFydHMgc2VuZGluZyB1cyB3cm9uZyByZXF1ZXN0cywg
d2Ugc3BlbmQgdGltZQ0KPiA+ID4gc2VuZGluZw0KPiA+ID4gYSByZXNldCBwYWNrZXQuIEJ1dCB3
ZSBhbHJlYWR5IGRvIHRoYXQgaWYgd2UgY2FuJ3QgZmluZCB0aGUgYm91bmQNCj4gPiA+IHNvY2tl
dCwNCj4gPiA+IHNvIGl0IG1pZ2h0IG1ha2Ugc2Vuc2UuDQo+ID4gDQo+ID4gWWVzIEkgZG9uJ3Qg
dGhpbmsgdGhpcyBpcyBnb25uYSBjYXVzZSBtb3JlIHRyb3VibGUsIGJ1dCBhdCBsZWFzdCB3ZQ0K
PiA+IGNhbm5vdCBlbmQgdXAgaW4gdGhpcyB3ZWlyZCBzaXR1YXRpb24gSSBkZXNjcmliZWQuDQo+
IA0KPiBPa2F5LCBidXQgaW4gdGhlIGhvc3QsIHdlIGNhbid0IHRydXN0IHRoZSBndWVzdCB0byBh
bnN3ZXIsIHdlIHNob3VsZA0KPiBoYW5kbGUgdGhpcyBjYXNlIHByb3Blcmx5Lg0KDQpXZWxsIEkg
Y2Fubm90IGFncmVlIG1vcmUgd2l0aCB0aGUgIndlIGNhbm5vdCB0cnVzdCB0aGUgZ3Vlc3QiDQpw
aGlsb3NvcGh5LCBidXQgaW4gdGhpcyBjYXNlIHRoZSB3b3JzdCB0aGluZyB0aGF0IGNhbiBoYXBw
ZW4gaXMgdGhlDQpndWVzdCBzaG9vdGluZyBoaW1zZWxmIGluIHRoZSBmb290IGJlY2F1c2UgaXQg
d291bGQgc2ltcGx5IHByZXZlbnQgdGhlDQpjb25uZWN0aW9uIGZyb20gaGFwcGVuaW5nLg0KDQpB
bmQgSSBhZ3JlZSBzZXR0aW5nIHVwIGEgdGltZW91dCBmcm9tIHRoZSBob3N0IHNpZGUgaXMgc3Rp
bGwgYSBnb29kDQppZGVhIGZvciBwcmV2ZW50aW5nIGZyb20gc3VjaCBET1MgYXR0YWNrLg0KDQpC
dXQgYXMgSSBtZW50aW9uZWQgYWJvdmUsIGluIHRoZSBub3JtYWwgdXNlIGNhc2UsIHRoaXMgYWxs
b3dzIGZvcg0KYmV0dGVyIHJlc3BvbnNpdmVuZXNzIHdoZW4gaXQgY29tZXMgdG8gZXN0YWJsaXNo
IHRoZSBjb25uZWN0aW9uIGFzIGZhc3QNCmFzIHBvc3NpYmxlLg0KDQo+IA0KPiA+IEkgd2FzIGp1
c3Qgbm90IHN1cmUgaWYgdGhlIGZ1bmN0aW9uIHdlIHNob3VsZCB1c2UgdG8gZG8gdGhlIHJlc2V0
DQo+ID4gc2hvdWxkIGJlIHZpcnRpb190cmFuc3BvcnRfcmVzZXRfbm9fc29jaygpIG9yDQo+ID4g
dmlydGlvX3RyYW5zcG9ydF9yZXNldCgpDQo+ID4gc2luY2UgYXQgdGhpcyBwb2ludCB0aGUgc29j
a2V0IGlzIGFscmVhZHkgYm91bmQuDQo+IA0KPiBJIHRoaW5rIHlvdSBjYW4gc2FmZWx5IHVzZSB2
aXJ0aW9fdHJhbnNwb3J0X3Jlc2V0KCkgaW4gdGhpcyBjYXNlLg0KDQpJJ3ZlIGp1c3QgdHJpZWQg
aXQgYW5kIHVuZm9ydHVuYXRlbHkgaXQgZG9lc24ndCB3b3JrLiBJIHRoaW5rIHRoYXQncw0KYmVj
YXVzZSB0aGUgY29ubmVjdGlvbiBoYXMgbm90IGJlZW4gcHJvcGVybHkgZXN0YWJsaXNoZWQgeWV0
LCBzbyB3ZQ0KY2Fubm90IGNvbnNpZGVyIGJlaW5nIGluIHRoaXMgY2FzZS4NClVzaW5nIHZpcnRp
b190cmFuc3BvcnRfcmVzZXRfbm9fc29jaygpIHNlZW1zIGxpa2UgdGhlIGxlc3MgaW50cnVzaXZl
DQpmdW5jdGlvbiBoZXJlLg0KDQo+IA0KPiBNYXliZSB3ZSBjYW4gYWRkIGEgdGVzdCBjYXNlIHRv
IHRoZSB2c29jayB0ZXN0IHN1aXRlDQo+ICh0b29scy90ZXN0aW5nL3Zzb2NrKQ0KPiB0byBzdHJl
c3MgdGhlIGNvbm5lY3QuDQoNCk9oIHllcyB0aGF0J3MgYSBnb29kIGlkZWEgOikNCg0KVGhhbmtz
LA0KU2ViYXN0aWVuDQoNCj4gDQo+IFRoYW5rcywNCj4gU3RlZmFubw0KPiANCi0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LQpJbnRlbCBDb3Jwb3JhdGlvbiBTQVMgKEZyZW5jaCBzaW1wbGlmaWVkIGpvaW50IHN0b2NrIGNv
bXBhbnkpClJlZ2lzdGVyZWQgaGVhZHF1YXJ0ZXJzOiAiTGVzIE1vbnRhbGV0cyItIDIsIHJ1ZSBk
ZSBQYXJpcywgCjkyMTk2IE1ldWRvbiBDZWRleCwgRnJhbmNlClJlZ2lzdHJhdGlvbiBOdW1iZXI6
ICAzMDIgNDU2IDE5OSBSLkMuUy4gTkFOVEVSUkUKQ2FwaXRhbDogNCw1NzIsMDAwIEV1cm9zCgpU
aGlzIGUtbWFpbCBhbmQgYW55IGF0dGFjaG1lbnRzIG1heSBjb250YWluIGNvbmZpZGVudGlhbCBt
YXRlcmlhbCBmb3IKdGhlIHNvbGUgdXNlIG9mIHRoZSBpbnRlbmRlZCByZWNpcGllbnQocykuIEFu
eSByZXZpZXcgb3IgZGlzdHJpYnV0aW9uCmJ5IG90aGVycyBpcyBzdHJpY3RseSBwcm9oaWJpdGVk
LiBJZiB5b3UgYXJlIG5vdCB0aGUgaW50ZW5kZWQKcmVjaXBpZW50LCBwbGVhc2UgY29udGFjdCB0
aGUgc2VuZGVyIGFuZCBkZWxldGUgYWxsIGNvcGllcy4K

