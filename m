Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id F378244D9C
	for <lists+netdev@lfdr.de>; Thu, 13 Jun 2019 22:39:54 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1729744AbfFMUjr (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Thu, 13 Jun 2019 16:39:47 -0400
Received: from mail-eopbgr80082.outbound.protection.outlook.com ([40.107.8.82]:2635
        "EHLO EUR04-VI1-obe.outbound.protection.outlook.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1729558AbfFMUjr (ORCPT <rfc822;netdev@vger.kernel.org>);
        Thu, 13 Jun 2019 16:39:47 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=Mellanox.com;
 s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=dZhnx14x1xVVmQNJ+KlU3Vo9ugSx5PgT2v4aTbQXuRM=;
 b=mYKMpwPUCjuTtoaI21fcLqy3qigKrAcS0/NknLCd8ofbZTqGbYLC1BHCAH24lpyMLpwGBejo+lPnRbX80ppdue76e4sMx7htJUtlIaouSa4fXk0/FDsSwl+nAnuIIUFbbLoGnEg7n+sBNndy2y3jtwpXvM5qMhXt+2U3prfdyXM=
Received: from DB6PR0501MB2759.eurprd05.prod.outlook.com (10.172.227.7) by
 DB6PR0501MB2629.eurprd05.prod.outlook.com (10.172.225.11) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.1965.15; Thu, 13 Jun 2019 20:39:26 +0000
Received: from DB6PR0501MB2759.eurprd05.prod.outlook.com
 ([fe80::a901:6951:59de:3278]) by DB6PR0501MB2759.eurprd05.prod.outlook.com
 ([fe80::a901:6951:59de:3278%2]) with mapi id 15.20.1987.012; Thu, 13 Jun 2019
 20:39:26 +0000
From:   Saeed Mahameed <saeedm@mellanox.com>
To:     "David S. Miller" <davem@davemloft.net>
CC:     "netdev@vger.kernel.org" <netdev@vger.kernel.org>,
        Jiri Pirko <jiri@mellanox.com>,
        Feras Daoud <ferasda@mellanox.com>,
        Moshe Shemesh <moshe@mellanox.com>,
        Daniel Jurgens <danielj@mellanox.com>,
        Alex Vesker <valex@mellanox.com>,
        Saeed Mahameed <saeedm@mellanox.com>
Subject: [net-next v2 06/15] net/mlx5: Handle SW reset of FW in error flow
Thread-Topic: [net-next v2 06/15] net/mlx5: Handle SW reset of FW in error
 flow
Thread-Index: AQHVIigXMdC0F5aeG0OBv1PLXWzOmA==
Date:   Thu, 13 Jun 2019 20:39:26 +0000
Message-ID: <20190613203825.31049-7-saeedm@mellanox.com>
References: <20190613203825.31049-1-saeedm@mellanox.com>
In-Reply-To: <20190613203825.31049-1-saeedm@mellanox.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-mailer: git-send-email 2.21.0
x-originating-ip: [209.116.155.178]
x-clientproxiedby: BYAPR02CA0020.namprd02.prod.outlook.com
 (2603:10b6:a02:ee::33) To DB6PR0501MB2759.eurprd05.prod.outlook.com
 (2603:10a6:4:84::7)
authentication-results: spf=none (sender IP is )
 smtp.mailfrom=saeedm@mellanox.com; 
x-ms-exchange-messagesentrepresentingtype: 1
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 353087ab-eda0-4c96-55a4-08d6f03f396a
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0;PCL:0;RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(4618075)(2017052603328)(7193020);SRVR:DB6PR0501MB2629;
x-ms-traffictypediagnostic: DB6PR0501MB2629:
x-microsoft-antispam-prvs: <DB6PR0501MB262945A21E98FA60A17C0C6ABEEF0@DB6PR0501MB2629.eurprd05.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:7691;
x-forefront-prvs: 0067A8BA2A
x-forefront-antispam-report: SFV:NSPM;SFS:(10009020)(396003)(136003)(366004)(39860400002)(376002)(346002)(199004)(189003)(8676002)(6916009)(81156014)(81166006)(2616005)(316002)(11346002)(25786009)(4326008)(6512007)(86362001)(476003)(486006)(8936002)(6436002)(446003)(50226002)(6486002)(66066001)(36756003)(26005)(305945005)(7736002)(186003)(73956011)(66946007)(64756008)(66446008)(66556008)(66476007)(53936002)(6116002)(256004)(14444005)(3846002)(1076003)(71190400001)(71200400001)(2906002)(478600001)(99286004)(52116002)(14454004)(30864003)(102836004)(54906003)(76176011)(5660300002)(6506007)(107886003)(386003)(68736007);DIR:OUT;SFP:1101;SCL:1;SRVR:DB6PR0501MB2629;H:DB6PR0501MB2759.eurprd05.prod.outlook.com;FPR:;SPF:None;LANG:en;PTR:InfoNoRecords;A:1;MX:1;
received-spf: None (protection.outlook.com: mellanox.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: 6taVsBbzlZGyHdPdeZbINtyynxV348B1rsNgNMZBjX00Of2qvDtO4oVzQQdxNTAKcDXMu+E7ElQD7UHooFUvEs1hx20lhhXU08Fc4v8z0Fj59GcXNPXJFl8G4SE/vlSLHYmhUgP8T8UbxAcVY14FpvS1/MApG9t7Yna6Of7QybaSbutpTxCCuYzHtoqiXk88FTB2yYBV1byy+eAEvXj5+XlcjJY0ZbSKqAnVJo6efwFU5G8OUOWTiEhcQIZAzQ45+v8cwkVR9WAJ+pGs4tdOCy5J1go3K0aEQyeu7LUiu7pkodjHmlOOupVfiUmz8XrRZGHVYj4PgotvhE9mp42Uz+Ds2cwLqGnaEZkmxfe5nyx/fMHBa5dcMgEExw70jBdNwiyPfW5M1ylvNfV+7BEu9dgAWgKnQWd/dVxe9Wo0iKw=
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-OriginatorOrg: Mellanox.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 353087ab-eda0-4c96-55a4-08d6f03f396a
X-MS-Exchange-CrossTenant-originalarrivaltime: 13 Jun 2019 20:39:26.2474
 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: a652971c-7d2e-4d9b-a6a4-d149256f461b
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: saeedm@mellanox.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DB6PR0501MB2629
Sender: netdev-owner@vger.kernel.org
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

RnJvbTogRmVyYXMgRGFvdWQgPGZlcmFzZGFAbWVsbGFub3guY29tPg0KDQpOZXcgbWx4NSBhZGFw
dGVycyBhbGxvdyB0aGUgZHJpdmVyIHRvIHJlc2V0IHRoZSBGVyBpbiB0aGUgZXZlbnQgb2YgYW4N
CmVycm9yLCB0aGlzIGFjdGlvbiBjYWxsZWQgIlNXIFJlc2V0Ii4gV2hlbiBhbiBTVyByZXNldCBp
cyBpc3N1ZWQgb24gYW55DQpQRiBhbGwgUEZzIGVudGVyIHJlc2V0IHN0YXRlIHdoaWNoIGlzIGEg
cmVjb3ZlcmFibGUgY29uZGl0aW9uLiBUaGUNCmV4aXN0aW5nIHJlY292ZXJ5IGZsb3cgd2FzIGRl
c2lnbmVkIHRvIGFsbG93IHRoZSByZWNvdmVyeSBvZiBhIFZGIGFmdGVyDQphIFBGIGRyaXZlciBy
ZWxvYWQuIFRoaXMgcGF0Y2ggYWRkcyB0aGUgc3cgcmVzZXQgdG8gdGhlIE5JQyBzdGF0ZXMNCmFz
IGEgcHJlcGFyYXRpb24gZm9yIHN3IHJlc2V0IGhhbmRsaW5nLg0KDQpXaGVuIGEgc29mdHdhcmUg
cmVzZXQgaXMgaXNzdWVkIHRoZSBmb2xsb3dpbmcgb2NjdXJzOg0KMS4gVGhlIE5JQyBpbnRlcmZh
Y2UgbW9kZSBpcyBzZXQgdG8gNyB3aGlsZSB0aGUgcmVzZXQgaXMgaW4gcHJvZ3Jlc3MuDQoyLiBP
bmNlIHRoZSByZXNldCBjb21wbGV0ZXMgdGhlIE5JQyBpbnRlcmZhY2UgbW9kZSBpcyBzZXQgdG8g
MS4NCg0KU2lnbmVkLW9mZi1ieTogRmVyYXMgRGFvdWQgPGZlcmFzZGFAbWVsbGFub3guY29tPg0K
U2lnbmVkLW9mZi1ieTogTW9zaGUgU2hlbWVzaCA8bW9zaGVAbWVsbGFub3guY29tPg0KU2lnbmVk
LW9mZi1ieTogRGFuaWVsIEp1cmdlbnMgPGRhbmllbGpAbWVsbGFub3guY29tPg0KUmV2aWV3ZWQt
Ynk6IEFsZXggVmVza2VyIDx2YWxleEBtZWxsYW5veC5jb20+DQpTaWduZWQtb2ZmLWJ5OiBTYWVl
ZCBNYWhhbWVlZCA8c2FlZWRtQG1lbGxhbm94LmNvbT4NCi0tLQ0KIC4uLi9ldGhlcm5ldC9tZWxs
YW5veC9tbHg1L2NvcmUvZW5fc2VsZnRlc3QuYyB8ICAgMiArLQ0KIC4uLi9uZXQvZXRoZXJuZXQv
bWVsbGFub3gvbWx4NS9jb3JlL2hlYWx0aC5jICB8IDEwNSArKysrKysrKy0tLS0tLS0tLS0NCiAu
Li4vbmV0L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9tYWluLmMgICAgfCAgIDIgKy0NCiAu
Li4vZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL21seDVfY29yZS5oICAgfCAgIDIgKy0NCiBp
bmNsdWRlL2xpbnV4L21seDUvZHJpdmVyLmggICAgICAgICAgICAgICAgICAgfCAgIDIgKy0NCiA1
IGZpbGVzIGNoYW5nZWQsIDQ4IGluc2VydGlvbnMoKyksIDY1IGRlbGV0aW9ucygtKQ0KDQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2VuX3NlbGZ0
ZXN0LmMgYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1L2NvcmUvZW5fc2VsZnRl
c3QuYw0KaW5kZXggNDM4MmVmODU0ODhjLi44NDBlYzk0NWNjYmEgMTAwNjQ0DQotLS0gYS9kcml2
ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1L2NvcmUvZW5fc2VsZnRlc3QuYw0KKysrIGIv
ZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2VuX3NlbGZ0ZXN0LmMNCkBA
IC02NCw3ICs2NCw3IEBAIHN0YXRpYyBpbnQgbWx4NWVfdGVzdF9oZWFsdGhfaW5mbyhzdHJ1Y3Qg
bWx4NWVfcHJpdiAqcHJpdikNCiB7DQogCXN0cnVjdCBtbHg1X2NvcmVfaGVhbHRoICpoZWFsdGgg
PSAmcHJpdi0+bWRldi0+cHJpdi5oZWFsdGg7DQogDQotCXJldHVybiBoZWFsdGgtPnNpY2sgPyAx
IDogMDsNCisJcmV0dXJuIGhlYWx0aC0+ZmF0YWxfZXJyb3IgPyAxIDogMDsNCiB9DQogDQogc3Rh
dGljIGludCBtbHg1ZV90ZXN0X2xpbmtfc3RhdGUoc3RydWN0IG1seDVlX3ByaXYgKnByaXYpDQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2hlYWx0
aC5jIGIvZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2hlYWx0aC5jDQpp
bmRleCBhMjY1NmY0MDA4ZDkuLjczN2U2ZDU1MDc3NSAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvbmV0
L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9oZWFsdGguYw0KKysrIGIvZHJpdmVycy9uZXQv
ZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2hlYWx0aC5jDQpAQCAtNjIsMTIgKzYyLDE4IEBA
IGVudW0gew0KIA0KIGVudW0gew0KIAlNTFg1X0RST1BfTkVXX0hFQUxUSF9XT1JLLA0KLQlNTFg1
X0RST1BfTkVXX1JFQ09WRVJZX1dPUkssDQorfTsNCisNCitlbnVtICB7DQorCU1MWDVfU0VOU09S
X05PX0VSUgkJPSAwLA0KKwlNTFg1X1NFTlNPUl9QQ0lfQ09NTV9FUlIJPSAxLA0KKwlNTFg1X1NF
TlNPUl9OSUNfRElTQUJMRUQJPSAyLA0KKwlNTFg1X1NFTlNPUl9OSUNfU1dfUkVTRVQJPSAzLA0K
IH07DQogDQogdTggbWx4NV9nZXRfbmljX3N0YXRlKHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYp
DQogew0KLQlyZXR1cm4gKGlvcmVhZDMyYmUoJmRldi0+aXNlZy0+Y21kcV9hZGRyX2xfc3opID4+
IDgpICYgMzsNCisJcmV0dXJuIChpb3JlYWQzMmJlKCZkZXYtPmlzZWctPmNtZHFfYWRkcl9sX3N6
KSA+PiA4KSAmIDc7DQogfQ0KIA0KIHZvaWQgbWx4NV9zZXRfbmljX3N0YXRlKHN0cnVjdCBtbHg1
X2NvcmVfZGV2ICpkZXYsIHU4IHN0YXRlKQ0KQEAgLTgwLDE4ICs4NiwyNSBAQCB2b2lkIG1seDVf
c2V0X25pY19zdGF0ZShzdHJ1Y3QgbWx4NV9jb3JlX2RldiAqZGV2LCB1OCBzdGF0ZSkNCiAJCSAg
ICAmZGV2LT5pc2VnLT5jbWRxX2FkZHJfbF9zeik7DQogfQ0KIA0KLXN0YXRpYyBpbnQgaW5fZmF0
YWwoc3RydWN0IG1seDVfY29yZV9kZXYgKmRldikNCitzdGF0aWMgYm9vbCBzZW5zb3JfcGNpX25v
dF93b3JraW5nKHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYpDQogew0KIAlzdHJ1Y3QgbWx4NV9j
b3JlX2hlYWx0aCAqaGVhbHRoID0gJmRldi0+cHJpdi5oZWFsdGg7DQogCXN0cnVjdCBoZWFsdGhf
YnVmZmVyIF9faW9tZW0gKmggPSBoZWFsdGgtPmhlYWx0aDsNCiANCi0JaWYgKG1seDVfZ2V0X25p
Y19zdGF0ZShkZXYpID09IE1MWDVfTklDX0lGQ19ESVNBQkxFRCkNCi0JCXJldHVybiAxOw0KKwkv
KiBPZmZsaW5lIFBDSSByZWFkcyByZXR1cm4gMHhmZmZmZmZmZiAqLw0KKwlyZXR1cm4gKGlvcmVh
ZDMyYmUoJmgtPmZ3X3ZlcikgPT0gMHhmZmZmZmZmZik7DQorfQ0KIA0KLQlpZiAoaW9yZWFkMzJi
ZSgmaC0+ZndfdmVyKSA9PSAweGZmZmZmZmZmKQ0KLQkJcmV0dXJuIDE7DQorc3RhdGljIHUzMiBj
aGVja19mYXRhbF9zZW5zb3JzKHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYpDQorew0KKwlpZiAo
c2Vuc29yX3BjaV9ub3Rfd29ya2luZyhkZXYpKQ0KKwkJcmV0dXJuIE1MWDVfU0VOU09SX1BDSV9D
T01NX0VSUjsNCisJaWYgKG1seDVfZ2V0X25pY19zdGF0ZShkZXYpID09IE1MWDVfTklDX0lGQ19E
SVNBQkxFRCkNCisJCXJldHVybiBNTFg1X1NFTlNPUl9OSUNfRElTQUJMRUQ7DQorCWlmIChtbHg1
X2dldF9uaWNfc3RhdGUoZGV2KSA9PSBNTFg1X05JQ19JRkNfU1dfUkVTRVQpDQorCQlyZXR1cm4g
TUxYNV9TRU5TT1JfTklDX1NXX1JFU0VUOw0KIA0KLQlyZXR1cm4gMDsNCisJcmV0dXJuIE1MWDVf
U0VOU09SX05PX0VSUjsNCiB9DQogDQogdm9pZCBtbHg1X2VudGVyX2Vycm9yX3N0YXRlKHN0cnVj
dCBtbHg1X2NvcmVfZGV2ICpkZXYsIGJvb2wgZm9yY2UpDQpAQCAtMTAxLDcgKzExNCw4IEBAIHZv
aWQgbWx4NV9lbnRlcl9lcnJvcl9zdGF0ZShzdHJ1Y3QgbWx4NV9jb3JlX2RldiAqZGV2LCBib29s
IGZvcmNlKQ0KIAkJZ290byB1bmxvY2s7DQogDQogCW1seDVfY29yZV9lcnIoZGV2LCAic3RhcnRc
biIpOw0KLQlpZiAocGNpX2NoYW5uZWxfb2ZmbGluZShkZXYtPnBkZXYpIHx8IGluX2ZhdGFsKGRl
dikgfHwgZm9yY2UpIHsNCisJaWYgKHBjaV9jaGFubmVsX29mZmxpbmUoZGV2LT5wZGV2KSB8fA0K
KwkgICAgZGV2LT5wcml2LmhlYWx0aC5mYXRhbF9lcnJvciAhPSBNTFg1X1NFTlNPUl9OT19FUlIg
fHwgZm9yY2UpIHsNCiAJCWRldi0+c3RhdGUgPSBNTFg1X0RFVklDRV9TVEFURV9JTlRFUk5BTF9F
UlJPUjsNCiAJCW1seDVfY21kX2ZsdXNoKGRldik7DQogCX0NCkBAIC0xMzcsMzggKzE1MSwxNCBA
QCBzdGF0aWMgdm9pZCBtbHg1X2hhbmRsZV9iYWRfc3RhdGUoc3RydWN0IG1seDVfY29yZV9kZXYg
KmRldikNCiAJbWx4NV9kaXNhYmxlX2RldmljZShkZXYpOw0KIH0NCiANCi1zdGF0aWMgdm9pZCBo
ZWFsdGhfcmVjb3ZlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspDQotew0KLQlzdHJ1Y3QgbWx4
NV9jb3JlX2hlYWx0aCAqaGVhbHRoOw0KLQlzdHJ1Y3QgZGVsYXllZF93b3JrICpkd29yazsNCi0J
c3RydWN0IG1seDVfY29yZV9kZXYgKmRldjsNCi0Jc3RydWN0IG1seDVfcHJpdiAqcHJpdjsNCi0J
dTggbmljX3N0YXRlOw0KLQ0KLQlkd29yayA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgZGVs
YXllZF93b3JrLCB3b3JrKTsNCi0JaGVhbHRoID0gY29udGFpbmVyX29mKGR3b3JrLCBzdHJ1Y3Qg
bWx4NV9jb3JlX2hlYWx0aCwgcmVjb3Zlcl93b3JrKTsNCi0JcHJpdiA9IGNvbnRhaW5lcl9vZiho
ZWFsdGgsIHN0cnVjdCBtbHg1X3ByaXYsIGhlYWx0aCk7DQotCWRldiA9IGNvbnRhaW5lcl9vZihw
cml2LCBzdHJ1Y3QgbWx4NV9jb3JlX2RldiwgcHJpdik7DQotDQotCW5pY19zdGF0ZSA9IG1seDVf
Z2V0X25pY19zdGF0ZShkZXYpOw0KLQlpZiAobmljX3N0YXRlID09IE1MWDVfTklDX0lGQ19JTlZB
TElEKSB7DQotCQltbHg1X2NvcmVfZXJyKGRldiwgImhlYWx0aCByZWNvdmVyeSBmbG93IGFib3J0
ZWQgc2luY2UgdGhlIG5pYyBzdGF0ZSBpcyBpbnZhbGlkXG4iKTsNCi0JCXJldHVybjsNCi0JfQ0K
LQ0KLQltbHg1X2NvcmVfZXJyKGRldiwgInN0YXJ0aW5nIGhlYWx0aCByZWNvdmVyeSBmbG93XG4i
KTsNCi0JbWx4NV9yZWNvdmVyX2RldmljZShkZXYpOw0KLX0NCi0NCiAvKiBIb3cgbXVjaCB0aW1l
IHRvIHdhaXQgdW50aWwgaGVhbHRoIHJlc2V0dGluZyB0aGUgZHJpdmVyIChpbiBtc2VjcykgKi8N
Ci0jZGVmaW5lIE1MWDVfUkVDT1ZFUllfREVMQVlfTVNFQ1MgNjAwMDANCisjZGVmaW5lIE1MWDVf
UkVDT1ZFUllfV0FJVF9NU0VDUyA2MDAwMA0KIHN0YXRpYyB2b2lkIGhlYWx0aF9jYXJlKHN0cnVj
dCB3b3JrX3N0cnVjdCAqd29yaykNCiB7DQotCXVuc2lnbmVkIGxvbmcgcmVjb3Zlcl9kZWxheSA9
IG1zZWNzX3RvX2ppZmZpZXMoTUxYNV9SRUNPVkVSWV9ERUxBWV9NU0VDUyk7DQogCXN0cnVjdCBt
bHg1X2NvcmVfaGVhbHRoICpoZWFsdGg7DQogCXN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXY7DQog
CXN0cnVjdCBtbHg1X3ByaXYgKnByaXY7DQotCXVuc2lnbmVkIGxvbmcgZmxhZ3M7DQorCXVuc2ln
bmVkIGxvbmcgZW5kOw0KIA0KIAloZWFsdGggPSBjb250YWluZXJfb2Yod29yaywgc3RydWN0IG1s
eDVfY29yZV9oZWFsdGgsIHdvcmspOw0KIAlwcml2ID0gY29udGFpbmVyX29mKGhlYWx0aCwgc3Ry
dWN0IG1seDVfcHJpdiwgaGVhbHRoKTsNCkBAIC0xNzYsMTMgKzE2NiwxOCBAQCBzdGF0aWMgdm9p
ZCBoZWFsdGhfY2FyZShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspDQogCW1seDVfY29yZV93YXJu
KGRldiwgImhhbmRsaW5nIGJhZCBkZXZpY2UgaGVyZVxuIik7DQogCW1seDVfaGFuZGxlX2JhZF9z
dGF0ZShkZXYpOw0KIA0KLQlzcGluX2xvY2tfaXJxc2F2ZSgmaGVhbHRoLT53cV9sb2NrLCBmbGFn
cyk7DQotCWlmICghdGVzdF9iaXQoTUxYNV9EUk9QX05FV19SRUNPVkVSWV9XT1JLLCAmaGVhbHRo
LT5mbGFncykpDQotCQlzY2hlZHVsZV9kZWxheWVkX3dvcmsoJmhlYWx0aC0+cmVjb3Zlcl93b3Jr
LCByZWNvdmVyX2RlbGF5KTsNCi0JZWxzZQ0KLQkJbWx4NV9jb3JlX2VycihkZXYsDQotCQkJICAg
ICAgIm5ldyBoZWFsdGggd29ya3MgYXJlIG5vdCBwZXJtaXR0ZWQgYXQgdGhpcyBzdGFnZVxuIik7
DQotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmhlYWx0aC0+d3FfbG9jaywgZmxhZ3MpOw0KKwll
bmQgPSBqaWZmaWVzICsgbXNlY3NfdG9famlmZmllcyhNTFg1X1JFQ09WRVJZX1dBSVRfTVNFQ1Mp
Ow0KKwl3aGlsZSAoc2Vuc29yX3BjaV9ub3Rfd29ya2luZyhkZXYpKSB7DQorCQlpZiAodGltZV9h
ZnRlcihqaWZmaWVzLCBlbmQpKSB7DQorCQkJbWx4NV9jb3JlX2VycihkZXYsDQorCQkJCSAgICAg
ICJoZWFsdGggcmVjb3ZlcnkgZmxvdyBhYm9ydGVkLCBQQ0kgcmVhZHMgc3RpbGwgbm90IHdvcmtp
bmdcbiIpOw0KKwkJCXJldHVybjsNCisJCX0NCisJCW1zbGVlcCgxMDApOw0KKwl9DQorDQorCW1s
eDVfY29yZV9lcnIoZGV2LCAic3RhcnRpbmcgaGVhbHRoIHJlY292ZXJ5IGZsb3dcbiIpOw0KKwlt
bHg1X3JlY292ZXJfZGV2aWNlKGRldik7DQogfQ0KIA0KIHN0YXRpYyBjb25zdCBjaGFyICpoc3lu
ZF9zdHIodTggc3luZCkNCkBAIC0yNzQsNiArMjY5LDcgQEAgc3RhdGljIHZvaWQgcG9sbF9oZWFs
dGgoc3RydWN0IHRpbWVyX2xpc3QgKnQpDQogew0KIAlzdHJ1Y3QgbWx4NV9jb3JlX2RldiAqZGV2
ID0gZnJvbV90aW1lcihkZXYsIHQsIHByaXYuaGVhbHRoLnRpbWVyKTsNCiAJc3RydWN0IG1seDVf
Y29yZV9oZWFsdGggKmhlYWx0aCA9ICZkZXYtPnByaXYuaGVhbHRoOw0KKwl1MzIgZmF0YWxfZXJy
b3I7DQogCXUzMiBjb3VudDsNCiANCiAJaWYgKGRldi0+c3RhdGUgPT0gTUxYNV9ERVZJQ0VfU1RB
VEVfSU5URVJOQUxfRVJST1IpDQpAQCAtMjkxLDggKzI4NywxMSBAQCBzdGF0aWMgdm9pZCBwb2xs
X2hlYWx0aChzdHJ1Y3QgdGltZXJfbGlzdCAqdCkNCiAJCXByaW50X2hlYWx0aF9pbmZvKGRldik7
DQogCX0NCiANCi0JaWYgKGluX2ZhdGFsKGRldikgJiYgIWhlYWx0aC0+c2ljaykgew0KLQkJaGVh
bHRoLT5zaWNrID0gdHJ1ZTsNCisJZmF0YWxfZXJyb3IgPSBjaGVja19mYXRhbF9zZW5zb3JzKGRl
dik7DQorDQorCWlmIChmYXRhbF9lcnJvciAmJiAhaGVhbHRoLT5mYXRhbF9lcnJvcikgew0KKwkJ
bWx4NV9jb3JlX2VycihkZXYsICJGYXRhbCBlcnJvciAldSBkZXRlY3RlZFxuIiwgZmF0YWxfZXJy
b3IpOw0KKwkJZGV2LT5wcml2LmhlYWx0aC5mYXRhbF9lcnJvciA9IGZhdGFsX2Vycm9yOw0KIAkJ
cHJpbnRfaGVhbHRoX2luZm8oZGV2KTsNCiAJCW1seDVfdHJpZ2dlcl9oZWFsdGhfd29yayhkZXYp
Ow0KIAl9DQpAQCAtMzA2LDkgKzMwNSw4IEBAIHZvaWQgbWx4NV9zdGFydF9oZWFsdGhfcG9sbChz
dHJ1Y3QgbWx4NV9jb3JlX2RldiAqZGV2KQ0KIAlzdHJ1Y3QgbWx4NV9jb3JlX2hlYWx0aCAqaGVh
bHRoID0gJmRldi0+cHJpdi5oZWFsdGg7DQogDQogCXRpbWVyX3NldHVwKCZoZWFsdGgtPnRpbWVy
LCBwb2xsX2hlYWx0aCwgMCk7DQotCWhlYWx0aC0+c2ljayA9IDA7DQorCWhlYWx0aC0+ZmF0YWxf
ZXJyb3IgPSBNTFg1X1NFTlNPUl9OT19FUlI7DQogCWNsZWFyX2JpdChNTFg1X0RST1BfTkVXX0hF
QUxUSF9XT1JLLCAmaGVhbHRoLT5mbGFncyk7DQotCWNsZWFyX2JpdChNTFg1X0RST1BfTkVXX1JF
Q09WRVJZX1dPUkssICZoZWFsdGgtPmZsYWdzKTsNCiAJaGVhbHRoLT5oZWFsdGggPSAmZGV2LT5p
c2VnLT5oZWFsdGg7DQogCWhlYWx0aC0+aGVhbHRoX2NvdW50ZXIgPSAmZGV2LT5pc2VnLT5oZWFs
dGhfY291bnRlcjsNCiANCkBAIC0zMjQsNyArMzIyLDYgQEAgdm9pZCBtbHg1X3N0b3BfaGVhbHRo
X3BvbGwoc3RydWN0IG1seDVfY29yZV9kZXYgKmRldiwgYm9vbCBkaXNhYmxlX2hlYWx0aCkNCiAJ
aWYgKGRpc2FibGVfaGVhbHRoKSB7DQogCQlzcGluX2xvY2tfaXJxc2F2ZSgmaGVhbHRoLT53cV9s
b2NrLCBmbGFncyk7DQogCQlzZXRfYml0KE1MWDVfRFJPUF9ORVdfSEVBTFRIX1dPUkssICZoZWFs
dGgtPmZsYWdzKTsNCi0JCXNldF9iaXQoTUxYNV9EUk9QX05FV19SRUNPVkVSWV9XT1JLLCAmaGVh
bHRoLT5mbGFncyk7DQogCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZoZWFsdGgtPndxX2xvY2ss
IGZsYWdzKTsNCiAJfQ0KIA0KQEAgLTMzOCwyMyArMzM1LDEwIEBAIHZvaWQgbWx4NV9kcmFpbl9o
ZWFsdGhfd3Eoc3RydWN0IG1seDVfY29yZV9kZXYgKmRldikNCiANCiAJc3Bpbl9sb2NrX2lycXNh
dmUoJmhlYWx0aC0+d3FfbG9jaywgZmxhZ3MpOw0KIAlzZXRfYml0KE1MWDVfRFJPUF9ORVdfSEVB
TFRIX1dPUkssICZoZWFsdGgtPmZsYWdzKTsNCi0Jc2V0X2JpdChNTFg1X0RST1BfTkVXX1JFQ09W
RVJZX1dPUkssICZoZWFsdGgtPmZsYWdzKTsNCiAJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaGVh
bHRoLT53cV9sb2NrLCBmbGFncyk7DQotCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmaGVhbHRo
LT5yZWNvdmVyX3dvcmspOw0KIAljYW5jZWxfd29ya19zeW5jKCZoZWFsdGgtPndvcmspOw0KIH0N
CiANCi12b2lkIG1seDVfZHJhaW5faGVhbHRoX3JlY292ZXJ5KHN0cnVjdCBtbHg1X2NvcmVfZGV2
ICpkZXYpDQotew0KLQlzdHJ1Y3QgbWx4NV9jb3JlX2hlYWx0aCAqaGVhbHRoID0gJmRldi0+cHJp
di5oZWFsdGg7DQotCXVuc2lnbmVkIGxvbmcgZmxhZ3M7DQotDQotCXNwaW5fbG9ja19pcnFzYXZl
KCZoZWFsdGgtPndxX2xvY2ssIGZsYWdzKTsNCi0Jc2V0X2JpdChNTFg1X0RST1BfTkVXX1JFQ09W
RVJZX1dPUkssICZoZWFsdGgtPmZsYWdzKTsNCi0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaGVh
bHRoLT53cV9sb2NrLCBmbGFncyk7DQotCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmZGV2LT5w
cml2LmhlYWx0aC5yZWNvdmVyX3dvcmspOw0KLX0NCi0NCiB2b2lkIG1seDVfaGVhbHRoX2ZsdXNo
KHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYpDQogew0KIAlzdHJ1Y3QgbWx4NV9jb3JlX2hlYWx0
aCAqaGVhbHRoID0gJmRldi0+cHJpdi5oZWFsdGg7DQpAQCAtMzg3LDcgKzM3MSw2IEBAIGludCBt
bHg1X2hlYWx0aF9pbml0KHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYpDQogCQlyZXR1cm4gLUVO
T01FTTsNCiAJc3Bpbl9sb2NrX2luaXQoJmhlYWx0aC0+d3FfbG9jayk7DQogCUlOSVRfV09SSygm
aGVhbHRoLT53b3JrLCBoZWFsdGhfY2FyZSk7DQotCUlOSVRfREVMQVlFRF9XT1JLKCZoZWFsdGgt
PnJlY292ZXJfd29yaywgaGVhbHRoX3JlY292ZXIpOw0KIA0KIAlyZXR1cm4gMDsNCiB9DQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL21haW4uYyBi
L2RyaXZlcnMvbmV0L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9tYWluLmMNCmluZGV4IGM3
MGU5NzA3MWI4Ny4uZmQwZTI5NDljNGYyIDEwMDY0NA0KLS0tIGEvZHJpdmVycy9uZXQvZXRoZXJu
ZXQvbWVsbGFub3gvbWx4NS9jb3JlL21haW4uYw0KKysrIGIvZHJpdmVycy9uZXQvZXRoZXJuZXQv
bWVsbGFub3gvbWx4NS9jb3JlL21haW4uYw0KQEAgLTExOTEsNyArMTE5MSw3IEBAIHN0YXRpYyBp
bnQgbWx4NV91bmxvYWRfb25lKHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYsIGJvb2wgY2xlYW51
cCkNCiAJaW50IGVyciA9IDA7DQogDQogCWlmIChjbGVhbnVwKQ0KLQkJbWx4NV9kcmFpbl9oZWFs
dGhfcmVjb3ZlcnkoZGV2KTsNCisJCW1seDVfZHJhaW5faGVhbHRoX3dxKGRldik7DQogDQogCW11
dGV4X2xvY2soJmRldi0+aW50Zl9zdGF0ZV9tdXRleCk7DQogCWlmICghdGVzdF9iaXQoTUxYNV9J
TlRFUkZBQ0VfU1RBVEVfVVAsICZkZXYtPmludGZfc3RhdGUpKSB7DQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL21seDVfY29yZS5oIGIvZHJpdmVy
cy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL21seDVfY29yZS5oDQppbmRleCBkNGRk
OGMxYWU1NWMuLjk3ZjhjZjY3Y2VkMCAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvbmV0L2V0aGVybmV0
L21lbGxhbm94L21seDUvY29yZS9tbHg1X2NvcmUuaA0KKysrIGIvZHJpdmVycy9uZXQvZXRoZXJu
ZXQvbWVsbGFub3gvbWx4NS9jb3JlL21seDVfY29yZS5oDQpAQCAtMjE0LDcgKzIxNCw3IEBAIGVu
dW0gew0KIAlNTFg1X05JQ19JRkNfRlVMTAkJPSAwLA0KIAlNTFg1X05JQ19JRkNfRElTQUJMRUQJ
CT0gMSwNCiAJTUxYNV9OSUNfSUZDX05PX0RSQU1fTklDCT0gMiwNCi0JTUxYNV9OSUNfSUZDX0lO
VkFMSUQJCT0gMw0KKwlNTFg1X05JQ19JRkNfU1dfUkVTRVQJCT0gNw0KIH07DQogDQogdTggbWx4
NV9nZXRfbmljX3N0YXRlKHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYpOw0KZGlmZiAtLWdpdCBh
L2luY2x1ZGUvbGludXgvbWx4NS9kcml2ZXIuaCBiL2luY2x1ZGUvbGludXgvbWx4NS9kcml2ZXIu
aA0KaW5kZXggNGFlNTMzYjNkYTA3Li5jYzdmZDhlNjI4NDQgMTAwNjQ0DQotLS0gYS9pbmNsdWRl
L2xpbnV4L21seDUvZHJpdmVyLmgNCisrKyBiL2luY2x1ZGUvbGludXgvbWx4NS9kcml2ZXIuaA0K
QEAgLTQzNSw2ICs0MzUsNyBAQCBzdHJ1Y3QgbWx4NV9jb3JlX2hlYWx0aCB7DQogCXUzMgkJCQlw
cmV2Ow0KIAlpbnQJCQkJbWlzc19jb3VudGVyOw0KIAlib29sCQkJCXNpY2s7DQorCXUzMgkJCQlm
YXRhbF9lcnJvcjsNCiAJdTMyCQkJCWNyZHVtcF9zaXplOw0KIAkvKiB3cSBzcGlubG9jayB0byBz
eW5jaHJvbml6ZSBkcmFpbmluZyAqLw0KIAlzcGlubG9ja190CQkJd3FfbG9jazsNCkBAIC05MDYs
NyArOTA3LDYgQEAgdm9pZCBtbHg1X3N0YXJ0X2hlYWx0aF9wb2xsKHN0cnVjdCBtbHg1X2NvcmVf
ZGV2ICpkZXYpOw0KIHZvaWQgbWx4NV9zdG9wX2hlYWx0aF9wb2xsKHN0cnVjdCBtbHg1X2NvcmVf
ZGV2ICpkZXYsIGJvb2wgZGlzYWJsZV9oZWFsdGgpOw0KIHZvaWQgbWx4NV9kcmFpbl9oZWFsdGhf
d3Eoc3RydWN0IG1seDVfY29yZV9kZXYgKmRldik7DQogdm9pZCBtbHg1X3RyaWdnZXJfaGVhbHRo
X3dvcmsoc3RydWN0IG1seDVfY29yZV9kZXYgKmRldik7DQotdm9pZCBtbHg1X2RyYWluX2hlYWx0
aF9yZWNvdmVyeShzdHJ1Y3QgbWx4NV9jb3JlX2RldiAqZGV2KTsNCiBpbnQgbWx4NV9idWZfYWxs
b2Nfbm9kZShzdHJ1Y3QgbWx4NV9jb3JlX2RldiAqZGV2LCBpbnQgc2l6ZSwNCiAJCQlzdHJ1Y3Qg
bWx4NV9mcmFnX2J1ZiAqYnVmLCBpbnQgbm9kZSk7DQogaW50IG1seDVfYnVmX2FsbG9jKHN0cnVj
dCBtbHg1X2NvcmVfZGV2ICpkZXYsDQotLSANCjIuMjEuMA0KDQo=
