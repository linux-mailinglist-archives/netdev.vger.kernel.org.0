Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 90378315E1
	for <lists+netdev@lfdr.de>; Fri, 31 May 2019 22:10:30 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727510AbfEaUKI (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Fri, 31 May 2019 16:10:08 -0400
Received: from mail-eopbgr60043.outbound.protection.outlook.com ([40.107.6.43]:15081
        "EHLO EUR04-DB3-obe.outbound.protection.outlook.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1727354AbfEaUKF (ORCPT <rfc822;netdev@vger.kernel.org>);
        Fri, 31 May 2019 16:10:05 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=Mellanox.com;
 s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=I9GH7yssLwG2YiUVBTwvrqnCHpQSRcw7Mc0HC8sR+0k=;
 b=Kl1AvLYRisJ0B03XrX3SXN+HnEdArQ3VYdmk4hWlczLP3rGSUeIPqxH5x6khm1qESpLLqQRdDGomkfE5u81qAcrAZ6f1Ibf9K4ZfeEZa+BtVoZEFZBtTZ4+M2GAy2uneDe7CgWFazqMDQcVinrqDqi5neCwQQ07CsYE/ptAMy6Y=
Received: from VI1PR05MB5902.eurprd05.prod.outlook.com (20.178.125.223) by
 VI1PR05MB5600.eurprd05.prod.outlook.com (20.177.203.32) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.1922.16; Fri, 31 May 2019 20:09:33 +0000
Received: from VI1PR05MB5902.eurprd05.prod.outlook.com
 ([fe80::dd31:2532:9adf:9b38]) by VI1PR05MB5902.eurprd05.prod.outlook.com
 ([fe80::dd31:2532:9adf:9b38%6]) with mapi id 15.20.1922.021; Fri, 31 May 2019
 20:09:33 +0000
From:   Saeed Mahameed <saeedm@mellanox.com>
To:     "David S. Miller" <davem@davemloft.net>
CC:     "netdev@vger.kernel.org" <netdev@vger.kernel.org>,
        Yevgeny Kliteynik <kliteyn@mellanox.com>,
        Oz Shlomo <ozsh@mellanox.com>,
        Saeed Mahameed <saeedm@mellanox.com>
Subject: [net-next 6/9] net/mlx5e: Rearrange tc tunnel code in a modular way
Thread-Topic: [net-next 6/9] net/mlx5e: Rearrange tc tunnel code in a modular
 way
Thread-Index: AQHVF+zCEECGB7B2y0yKwSuIUftXUg==
Date:   Fri, 31 May 2019 20:09:32 +0000
Message-ID: <20190531200838.25184-7-saeedm@mellanox.com>
References: <20190531200838.25184-1-saeedm@mellanox.com>
In-Reply-To: <20190531200838.25184-1-saeedm@mellanox.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-mailer: git-send-email 2.21.0
x-originating-ip: [209.116.155.178]
x-clientproxiedby: BYAPR07CA0086.namprd07.prod.outlook.com
 (2603:10b6:a03:12b::27) To VI1PR05MB5902.eurprd05.prod.outlook.com
 (2603:10a6:803:df::31)
authentication-results: spf=none (sender IP is )
 smtp.mailfrom=saeedm@mellanox.com; 
x-ms-exchange-messagesentrepresentingtype: 1
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 9b8cab13-d869-4cff-97da-08d6e603e511
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0;PCL:0;RULEID:(2390118)(7020095)(4652040)(8989299)(5600148)(711020)(4605104)(1401327)(4618075)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(2017052603328)(7193020);SRVR:VI1PR05MB5600;
x-ms-traffictypediagnostic: VI1PR05MB5600:
x-microsoft-antispam-prvs: <VI1PR05MB560065A2F795429E1B2DE1ABBE190@VI1PR05MB5600.eurprd05.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:7219;
x-forefront-prvs: 00540983E2
x-forefront-antispam-report: SFV:NSPM;SFS:(10009020)(39860400002)(376002)(366004)(136003)(396003)(346002)(189003)(199004)(99286004)(52116002)(2616005)(6116002)(6512007)(14444005)(107886003)(486006)(54906003)(386003)(476003)(76176011)(186003)(26005)(3846002)(5024004)(11346002)(305945005)(81166006)(66066001)(256004)(6506007)(4326008)(25786009)(6486002)(102836004)(6436002)(66946007)(8936002)(64756008)(7736002)(8676002)(53936002)(66476007)(73956011)(30864003)(446003)(66556008)(81156014)(66446008)(6916009)(1076003)(68736007)(2906002)(86362001)(71190400001)(14454004)(5660300002)(316002)(508600001)(36756003)(50226002)(53946003)(71200400001)(579004)(559001)(309714004);DIR:OUT;SFP:1101;SCL:1;SRVR:VI1PR05MB5600;H:VI1PR05MB5902.eurprd05.prod.outlook.com;FPR:;SPF:None;LANG:en;PTR:InfoNoRecords;MX:1;A:1;
received-spf: None (protection.outlook.com: mellanox.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: 96tFoqlvxxFUg69fCk41wyZzjENl/XF4gXz/sqEvcQT5YDiShA1/ql225cgKLLDc9GfP86mbVqQYMD2q0Vnk8Phl/BXTxEnKNPz6gUfBtVWhshNt1oCvAn7c0JpuIhASotppYO1gtzGcL7TBuksL/zip4CBqEi9wjlv1cTF2ILrT7aVHKcjKfq1OAog8OJKH0cN4Yue5m729XkTGxn0iHEPwWnlYCTZHmooZj3FW6YPnoyl1sDiOJHnDPfoxUDIlGdN5fkO4aU/plVlO7B8x1wtjlpXmxxuxD3LIcKc4PITqoAdK/SQA5QwxiZjOx3KjgznDsMkzID5/c6BHqvVaAcyYbr15pH0smQisOGF3qfu1pSOcIvvzxxzfuja+hH40hnfQwwQ0CJUu0539XjeDr+SjNl+oEdlBl6WZzSU7dj8=
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-OriginatorOrg: Mellanox.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 9b8cab13-d869-4cff-97da-08d6e603e511
X-MS-Exchange-CrossTenant-originalarrivaltime: 31 May 2019 20:09:32.8675
 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: a652971c-7d2e-4d9b-a6a4-d149256f461b
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: saeedm@mellanox.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: VI1PR05MB5600
Sender: netdev-owner@vger.kernel.org
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

RnJvbTogWWV2Z2VueSBLbGl0ZXluaWsgPGtsaXRleW5AbWVsbGFub3guY29tPg0KDQpSZWFycmFu
Z2UgdGMgdHVubmVsIGNvZGUgc28gdGhhdCBpdCB3b3VsZCBiZSBlYXN5IHRvIGFkZCBmdXR1cmUg
dHVubmVsczoNCiAtIERlZmluZSB0YyB0dW5uZWwgb2JqZWN0IHdpdGggdGhlIGZpZWxkcyBhbmQg
Y2FsbGJhY2tzIHRoYXQgYW55DQogICB0dW5uZWwgbXVzdCBpbXBsZW1lbnQuDQogLSBEZWZpbmUg
dGMgVURQIHR1bm5lbCBvYmplY3QgZm9yIFVEUCB0dW5uZWxzLCBzdWNoIGFzIFZYTEFODQogLSBN
b3ZlIGVhY2ggdHVubmVsIGNvZGUgKEdSRSwgVlhMQU4pIHRvIGl0cyBvd24gc2VwYXJhdGUgZmls
ZQ0KIC0gUmV3cml0ZSB0YyB0dW5uZWwgaW1wbGVtZW50YXRpb24gaW4gYSBnZW5lcmFsIHdheSAt
IHVzaW5nIG9ubHkNCiAgIHRoZSBvYmplY3RzIGFuZCB0aGVpciBjYWxsYmFja3MuDQoNClJldmll
d2VkLWJ5OiBPeiBTaGxvbW8gPG96c2hAbWVsbGFub3guY29tPg0KU2lnbmVkLW9mZi1ieTogWWV2
Z2VueSBLbGl0ZXluaWsgPGtsaXRleW5AbWVsbGFub3guY29tPg0KU2lnbmVkLW9mZi1ieTogU2Fl
ZWQgTWFoYW1lZWQgPHNhZWVkbUBtZWxsYW5veC5jb20+DQotLS0NCiAuLi4vbmV0L2V0aGVybmV0
L21lbGxhbm94L21seDUvY29yZS9NYWtlZmlsZSAgfCAgIDIgKy0NCiAuLi4vZXRoZXJuZXQvbWVs
bGFub3gvbWx4NS9jb3JlL2VuL3RjX3R1bi5jICAgfCAyODEgKysrKysrLS0tLS0tLS0tLS0tDQog
Li4uL2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9lbi90Y190dW4uaCAgIHwgIDM5ICsrLQ0K
IC4uLi9tZWxsYW5veC9tbHg1L2NvcmUvZW4vdGNfdHVuX2dyZS5jICAgICAgICB8ICA5NSArKysr
KysNCiAuLi4vbWVsbGFub3gvbWx4NS9jb3JlL2VuL3RjX3R1bl92eGxhbi5jICAgICAgfCAxNTEg
KysrKysrKysrKw0KIC4uLi9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2VuX3JlcC5o
ICB8ICAgMyArLQ0KIC4uLi9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2VuX3RjLmMg
ICB8ICAxMCArLQ0KIDcgZmlsZXMgY2hhbmdlZCwgMzczIGluc2VydGlvbnMoKyksIDIwOCBkZWxl
dGlvbnMoLSkNCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFu
b3gvbWx4NS9jb3JlL2VuL3RjX3R1bl9ncmUuYw0KIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJz
L25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1L2NvcmUvZW4vdGNfdHVuX3Z4bGFuLmMNCg0KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvbmV0L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9NYWtlZmls
ZSBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9NYWtlZmlsZQ0KaW5k
ZXggZTMxMDI3Mjc3YTZlLi5mMWYyMjJmYzY3ZTIgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL25ldC9l
dGhlcm5ldC9tZWxsYW5veC9tbHg1L2NvcmUvTWFrZWZpbGUNCisrKyBiL2RyaXZlcnMvbmV0L2V0
aGVybmV0L21lbGxhbm94L21seDUvY29yZS9NYWtlZmlsZQ0KQEAgLTMyLDcgKzMyLDcgQEAgbWx4
NV9jb3JlLSQoQ09ORklHX01MWDVfRU5fQVJGUykgICAgICs9IGVuX2FyZnMubw0KIG1seDVfY29y
ZS0kKENPTkZJR19NTFg1X0VOX1JYTkZDKSAgICArPSBlbl9mc19ldGh0b29sLm8NCiBtbHg1X2Nv
cmUtJChDT05GSUdfTUxYNV9DT1JFX0VOX0RDQikgKz0gZW5fZGNibmwubyBlbi9wb3J0X2J1ZmZl
ci5vDQogbWx4NV9jb3JlLSQoQ09ORklHX01MWDVfRVNXSVRDSCkgICAgICs9IGVuX3JlcC5vIGVu
X3RjLm8gZW4vdGNfdHVuLm8gbGliL3BvcnRfdHVuLm8gbGFnX21wLm8gXA0KLQkJCQkJbGliL2dl
bmV2ZS5vDQorCQkJCQlsaWIvZ2VuZXZlLm8gZW4vdGNfdHVuX3Z4bGFuLm8gZW4vdGNfdHVuX2dy
ZS5vDQogDQogIw0KICMgQ29yZSBleHRyYQ0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvbmV0L2V0aGVy
bmV0L21lbGxhbm94L21seDUvY29yZS9lbi90Y190dW4uYyBiL2RyaXZlcnMvbmV0L2V0aGVybmV0
L21lbGxhbm94L21seDUvY29yZS9lbi90Y190dW4uYw0KaW5kZXggMjAwNGQwNGM0YzQ2Li42ZjMx
YjY4NzYzMTYgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1
L2NvcmUvZW4vdGNfdHVuLmMNCisrKyBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L21lbGxhbm94L21s
eDUvY29yZS9lbi90Y190dW4uYw0KQEAgLTMsOSArMywxOSBAQA0KIA0KICNpbmNsdWRlIDxuZXQv
dnhsYW4uaD4NCiAjaW5jbHVkZSA8bmV0L2dyZS5oPg0KLSNpbmNsdWRlICJsaWIvdnhsYW4uaCIN
CiAjaW5jbHVkZSAiZW4vdGNfdHVuLmgiDQogDQorc3RydWN0IG1seDVlX3RjX3R1bm5lbCAqbWx4
NWVfZ2V0X3RjX3R1bihzdHJ1Y3QgbmV0X2RldmljZSAqdHVubmVsX2RldikNCit7DQorCWlmIChu
ZXRpZl9pc192eGxhbih0dW5uZWxfZGV2KSkNCisJCXJldHVybiAmdnhsYW5fdHVubmVsOw0KKwll
bHNlIGlmIChuZXRpZl9pc19ncmV0YXAodHVubmVsX2RldikgfHwNCisJCSBuZXRpZl9pc19pcDZn
cmV0YXAodHVubmVsX2RldikpDQorCQlyZXR1cm4gJmdyZV90dW5uZWw7DQorCWVsc2UNCisJCXJl
dHVybiBOVUxMOw0KK30NCisNCiBzdGF0aWMgaW50IGdldF9yb3V0ZV9hbmRfb3V0X2RldnMoc3Ry
dWN0IG1seDVlX3ByaXYgKnByaXYsDQogCQkJCSAgc3RydWN0IG5ldF9kZXZpY2UgKmRldiwNCiAJ
CQkJICBzdHJ1Y3QgbmV0X2RldmljZSAqKnJvdXRlX2RldiwNCkBAIC0xNDEsNjQgKzE1MSwxNSBA
QCBzdGF0aWMgaW50IG1seDVlX3JvdXRlX2xvb2t1cF9pcHY2KHN0cnVjdCBtbHg1ZV9wcml2ICpw
cml2LA0KIAlyZXR1cm4gMDsNCiB9DQogDQotc3RhdGljIGludCBtbHg1ZV9nZW5fdnhsYW5faGVh
ZGVyKGNoYXIgYnVmW10sDQotCQkJCSAgY29uc3Qgc3RydWN0IGlwX3R1bm5lbF9rZXkgKnR1bl9r
ZXkpDQotew0KLQlfX2JlMzIgdHVuX2lkID0gdHVubmVsX2lkX3RvX2tleTMyKHR1bl9rZXktPnR1
bl9pZCk7DQotCXN0cnVjdCB1ZHBoZHIgKnVkcCA9IChzdHJ1Y3QgdWRwaGRyICopKGJ1Zik7DQot
CXN0cnVjdCB2eGxhbmhkciAqdnhoID0gKHN0cnVjdCB2eGxhbmhkciAqKQ0KLQkJCSAgICAgICAo
KGNoYXIgKil1ZHAgKyBzaXplb2Yoc3RydWN0IHVkcGhkcikpOw0KLQ0KLQl1ZHAtPmRlc3QgPSB0
dW5fa2V5LT50cF9kc3Q7DQotCXZ4aC0+dnhfZmxhZ3MgPSBWWExBTl9IRl9WTkk7DQotCXZ4aC0+
dnhfdm5pID0gdnhsYW5fdm5pX2ZpZWxkKHR1bl9pZCk7DQotDQotCXJldHVybiAwOw0KLX0NCi0N
Ci1zdGF0aWMgaW50IG1seDVlX2dlbl9ncmVfaGVhZGVyKGNoYXIgYnVmW10sIGNvbnN0IHN0cnVj
dCBpcF90dW5uZWxfa2V5ICp0dW5fa2V5KQ0KLXsNCi0JX19iZTMyIHR1bl9pZCA9IHR1bm5lbF9p
ZF90b19rZXkzMih0dW5fa2V5LT50dW5faWQpOw0KLQlpbnQgaGRyX2xlbjsNCi0Jc3RydWN0IGdy
ZV9iYXNlX2hkciAqZ3JlaCA9IChzdHJ1Y3QgZ3JlX2Jhc2VfaGRyICopKGJ1Zik7DQotDQotCS8q
IHRoZSBIVyBkb2VzIG5vdCBjYWxjdWxhdGUgR1JFIGNzdW0gb3Igc2VxdWVuY2VzICovDQotCWlm
ICh0dW5fa2V5LT50dW5fZmxhZ3MgJiAoVFVOTkVMX0NTVU0gfCBUVU5ORUxfU0VRKSkNCi0JCXJl
dHVybiAtRU9QTk9UU1VQUDsNCi0NCi0JZ3JlaC0+cHJvdG9jb2wgPSBodG9ucyhFVEhfUF9URUIp
Ow0KLQ0KLQkvKiBHUkUga2V5ICovDQotCWhkcl9sZW4gPSBncmVfY2FsY19obGVuKHR1bl9rZXkt
PnR1bl9mbGFncyk7DQotCWdyZWgtPmZsYWdzID0gZ3JlX3RubF9mbGFnc190b19ncmVfZmxhZ3Mo
dHVuX2tleS0+dHVuX2ZsYWdzKTsNCi0JaWYgKHR1bl9rZXktPnR1bl9mbGFncyAmIFRVTk5FTF9L
RVkpIHsNCi0JCV9fYmUzMiAqcHRyID0gKF9fYmUzMiAqKSgoKHU4ICopZ3JlaCkgKyBoZHJfbGVu
IC0gNCk7DQotDQotCQkqcHRyID0gdHVuX2lkOw0KLQl9DQotDQotCXJldHVybiAwOw0KLX0NCi0N
CiBzdGF0aWMgaW50IG1seDVlX2dlbl9pcF90dW5uZWxfaGVhZGVyKGNoYXIgYnVmW10sIF9fdTgg
KmlwX3Byb3RvLA0KIAkJCQkgICAgICBzdHJ1Y3QgbWx4NWVfZW5jYXBfZW50cnkgKmUpDQogew0K
LQlpbnQgZXJyID0gMDsNCi0JY29uc3Qgc3RydWN0IGlwX3R1bm5lbF9rZXkgKmtleSA9ICZlLT50
dW5faW5mby0+a2V5Ow0KLQ0KLQlpZiAoZS0+dHVubmVsX3R5cGUgPT0gTUxYNUVfVENfVFVOTkVM
X1RZUEVfVlhMQU4pIHsNCi0JCSppcF9wcm90byA9IElQUFJPVE9fVURQOw0KLQkJZXJyID0gbWx4
NWVfZ2VuX3Z4bGFuX2hlYWRlcihidWYsIGtleSk7DQotCX0gZWxzZSBpZiAgKGUtPnR1bm5lbF90
eXBlID09IE1MWDVFX1RDX1RVTk5FTF9UWVBFX0dSRVRBUCkgew0KLQkJKmlwX3Byb3RvID0gSVBQ
Uk9UT19HUkU7DQotCQllcnIgPSBtbHg1ZV9nZW5fZ3JlX2hlYWRlcihidWYsIGtleSk7DQotCX0g
ZWxzZSB7DQotCQlwcl93YXJuKCJtbHg1OiBDYW5ub3QgZ2VuZXJhdGUgdHVubmVsIGhlYWRlciBm
b3IgdHVubmVsIHR5cGUgKCVkKVxuIg0KLQkJCSwgZS0+dHVubmVsX3R5cGUpOw0KLQkJZXJyID0g
LUVPUE5PVFNVUFA7DQorCWlmICghZS0+dHVubmVsKSB7DQorCQlwcl93YXJuKCJtbHg1OiBDYW5u
b3QgZ2VuZXJhdGUgdHVubmVsIGhlYWRlciBmb3IgdGhpcyB0dW5uZWxcbiIpOw0KKwkJcmV0dXJu
IC1FT1BOT1RTVVBQOw0KIAl9DQogDQotCXJldHVybiBlcnI7DQorCXJldHVybiBlLT50dW5uZWwt
PmdlbmVyYXRlX2lwX3R1bl9oZHIoYnVmLCBpcF9wcm90bywgZSk7DQogfQ0KIA0KIHN0YXRpYyBj
aGFyICpnZW5fZXRoX3RubF9oZHIoY2hhciAqYnVmLCBzdHJ1Y3QgbmV0X2RldmljZSAqZGV2LA0K
QEAgLTI1NCw3ICsyMTUsNyBAQCBpbnQgbWx4NWVfdGNfdHVuX2NyZWF0ZV9oZWFkZXJfaXB2NChz
dHJ1Y3QgbWx4NWVfcHJpdiAqcHJpdiwNCiAJaXB2NF9lbmNhcF9zaXplID0NCiAJCShpc192bGFu
X2Rldihyb3V0ZV9kZXYpID8gVkxBTl9FVEhfSExFTiA6IEVUSF9ITEVOKSArDQogCQlzaXplb2Yo
c3RydWN0IGlwaGRyKSArDQotCQllLT50dW5uZWxfaGxlbjsNCisJCWUtPnR1bm5lbC0+Y2FsY19o
bGVuKGUpOw0KIA0KIAlpZiAobWF4X2VuY2FwX3NpemUgPCBpcHY0X2VuY2FwX3NpemUpIHsNCiAJ
CW1seDVfY29yZV93YXJuKHByaXYtPm1kZXYsICJlbmNhcCBzaXplICVkIHRvbyBiaWcsIG1heCBz
dXBwb3J0ZWQgaXMgJWRcbiIsDQpAQCAtMzcwLDcgKzMzMSw3IEBAIGludCBtbHg1ZV90Y190dW5f
Y3JlYXRlX2hlYWRlcl9pcHY2KHN0cnVjdCBtbHg1ZV9wcml2ICpwcml2LA0KIAlpcHY2X2VuY2Fw
X3NpemUgPQ0KIAkJKGlzX3ZsYW5fZGV2KHJvdXRlX2RldikgPyBWTEFOX0VUSF9ITEVOIDogRVRI
X0hMRU4pICsNCiAJCXNpemVvZihzdHJ1Y3QgaXB2NmhkcikgKw0KLQkJZS0+dHVubmVsX2hsZW47
DQorCQllLT50dW5uZWwtPmNhbGNfaGxlbihlKTsNCiANCiAJaWYgKG1heF9lbmNhcF9zaXplIDwg
aXB2Nl9lbmNhcF9zaXplKSB7DQogCQltbHg1X2NvcmVfd2Fybihwcml2LT5tZGV2LCAiZW5jYXAg
c2l6ZSAlZCB0b28gYmlnLCBtYXggc3VwcG9ydGVkIGlzICVkXG4iLA0KQEAgLTQ1NiwyNyArNDE3
LDEyIEBAIGludCBtbHg1ZV90Y190dW5fY3JlYXRlX2hlYWRlcl9pcHY2KHN0cnVjdCBtbHg1ZV9w
cml2ICpwcml2LA0KIAlyZXR1cm4gZXJyOw0KIH0NCiANCi1pbnQgbWx4NWVfdGNfdHVuX2dldF90
eXBlKHN0cnVjdCBuZXRfZGV2aWNlICp0dW5uZWxfZGV2KQ0KLXsNCi0JaWYgKG5ldGlmX2lzX3Z4
bGFuKHR1bm5lbF9kZXYpKQ0KLQkJcmV0dXJuIE1MWDVFX1RDX1RVTk5FTF9UWVBFX1ZYTEFOOw0K
LQllbHNlIGlmIChuZXRpZl9pc19ncmV0YXAodHVubmVsX2RldikgfHwNCi0JCSBuZXRpZl9pc19p
cDZncmV0YXAodHVubmVsX2RldikpDQotCQlyZXR1cm4gTUxYNUVfVENfVFVOTkVMX1RZUEVfR1JF
VEFQOw0KLQllbHNlDQotCQlyZXR1cm4gTUxYNUVfVENfVFVOTkVMX1RZUEVfVU5LTk9XTjsNCi19
DQotDQogYm9vbCBtbHg1ZV90Y190dW5fZGV2aWNlX3RvX29mZmxvYWQoc3RydWN0IG1seDVlX3By
aXYgKnByaXYsDQogCQkJCSAgICBzdHJ1Y3QgbmV0X2RldmljZSAqbmV0ZGV2KQ0KIHsNCi0JaW50
IHR1bm5lbF90eXBlID0gbWx4NWVfdGNfdHVuX2dldF90eXBlKG5ldGRldik7DQorCXN0cnVjdCBt
bHg1ZV90Y190dW5uZWwgKnR1bm5lbCA9IG1seDVlX2dldF90Y190dW4obmV0ZGV2KTsNCiANCi0J
aWYgKHR1bm5lbF90eXBlID09IE1MWDVFX1RDX1RVTk5FTF9UWVBFX1ZYTEFOICYmDQotCSAgICBN
TFg1X0NBUF9FU1cocHJpdi0+bWRldiwgdnhsYW5fZW5jYXBfZGVjYXApKQ0KLQkJcmV0dXJuIHRy
dWU7DQotCWVsc2UgaWYgKHR1bm5lbF90eXBlID09IE1MWDVFX1RDX1RVTk5FTF9UWVBFX0dSRVRB
UCAmJg0KLQkJIE1MWDVfQ0FQX0VTVyhwcml2LT5tZGV2LCBudmdyZV9lbmNhcF9kZWNhcCkpDQor
CWlmICh0dW5uZWwgJiYgdHVubmVsLT5jYW5fb2ZmbG9hZChwcml2KSkNCiAJCXJldHVybiB0cnVl
Ow0KIAllbHNlDQogCQlyZXR1cm4gZmFsc2U7DQpAQCAtNDg3LDcxICs0MzMsODcgQEAgaW50IG1s
eDVlX3RjX3R1bl9pbml0X2VuY2FwX2F0dHIoc3RydWN0IG5ldF9kZXZpY2UgKnR1bm5lbF9kZXYs
DQogCQkJCSBzdHJ1Y3QgbWx4NWVfZW5jYXBfZW50cnkgKmUsDQogCQkJCSBzdHJ1Y3QgbmV0bGlu
a19leHRfYWNrICpleHRhY2spDQogew0KLQllLT50dW5uZWxfdHlwZSA9IG1seDVlX3RjX3R1bl9n
ZXRfdHlwZSh0dW5uZWxfZGV2KTsNCisJc3RydWN0IG1seDVlX3RjX3R1bm5lbCAqdHVubmVsID0g
bWx4NWVfZ2V0X3RjX3R1bih0dW5uZWxfZGV2KTsNCiANCi0JaWYgKGUtPnR1bm5lbF90eXBlID09
IE1MWDVFX1RDX1RVTk5FTF9UWVBFX1ZYTEFOKSB7DQotCQlpbnQgZHN0X3BvcnQgPSBiZTE2X3Rv
X2NwdShlLT50dW5faW5mby0+a2V5LnRwX2RzdCk7DQotDQotCQlpZiAoIW1seDVfdnhsYW5fbG9v
a3VwX3BvcnQocHJpdi0+bWRldi0+dnhsYW4sIGRzdF9wb3J0KSkgew0KLQkJCU5MX1NFVF9FUlJf
TVNHX01PRChleHRhY2ssDQotCQkJCQkgICAidnhsYW4gdWRwIGRwb3J0IHdhcyBub3QgcmVnaXN0
ZXJlZCB3aXRoIHRoZSBIVyIpOw0KLQkJCW5ldGRldl93YXJuKHByaXYtPm5ldGRldiwNCi0JCQkJ
ICAgICIlZCBpc24ndCBhbiBvZmZsb2FkZWQgdnhsYW4gdWRwIGRwb3J0XG4iLA0KLQkJCQkgICAg
ZHN0X3BvcnQpOw0KLQkJCXJldHVybiAtRU9QTk9UU1VQUDsNCi0JCX0NCi0JCWUtPnJlZm9ybWF0
X3R5cGUgPSBNTFg1X1JFRk9STUFUX1RZUEVfTDJfVE9fVlhMQU47DQotCQllLT50dW5uZWxfaGxl
biA9IFZYTEFOX0hMRU47DQotCX0gZWxzZSBpZiAoZS0+dHVubmVsX3R5cGUgPT0gTUxYNUVfVENf
VFVOTkVMX1RZUEVfR1JFVEFQKSB7DQotCQllLT5yZWZvcm1hdF90eXBlID0gTUxYNV9SRUZPUk1B
VF9UWVBFX0wyX1RPX05WR1JFOw0KLQkJZS0+dHVubmVsX2hsZW4gPSBncmVfY2FsY19obGVuKGUt
PnR1bl9pbmZvLT5rZXkudHVuX2ZsYWdzKTsNCi0JfSBlbHNlIHsNCisJaWYgKCF0dW5uZWwpIHsN
CiAJCWUtPnJlZm9ybWF0X3R5cGUgPSAtMTsNCi0JCWUtPnR1bm5lbF9obGVuID0gLTE7DQogCQly
ZXR1cm4gLUVPUE5PVFNVUFA7DQogCX0NCi0JcmV0dXJuIDA7DQorDQorCXJldHVybiB0dW5uZWwt
PmluaXRfZW5jYXBfYXR0cih0dW5uZWxfZGV2LCBwcml2LCBlLCBleHRhY2spOw0KIH0NCiANCi1z
dGF0aWMgaW50IG1seDVlX3RjX3R1bl9wYXJzZV92eGxhbihzdHJ1Y3QgbWx4NWVfcHJpdiAqcHJp
diwNCi0JCQkJICAgIHN0cnVjdCBtbHg1X2Zsb3dfc3BlYyAqc3BlYywNCi0JCQkJICAgIHN0cnVj
dCB0Y19jbHNfZmxvd2VyX29mZmxvYWQgKmYsDQotCQkJCSAgICB2b2lkICpoZWFkZXJzX2MsDQot
CQkJCSAgICB2b2lkICpoZWFkZXJzX3YpDQoraW50IG1seDVlX3RjX3R1bl9wYXJzZShzdHJ1Y3Qg
bmV0X2RldmljZSAqZmlsdGVyX2RldiwNCisJCSAgICAgICBzdHJ1Y3QgbWx4NWVfcHJpdiAqcHJp
diwNCisJCSAgICAgICBzdHJ1Y3QgbWx4NV9mbG93X3NwZWMgKnNwZWMsDQorCQkgICAgICAgc3Ry
dWN0IHRjX2Nsc19mbG93ZXJfb2ZmbG9hZCAqZiwNCisJCSAgICAgICB2b2lkICpoZWFkZXJzX2Ms
DQorCQkgICAgICAgdm9pZCAqaGVhZGVyc192LCB1OCAqbWF0Y2hfbGV2ZWwpDQorew0KKwlzdHJ1
Y3QgbWx4NWVfdGNfdHVubmVsICp0dW5uZWwgPSBtbHg1ZV9nZXRfdGNfdHVuKGZpbHRlcl9kZXYp
Ow0KKwlpbnQgZXJyID0gMDsNCisNCisJaWYgKCF0dW5uZWwpIHsNCisJCW5ldGRldl93YXJuKHBy
aXYtPm5ldGRldiwNCisJCQkgICAgImRlY2Fwc3VsYXRpb24gb2ZmbG9hZCBpcyBub3Qgc3VwcG9y
dGVkIGZvciAlcyBuZXQgZGV2aWNlXG4iLA0KKwkJCSAgICBtbHg1ZV9uZXRkZXZfa2luZChmaWx0
ZXJfZGV2KSk7DQorCQllcnIgPSAtRU9QTk9UU1VQUDsNCisJCWdvdG8gb3V0Ow0KKwl9DQorDQor
CSptYXRjaF9sZXZlbCA9IHR1bm5lbC0+bWF0Y2hfbGV2ZWw7DQorDQorCWlmICh0dW5uZWwtPnBh
cnNlX3VkcF9wb3J0cykgew0KKwkJZXJyID0gdHVubmVsLT5wYXJzZV91ZHBfcG9ydHMocHJpdiwg
c3BlYywgZiwNCisJCQkJCSAgICAgIGhlYWRlcnNfYywgaGVhZGVyc192KTsNCisJCWlmIChlcnIp
DQorCQkJZ290byBvdXQ7DQorCX0NCisNCisJaWYgKHR1bm5lbC0+cGFyc2VfdHVubmVsKSB7DQor
CQllcnIgPSB0dW5uZWwtPnBhcnNlX3R1bm5lbChwcml2LCBzcGVjLCBmLA0KKwkJCQkJICAgaGVh
ZGVyc19jLCBoZWFkZXJzX3YpOw0KKwkJaWYgKGVycikNCisJCQlnb3RvIG91dDsNCisJfQ0KKw0K
K291dDoNCisJcmV0dXJuIGVycjsNCit9DQorDQoraW50IG1seDVlX3RjX3R1bl9wYXJzZV91ZHBf
cG9ydHMoc3RydWN0IG1seDVlX3ByaXYgKnByaXYsDQorCQkJCSBzdHJ1Y3QgbWx4NV9mbG93X3Nw
ZWMgKnNwZWMsDQorCQkJCSBzdHJ1Y3QgdGNfY2xzX2Zsb3dlcl9vZmZsb2FkICpmLA0KKwkJCQkg
dm9pZCAqaGVhZGVyc19jLA0KKwkJCQkgdm9pZCAqaGVhZGVyc192KQ0KIHsNCiAJc3RydWN0IGZs
b3dfcnVsZSAqcnVsZSA9IHRjX2Nsc19mbG93ZXJfb2ZmbG9hZF9mbG93X3J1bGUoZik7DQogCXN0
cnVjdCBuZXRsaW5rX2V4dF9hY2sgKmV4dGFjayA9IGYtPmNvbW1vbi5leHRhY2s7DQotCXZvaWQg
Km1pc2NfYyA9IE1MWDVfQUREUl9PRihmdGVfbWF0Y2hfcGFyYW0sDQotCQkJCSAgICBzcGVjLT5t
YXRjaF9jcml0ZXJpYSwNCi0JCQkJICAgIG1pc2NfcGFyYW1ldGVycyk7DQotCXZvaWQgKm1pc2Nf
diA9IE1MWDVfQUREUl9PRihmdGVfbWF0Y2hfcGFyYW0sDQotCQkJCSAgICBzcGVjLT5tYXRjaF92
YWx1ZSwNCi0JCQkJICAgIG1pc2NfcGFyYW1ldGVycyk7DQogCXN0cnVjdCBmbG93X21hdGNoX3Bv
cnRzIGVuY19wb3J0czsNCiANCi0JZmxvd19ydWxlX21hdGNoX2VuY19wb3J0cyhydWxlLCAmZW5j
X3BvcnRzKTsNCi0NCiAJLyogRnVsbCB1ZHAgZHN0IHBvcnQgbXVzdCBiZSBnaXZlbiAqLw0KLQlp
ZiAoIWZsb3dfcnVsZV9tYXRjaF9rZXkocnVsZSwgRkxPV19ESVNTRUNUT1JfS0VZX0VOQ19QT1JU
UykgfHwNCi0JICAgIG1lbWNocl9pbnYoJmVuY19wb3J0cy5tYXNrLT5kc3QsIDB4ZmYsIHNpemVv
ZihlbmNfcG9ydHMubWFzay0+ZHN0KSkpIHsNCisNCisJaWYgKCFmbG93X3J1bGVfbWF0Y2hfa2V5
KHJ1bGUsIEZMT1dfRElTU0VDVE9SX0tFWV9FTkNfUE9SVFMpKSB7DQogCQlOTF9TRVRfRVJSX01T
R19NT0QoZXh0YWNrLA0KLQkJCQkgICAiVlhMQU4gZGVjYXAgZmlsdGVyIG11c3QgaW5jbHVkZSBl
bmNfZHN0X3BvcnQgY29uZGl0aW9uIik7DQorCQkJCSAgICJVRFAgdHVubmVsIGRlY2FwIGZpbHRl
ciBtdXN0IGluY2x1ZGUgZW5jX2RzdF9wb3J0IGNvbmRpdGlvbiIpOw0KIAkJbmV0ZGV2X3dhcm4o
cHJpdi0+bmV0ZGV2LA0KLQkJCSAgICAiVlhMQU4gZGVjYXAgZmlsdGVyIG11c3QgaW5jbHVkZSBl
bmNfZHN0X3BvcnQgY29uZGl0aW9uXG4iKTsNCisJCQkgICAgIlVEUCB0dW5uZWwgZGVjYXAgZmls
dGVyIG11c3QgaW5jbHVkZSBlbmNfZHN0X3BvcnQgY29uZGl0aW9uXG4iKTsNCiAJCXJldHVybiAt
RU9QTk9UU1VQUDsNCiAJfQ0KIA0KLQkvKiB1ZHAgZHN0IHBvcnQgbXVzdCBiZSBrbm9ud24gYXMg
YSBWWExBTiBwb3J0ICovDQotCWlmICghbWx4NV92eGxhbl9sb29rdXBfcG9ydChwcml2LT5tZGV2
LT52eGxhbiwgYmUxNl90b19jcHUoZW5jX3BvcnRzLmtleS0+ZHN0KSkpIHsNCisJZmxvd19ydWxl
X21hdGNoX2VuY19wb3J0cyhydWxlLCAmZW5jX3BvcnRzKTsNCisNCisJaWYgKG1lbWNocl9pbnYo
JmVuY19wb3J0cy5tYXNrLT5kc3QsIDB4ZmYsDQorCQkgICAgICAgc2l6ZW9mKGVuY19wb3J0cy5t
YXNrLT5kc3QpKSkgew0KIAkJTkxfU0VUX0VSUl9NU0dfTU9EKGV4dGFjaywNCi0JCQkJICAgIk1h
dGNoZWQgVURQIHBvcnQgaXMgbm90IHJlZ2lzdGVyZWQgYXMgYSBWWExBTiBwb3J0Iik7DQorCQkJ
CSAgICJVRFAgdHVubmVsIGRlY2FwIGZpbHRlciBtdXN0IG1hdGNoIGVuY19kc3RfcG9ydCBmdWxs
eSIpOw0KIAkJbmV0ZGV2X3dhcm4ocHJpdi0+bmV0ZGV2LA0KLQkJCSAgICAiVURQIHBvcnQgJWQg
aXMgbm90IHJlZ2lzdGVyZWQgYXMgYSBWWExBTiBwb3J0XG4iLA0KLQkJCSAgICBiZTE2X3RvX2Nw
dShlbmNfcG9ydHMua2V5LT5kc3QpKTsNCisJCQkgICAgIlVEUCB0dW5uZWwgZGVjYXAgZmlsdGVy
IG11c3QgbWF0Y2ggZW5jX2RzdF9wb3J0IGZ1bGx5XG4iKTsNCiAJCXJldHVybiAtRU9QTk9UU1VQ
UDsNCiAJfQ0KIA0KLQkvKiBkc3QgVURQIHBvcnQgaXMgdmFsaWQgaGVyZSAqLw0KKwkvKiBtYXRj
aCBvbiBVRFAgcHJvdG9jb2wgYW5kIGRzdCBwb3J0IG51bWJlciAqLw0KKw0KIAlNTFg1X1NFVF9U
T19PTkVTKGZ0ZV9tYXRjaF9zZXRfbHlyXzJfNCwgaGVhZGVyc19jLCBpcF9wcm90b2NvbCk7DQog
CU1MWDVfU0VUKGZ0ZV9tYXRjaF9zZXRfbHlyXzJfNCwgaGVhZGVyc192LCBpcF9wcm90b2NvbCwg
SVBQUk9UT19VRFApOw0KIA0KQEAgLTU2MCw5MiArNTIyLDE1IEBAIHN0YXRpYyBpbnQgbWx4NWVf
dGNfdHVuX3BhcnNlX3Z4bGFuKHN0cnVjdCBtbHg1ZV9wcml2ICpwcml2LA0KIAlNTFg1X1NFVChm
dGVfbWF0Y2hfc2V0X2x5cl8yXzQsIGhlYWRlcnNfdiwgdWRwX2Rwb3J0LA0KIAkJIG50b2hzKGVu
Y19wb3J0cy5rZXktPmRzdCkpOw0KIA0KKwkvKiBVRFAgc3JjIHBvcnQgb24gb3V0ZXIgaGVhZGVy
IGlzIGdlbmVyYXRlZCBieSBIVywNCisJICogc28gaXQgaXMgcHJvYmFibHkgYSBiYWQgaWRlYSB0
byByZXF1ZXN0IG1hdGNoaW5nIGl0Lg0KKwkgKiBOb25ldGhlbGVzcywgaXQgaXMgYWxsb3dlZC4N
CisJICovDQorDQogCU1MWDVfU0VUKGZ0ZV9tYXRjaF9zZXRfbHlyXzJfNCwgaGVhZGVyc19jLCB1
ZHBfc3BvcnQsDQogCQkgbnRvaHMoZW5jX3BvcnRzLm1hc2stPnNyYykpOw0KIAlNTFg1X1NFVChm
dGVfbWF0Y2hfc2V0X2x5cl8yXzQsIGhlYWRlcnNfdiwgdWRwX3Nwb3J0LA0KIAkJIG50b2hzKGVu
Y19wb3J0cy5rZXktPnNyYykpOw0KIA0KLQkvKiBtYXRjaCBvbiBWTkkgKi8NCi0JaWYgKGZsb3df
cnVsZV9tYXRjaF9rZXkocnVsZSwgRkxPV19ESVNTRUNUT1JfS0VZX0VOQ19LRVlJRCkpIHsNCi0J
CXN0cnVjdCBmbG93X21hdGNoX2VuY19rZXlpZCBlbmNfa2V5aWQ7DQotDQotCQlmbG93X3J1bGVf
bWF0Y2hfZW5jX2tleWlkKHJ1bGUsICZlbmNfa2V5aWQpOw0KLQ0KLQkJTUxYNV9TRVQoZnRlX21h
dGNoX3NldF9taXNjLCBtaXNjX2MsIHZ4bGFuX3ZuaSwNCi0JCQkgYmUzMl90b19jcHUoZW5jX2tl
eWlkLm1hc2stPmtleWlkKSk7DQotCQlNTFg1X1NFVChmdGVfbWF0Y2hfc2V0X21pc2MsIG1pc2Nf
diwgdnhsYW5fdm5pLA0KLQkJCSBiZTMyX3RvX2NwdShlbmNfa2V5aWQua2V5LT5rZXlpZCkpOw0K
LQl9DQotCXJldHVybiAwOw0KLX0NCi0NCi1zdGF0aWMgaW50IG1seDVlX3RjX3R1bl9wYXJzZV9n
cmV0YXAoc3RydWN0IG1seDVlX3ByaXYgKnByaXYsDQotCQkJCSAgICAgc3RydWN0IG1seDVfZmxv
d19zcGVjICpzcGVjLA0KLQkJCQkgICAgIHN0cnVjdCB0Y19jbHNfZmxvd2VyX29mZmxvYWQgKmYs
DQotCQkJCSAgICAgdm9pZCAqb3V0ZXJfaGVhZGVyc19jLA0KLQkJCQkgICAgIHZvaWQgKm91dGVy
X2hlYWRlcnNfdikNCi17DQotCXZvaWQgKm1pc2NfYyA9IE1MWDVfQUREUl9PRihmdGVfbWF0Y2hf
cGFyYW0sIHNwZWMtPm1hdGNoX2NyaXRlcmlhLA0KLQkJCQkgICAgbWlzY19wYXJhbWV0ZXJzKTsN
Ci0Jdm9pZCAqbWlzY192ID0gTUxYNV9BRERSX09GKGZ0ZV9tYXRjaF9wYXJhbSwgc3BlYy0+bWF0
Y2hfdmFsdWUsDQotCQkJCSAgICBtaXNjX3BhcmFtZXRlcnMpOw0KLQlzdHJ1Y3QgZmxvd19ydWxl
ICpydWxlID0gdGNfY2xzX2Zsb3dlcl9vZmZsb2FkX2Zsb3dfcnVsZShmKTsNCi0NCi0JaWYgKCFN
TFg1X0NBUF9FU1cocHJpdi0+bWRldiwgbnZncmVfZW5jYXBfZGVjYXApKSB7DQotCQlOTF9TRVRf
RVJSX01TR19NT0QoZi0+Y29tbW9uLmV4dGFjaywNCi0JCQkJICAgIkdSRSBIVyBvZmZsb2FkaW5n
IGlzIG5vdCBzdXBwb3J0ZWQiKTsNCi0JCW5ldGRldl93YXJuKHByaXYtPm5ldGRldiwgIkdSRSBI
VyBvZmZsb2FkaW5nIGlzIG5vdCBzdXBwb3J0ZWRcbiIpOw0KLQkJcmV0dXJuIC1FT1BOT1RTVVBQ
Ow0KLQl9DQotDQotCU1MWDVfU0VUX1RPX09ORVMoZnRlX21hdGNoX3NldF9seXJfMl80LCBvdXRl
cl9oZWFkZXJzX2MsIGlwX3Byb3RvY29sKTsNCi0JTUxYNV9TRVQoZnRlX21hdGNoX3NldF9seXJf
Ml80LCBvdXRlcl9oZWFkZXJzX3YsDQotCQkgaXBfcHJvdG9jb2wsIElQUFJPVE9fR1JFKTsNCi0N
Ci0JLyogZ3JlIHByb3RvY29sKi8NCi0JTUxYNV9TRVRfVE9fT05FUyhmdGVfbWF0Y2hfc2V0X21p
c2MsIG1pc2NfYywgZ3JlX3Byb3RvY29sKTsNCi0JTUxYNV9TRVQoZnRlX21hdGNoX3NldF9taXNj
LCBtaXNjX3YsIGdyZV9wcm90b2NvbCwgRVRIX1BfVEVCKTsNCi0NCi0JLyogZ3JlIGtleSAqLw0K
LQlpZiAoZmxvd19ydWxlX21hdGNoX2tleShydWxlLCBGTE9XX0RJU1NFQ1RPUl9LRVlfRU5DX0tF
WUlEKSkgew0KLQkJc3RydWN0IGZsb3dfbWF0Y2hfZW5jX2tleWlkIGVuY19rZXlpZDsNCi0NCi0J
CWZsb3dfcnVsZV9tYXRjaF9lbmNfa2V5aWQocnVsZSwgJmVuY19rZXlpZCk7DQotCQlNTFg1X1NF
VChmdGVfbWF0Y2hfc2V0X21pc2MsIG1pc2NfYywNCi0JCQkgZ3JlX2tleS5rZXksIGJlMzJfdG9f
Y3B1KGVuY19rZXlpZC5tYXNrLT5rZXlpZCkpOw0KLQkJTUxYNV9TRVQoZnRlX21hdGNoX3NldF9t
aXNjLCBtaXNjX3YsDQotCQkJIGdyZV9rZXkua2V5LCBiZTMyX3RvX2NwdShlbmNfa2V5aWQua2V5
LT5rZXlpZCkpOw0KLQl9DQotDQogCXJldHVybiAwOw0KIH0NCi0NCi1pbnQgbWx4NWVfdGNfdHVu
X3BhcnNlKHN0cnVjdCBuZXRfZGV2aWNlICpmaWx0ZXJfZGV2LA0KLQkJICAgICAgIHN0cnVjdCBt
bHg1ZV9wcml2ICpwcml2LA0KLQkJICAgICAgIHN0cnVjdCBtbHg1X2Zsb3dfc3BlYyAqc3BlYywN
Ci0JCSAgICAgICBzdHJ1Y3QgdGNfY2xzX2Zsb3dlcl9vZmZsb2FkICpmLA0KLQkJICAgICAgIHZv
aWQgKmhlYWRlcnNfYywNCi0JCSAgICAgICB2b2lkICpoZWFkZXJzX3YsIHU4ICptYXRjaF9sZXZl
bCkNCi17DQotCWludCB0dW5uZWxfdHlwZTsNCi0JaW50IGVyciA9IDA7DQotDQotCXR1bm5lbF90
eXBlID0gbWx4NWVfdGNfdHVuX2dldF90eXBlKGZpbHRlcl9kZXYpOw0KLQlpZiAodHVubmVsX3R5
cGUgPT0gTUxYNUVfVENfVFVOTkVMX1RZUEVfVlhMQU4pIHsNCi0JCSptYXRjaF9sZXZlbCA9IE1M
WDVfTUFUQ0hfTDQ7DQotCQllcnIgPSBtbHg1ZV90Y190dW5fcGFyc2VfdnhsYW4ocHJpdiwgc3Bl
YywgZiwNCi0JCQkJCSAgICAgICBoZWFkZXJzX2MsIGhlYWRlcnNfdik7DQotCX0gZWxzZSBpZiAo
dHVubmVsX3R5cGUgPT0gTUxYNUVfVENfVFVOTkVMX1RZUEVfR1JFVEFQKSB7DQotCQkqbWF0Y2hf
bGV2ZWwgPSBNTFg1X01BVENIX0wzOw0KLQkJZXJyID0gbWx4NWVfdGNfdHVuX3BhcnNlX2dyZXRh
cChwcml2LCBzcGVjLCBmLA0KLQkJCQkJCWhlYWRlcnNfYywgaGVhZGVyc192KTsNCi0JfSBlbHNl
IHsNCi0JCW5ldGRldl93YXJuKHByaXYtPm5ldGRldiwNCi0JCQkgICAgImRlY2Fwc3VsYXRpb24g
b2ZmbG9hZCBpcyBub3Qgc3VwcG9ydGVkIGZvciAlcyAoa2luZDogXCIlc1wiKVxuIiwNCi0JCQkg
ICAgbmV0ZGV2X25hbWUoZmlsdGVyX2RldiksDQotCQkJICAgIG1seDVlX25ldGRldl9raW5kKGZp
bHRlcl9kZXYpKTsNCi0NCi0JCXJldHVybiAtRU9QTk9UU1VQUDsNCi0JfQ0KLQlyZXR1cm4gZXJy
Ow0KLX0NCmRpZmYgLS1naXQgYS9kcml2ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1L2Nv
cmUvZW4vdGNfdHVuLmggYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1L2NvcmUv
ZW4vdGNfdHVuLmgNCmluZGV4IGI2M2YxNWRlODk5ZC4uY2ExZDMzNzBiNDI5IDEwMDY0NA0KLS0t
IGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2VuL3RjX3R1bi5oDQor
KysgYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1L2NvcmUvZW4vdGNfdHVuLmgN
CkBAIC0xNCw5ICsxNCwzOSBAQA0KIGVudW0gew0KIAlNTFg1RV9UQ19UVU5ORUxfVFlQRV9VTktO
T1dOLA0KIAlNTFg1RV9UQ19UVU5ORUxfVFlQRV9WWExBTiwNCi0JTUxYNUVfVENfVFVOTkVMX1RZ
UEVfR1JFVEFQDQorCU1MWDVFX1RDX1RVTk5FTF9UWVBFX0dSRVRBUCwNCiB9Ow0KIA0KK3N0cnVj
dCBtbHg1ZV90Y190dW5uZWwgew0KKwlpbnQgdHVubmVsX3R5cGU7DQorCWVudW0gbWx4NV9mbG93
X21hdGNoX2xldmVsIG1hdGNoX2xldmVsOw0KKw0KKwlib29sICgqY2FuX29mZmxvYWQpKHN0cnVj
dCBtbHg1ZV9wcml2ICpwcml2KTsNCisJaW50ICgqY2FsY19obGVuKShzdHJ1Y3QgbWx4NWVfZW5j
YXBfZW50cnkgKmUpOw0KKwlpbnQgKCppbml0X2VuY2FwX2F0dHIpKHN0cnVjdCBuZXRfZGV2aWNl
ICp0dW5uZWxfZGV2LA0KKwkJCSAgICAgICBzdHJ1Y3QgbWx4NWVfcHJpdiAqcHJpdiwNCisJCQkg
ICAgICAgc3RydWN0IG1seDVlX2VuY2FwX2VudHJ5ICplLA0KKwkJCSAgICAgICBzdHJ1Y3QgbmV0
bGlua19leHRfYWNrICpleHRhY2spOw0KKwlpbnQgKCpnZW5lcmF0ZV9pcF90dW5faGRyKShjaGFy
IGJ1ZltdLA0KKwkJCQkgICBfX3U4ICppcF9wcm90bywNCisJCQkJICAgc3RydWN0IG1seDVlX2Vu
Y2FwX2VudHJ5ICplKTsNCisJaW50ICgqcGFyc2VfdWRwX3BvcnRzKShzdHJ1Y3QgbWx4NWVfcHJp
diAqcHJpdiwNCisJCQkgICAgICAgc3RydWN0IG1seDVfZmxvd19zcGVjICpzcGVjLA0KKwkJCSAg
ICAgICBzdHJ1Y3QgdGNfY2xzX2Zsb3dlcl9vZmZsb2FkICpmLA0KKwkJCSAgICAgICB2b2lkICpo
ZWFkZXJzX2MsDQorCQkJICAgICAgIHZvaWQgKmhlYWRlcnNfdik7DQorCWludCAoKnBhcnNlX3R1
bm5lbCkoc3RydWN0IG1seDVlX3ByaXYgKnByaXYsDQorCQkJICAgIHN0cnVjdCBtbHg1X2Zsb3df
c3BlYyAqc3BlYywNCisJCQkgICAgc3RydWN0IHRjX2Nsc19mbG93ZXJfb2ZmbG9hZCAqZiwNCisJ
CQkgICAgdm9pZCAqaGVhZGVyc19jLA0KKwkJCSAgICB2b2lkICpoZWFkZXJzX3YpOw0KK307DQor
DQorZXh0ZXJuIHN0cnVjdCBtbHg1ZV90Y190dW5uZWwgdnhsYW5fdHVubmVsOw0KK2V4dGVybiBz
dHJ1Y3QgbWx4NWVfdGNfdHVubmVsIGdyZV90dW5uZWw7DQorDQorc3RydWN0IG1seDVlX3RjX3R1
bm5lbCAqbWx4NWVfZ2V0X3RjX3R1bihzdHJ1Y3QgbmV0X2RldmljZSAqdHVubmVsX2Rldik7DQor
DQogaW50IG1seDVlX3RjX3R1bl9pbml0X2VuY2FwX2F0dHIoc3RydWN0IG5ldF9kZXZpY2UgKnR1
bm5lbF9kZXYsDQogCQkJCSBzdHJ1Y3QgbWx4NWVfcHJpdiAqcHJpdiwNCiAJCQkJIHN0cnVjdCBt
bHg1ZV9lbmNhcF9lbnRyeSAqZSwNCkBAIC0zMCw3ICs2MCw2IEBAIGludCBtbHg1ZV90Y190dW5f
Y3JlYXRlX2hlYWRlcl9pcHY2KHN0cnVjdCBtbHg1ZV9wcml2ICpwcml2LA0KIAkJCQkgICAgc3Ry
dWN0IG5ldF9kZXZpY2UgKm1pcnJlZF9kZXYsDQogCQkJCSAgICBzdHJ1Y3QgbWx4NWVfZW5jYXBf
ZW50cnkgKmUpOw0KIA0KLWludCBtbHg1ZV90Y190dW5fZ2V0X3R5cGUoc3RydWN0IG5ldF9kZXZp
Y2UgKnR1bm5lbF9kZXYpOw0KIGJvb2wgbWx4NWVfdGNfdHVuX2RldmljZV90b19vZmZsb2FkKHN0
cnVjdCBtbHg1ZV9wcml2ICpwcml2LA0KIAkJCQkgICAgc3RydWN0IG5ldF9kZXZpY2UgKm5ldGRl
dik7DQogDQpAQCAtNDEsNCArNzAsMTAgQEAgaW50IG1seDVlX3RjX3R1bl9wYXJzZShzdHJ1Y3Qg
bmV0X2RldmljZSAqZmlsdGVyX2RldiwNCiAJCSAgICAgICB2b2lkICpoZWFkZXJzX2MsDQogCQkg
ICAgICAgdm9pZCAqaGVhZGVyc192LCB1OCAqbWF0Y2hfbGV2ZWwpOw0KIA0KK2ludCBtbHg1ZV90
Y190dW5fcGFyc2VfdWRwX3BvcnRzKHN0cnVjdCBtbHg1ZV9wcml2ICpwcml2LA0KKwkJCQkgc3Ry
dWN0IG1seDVfZmxvd19zcGVjICpzcGVjLA0KKwkJCQkgc3RydWN0IHRjX2Nsc19mbG93ZXJfb2Zm
bG9hZCAqZiwNCisJCQkJIHZvaWQgKmhlYWRlcnNfYywNCisJCQkJIHZvaWQgKmhlYWRlcnNfdik7
DQorDQogI2VuZGlmIC8vX19NTFg1X0VOX1RDX1RVTk5FTF9IX18NCmRpZmYgLS1naXQgYS9kcml2
ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1L2NvcmUvZW4vdGNfdHVuX2dyZS5jIGIvZHJp
dmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2VuL3RjX3R1bl9ncmUuYw0KbmV3
IGZpbGUgbW9kZSAxMDA2NDQNCmluZGV4IDAwMDAwMDAwMDAwMC4uMDY5MDg0NDFkOTMyDQotLS0g
L2Rldi9udWxsDQorKysgYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1L2NvcmUv
ZW4vdGNfdHVuX2dyZS5jDQpAQCAtMCwwICsxLDk1IEBADQorLy8gU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IEdQTC0yLjAgT1IgTGludXgtT3BlbklCDQorLyogQ29weXJpZ2h0IChjKSAyMDE4IE1l
bGxhbm94IFRlY2hub2xvZ2llcy4gKi8NCisNCisjaW5jbHVkZSA8bmV0L2dyZS5oPg0KKyNpbmNs
dWRlICJlbi90Y190dW4uaCINCisNCitzdGF0aWMgYm9vbCBtbHg1ZV90Y190dW5fY2FuX29mZmxv
YWRfZ3JldGFwKHN0cnVjdCBtbHg1ZV9wcml2ICpwcml2KQ0KK3sNCisJcmV0dXJuICEhTUxYNV9D
QVBfRVNXKHByaXYtPm1kZXYsIG52Z3JlX2VuY2FwX2RlY2FwKTsNCit9DQorDQorc3RhdGljIGlu
dCBtbHg1ZV90Y190dW5fY2FsY19obGVuX2dyZXRhcChzdHJ1Y3QgbWx4NWVfZW5jYXBfZW50cnkg
KmUpDQorew0KKwlyZXR1cm4gZ3JlX2NhbGNfaGxlbihlLT50dW5faW5mby0+a2V5LnR1bl9mbGFn
cyk7DQorfQ0KKw0KK3N0YXRpYyBpbnQgbWx4NWVfdGNfdHVuX2luaXRfZW5jYXBfYXR0cl9ncmV0
YXAoc3RydWN0IG5ldF9kZXZpY2UgKnR1bm5lbF9kZXYsDQorCQkJCQkgICAgICAgc3RydWN0IG1s
eDVlX3ByaXYgKnByaXYsDQorCQkJCQkgICAgICAgc3RydWN0IG1seDVlX2VuY2FwX2VudHJ5ICpl
LA0KKwkJCQkJICAgICAgIHN0cnVjdCBuZXRsaW5rX2V4dF9hY2sgKmV4dGFjaykNCit7DQorCWUt
PnR1bm5lbCA9ICZncmVfdHVubmVsOw0KKwllLT5yZWZvcm1hdF90eXBlID0gTUxYNV9SRUZPUk1B
VF9UWVBFX0wyX1RPX05WR1JFOw0KKwlyZXR1cm4gMDsNCit9DQorDQorc3RhdGljIGludCBtbHg1
ZV9nZW5faXBfdHVubmVsX2hlYWRlcl9ncmV0YXAoY2hhciBidWZbXSwNCisJCQkJCSAgICAgX191
OCAqaXBfcHJvdG8sDQorCQkJCQkgICAgIHN0cnVjdCBtbHg1ZV9lbmNhcF9lbnRyeSAqZSkNCit7
DQorCWNvbnN0IHN0cnVjdCBpcF90dW5uZWxfa2V5ICp0dW5fa2V5ICA9ICZlLT50dW5faW5mby0+
a2V5Ow0KKwlzdHJ1Y3QgZ3JlX2Jhc2VfaGRyICpncmVoID0gKHN0cnVjdCBncmVfYmFzZV9oZHIg
KikoYnVmKTsNCisJX19iZTMyIHR1bl9pZCA9IHR1bm5lbF9pZF90b19rZXkzMih0dW5fa2V5LT50
dW5faWQpOw0KKwlpbnQgaGRyX2xlbjsNCisNCisJKmlwX3Byb3RvID0gSVBQUk9UT19HUkU7DQor
DQorCS8qIHRoZSBIVyBkb2VzIG5vdCBjYWxjdWxhdGUgR1JFIGNzdW0gb3Igc2VxdWVuY2VzICov
DQorCWlmICh0dW5fa2V5LT50dW5fZmxhZ3MgJiAoVFVOTkVMX0NTVU0gfCBUVU5ORUxfU0VRKSkN
CisJCXJldHVybiAtRU9QTk9UU1VQUDsNCisNCisJZ3JlaC0+cHJvdG9jb2wgPSBodG9ucyhFVEhf
UF9URUIpOw0KKw0KKwkvKiBHUkUga2V5ICovDQorCWhkcl9sZW4JPSBtbHg1ZV90Y190dW5fY2Fs
Y19obGVuX2dyZXRhcChlKTsNCisJZ3JlaC0+ZmxhZ3MgPSBncmVfdG5sX2ZsYWdzX3RvX2dyZV9m
bGFncyh0dW5fa2V5LT50dW5fZmxhZ3MpOw0KKwlpZiAodHVuX2tleS0+dHVuX2ZsYWdzICYgVFVO
TkVMX0tFWSkgew0KKwkJX19iZTMyICpwdHIgPSAoX19iZTMyICopKCgodTggKilncmVoKSArIGhk
cl9sZW4gLSA0KTsNCisJCSpwdHIgPSB0dW5faWQ7DQorCX0NCisNCisJcmV0dXJuIDA7DQorfQ0K
Kw0KK3N0YXRpYyBpbnQgbWx4NWVfdGNfdHVuX3BhcnNlX2dyZXRhcChzdHJ1Y3QgbWx4NWVfcHJp
diAqcHJpdiwNCisJCQkJICAgICBzdHJ1Y3QgbWx4NV9mbG93X3NwZWMgKnNwZWMsDQorCQkJCSAg
ICAgc3RydWN0IHRjX2Nsc19mbG93ZXJfb2ZmbG9hZCAqZiwNCisJCQkJICAgICB2b2lkICpoZWFk
ZXJzX2MsDQorCQkJCSAgICAgdm9pZCAqaGVhZGVyc192KQ0KK3sNCisJdm9pZCAqbWlzY19jID0g
TUxYNV9BRERSX09GKGZ0ZV9tYXRjaF9wYXJhbSwgc3BlYy0+bWF0Y2hfY3JpdGVyaWEsIG1pc2Nf
cGFyYW1ldGVycyk7DQorCXZvaWQgKm1pc2NfdiA9IE1MWDVfQUREUl9PRihmdGVfbWF0Y2hfcGFy
YW0sIHNwZWMtPm1hdGNoX3ZhbHVlLCBtaXNjX3BhcmFtZXRlcnMpOw0KKwlzdHJ1Y3QgZmxvd19y
dWxlICpydWxlID0gdGNfY2xzX2Zsb3dlcl9vZmZsb2FkX2Zsb3dfcnVsZShmKTsNCisNCisJTUxY
NV9TRVRfVE9fT05FUyhmdGVfbWF0Y2hfc2V0X2x5cl8yXzQsIGhlYWRlcnNfYywgaXBfcHJvdG9j
b2wpOw0KKwlNTFg1X1NFVChmdGVfbWF0Y2hfc2V0X2x5cl8yXzQsIGhlYWRlcnNfdiwgaXBfcHJv
dG9jb2wsIElQUFJPVE9fR1JFKTsNCisNCisJLyogZ3JlIHByb3RvY29sICovDQorCU1MWDVfU0VU
X1RPX09ORVMoZnRlX21hdGNoX3NldF9taXNjLCBtaXNjX2MsIGdyZV9wcm90b2NvbCk7DQorCU1M
WDVfU0VUKGZ0ZV9tYXRjaF9zZXRfbWlzYywgbWlzY192LCBncmVfcHJvdG9jb2wsIEVUSF9QX1RF
Qik7DQorDQorCS8qIGdyZSBrZXkgKi8NCisJaWYgKGZsb3dfcnVsZV9tYXRjaF9rZXkocnVsZSwg
RkxPV19ESVNTRUNUT1JfS0VZX0VOQ19LRVlJRCkpIHsNCisJCXN0cnVjdCBmbG93X21hdGNoX2Vu
Y19rZXlpZCBlbmNfa2V5aWQ7DQorDQorCQlmbG93X3J1bGVfbWF0Y2hfZW5jX2tleWlkKHJ1bGUs
ICZlbmNfa2V5aWQpOw0KKwkJTUxYNV9TRVQoZnRlX21hdGNoX3NldF9taXNjLCBtaXNjX2MsDQor
CQkJIGdyZV9rZXkua2V5LCBiZTMyX3RvX2NwdShlbmNfa2V5aWQubWFzay0+a2V5aWQpKTsNCisJ
CU1MWDVfU0VUKGZ0ZV9tYXRjaF9zZXRfbWlzYywgbWlzY192LA0KKwkJCSBncmVfa2V5LmtleSwg
YmUzMl90b19jcHUoZW5jX2tleWlkLmtleS0+a2V5aWQpKTsNCisJfQ0KKw0KKwlyZXR1cm4gMDsN
Cit9DQorDQorc3RydWN0IG1seDVlX3RjX3R1bm5lbCBncmVfdHVubmVsID0gew0KKwkudHVubmVs
X3R5cGUgICAgICAgICAgPSBNTFg1RV9UQ19UVU5ORUxfVFlQRV9HUkVUQVAsDQorCS5tYXRjaF9s
ZXZlbCAgICAgICAgICA9IE1MWDVfTUFUQ0hfTDMsDQorCS5jYW5fb2ZmbG9hZCAgICAgICAgICA9
IG1seDVlX3RjX3R1bl9jYW5fb2ZmbG9hZF9ncmV0YXAsDQorCS5jYWxjX2hsZW4gICAgICAgICAg
ICA9IG1seDVlX3RjX3R1bl9jYWxjX2hsZW5fZ3JldGFwLA0KKwkuaW5pdF9lbmNhcF9hdHRyICAg
ICAgPSBtbHg1ZV90Y190dW5faW5pdF9lbmNhcF9hdHRyX2dyZXRhcCwNCisJLmdlbmVyYXRlX2lw
X3R1bl9oZHIgID0gbWx4NWVfZ2VuX2lwX3R1bm5lbF9oZWFkZXJfZ3JldGFwLA0KKwkucGFyc2Vf
dWRwX3BvcnRzICAgICAgPSBOVUxMLA0KKwkucGFyc2VfdHVubmVsICAgICAgICAgPSBtbHg1ZV90
Y190dW5fcGFyc2VfZ3JldGFwLA0KK307DQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9uZXQvZXRoZXJu
ZXQvbWVsbGFub3gvbWx4NS9jb3JlL2VuL3RjX3R1bl92eGxhbi5jIGIvZHJpdmVycy9uZXQvZXRo
ZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2VuL3RjX3R1bl92eGxhbi5jDQpuZXcgZmlsZSBtb2Rl
IDEwMDY0NA0KaW5kZXggMDAwMDAwMDAwMDAwLi4yODU3YjM4NTI3ZDYNCi0tLSAvZGV2L251bGwN
CisrKyBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9lbi90Y190dW5f
dnhsYW4uYw0KQEAgLTAsMCArMSwxNTEgQEANCisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjog
R1BMLTIuMCBPUiBMaW51eC1PcGVuSUINCisvKiBDb3B5cmlnaHQgKGMpIDIwMTggTWVsbGFub3gg
VGVjaG5vbG9naWVzLiAqLw0KKw0KKyNpbmNsdWRlIDxuZXQvdnhsYW4uaD4NCisjaW5jbHVkZSAi
bGliL3Z4bGFuLmgiDQorI2luY2x1ZGUgImVuL3RjX3R1bi5oIg0KKw0KK3N0YXRpYyBib29sIG1s
eDVlX3RjX3R1bl9jYW5fb2ZmbG9hZF92eGxhbihzdHJ1Y3QgbWx4NWVfcHJpdiAqcHJpdikNCit7
DQorCXJldHVybiAhIU1MWDVfQ0FQX0VTVyhwcml2LT5tZGV2LCB2eGxhbl9lbmNhcF9kZWNhcCk7
DQorfQ0KKw0KK3N0YXRpYyBpbnQgbWx4NWVfdGNfdHVuX2NhbGNfaGxlbl92eGxhbihzdHJ1Y3Qg
bWx4NWVfZW5jYXBfZW50cnkgKmUpDQorew0KKwlyZXR1cm4gVlhMQU5fSExFTjsNCit9DQorDQor
c3RhdGljIGludCBtbHg1ZV90Y190dW5fY2hlY2tfdWRwX2Rwb3J0X3Z4bGFuKHN0cnVjdCBtbHg1
ZV9wcml2ICpwcml2LA0KKwkJCQkJICAgICAgc3RydWN0IHRjX2Nsc19mbG93ZXJfb2ZmbG9hZCAq
ZikNCit7DQorCXN0cnVjdCBmbG93X3J1bGUgKnJ1bGUgPSB0Y19jbHNfZmxvd2VyX29mZmxvYWRf
Zmxvd19ydWxlKGYpOw0KKwlzdHJ1Y3QgbmV0bGlua19leHRfYWNrICpleHRhY2sgPSBmLT5jb21t
b24uZXh0YWNrOw0KKwlzdHJ1Y3QgZmxvd19tYXRjaF9wb3J0cyBlbmNfcG9ydHM7DQorDQorCWlm
ICghZmxvd19ydWxlX21hdGNoX2tleShydWxlLCBGTE9XX0RJU1NFQ1RPUl9LRVlfRU5DX1BPUlRT
KSkNCisJCXJldHVybiAtRU9QTk9UU1VQUDsNCisNCisJZmxvd19ydWxlX21hdGNoX2VuY19wb3J0
cyhydWxlLCAmZW5jX3BvcnRzKTsNCisNCisJLyogY2hlY2sgdGhlIFVEUCBkZXN0aW5hdGlvbiBw
b3J0IHZhbGlkaXR5ICovDQorDQorCWlmICghbWx4NV92eGxhbl9sb29rdXBfcG9ydChwcml2LT5t
ZGV2LT52eGxhbiwNCisJCQkJICAgIGJlMTZfdG9fY3B1KGVuY19wb3J0cy5rZXktPmRzdCkpKSB7
DQorCQlOTF9TRVRfRVJSX01TR19NT0QoZXh0YWNrLA0KKwkJCQkgICAiTWF0Y2hlZCBVRFAgZHN0
IHBvcnQgaXMgbm90IHJlZ2lzdGVyZWQgYXMgYSBWWExBTiBwb3J0Iik7DQorCQluZXRkZXZfd2Fy
bihwcml2LT5uZXRkZXYsDQorCQkJICAgICJVRFAgcG9ydCAlZCBpcyBub3QgcmVnaXN0ZXJlZCBh
cyBhIFZYTEFOIHBvcnRcbiIsDQorCQkJICAgIGJlMTZfdG9fY3B1KGVuY19wb3J0cy5rZXktPmRz
dCkpOw0KKwkJcmV0dXJuIC1FT1BOT1RTVVBQOw0KKwl9DQorDQorCXJldHVybiAwOw0KK30NCisN
CitzdGF0aWMgaW50IG1seDVlX3RjX3R1bl9wYXJzZV91ZHBfcG9ydHNfdnhsYW4oc3RydWN0IG1s
eDVlX3ByaXYgKnByaXYsDQorCQkJCQkgICAgICBzdHJ1Y3QgbWx4NV9mbG93X3NwZWMgKnNwZWMs
DQorCQkJCQkgICAgICBzdHJ1Y3QgdGNfY2xzX2Zsb3dlcl9vZmZsb2FkICpmLA0KKwkJCQkJICAg
ICAgdm9pZCAqaGVhZGVyc19jLA0KKwkJCQkJICAgICAgdm9pZCAqaGVhZGVyc192KQ0KK3sNCisJ
aW50IGVyciA9IDA7DQorDQorCWVyciA9IG1seDVlX3RjX3R1bl9wYXJzZV91ZHBfcG9ydHMocHJp
diwgc3BlYywgZiwgaGVhZGVyc19jLCBoZWFkZXJzX3YpOw0KKwlpZiAoZXJyKQ0KKwkJcmV0dXJu
IGVycjsNCisNCisJcmV0dXJuIG1seDVlX3RjX3R1bl9jaGVja191ZHBfZHBvcnRfdnhsYW4ocHJp
diwgZik7DQorfQ0KKw0KK3N0YXRpYyBpbnQgbWx4NWVfdGNfdHVuX2luaXRfZW5jYXBfYXR0cl92
eGxhbihzdHJ1Y3QgbmV0X2RldmljZSAqdHVubmVsX2RldiwNCisJCQkJCSAgICAgIHN0cnVjdCBt
bHg1ZV9wcml2ICpwcml2LA0KKwkJCQkJICAgICAgc3RydWN0IG1seDVlX2VuY2FwX2VudHJ5ICpl
LA0KKwkJCQkJICAgICAgc3RydWN0IG5ldGxpbmtfZXh0X2FjayAqZXh0YWNrKQ0KK3sNCisJaW50
IGRzdF9wb3J0ID0gYmUxNl90b19jcHUoZS0+dHVuX2luZm8tPmtleS50cF9kc3QpOw0KKw0KKwll
LT50dW5uZWwgPSAmdnhsYW5fdHVubmVsOw0KKw0KKwlpZiAoIW1seDVfdnhsYW5fbG9va3VwX3Bv
cnQocHJpdi0+bWRldi0+dnhsYW4sIGRzdF9wb3J0KSkgew0KKwkJTkxfU0VUX0VSUl9NU0dfTU9E
KGV4dGFjaywNCisJCQkJICAgInZ4bGFuIHVkcCBkcG9ydCB3YXMgbm90IHJlZ2lzdGVyZWQgd2l0
aCB0aGUgSFciKTsNCisJCW5ldGRldl93YXJuKHByaXYtPm5ldGRldiwNCisJCQkgICAgIiVkIGlz
bid0IGFuIG9mZmxvYWRlZCB2eGxhbiB1ZHAgZHBvcnRcbiIsDQorCQkJICAgIGRzdF9wb3J0KTsN
CisJCXJldHVybiAtRU9QTk9UU1VQUDsNCisJfQ0KKw0KKwllLT5yZWZvcm1hdF90eXBlID0gTUxY
NV9SRUZPUk1BVF9UWVBFX0wyX1RPX1ZYTEFOOw0KKwlyZXR1cm4gMDsNCit9DQorDQorc3RhdGlj
IGludCBtbHg1ZV9nZW5faXBfdHVubmVsX2hlYWRlcl92eGxhbihjaGFyIGJ1ZltdLA0KKwkJCQkJ
ICAgIF9fdTggKmlwX3Byb3RvLA0KKwkJCQkJICAgIHN0cnVjdCBtbHg1ZV9lbmNhcF9lbnRyeSAq
ZSkNCit7DQorCWNvbnN0IHN0cnVjdCBpcF90dW5uZWxfa2V5ICp0dW5fa2V5ID0gJmUtPnR1bl9p
bmZvLT5rZXk7DQorCV9fYmUzMiB0dW5faWQgPSB0dW5uZWxfaWRfdG9fa2V5MzIodHVuX2tleS0+
dHVuX2lkKTsNCisJc3RydWN0IHVkcGhkciAqdWRwID0gKHN0cnVjdCB1ZHBoZHIgKikoYnVmKTsN
CisJc3RydWN0IHZ4bGFuaGRyICp2eGg7DQorDQorCXZ4aCA9IChzdHJ1Y3QgdnhsYW5oZHIgKiko
KGNoYXIgKil1ZHAgKyBzaXplb2Yoc3RydWN0IHVkcGhkcikpOw0KKwkqaXBfcHJvdG8gPSBJUFBS
T1RPX1VEUDsNCisNCisJdWRwLT5kZXN0ID0gdHVuX2tleS0+dHBfZHN0Ow0KKwl2eGgtPnZ4X2Zs
YWdzID0gVlhMQU5fSEZfVk5JOw0KKwl2eGgtPnZ4X3ZuaSA9IHZ4bGFuX3ZuaV9maWVsZCh0dW5f
aWQpOw0KKw0KKwlyZXR1cm4gMDsNCit9DQorDQorc3RhdGljIGludCBtbHg1ZV90Y190dW5fcGFy
c2VfdnhsYW4oc3RydWN0IG1seDVlX3ByaXYgKnByaXYsDQorCQkJCSAgICBzdHJ1Y3QgbWx4NV9m
bG93X3NwZWMgKnNwZWMsDQorCQkJCSAgICBzdHJ1Y3QgdGNfY2xzX2Zsb3dlcl9vZmZsb2FkICpm
LA0KKwkJCQkgICAgdm9pZCAqaGVhZGVyc19jLA0KKwkJCQkgICAgdm9pZCAqaGVhZGVyc192KQ0K
K3sNCisJc3RydWN0IGZsb3dfcnVsZSAqcnVsZSA9IHRjX2Nsc19mbG93ZXJfb2ZmbG9hZF9mbG93
X3J1bGUoZik7DQorCXN0cnVjdCBuZXRsaW5rX2V4dF9hY2sgKmV4dGFjayA9IGYtPmNvbW1vbi5l
eHRhY2s7DQorCXN0cnVjdCBmbG93X21hdGNoX2VuY19rZXlpZCBlbmNfa2V5aWQ7DQorCXZvaWQg
Km1pc2NfYywgKm1pc2NfdjsNCisNCisJbWlzY19jID0gTUxYNV9BRERSX09GKGZ0ZV9tYXRjaF9w
YXJhbSwgc3BlYy0+bWF0Y2hfY3JpdGVyaWEsIG1pc2NfcGFyYW1ldGVycyk7DQorCW1pc2NfdiA9
IE1MWDVfQUREUl9PRihmdGVfbWF0Y2hfcGFyYW0sIHNwZWMtPm1hdGNoX3ZhbHVlLCBtaXNjX3Bh
cmFtZXRlcnMpOw0KKw0KKwlpZiAoIWZsb3dfcnVsZV9tYXRjaF9rZXkocnVsZSwgRkxPV19ESVNT
RUNUT1JfS0VZX0VOQ19LRVlJRCkpDQorCQlyZXR1cm4gMDsNCisNCisJZmxvd19ydWxlX21hdGNo
X2VuY19rZXlpZChydWxlLCAmZW5jX2tleWlkKTsNCisNCisJaWYgKCFlbmNfa2V5aWQubWFzay0+
a2V5aWQpDQorCQlyZXR1cm4gMDsNCisNCisJLyogbWF0Y2ggb24gVk5JIGlzIHJlcXVpcmVkICov
DQorDQorCWlmICghTUxYNV9DQVBfRVNXX0ZMT1dUQUJMRV9GREIocHJpdi0+bWRldiwNCisJCQkJ
CWZ0X2ZpZWxkX3N1cHBvcnQub3V0ZXJfdnhsYW5fdm5pKSkgew0KKwkJTkxfU0VUX0VSUl9NU0df
TU9EKGV4dGFjaywNCisJCQkJICAgIk1hdGNoaW5nIG9uIFZYTEFOIFZOSSBpcyBub3Qgc3VwcG9y
dGVkIik7DQorCQluZXRkZXZfd2Fybihwcml2LT5uZXRkZXYsDQorCQkJICAgICJNYXRjaGluZyBv
biBWWExBTiBWTkkgaXMgbm90IHN1cHBvcnRlZFxuIik7DQorCQlyZXR1cm4gLUVPUE5PVFNVUFA7
DQorCX0NCisNCisJTUxYNV9TRVQoZnRlX21hdGNoX3NldF9taXNjLCBtaXNjX2MsIHZ4bGFuX3Zu
aSwNCisJCSBiZTMyX3RvX2NwdShlbmNfa2V5aWQubWFzay0+a2V5aWQpKTsNCisJTUxYNV9TRVQo
ZnRlX21hdGNoX3NldF9taXNjLCBtaXNjX3YsIHZ4bGFuX3ZuaSwNCisJCSBiZTMyX3RvX2NwdShl
bmNfa2V5aWQua2V5LT5rZXlpZCkpOw0KKw0KKwlyZXR1cm4gMDsNCit9DQorDQorc3RydWN0IG1s
eDVlX3RjX3R1bm5lbCB2eGxhbl90dW5uZWwgPSB7DQorCS50dW5uZWxfdHlwZSAgICAgICAgICA9
IE1MWDVFX1RDX1RVTk5FTF9UWVBFX1ZYTEFOLA0KKwkubWF0Y2hfbGV2ZWwgICAgICAgICAgPSBN
TFg1X01BVENIX0w0LA0KKwkuY2FuX29mZmxvYWQgICAgICAgICAgPSBtbHg1ZV90Y190dW5fY2Fu
X29mZmxvYWRfdnhsYW4sDQorCS5jYWxjX2hsZW4gICAgICAgICAgICA9IG1seDVlX3RjX3R1bl9j
YWxjX2hsZW5fdnhsYW4sDQorCS5pbml0X2VuY2FwX2F0dHIgICAgICA9IG1seDVlX3RjX3R1bl9p
bml0X2VuY2FwX2F0dHJfdnhsYW4sDQorCS5nZW5lcmF0ZV9pcF90dW5faGRyICA9IG1seDVlX2dl
bl9pcF90dW5uZWxfaGVhZGVyX3Z4bGFuLA0KKwkucGFyc2VfdWRwX3BvcnRzICAgICAgPSBtbHg1
ZV90Y190dW5fcGFyc2VfdWRwX3BvcnRzX3Z4bGFuLA0KKwkucGFyc2VfdHVubmVsICAgICAgICAg
PSBtbHg1ZV90Y190dW5fcGFyc2VfdnhsYW4sDQorfTsNCmRpZmYgLS1naXQgYS9kcml2ZXJzL25l
dC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1L2NvcmUvZW5fcmVwLmggYi9kcml2ZXJzL25ldC9ldGhl
cm5ldC9tZWxsYW5veC9tbHg1L2NvcmUvZW5fcmVwLmgNCmluZGV4IDU0NzJiYjRhMGI1MS4uZDQ1
ODVmM2I4Y2IyIDEwMDY0NA0KLS0tIGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4
NS9jb3JlL2VuX3JlcC5oDQorKysgYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1
L2NvcmUvZW5fcmVwLmgNCkBAIC0xNTUsOCArMTU1LDcgQEAgc3RydWN0IG1seDVlX2VuY2FwX2Vu
dHJ5IHsNCiANCiAJc3RydWN0IG5ldF9kZXZpY2UgKm91dF9kZXY7DQogCXN0cnVjdCBuZXRfZGV2
aWNlICpyb3V0ZV9kZXY7DQotCWludCB0dW5uZWxfdHlwZTsNCi0JaW50IHR1bm5lbF9obGVuOw0K
KwlzdHJ1Y3QgbWx4NWVfdGNfdHVubmVsICp0dW5uZWw7DQogCWludCByZWZvcm1hdF90eXBlOw0K
IAl1OCBmbGFnczsNCiAJY2hhciAqZW5jYXBfaGVhZGVyOw0KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
bmV0L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9lbl90Yy5jIGIvZHJpdmVycy9uZXQvZXRo
ZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2VuX3RjLmMNCmluZGV4IDhiMDZjOThjZDQzNi4uOTE1
ZjBhYmMyMWUyIDEwMDY0NA0KLS0tIGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4
NS9jb3JlL2VuX3RjLmMNCisrKyBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L21lbGxhbm94L21seDUv
Y29yZS9lbl90Yy5jDQpAQCAtMjU2OSwyMCArMjU2OSwyMCBAQCBzdGF0aWMgaW50IHBhcnNlX3Rj
X25pY19hY3Rpb25zKHN0cnVjdCBtbHg1ZV9wcml2ICpwcml2LA0KIA0KIHN0cnVjdCBlbmNhcF9r
ZXkgew0KIAljb25zdCBzdHJ1Y3QgaXBfdHVubmVsX2tleSAqaXBfdHVuX2tleTsNCi0JaW50IHR1
bm5lbF90eXBlOw0KKwlzdHJ1Y3QgbWx4NWVfdGNfdHVubmVsICp0Y190dW5uZWw7DQogfTsNCiAN
CiBzdGF0aWMgaW5saW5lIGludCBjbXBfZW5jYXBfaW5mbyhzdHJ1Y3QgZW5jYXBfa2V5ICphLA0K
IAkJCQkgc3RydWN0IGVuY2FwX2tleSAqYikNCiB7DQogCXJldHVybiBtZW1jbXAoYS0+aXBfdHVu
X2tleSwgYi0+aXBfdHVuX2tleSwgc2l6ZW9mKCphLT5pcF90dW5fa2V5KSkgfHwNCi0JICAgICAg
IGEtPnR1bm5lbF90eXBlICE9IGItPnR1bm5lbF90eXBlOw0KKwkgICAgICAgYS0+dGNfdHVubmVs
LT50dW5uZWxfdHlwZSAhPSBiLT50Y190dW5uZWwtPnR1bm5lbF90eXBlOw0KIH0NCiANCiBzdGF0
aWMgaW5saW5lIGludCBoYXNoX2VuY2FwX2luZm8oc3RydWN0IGVuY2FwX2tleSAqa2V5KQ0KIHsN
CiAJcmV0dXJuIGpoYXNoKGtleS0+aXBfdHVuX2tleSwgc2l6ZW9mKCprZXktPmlwX3R1bl9rZXkp
LA0KLQkJICAgICBrZXktPnR1bm5lbF90eXBlKTsNCisJCSAgICAga2V5LT50Y190dW5uZWwtPnR1
bm5lbF90eXBlKTsNCiB9DQogDQogDQpAQCAtMjYyNCwxNCArMjYyNCwxNCBAQCBzdGF0aWMgaW50
IG1seDVlX2F0dGFjaF9lbmNhcChzdHJ1Y3QgbWx4NWVfcHJpdiAqcHJpdiwNCiAJdHVuX2luZm8g
PSBwYXJzZV9hdHRyLT50dW5faW5mb1tvdXRfaW5kZXhdOw0KIAlmYW1pbHkgPSBpcF90dW5uZWxf
aW5mb19hZih0dW5faW5mbyk7DQogCWtleS5pcF90dW5fa2V5ID0gJnR1bl9pbmZvLT5rZXk7DQot
CWtleS50dW5uZWxfdHlwZSA9IG1seDVlX3RjX3R1bl9nZXRfdHlwZShtaXJyZWRfZGV2KTsNCisJ
a2V5LnRjX3R1bm5lbCA9IG1seDVlX2dldF90Y190dW4obWlycmVkX2Rldik7DQogDQogCWhhc2hf
a2V5ID0gaGFzaF9lbmNhcF9pbmZvKCZrZXkpOw0KIA0KIAloYXNoX2Zvcl9lYWNoX3Bvc3NpYmxl
X3JjdShlc3ctPm9mZmxvYWRzLmVuY2FwX3RibCwgZSwNCiAJCQkJICAgZW5jYXBfaGxpc3QsIGhh
c2hfa2V5KSB7DQogCQllX2tleS5pcF90dW5fa2V5ID0gJmUtPnR1bl9pbmZvLT5rZXk7DQotCQll
X2tleS50dW5uZWxfdHlwZSA9IGUtPnR1bm5lbF90eXBlOw0KKwkJZV9rZXkudGNfdHVubmVsID0g
ZS0+dHVubmVsOw0KIAkJaWYgKCFjbXBfZW5jYXBfaW5mbygmZV9rZXksICZrZXkpKSB7DQogCQkJ
Zm91bmQgPSB0cnVlOw0KIAkJCWJyZWFrOw0KLS0gDQoyLjIxLjANCg0K
