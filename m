Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 59FE91B1113
	for <lists+netdev@lfdr.de>; Mon, 20 Apr 2020 18:05:28 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1728271AbgDTQDl (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Mon, 20 Apr 2020 12:03:41 -0400
Received: from mail-dm6nam10on2078.outbound.protection.outlook.com ([40.107.93.78]:42592
        "EHLO NAM10-DM6-obe.outbound.protection.outlook.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1726973AbgDTQDi (ORCPT <rfc822;netdev@vger.kernel.org>);
        Mon, 20 Apr 2020 12:03:38 -0400
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=HEXz+8peau+UYuxV4ZR2fwbFfLeUgR8wCtUxqhvav0TfGLxUkJpXLhMm0WFD61mQs7K8uQu3t+JLUs/X3XT2HZcypa0aUxn8avSmuTG/WMMU5DB6Ni8QQTmxC/+zIOJNaaCD+wfDmngEgBj/uViZh/NNFqjkBEhahfpcMrHRk0Dmoal2gV6l8AmePc5jwIjm8a/qQCUjixCbIp/PXLOEam+yYZzPCPkbeAnbzUYUnYmPsHc8KFBgHeJDyzWRdsJzqW94MqeLZ51oXNjBdDX4HmqM3Uztjg6q4El/AF3fFiXVGgv9RykNkJWYOzLnJWKu3Cs5c1pNrIULuRrARKVlRA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=4rFrMcu/Tn2AvjEWwiJmrsBWjUUpAZGtbNMnDrXfhUg=;
 b=OGy+dkqNghVble3mlGE0CoY9tzHnniW0fgjkARP0CCgGc2tHgRLRBz5Dx8TpnfR9IKtOQNMbN7n7xZ/FW8r9fZjROaG1Q3bZo6WSulsfSX5gXHe+qfQzlAzbbxrXO5HLOm5JlVy5GU/z46qVsUFIXv6k18w3rh4gWpU+9XQYjb7ZV5xu7umSNclM501HPV2yESsstpAGjypiKkR5crFcXCNy4N0DEuDYlKcsBiXLNGq3aDXLiz0KlM1EOskwQZWNsab6BCW1cT0FYN3c8Uo3uDQFIATg+r3oTU3/XTZkQFPBF+PlI/sQ0qJeFzV1jGH/frsUrFhnhExi15S8/POFzw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=silabs.com; dmarc=pass action=none header.from=silabs.com;
 dkim=pass header.d=silabs.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=silabs.onmicrosoft.com; s=selector2-silabs-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=4rFrMcu/Tn2AvjEWwiJmrsBWjUUpAZGtbNMnDrXfhUg=;
 b=HqqGQUt7EbpcHWaCfbEulOuU65gIGi0yk8ho8f+si5N55WY60iVA0gSpejD/L2P5seKyrhb6/Ti0KZIjHVvxCZlz8WxSpPVlsVMsiw5QvLGgCsdu8r1bYDMBxpv3y00Wgo5JH+bKGxeozGxf6eoT8p7HzTHBGBZpL98DPSWRQ7I=
Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Jerome.Pouiller@silabs.com; 
Received: from MWHPR11MB1775.namprd11.prod.outlook.com (2603:10b6:300:10e::14)
 by MWHPR11MB1792.namprd11.prod.outlook.com (2603:10b6:300:10b::9) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2921.29; Mon, 20 Apr
 2020 16:03:32 +0000
Received: from MWHPR11MB1775.namprd11.prod.outlook.com
 ([fe80::81d5:b62b:3770:ffbe]) by MWHPR11MB1775.namprd11.prod.outlook.com
 ([fe80::81d5:b62b:3770:ffbe%10]) with mapi id 15.20.2921.030; Mon, 20 Apr
 2020 16:03:32 +0000
From:   Jerome Pouiller <Jerome.Pouiller@silabs.com>
To:     devel@driverdev.osuosl.org, linux-wireless@vger.kernel.org
Cc:     netdev@vger.kernel.org, linux-kernel@vger.kernel.org,
        Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
        Kalle Valo <kvalo@codeaurora.org>,
        "David S . Miller" <davem@davemloft.net>,
        =?UTF-8?q?J=C3=A9r=C3=B4me=20Pouiller?= 
        <jerome.pouiller@silabs.com>
Subject: [PATCH 02/16] staging: wfx: use ieee80211_beacon_loss() provided by mac80211
Date:   Mon, 20 Apr 2020 18:02:57 +0200
Message-Id: <20200420160311.57323-3-Jerome.Pouiller@silabs.com>
X-Mailer: git-send-email 2.26.1
In-Reply-To: <20200420160311.57323-1-Jerome.Pouiller@silabs.com>
References: <20200420160311.57323-1-Jerome.Pouiller@silabs.com>
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: base64
X-ClientProxiedBy: DM6PR07CA0065.namprd07.prod.outlook.com
 (2603:10b6:5:74::42) To MWHPR11MB1775.namprd11.prod.outlook.com
 (2603:10b6:300:10e::14)
MIME-Version: 1.0
X-MS-Exchange-MessageSentRepresentingType: 1
Received: from pc-42.silabs.com (2a01:e35:2435:66a0:544b:f17b:7ae8:fb7) by DM6PR07CA0065.namprd07.prod.outlook.com (2603:10b6:5:74::42) with Microsoft SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2921.26 via Frontend Transport; Mon, 20 Apr 2020 16:03:30 +0000
X-Mailer: git-send-email 2.26.1
X-Originating-IP: [2a01:e35:2435:66a0:544b:f17b:7ae8:fb7]
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 1e5398b1-a095-43d0-76f3-08d7e5445f57
X-MS-TrafficTypeDiagnostic: MWHPR11MB1792:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <MWHPR11MB17922F81178D7DBC80ACC4C193D40@MWHPR11MB1792.namprd11.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:2733;
X-Forefront-PRVS: 03793408BA
X-Forefront-Antispam-Report: CIP:255.255.255.255;CTRY:;LANG:en;SCL:1;SRV:;IPV:NLI;SFV:NSPM;H:MWHPR11MB1775.namprd11.prod.outlook.com;PTR:;CAT:NONE;SFTY:;SFS:(10009020)(39850400004)(346002)(376002)(366004)(396003)(136003)(66476007)(66556008)(186003)(66946007)(4326008)(86362001)(16526019)(107886003)(6666004)(81156014)(7696005)(478600001)(52116002)(8676002)(66574012)(54906003)(316002)(6486002)(1076003)(2616005)(36756003)(8936002)(5660300002)(2906002);DIR:OUT;SFP:1101;
Received-SPF: None (protection.outlook.com: silabs.com does not designate
 permitted sender hosts)
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: 5nX6MqCZSajDJnU/VITWx3jArImCZDYQPXI8MJ9RPqmDyoDReblNeDx5AK+mbmCLq18PlzWHbTqUovYMGKGNZ8Squ2x6cHKS0+xpZmWPCcQB+jveWTNfJeyBw61/Lnc/1VpP6lg5uXleBOyqxCK6Th5TACgttPxMAV2mqu3rucTJ62D8CtyptM0B416GnQN+RE9eKE3y/Kr1hmZ0W5xBWPxlwjUQ/oMH834viMWuK82Xac/jMPGCn6pwORt6IPjR1Fu4plAfmtzd/CLf4mp+qFMyq7dNdiP9HKc1f0ErEmgsU18NUzGcxT1rpEb56GVllIdXIILe5DYFmrkP+Dh7AnikcPFwvuLcvjXlv7h6tBSQ68X5LXOzfuJhY/JV41dLugcIBNfXvcBwh5TcuaJSjPV67zxvx2gnEjgx9Jt9nBlPSbUI/NLuc9zlpQf47pah
X-MS-Exchange-AntiSpam-MessageData: d53S+KlMjAKWPh+Txa3yDmYQiIcjNcH0YzOYLcVIs7yV1eyg/BMcFh7gsLae1U4GCaOMsMKZ5KUDAoZ8Di65sAl6eaNVVN1RdCXm+ScKE4MpuMgqBpI99asQx1TK8e2RfZesD5gVDur8TtWQK2zaXOG6F8DEd7klH8qI97t8VChfxVFpTbVOgc2ufxylwskc8lLXmoITa4AA3ojdyLt8vE8Ilndpr2klxLCFZI0mJHH6ITLBBd2M3v6+bZDVRTte8yWLb709g3PqiKpXbu5UXb6UfjYWxq+bgPwGPl/+/NqAXqlx2jHaCkZ91XwfQS9d7pPINx8PMtLW7hbN0hJZkf2R9y5zXjku+eT8igNmbLmMr7AjiJOSLEAjKxbZrG3OQUoddA8S7PIyY9/4V68Hwxv0wZmJ7lkf6WS8JLwv36rSsESDg9vYdqOfvt6uHRi6Z9LLW52M5/p26Xjzmz63pZ6aKjXQ/CdIMyyXNXp4HDcaLA9U3pEqaf7fsejxX4jSiXMownl0ol37zRYR5SUuPbBRkzbfNz0XjtZWXlo/mSR5mcextFc/vq0yy7e3Je7wSdH5HFnsgRcGiZI0v0yeWCoGIiLNmbWJImw0oTOyoAY4T6G3YDHbbaSRkHxUQlBILjT3aZUm7ErtxRzCJ648b+vov2ChPaUYCVnp0JGLqIe2N2iw7LjI+a0HaShLV/UYOEJ169is9GGE3xD79quazle5xNDqoChSQntsbFy94Ij47VSougo6Bf/8hOPBujbCcNuVyxiU1HU0QjhGeN/LFnqXdfQjdnA2sP4FGNOYnQSv+vUPVKz8m0P3PQwbzkzSOAfPHG0raybLjwOngpa9u6Jp6kowOE8YOR1UL/wZC2s=
X-OriginatorOrg: silabs.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 1e5398b1-a095-43d0-76f3-08d7e5445f57
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 20 Apr 2020 16:03:32.1086
 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 54dbd822-5231-4b20-944d-6f4abcd541fb
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: 9Lf1l+zU81nvD2qPLMU8D2bTncwhh2IGw89Wv+uxZQghAy5iNsyP2aC2NM/lz/MZKdYJ1PpLQAZxIA7jjrDSzQ==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: MWHPR11MB1792
Sender: netdev-owner@vger.kernel.org
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

RnJvbTogSsOpcsO0bWUgUG91aWxsZXIgPGplcm9tZS5wb3VpbGxlckBzaWxhYnMuY29tPgoKVGhl
IGZpcm13YXJlIGlzIGFibGUgdG8gZmlsdGVyIGJlYWNvbnMgYW5kIHNlbmQgYSBub3RpZmljYXRp
b24gaWYgb25lIG9yCm11bHRpcGxlIGJlYWNvbnMgYXJlIG5vdCByZWNlaXZlZC4gTm90ZSB0aGF0
IGl0IHNlbmQgdGhpcyBub3RpZmljYXRpb24Kb25seSBvbmNlLiBPbmx5IGlmIGl0IHJlY2VpdmUg
YmVhY29ucyBnYWluLCBpdCBzZW5kIGEgbmV3IG5vdGlmaWNhdGlvbi4KCkN1cnJlbnRseSwgdGhl
IGRyaXZlciBoYW5kbGUgdGhlIGNvbm5lY3Rpb24gbG9zcyBpdHNlbGYgKHNlZQp3ZnhfY3FtX2Jz
c2xvc3Nfc20oKSkuIEl0IHNlbmQgbnVsbCBmcmFtZXMgYW5kIHdhdGNoIHRoZSBhbnN3ZXJzLgoK
VGhpcyBwYXRjaCBmaXhlcyBhbGwgdGhpcyBtZXNzOgogIC0gc2V0dGxlIGZpcm13YXJlIHRvIHNl
bmQgYSBub3RpZmljYXRpb24gb24gdGhlIGZpcnN0IGJlYWNvbiBsb3NzCiAgLSBjYWxsIGllZWU4
MDIxMV9iZWFjb25fbG9zcygpIGFuZCBsZXQgbWFjODAyMTEgaGFuZGxlIGFsbCB0aGUgcHJvY2Vz
cwogIC0gc2luY2Ugd2UgZG8gaGF2ZSBub3RpZmljYXRpb24gZm9yIGVhY2ggYmVhY29uIGxvc3Ms
IGFkZCBhIHBlcmlvZAogICAgdGFzayB0aGF0IGNhbGwgaWVlZTgwMjExX2JlYWNvbl9sb3NzKCkg
dW50aWwgd2UgcmVjZWl2ZSAiUkVHQUlOIgogICAgbm90aWZpY2F0aW9uLgoKVGh1cywgd2UgY2Fu
IGRyb3AgdGhlIHVnbHkgd2Z4X2NxbV9ic3Nsb3NzX3NtKCkgYW5kCndmeF9ic3NfcGFyYW1zX3dv
cmsoKS4KClNpZ25lZC1vZmYtYnk6IErDqXLDtG1lIFBvdWlsbGVyIDxqZXJvbWUucG91aWxsZXJA
c2lsYWJzLmNvbT4KLS0tCiBkcml2ZXJzL3N0YWdpbmcvd2Z4L2RhdGFfdHguYyB8ICAgNyAtLS0K
IGRyaXZlcnMvc3RhZ2luZy93ZngvcXVldWUuYyAgIHwgIDExIC0tLS0KIGRyaXZlcnMvc3RhZ2lu
Zy93Zngvc3RhLmMgICAgIHwgMTA2ICsrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0K
IGRyaXZlcnMvc3RhZ2luZy93Zngvc3RhLmggICAgIHwgICAxIC0KIGRyaXZlcnMvc3RhZ2luZy93
Zngvd2Z4LmggICAgIHwgICA3ICstLQogNSBmaWxlcyBjaGFuZ2VkLCAyMCBpbnNlcnRpb25zKCsp
LCAxMTIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9zdGFnaW5nL3dmeC9kYXRh
X3R4LmMgYi9kcml2ZXJzL3N0YWdpbmcvd2Z4L2RhdGFfdHguYwppbmRleCBjMzBlNGY1YjZlMmQu
LjljMWE5MTIwN2RkOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9zdGFnaW5nL3dmeC9kYXRhX3R4LmMK
KysrIGIvZHJpdmVycy9zdGFnaW5nL3dmeC9kYXRhX3R4LmMKQEAgLTU0Nyw5ICs1NDcsNiBAQCB2
b2lkIHdmeF90eF9jb25maXJtX2NiKHN0cnVjdCB3ZnhfdmlmICp3dmlmLCBjb25zdCBzdHJ1Y3Qg
aGlmX2NuZl90eCAqYXJnKQogCW1lbXNldCh0eF9pbmZvLT5wYWQsIDAsIHNpemVvZih0eF9pbmZv
LT5wYWQpKTsKIAogCWlmICghYXJnLT5zdGF0dXMpIHsKLQkJaWYgKHd2aWYtPmJzc19sb3NzX3N0
YXRlICYmCi0JCSAgICBhcmctPnBhY2tldF9pZCA9PSB3dmlmLT5ic3NfbG9zc19jb25maXJtX2lk
KQotCQkJd2Z4X2NxbV9ic3Nsb3NzX3NtKHd2aWYsIDAsIDEsIDApOwogCQl0eF9pbmZvLT5zdGF0
dXMudHhfdGltZSA9CiAJCWFyZy0+bWVkaWFfZGVsYXkgLSBhcmctPnR4X3F1ZXVlX2RlbGF5Owog
CQlpZiAodHhfaW5mby0+ZmxhZ3MgJiBJRUVFODAyMTFfVFhfQ1RMX05PX0FDSykKQEAgLTU2Mywx
MCArNTYwLDYgQEAgdm9pZCB3ZnhfdHhfY29uZmlybV9jYihzdHJ1Y3Qgd2Z4X3ZpZiAqd3ZpZiwg
Y29uc3Qgc3RydWN0IGhpZl9jbmZfdHggKmFyZykKIAkJCXNjaGVkdWxlX3dvcmsoJnd2aWYtPnVw
ZGF0ZV90aW1fd29yayk7CiAJCX0KIAkJdHhfaW5mby0+ZmxhZ3MgfD0gSUVFRTgwMjExX1RYX1NU
QVRfVFhfRklMVEVSRUQ7Ci0JfSBlbHNlIHsKLQkJaWYgKHd2aWYtPmJzc19sb3NzX3N0YXRlICYm
Ci0JCSAgICBhcmctPnBhY2tldF9pZCA9PSB3dmlmLT5ic3NfbG9zc19jb25maXJtX2lkKQotCQkJ
d2Z4X2NxbV9ic3Nsb3NzX3NtKHd2aWYsIDAsIDAsIDEpOwogCX0KIAl3Znhfc2tiX2R0b3Iod3Zp
Zi0+d2Rldiwgc2tiKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvc3RhZ2luZy93ZngvcXVldWUu
YyBiL2RyaXZlcnMvc3RhZ2luZy93ZngvcXVldWUuYwppbmRleCBlNmQ3ZDBlNDUxNTYuLmU5NTcz
ZTlkMDA5ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9zdGFnaW5nL3dmeC9xdWV1ZS5jCisrKyBiL2Ry
aXZlcnMvc3RhZ2luZy93ZngvcXVldWUuYwpAQCAtMjY2LDE3ICsyNjYsNiBAQCBzdGF0aWMgYm9v
bCB3ZnhfaGFuZGxlX3R4X2RhdGEoc3RydWN0IHdmeF9kZXYgKndkZXYsIHN0cnVjdCBza19idWZm
ICpza2IpCiAJaWYgKCF3dmlmKQogCQlyZXR1cm4gZmFsc2U7CiAKLQkvLyBGSVhNRTogbWFjODAy
MTEgaXMgc21hcnQgZW5vdWdoIHRvIGhhbmRsZSBCU1MgbG9zcy4gRHJpdmVyIHNob3VsZCBub3QK
LQkvLyB0cnkgdG8gZG8gYW55dGhpbmcgYWJvdXQgdGhhdC4KLQlpZiAoaWVlZTgwMjExX2lzX251
bGxmdW5jKGZyYW1lLT5mcmFtZV9jb250cm9sKSkgewotCQltdXRleF9sb2NrKCZ3dmlmLT5ic3Nf
bG9zc19sb2NrKTsKLQkJaWYgKHd2aWYtPmJzc19sb3NzX3N0YXRlKSB7Ci0JCQl3dmlmLT5ic3Nf
bG9zc19jb25maXJtX2lkID0gcmVxLT5wYWNrZXRfaWQ7Ci0JCQlyZXEtPnF1ZXVlX2lkLnF1ZXVl
X2lkID0gSElGX1FVRVVFX0lEX1ZPSUNFOwotCQl9Ci0JCW11dGV4X3VubG9jaygmd3ZpZi0+YnNz
X2xvc3NfbG9jayk7Ci0JfQotCiAJLy8gRklYTUU6IGlkZW50aWZ5IHRoZSBleGFjdCBzY2VuYXJp
byBtYXRjaGVkIGJ5IHRoaXMgY29uZGl0aW9uLiBEb2VzIGl0CiAJLy8gaGFwcGVuIHlldD8KIAlp
ZiAoaWVlZTgwMjExX2hhc19wcm90ZWN0ZWQoZnJhbWUtPmZyYW1lX2NvbnRyb2wpICYmCmRpZmYg
LS1naXQgYS9kcml2ZXJzL3N0YWdpbmcvd2Z4L3N0YS5jIGIvZHJpdmVycy9zdGFnaW5nL3dmeC9z
dGEuYwppbmRleCBjMGMzZWI5NDU5NjcuLmNhODQ3MjRlNTMxYyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9zdGFnaW5nL3dmeC9zdGEuYworKysgYi9kcml2ZXJzL3N0YWdpbmcvd2Z4L3N0YS5jCkBAIC01
OSw2MCArNTksNiBAQCBzdGF0aWMgdm9pZCB3ZnhfZnJlZV9ldmVudF9xdWV1ZShzdHJ1Y3Qgd2Z4
X3ZpZiAqd3ZpZikKIAlfX3dmeF9mcmVlX2V2ZW50X3F1ZXVlKCZsaXN0KTsKIH0KIAotdm9pZCB3
ZnhfY3FtX2Jzc2xvc3Nfc20oc3RydWN0IHdmeF92aWYgKnd2aWYsIGludCBpbml0LCBpbnQgZ29v
ZCwgaW50IGJhZCkKLXsKLQlpbnQgdHggPSAwOwotCi0JbXV0ZXhfbG9jaygmd3ZpZi0+YnNzX2xv
c3NfbG9jayk7Ci0JY2FuY2VsX3dvcmtfc3luYygmd3ZpZi0+YnNzX3BhcmFtc193b3JrKTsKLQot
CWlmIChpbml0KSB7Ci0JCXNjaGVkdWxlX2RlbGF5ZWRfd29yaygmd3ZpZi0+YnNzX2xvc3Nfd29y
aywgSFopOwotCQl3dmlmLT5ic3NfbG9zc19zdGF0ZSA9IDA7Ci0KLQkJaWYgKCFhdG9taWNfcmVh
ZCgmd3ZpZi0+d2Rldi0+dHhfbG9jaykpCi0JCQl0eCA9IDE7Ci0JfSBlbHNlIGlmIChnb29kKSB7
Ci0JCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmd3ZpZi0+YnNzX2xvc3Nfd29yayk7Ci0JCXd2
aWYtPmJzc19sb3NzX3N0YXRlID0gMDsKLQkJc2NoZWR1bGVfd29yaygmd3ZpZi0+YnNzX3BhcmFt
c193b3JrKTsKLQl9IGVsc2UgaWYgKGJhZCkgewotCQkvKiBGSVhNRSBTaG91bGQgd2UganVzdCBr
ZWVwIGdvaW5nIHVudGlsIHdlIHRpbWUgb3V0PyAqLwotCQlpZiAod3ZpZi0+YnNzX2xvc3Nfc3Rh
dGUgPCAzKQotCQkJdHggPSAxOwotCX0gZWxzZSB7Ci0JCWNhbmNlbF9kZWxheWVkX3dvcmtfc3lu
Yygmd3ZpZi0+YnNzX2xvc3Nfd29yayk7Ci0JCXd2aWYtPmJzc19sb3NzX3N0YXRlID0gMDsKLQl9
Ci0KLQkvKiBTcGl0IG91dCBhIE5VTEwgcGFja2V0IHRvIG91ciBBUCBpZiBuZWNlc3NhcnkgKi8K
LQkvLyBGSVhNRTogY2FsbCBpZWVlODAyMTFfYmVhY29uX2xvc3MvaWVlZTgwMjExX2Nvbm5lY3Rp
b25fbG9zcyBpbnN0ZWFkCi0JaWYgKHR4KSB7Ci0JCXN0cnVjdCBza19idWZmICpza2I7Ci0JCXN0
cnVjdCBpZWVlODAyMTFfaGRyICpoZHI7Ci0JCXN0cnVjdCBpZWVlODAyMTFfdHhfY29udHJvbCBj
b250cm9sID0geyB9OwotCi0JCXd2aWYtPmJzc19sb3NzX3N0YXRlKys7Ci0KLQkJc2tiID0gaWVl
ZTgwMjExX251bGxmdW5jX2dldCh3dmlmLT53ZGV2LT5odywgd3ZpZi0+dmlmLCBmYWxzZSk7Ci0J
CWlmICghc2tiKQotCQkJZ290byBlbmQ7Ci0JCWhkciA9IChzdHJ1Y3QgaWVlZTgwMjExX2hkciAq
KXNrYi0+ZGF0YTsKLQkJbWVtc2V0KElFRUU4MDIxMV9TS0JfQ0Ioc2tiKSwgMCwKLQkJICAgICAg
IHNpemVvZigqSUVFRTgwMjExX1NLQl9DQihza2IpKSk7Ci0JCUlFRUU4MDIxMV9TS0JfQ0Ioc2ti
KS0+Y29udHJvbC52aWYgPSB3dmlmLT52aWY7Ci0JCUlFRUU4MDIxMV9TS0JfQ0Ioc2tiKS0+ZHJp
dmVyX3JhdGVzWzBdLmlkeCA9IDA7Ci0JCUlFRUU4MDIxMV9TS0JfQ0Ioc2tiKS0+ZHJpdmVyX3Jh
dGVzWzBdLmNvdW50ID0gMTsKLQkJSUVFRTgwMjExX1NLQl9DQihza2IpLT5kcml2ZXJfcmF0ZXNb
MV0uaWR4ID0gLTE7Ci0JCXJjdV9yZWFkX2xvY2soKTsgLy8gcHJvdGVjdCBjb250cm9sLnN0YQot
CQljb250cm9sLnN0YSA9IGllZWU4MDIxMV9maW5kX3N0YSh3dmlmLT52aWYsIGhkci0+YWRkcjEp
OwotCQl3ZnhfdHgod3ZpZi0+d2Rldi0+aHcsICZjb250cm9sLCBza2IpOwotCQlyY3VfcmVhZF91
bmxvY2soKTsKLQl9Ci1lbmQ6Ci0JbXV0ZXhfdW5sb2NrKCZ3dmlmLT5ic3NfbG9zc19sb2NrKTsK
LX0KLQogc3RhdGljIHZvaWQgd2Z4X2ZpbHRlcl9iZWFjb24oc3RydWN0IHdmeF92aWYgKnd2aWYs
IGJvb2wgZmlsdGVyX2JlYWNvbikKIHsKIAljb25zdCBzdHJ1Y3QgaGlmX2llX3RhYmxlX2VudHJ5
IGZpbHRlcl9pZXNbXSA9IHsKQEAgLTMzOSw2ICsyODUsMTcgQEAgc3RhdGljIHZvaWQgd2Z4X2V2
ZW50X3JlcG9ydF9yc3NpKHN0cnVjdCB3ZnhfdmlmICp3dmlmLCB1OCByYXdfcmNwaV9yc3NpKQog
CWllZWU4MDIxMV9jcW1fcnNzaV9ub3RpZnkod3ZpZi0+dmlmLCBjcW1fZXZ0LCByY3BpX3Jzc2ks
IEdGUF9LRVJORUwpOwogfQogCitzdGF0aWMgdm9pZCB3ZnhfYmVhY29uX2xvc3Nfd29yayhzdHJ1
Y3Qgd29ya19zdHJ1Y3QgKndvcmspCit7CisJc3RydWN0IHdmeF92aWYgKnd2aWYgPSBjb250YWlu
ZXJfb2YodG9fZGVsYXllZF93b3JrKHdvcmspLAorCQkJCQkgICAgc3RydWN0IHdmeF92aWYsIGJl
YWNvbl9sb3NzX3dvcmspOworCXN0cnVjdCBpZWVlODAyMTFfYnNzX2NvbmYgKmJzc19jb25mID0g
Jnd2aWYtPnZpZi0+YnNzX2NvbmY7CisKKwlpZWVlODAyMTFfYmVhY29uX2xvc3Mod3ZpZi0+dmlm
KTsKKwlzY2hlZHVsZV9kZWxheWVkX3dvcmsodG9fZGVsYXllZF93b3JrKHdvcmspLAorCQkJICAg
ICAgbXNlY3NfdG9famlmZmllcyhic3NfY29uZi0+YmVhY29uX2ludCkpOworfQorCiBzdGF0aWMg
dm9pZCB3ZnhfZXZlbnRfaGFuZGxlcl93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsK
IAlzdHJ1Y3Qgd2Z4X3ZpZiAqd3ZpZiA9CkBAIC0zNTQsMTIgKzMxMSwxMCBAQCBzdGF0aWMgdm9p
ZCB3ZnhfZXZlbnRfaGFuZGxlcl93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAlsaXN0
X2Zvcl9lYWNoX2VudHJ5KGV2ZW50LCAmbGlzdCwgbGluaykgewogCQlzd2l0Y2ggKGV2ZW50LT5l
dnQuZXZlbnRfaWQpIHsKIAkJY2FzZSBISUZfRVZFTlRfSU5EX0JTU0xPU1Q6Ci0JCQltdXRleF9s
b2NrKCZ3dmlmLT5zY2FuX2xvY2spOwotCQkJd2Z4X2NxbV9ic3Nsb3NzX3NtKHd2aWYsIDEsIDAs
IDApOwotCQkJbXV0ZXhfdW5sb2NrKCZ3dmlmLT5zY2FuX2xvY2spOworCQkJc2NoZWR1bGVfZGVs
YXllZF93b3JrKCZ3dmlmLT5iZWFjb25fbG9zc193b3JrLCAwKTsKIAkJCWJyZWFrOwogCQljYXNl
IEhJRl9FVkVOVF9JTkRfQlNTUkVHQUlORUQ6Ci0JCQl3ZnhfY3FtX2Jzc2xvc3Nfc20od3ZpZiwg
MCwgMCwgMCk7CisJCQljYW5jZWxfZGVsYXllZF93b3JrKCZ3dmlmLT5iZWFjb25fbG9zc193b3Jr
KTsKIAkJCWJyZWFrOwogCQljYXNlIEhJRl9FVkVOVF9JTkRfUkNQSV9SU1NJOgogCQkJd2Z4X2V2
ZW50X3JlcG9ydF9yc3NpKHd2aWYsCkBAIC0zNzksMjYgKzMzNCw2IEBAIHN0YXRpYyB2b2lkIHdm
eF9ldmVudF9oYW5kbGVyX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCV9fd2Z4X2Zy
ZWVfZXZlbnRfcXVldWUoJmxpc3QpOwogfQogCi1zdGF0aWMgdm9pZCB3ZnhfYnNzX2xvc3Nfd29y
ayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCi17Ci0Jc3RydWN0IHdmeF92aWYgKnd2aWYgPSBj
b250YWluZXJfb2Yod29yaywgc3RydWN0IHdmeF92aWYsCi0JCQkJCSAgICBic3NfbG9zc193b3Jr
LndvcmspOwotCi0JaWVlZTgwMjExX2Nvbm5lY3Rpb25fbG9zcyh3dmlmLT52aWYpOwotfQotCi1z
dGF0aWMgdm9pZCB3ZnhfYnNzX3BhcmFtc193b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykK
LXsKLQlzdHJ1Y3Qgd2Z4X3ZpZiAqd3ZpZiA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3Qgd2Z4
X3ZpZiwKLQkJCQkJICAgIGJzc19wYXJhbXNfd29yayk7Ci0KLQltdXRleF9sb2NrKCZ3dmlmLT53
ZGV2LT5jb25mX211dGV4KTsKLQl3dmlmLT5ic3NfcGFyYW1zLmJzc19mbGFncy5sb3N0X2NvdW50
X29ubHkgPSAxOwotCWhpZl9zZXRfYnNzX3BhcmFtcyh3dmlmLCAmd3ZpZi0+YnNzX3BhcmFtcyk7
Ci0Jd3ZpZi0+YnNzX3BhcmFtcy5ic3NfZmxhZ3MubG9zdF9jb3VudF9vbmx5ID0gMDsKLQltdXRl
eF91bmxvY2soJnd2aWYtPndkZXYtPmNvbmZfbXV0ZXgpOwotfQotCiAvLyBDYWxsIGl0IHdpdGgg
d2Rldi0+Y29uZl9tdXRleCBsb2NrZWQKIHN0YXRpYyB2b2lkIHdmeF9kb191bmpvaW4oc3RydWN0
IHdmeF92aWYgKnd2aWYpCiB7CkBAIC00MTgsMTAgKzM1MywxMCBAQCBzdGF0aWMgdm9pZCB3Znhf
ZG9fdW5qb2luKHN0cnVjdCB3ZnhfdmlmICp3dmlmKQogCQloaWZfc2V0X2Jsb2NrX2Fja19wb2xp
Y3kod3ZpZiwgMHhGRiwgMHhGRik7CiAJd2Z4X2ZyZWVfZXZlbnRfcXVldWUod3ZpZik7CiAJY2Fu
Y2VsX3dvcmtfc3luYygmd3ZpZi0+ZXZlbnRfaGFuZGxlcl93b3JrKTsKLQl3ZnhfY3FtX2Jzc2xv
c3Nfc20od3ZpZiwgMCwgMCwgMCk7CiAKIAltZW1zZXQoJnd2aWYtPmJzc19wYXJhbXMsIDAsIHNp
emVvZih3dmlmLT5ic3NfcGFyYW1zKSk7CiAJd2Z4X3R4X3VubG9jayh3dmlmLT53ZGV2KTsKKwlj
YW5jZWxfZGVsYXllZF93b3JrX3N5bmMoJnd2aWYtPmJlYWNvbl9sb3NzX3dvcmspOwogfQogCiBz
dGF0aWMgdm9pZCB3Znhfc2V0X21mcChzdHJ1Y3Qgd2Z4X3ZpZiAqd3ZpZiwKQEAgLTYxNSw5ICs1
NTAsOSBAQCBzdGF0aWMgdm9pZCB3Znhfam9pbl9maW5hbGl6ZShzdHJ1Y3Qgd2Z4X3ZpZiAqd3Zp
ZiwKIAllbHNlCiAJCWhpZl9kdWFsX2N0c19wcm90ZWN0aW9uKHd2aWYsIGZhbHNlKTsKIAotCXdm
eF9jcW1fYnNzbG9zc19zbSh3dmlmLCAwLCAwLCAwKTsKLQotCXd2aWYtPmJzc19wYXJhbXMuYmVh
Y29uX2xvc3RfY291bnQgPSAyMDsKKwkvLyBiZWFjb25fbG9zc19jb3VudCBpcyBkZWZpbmVkIHRv
IDcgaW4gbmV0L21hYzgwMjExL21sbWUuYy4gTGV0J3MgdXNlCisJLy8gdGhlIHNhbWUgdmFsdWUu
CisJd3ZpZi0+YnNzX3BhcmFtcy5iZWFjb25fbG9zdF9jb3VudCA9IDc7CiAJd3ZpZi0+YnNzX3Bh
cmFtcy5haWQgPSBpbmZvLT5haWQ7CiAKIAloaWZfc2V0X2Fzc29jaWF0aW9uX21vZGUod3ZpZiwg
aW5mbyk7CkBAIC05MDQsMTIgKzgzOSwxMCBAQCBpbnQgd2Z4X2FkZF9pbnRlcmZhY2Uoc3RydWN0
IGllZWU4MDIxMV9odyAqaHcsIHN0cnVjdCBpZWVlODAyMTFfdmlmICp2aWYpCiAKIAl3dmlmLT5s
aW5rX2lkX21hcCA9IDE7IC8vIGxpbmstaWQgMCBpcyByZXNlcnZlZCBmb3IgbXVsdGljYXN0CiAJ
SU5JVF9XT1JLKCZ3dmlmLT51cGRhdGVfdGltX3dvcmssIHdmeF91cGRhdGVfdGltX3dvcmspOwor
CUlOSVRfREVMQVlFRF9XT1JLKCZ3dmlmLT5iZWFjb25fbG9zc193b3JrLCB3ZnhfYmVhY29uX2xv
c3Nfd29yayk7CiAKIAltZW1zZXQoJnd2aWYtPmJzc19wYXJhbXMsIDAsIHNpemVvZih3dmlmLT5i
c3NfcGFyYW1zKSk7CiAKLQltdXRleF9pbml0KCZ3dmlmLT5ic3NfbG9zc19sb2NrKTsKLQlJTklU
X0RFTEFZRURfV09SSygmd3ZpZi0+YnNzX2xvc3Nfd29yaywgd2Z4X2Jzc19sb3NzX3dvcmspOwot
CiAJd3ZpZi0+d2VwX2RlZmF1bHRfa2V5X2lkID0gLTE7CiAJSU5JVF9XT1JLKCZ3dmlmLT53ZXBf
a2V5X3dvcmssIHdmeF93ZXBfa2V5X3dvcmspOwogCkBAIC05MTksNyArODUyLDYgQEAgaW50IHdm
eF9hZGRfaW50ZXJmYWNlKHN0cnVjdCBpZWVlODAyMTFfaHcgKmh3LCBzdHJ1Y3QgaWVlZTgwMjEx
X3ZpZiAqdmlmKQogCiAJaW5pdF9jb21wbGV0aW9uKCZ3dmlmLT5zZXRfcG1fbW9kZV9jb21wbGV0
ZSk7CiAJY29tcGxldGUoJnd2aWYtPnNldF9wbV9tb2RlX2NvbXBsZXRlKTsKLQlJTklUX1dPUkso
Jnd2aWYtPmJzc19wYXJhbXNfd29yaywgd2Z4X2Jzc19wYXJhbXNfd29yayk7CiAJSU5JVF9XT1JL
KCZ3dmlmLT50eF9wb2xpY3lfdXBsb2FkX3dvcmssIHdmeF90eF9wb2xpY3lfdXBsb2FkX3dvcmsp
OwogCiAJbXV0ZXhfaW5pdCgmd3ZpZi0+c2Nhbl9sb2NrKTsKQEAgLTk3NCw4ICs5MDYsOCBAQCB2
b2lkIHdmeF9yZW1vdmVfaW50ZXJmYWNlKHN0cnVjdCBpZWVlODAyMTFfaHcgKmh3LAogCS8qIEZJ
WE1FOiBJbiBhZGQgdG8gcmVzZXQgTUFDIGFkZHJlc3MsIHRyeSB0byByZXNldCBpbnRlcmZhY2Ug
Ki8KIAloaWZfc2V0X21hY2FkZHIod3ZpZiwgTlVMTCk7CiAKLQl3ZnhfY3FtX2Jzc2xvc3Nfc20o
d3ZpZiwgMCwgMCwgMCk7CiAJd2Z4X2ZyZWVfZXZlbnRfcXVldWUod3ZpZik7CisJY2FuY2VsX2Rl
bGF5ZWRfd29ya19zeW5jKCZ3dmlmLT5iZWFjb25fbG9zc193b3JrKTsKIAogCXdkZXYtPnZpZlt3
dmlmLT5pZF0gPSBOVUxMOwogCXd2aWYtPnZpZiA9IE5VTEw7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L3N0YWdpbmcvd2Z4L3N0YS5oIGIvZHJpdmVycy9zdGFnaW5nL3dmeC9zdGEuaAppbmRleCAzMTA5
NzA1NzU2M2EuLjZkNzczNGM2NTkwMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9zdGFnaW5nL3dmeC9z
dGEuaAorKysgYi9kcml2ZXJzL3N0YWdpbmcvd2Z4L3N0YS5oCkBAIC04MSw3ICs4MSw2IEBAIHZv
aWQgd2Z4X3VuYXNzaWduX3ZpZl9jaGFuY3R4KHN0cnVjdCBpZWVlODAyMTFfaHcgKmh3LAogdm9p
ZCB3Znhfc3VzcGVuZF9yZXN1bWVfbWMoc3RydWN0IHdmeF92aWYgKnd2aWYsIGVudW0gc3RhX25v
dGlmeV9jbWQgY21kKTsKIAogLy8gT3RoZXIgSGVscGVycwotdm9pZCB3ZnhfY3FtX2Jzc2xvc3Nf
c20oc3RydWN0IHdmeF92aWYgKnd2aWYsIGludCBpbml0LCBpbnQgZ29vZCwgaW50IGJhZCk7CiB1
MzIgd2Z4X3JhdGVfbWFza190b19odyhzdHJ1Y3Qgd2Z4X2RldiAqd2RldiwgdTMyIHJhdGVzKTsK
IAogI2VuZGlmIC8qIFdGWF9TVEFfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9zdGFnaW5nL3dm
eC93ZnguaCBiL2RyaXZlcnMvc3RhZ2luZy93Zngvd2Z4LmgKaW5kZXggYjVkMmQwZjA3NzQwLi4y
NzQ3YzdjZGY0ZDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvc3RhZ2luZy93Zngvd2Z4LmgKKysrIGIv
ZHJpdmVycy9zdGFnaW5nL3dmeC93ZnguaApAQCAtNjksMTQgKzY5LDEwIEBAIHN0cnVjdCB3Znhf
dmlmIHsKIAlpbnQJCQlpZDsKIAllbnVtIHdmeF9zdGF0ZQkJc3RhdGU7CiAKLQlpbnQJCQlic3Nf
bG9zc19zdGF0ZTsKLQl1MzIJCQlic3NfbG9zc19jb25maXJtX2lkOwotCXN0cnVjdCBtdXRleAkJ
YnNzX2xvc3NfbG9jazsKLQlzdHJ1Y3QgZGVsYXllZF93b3JrCWJzc19sb3NzX3dvcms7Ci0KIAl1
MzIJCQlsaW5rX2lkX21hcDsKIAogCWJvb2wJCQlhZnRlcl9kdGltX3R4X2FsbG93ZWQ7CisJc3Ry
dWN0IGRlbGF5ZWRfd29yawliZWFjb25fbG9zc193b3JrOwogCiAJczgJCQl3ZXBfZGVmYXVsdF9r
ZXlfaWQ7CiAJc3RydWN0IHNrX2J1ZmYJCSp3ZXBfcGVuZGluZ19za2I7CkBAIC05Miw3ICs4OCw2
IEBAIHN0cnVjdCB3ZnhfdmlmIHsKIAogCXVuc2lnbmVkIGxvbmcJCXVhcHNkX21hc2s7CiAJc3Ry
dWN0IGhpZl9yZXFfc2V0X2Jzc19wYXJhbXMgYnNzX3BhcmFtczsKLQlzdHJ1Y3Qgd29ya19zdHJ1
Y3QJYnNzX3BhcmFtc193b3JrOwogCiAJaW50CQkJam9pbl9jb21wbGV0ZV9zdGF0dXM7CiAKLS0g
CjIuMjYuMQoK
