Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 1612719BE4
	for <lists+netdev@lfdr.de>; Fri, 10 May 2019 12:50:13 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727225AbfEJKuL (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Fri, 10 May 2019 06:50:11 -0400
Received: from mail-eopbgr20060.outbound.protection.outlook.com ([40.107.2.60]:55334
        "EHLO EUR02-VE1-obe.outbound.protection.outlook.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1727100AbfEJKuK (ORCPT <rfc822;netdev@vger.kernel.org>);
        Fri, 10 May 2019 06:50:10 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=nxp.com; s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=0isoIFDRr4YNDIkb9zqQ9Z6fT3BRKzy8LrmWH8Dh4a8=;
 b=Wc9M/fif5rpW8f9nr6ecqYTvpJyPF124DM/dC27PMGf8QXHpHkQPcC9DKZN8iqkxpzi+Qfl+Q+Z0ooQ0nCU67H5jn+9UydBOfuFkfLSGg9fTVLW0Sa2pb7fxvyd17FCLhOMQcV5edPi6u3V6Cl9wooCxAJ3sD6FBdm8pOOX5kMg=
Received: from DB7PR04MB4618.eurprd04.prod.outlook.com (52.135.138.152) by
 DB7PR04MB5994.eurprd04.prod.outlook.com (20.178.107.83) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.1878.21; Fri, 10 May 2019 10:50:01 +0000
Received: from DB7PR04MB4618.eurprd04.prod.outlook.com
 ([fe80::dcff:11e1:ab70:bb81]) by DB7PR04MB4618.eurprd04.prod.outlook.com
 ([fe80::dcff:11e1:ab70:bb81%5]) with mapi id 15.20.1878.022; Fri, 10 May 2019
 10:50:01 +0000
From:   Joakim Zhang <qiangqing.zhang@nxp.com>
To:     "mkl@pengutronix.de" <mkl@pengutronix.de>,
        "linux-can@vger.kernel.org" <linux-can@vger.kernel.org>
CC:     dl-linux-imx <linux-imx@nxp.com>,
        "wg@grandegger.com" <wg@grandegger.com>,
        "netdev@vger.kernel.org" <netdev@vger.kernel.org>,
        Stefan-gabriel Mirea <stefan-gabriel.mirea@nxp.com>,
        Joakim Zhang <qiangqing.zhang@nxp.com>
Subject: [PATCH V3 3/7] can: flexcan: add CAN FD mode support
Thread-Topic: [PATCH V3 3/7] can: flexcan: add CAN FD mode support
Thread-Index: AQHVBx4ePB9T+sVK0kqfiUr0ndYD6Q==
Date:   Fri, 10 May 2019 10:50:01 +0000
Message-ID: <20190510104639.15170-4-qiangqing.zhang@nxp.com>
References: <20190510104639.15170-1-qiangqing.zhang@nxp.com>
In-Reply-To: <20190510104639.15170-1-qiangqing.zhang@nxp.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-mailer: git-send-email 2.17.1
x-clientproxiedby: SG2PR01CA0105.apcprd01.prod.exchangelabs.com
 (2603:1096:3:15::31) To DB7PR04MB4618.eurprd04.prod.outlook.com
 (2603:10a6:5:36::24)
authentication-results: spf=none (sender IP is )
 smtp.mailfrom=qiangqing.zhang@nxp.com; 
x-ms-exchange-messagesentrepresentingtype: 1
x-originating-ip: [119.31.174.71]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 250c4792-0377-4b01-bcfa-08d6d53540af
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0;PCL:0;RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600141)(711020)(4605104)(4618075)(2017052603328)(7193020);SRVR:DB7PR04MB5994;
x-ms-traffictypediagnostic: DB7PR04MB5994:
x-microsoft-antispam-prvs: <DB7PR04MB599421E40D56188A58D1876CE60C0@DB7PR04MB5994.eurprd04.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:1060;
x-forefront-prvs: 0033AAD26D
x-forefront-antispam-report: SFV:NSPM;SFS:(10009020)(979002)(346002)(39860400002)(396003)(136003)(376002)(366004)(189003)(199004)(54534003)(14454004)(11346002)(478600001)(66066001)(4326008)(66556008)(64756008)(66446008)(53936002)(66476007)(8936002)(81166006)(6436002)(81156014)(25786009)(8676002)(1076003)(6486002)(2501003)(6116002)(3846002)(186003)(2906002)(50226002)(305945005)(73956011)(14444005)(71190400001)(6512007)(71200400001)(446003)(66946007)(5660300002)(54906003)(2616005)(476003)(36756003)(86362001)(26005)(110136005)(7736002)(76176011)(102836004)(386003)(68736007)(99286004)(52116002)(6506007)(486006)(256004)(316002)(969003)(989001)(999001)(1009001)(1019001);DIR:OUT;SFP:1101;SCL:1;SRVR:DB7PR04MB5994;H:DB7PR04MB4618.eurprd04.prod.outlook.com;FPR:;SPF:None;LANG:en;PTR:InfoNoRecords;MX:1;A:1;
received-spf: None (protection.outlook.com: nxp.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: cMphqBrnHhNkjL4GRBfotTHQ7E0I2rA5DFg7fkEM3cz7mWdKixrk3Ktv95+/6qnOP8WzlQtndNaKFneMdRGkdM+h8YJIlzTw/dOiKCJr4xE7MIPwthYUFE2rICXzuTZH1odY49LfNN51j9GWmE+jy3vCbRsTyYEIJr/+LvjAckd7el4Tct+F/nYx2A20gQJjwTYH+cJ3OqnjiweK7vU1InZnvklDtFwqh4fVSwRf40ZAsVL11xgRkWnMWDykjHhhCdoulVxSbleYhqkzUbsaV3uz/4rO42ncT+m+4ycpWU5RKwSYkV4OJeS5Kz/8CArCfP10ZFZVcB1RF1aE7iahmT3IZu6ILrwxEmrqLYOn8tpgH4dP391bee3rrOy5baY4Qw8nzd5mDBd2DPRa2TB/4UmGaONjLk27c1EQx58weOA=
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-OriginatorOrg: nxp.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 250c4792-0377-4b01-bcfa-08d6d53540af
X-MS-Exchange-CrossTenant-originalarrivaltime: 10 May 2019 10:50:01.8648
 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 686ea1d3-bc2b-4c6f-a92c-d99c5c301635
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DB7PR04MB5994
Sender: netdev-owner@vger.kernel.org
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

VGhpcyBwYXRjaCBpbnRlbmRzIHRvIGFkZCBDQU4gRkQgbW9kZSBzdXBwb3J0IGluIGRyaXZlciwg
aXQgbWVhbnMgdGhhdA0KcGF5bG9hZCBzaXplIGNhbiBleHRlbmQgdXAgdG8gNjQgYnl0ZXMuDQoN
Ck5PVEU6IEJpdCByYXRlIHN3aXRjaCAoQlJTKSBlbmFibGVkIGJ5IHN5c3RlbSByZXNldCB3aGVu
IGl0IGVuYWJsZXMgQ0FODQpGRCBtb2RlIChleHBsaWNpdGx5IHNldCBCUlMgYWdhaW4gaW4gZHJp
dmVyKS4gU28gQ0FOIGhhcmR3YXJlIGhhcyBzdXBwb3J0DQpCUlMsIGJ1dCBub3cgZHJpdmVyIGhh
cyBub3Qgc3VwcG9ydCBpdCBkdWUgdG8gYml0IHRpbWluZyBhbHdheXMgc2V0IGluIENCVA0KcmVn
aXN0ZXIgb3RoZXIgdGhhbiBDVFJMMSByZWdpc3Rlci4gSXQgd2lsbCBhZGQgaW4gbmV4dCBwYXRj
aC4NCg0KU2lnbmVkLW9mZi1ieTogSm9ha2ltIFpoYW5nIDxxaWFuZ3FpbmcuemhhbmdAbnhwLmNv
bT4NCg0KQ2hhbmdlTG9nOg0KLS0tLS0tLS0tLQ0KVjEtPlYyOg0KCSptb3ZlICJwcml2LT5vZmZs
b2FkLmlzX2NhbmZkID0gdHJ1ZSIgZnJvbSBfcHJvYmUoKSB0byBfc3RhcnQoKQ0KVjItPlYzOg0K
CSp0aHJlZSBzYW1wbGUgYW5kIGZkIG1vZGUgY2FuJ3QgYmUgdXNlZCB0b2dldGhlcg0KCSpjbGVh
ciBDQU4gRkQgcmVsYXRlZCBiaXQgd2hlbiBmZCBtb2RlIGlzIG9mZg0KCSpjb3JyZWN0IHRoZSBy
YW5nZSBvZiBmbGV4Y2FuX2ZkX2RhdGFfYml0dGltaW5nX2NvbnN0IHZhcmlhYmxlDQotLS0NCiBk
cml2ZXJzL25ldC9jYW4vZmxleGNhbi5jIHwgMTMyICsrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrLS0tDQogMSBmaWxlIGNoYW5nZWQsIDEyMyBpbnNlcnRpb25zKCspLCA5IGRlbGV0
aW9ucygtKQ0KDQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9uZXQvY2FuL2ZsZXhjYW4uYyBiL2RyaXZl
cnMvbmV0L2Nhbi9mbGV4Y2FuLmMNCmluZGV4IDIyZjVjMjhmZjk5Zi4uNjYyYzhjOGYxOTFiIDEw
MDY0NA0KLS0tIGEvZHJpdmVycy9uZXQvY2FuL2ZsZXhjYW4uYw0KKysrIGIvZHJpdmVycy9uZXQv
Y2FuL2ZsZXhjYW4uYw0KQEAgLTUyLDYgKzUyLDcgQEANCiAjZGVmaW5lIEZMRVhDQU5fTUNSX0lS
TVEJCUJJVCgxNikNCiAjZGVmaW5lIEZMRVhDQU5fTUNSX0xQUklPX0VOCQlCSVQoMTMpDQogI2Rl
ZmluZSBGTEVYQ0FOX01DUl9BRU4JCQlCSVQoMTIpDQorI2RlZmluZSBGTEVYQ0FOX01DUl9GREVO
CQlCSVQoMTEpDQogLyogTUNSX01BWE1COiBtYXhpbXVtIHVzZWQgTUJzIGlzIE1BWE1CICsgMSAq
Lw0KICNkZWZpbmUgRkxFWENBTl9NQ1JfTUFYTUIoeCkJCSgoeCkgJiAweDdmKQ0KICNkZWZpbmUg
RkxFWENBTl9NQ1JfSURBTV9BCQkoMHgwIDw8IDgpDQpAQCAtMTM3LDYgKzEzOCwyMCBAQA0KIAkg
RkxFWENBTl9FU1JfQk9GRl9JTlQgfCBGTEVYQ0FOX0VTUl9FUlJfSU5UIHwgXA0KIAkgRkxFWENB
Tl9FU1JfV0FLX0lOVCkNCiANCisvKiBGTEVYQ0FOIEZEIGNvbnRyb2wgcmVnaXN0ZXIgKEZEQ1RS
TCkgYml0cyAqLw0KKyNkZWZpbmUgRkxFWENBTl9GRENUUkxfRkRSQVRFCQlCSVQoMzEpDQorI2Rl
ZmluZSBGTEVYQ0FOX0ZEQ1RSTF9NQkRTUjMoeCkJKCgoeCkgJiAweDMpIDw8IDI1KQ0KKyNkZWZp
bmUgRkxFWENBTl9GRENUUkxfTUJEU1IyKHgpCSgoKHgpICYgMHgzKSA8PCAyMikNCisjZGVmaW5l
IEZMRVhDQU5fRkRDVFJMX01CRFNSMSh4KQkoKCh4KSAmIDB4MykgPDwgMTkpDQorI2RlZmluZSBG
TEVYQ0FOX0ZEQ1RSTF9NQkRTUjAoeCkJKCgoeCkgJiAweDMpIDw8IDE2KQ0KKw0KKy8qIEZMRVhD
QU4gRkQgQml0IFRpbWluZyByZWdpc3RlciAoRkRDQlQpIGJpdHMgKi8NCisjZGVmaW5lIEZMRVhD
QU5fRkRDQlRfRlBSRVNESVYoeCkJKCgoeCkgJiAweDNmZikgPDwgMjApDQorI2RlZmluZSBGTEVY
Q0FOX0ZEQ0JUX0ZSSlcoeCkJCSgoKHgpICYgMHgwNykgPDwgMTYpDQorI2RlZmluZSBGTEVYQ0FO
X0ZEQ0JUX0ZQUk9QU0VHKHgpCSgoKHgpICYgMHgxZikgPDwgMTApDQorI2RlZmluZSBGTEVYQ0FO
X0ZEQ0JUX0ZQU0VHMSh4KQkJKCgoeCkgJiAweDA3KSA8PCA1KQ0KKyNkZWZpbmUgRkxFWENBTl9G
RENCVF9GUFNFRzIoeCkJCSgoeCkgJiAweDA3KQ0KKw0KIC8qIEZMRVhDQU4gaW50ZXJydXB0IGZs
YWcgcmVnaXN0ZXIgKElGTEFHKSBiaXRzICovDQogLyogRXJyYXRhIEVSUjAwNTgyOSBzdGVwNzog
UmVzZXJ2ZSBmaXJzdCB2YWxpZCBNQiAqLw0KICNkZWZpbmUgRkxFWENBTl9UWF9NQl9SRVNFUlZF
RF9PRkZfRklGTwkJOA0KQEAgLTE0OCw2ICsxNjMsMTAgQEANCiAjZGVmaW5lIEZMRVhDQU5fSUZM
QUdfUlhfRklGT19BVkFJTEFCTEUJQklUKDUpDQogDQogLyogRkxFWENBTiBtZXNzYWdlIGJ1ZmZl
cnMgKi8NCisjZGVmaW5lIEZMRVhDQU5fTUJfQ05UX0VETAkJQklUKDMxKQ0KKyNkZWZpbmUgRkxF
WENBTl9NQl9DTlRfQlJTCQlCSVQoMzApDQorI2RlZmluZSBGTEVYQ0FOX01CX0NOVF9FU0kJCUJJ
VCgyOSkNCisNCiAjZGVmaW5lIEZMRVhDQU5fTUJfQ09ERV9NQVNLCQkoMHhmIDw8IDI0KQ0KICNk
ZWZpbmUgRkxFWENBTl9NQl9DT0RFX1JYX0JVU1lfQklUCSgweDEgPDwgMjQpDQogI2RlZmluZSBG
TEVYQ0FOX01CX0NPREVfUlhfSU5BQ1RJVkUJKDB4MCA8PCAyNCkNCkBAIC0xOTIsNiArMjExLDcg
QEANCiAjZGVmaW5lIEZMRVhDQU5fUVVJUktfQlJPS0VOX1BFUlJfU1RBVEUJQklUKDYpIC8qIE5v
IGludGVycnVwdCBmb3IgZXJyb3IgcGFzc2l2ZSAqLw0KICNkZWZpbmUgRkxFWENBTl9RVUlSS19E
RUZBVUxUX0JJR19FTkRJQU4JQklUKDcpIC8qIGRlZmF1bHQgdG8gQkUgcmVnaXN0ZXIgYWNjZXNz
ICovDQogI2RlZmluZSBGTEVYQ0FOX1FVSVJLX1NFVFVQX1NUT1BfTU9ERQkJQklUKDgpIC8qIFNl
dHVwIHN0b3AgbW9kZSB0byBzdXBwb3J0IHdha2V1cCAqLw0KKyNkZWZpbmUgRkxFWENBTl9RVUlS
S19USU1FU1RBTVBfU1VQUE9SVF9GRAlCSVQoOSkgLyogVXNlIHRpbWVzdGFtcCB0aGVuIHN1cHBv
cnQgY2FuIGZkIG1vZGUgKi8NCiANCiAvKiBTdHJ1Y3R1cmUgb2YgdGhlIG1lc3NhZ2UgYnVmZmVy
ICovDQogc3RydWN0IGZsZXhjYW5fbWIgew0KQEAgLTI1MCw2ICsyNzAsOSBAQCBzdHJ1Y3QgZmxl
eGNhbl9yZWdzIHsNCiAJdTMyIHJlcnJkcjsJCS8qIDB4YWY0ICovDQogCXUzMiByZXJyc3lucjsJ
CS8qIDB4YWY4ICovDQogCXUzMiBlcnJzcjsJCS8qIDB4YWZjICovDQorCXUzMiBfcmVzZXJ2ZWQ3
WzY0XTsgICAgIC8qIDB4YjAwICovDQorCXUzMiBmZGN0cmw7ICAgICAgICAgICAgIC8qIDB4YzAw
ICovDQorCXUzMiBmZGNidDsgICAgICAgICAgICAgIC8qIDB4YzA0ICovDQogfTsNCiANCiBzdHJ1
Y3QgZmxleGNhbl9kZXZ0eXBlX2RhdGEgew0KQEAgLTMzNyw2ICszNjAsMTggQEAgc3RhdGljIGNv
bnN0IHN0cnVjdCBjYW5fYml0dGltaW5nX2NvbnN0IGZsZXhjYW5fYml0dGltaW5nX2NvbnN0ID0g
ew0KIAkuYnJwX2luYyA9IDEsDQogfTsNCiANCitzdGF0aWMgY29uc3Qgc3RydWN0IGNhbl9iaXR0
aW1pbmdfY29uc3QgZmxleGNhbl9mZF9kYXRhX2JpdHRpbWluZ19jb25zdCA9IHsNCisJLm5hbWUg
PSBEUlZfTkFNRSwNCisJLnRzZWcxX21pbiA9IDIsDQorCS50c2VnMV9tYXggPSAxNiwNCisJLnRz
ZWcyX21pbiA9IDIsDQorCS50c2VnMl9tYXggPSA4LA0KKwkuc2p3X21heCA9IDgsDQorCS5icnBf
bWluID0gMSwNCisJLmJycF9tYXggPSAxMDI0LA0KKwkuYnJwX2luYyA9IDEsDQorfTsNCisNCiAv
KiBGbGV4Q0FOIG1vZHVsZSBpcyBlc3NlbnRpYWxseSBtb2RlbGxlZCBhcyBhIGxpdHRsZS1lbmRp
YW4gSVAgaW4gbW9zdA0KICAqIFNvQ3MsIGkuZSB0aGUgcmVnaXN0ZXJzIGFzIHdlbGwgYXMgdGhl
IG1lc3NhZ2UgYnVmZmVyIGFyZWFzIGFyZQ0KICAqIGltcGxlbWVudGVkIGluIGEgbGl0dGxlLWVu
ZGlhbiBmYXNoaW9uLg0KQEAgLTYxMiw3ICs2NDcsNyBAQCBzdGF0aWMgbmV0ZGV2X3R4X3QgZmxl
eGNhbl9zdGFydF94bWl0KHN0cnVjdCBza19idWZmICpza2IsIHN0cnVjdCBuZXRfZGV2aWNlICpk
ZQ0KIAlzdHJ1Y3QgY2FuZmRfZnJhbWUgKmNmID0gKHN0cnVjdCBjYW5mZF9mcmFtZSAqKXNrYi0+
ZGF0YTsNCiAJdTMyIGNhbl9pZDsNCiAJdTMyIGRhdGE7DQotCXUzMiBjdHJsID0gRkxFWENBTl9N
Ql9DT0RFX1RYX0RBVEEgfCAoY2YtPmxlbiA8PCAxNik7DQorCXUzMiBjdHJsID0gRkxFWENBTl9N
Ql9DT0RFX1RYX0RBVEEgfCAoKGNhbl9sZW4yZGxjKGNmLT5sZW4pKSA8PCAxNik7DQogCWludCBp
Ow0KIA0KIAlpZiAoY2FuX2Ryb3BwZWRfaW52YWxpZF9za2IoZGV2LCBza2IpKQ0KQEAgLTYzMCw2
ICs2NjUsMTEgQEAgc3RhdGljIG5ldGRldl90eF90IGZsZXhjYW5fc3RhcnRfeG1pdChzdHJ1Y3Qg
c2tfYnVmZiAqc2tiLCBzdHJ1Y3QgbmV0X2RldmljZSAqZGUNCiAJaWYgKGNmLT5jYW5faWQgJiBD
QU5fUlRSX0ZMQUcpDQogCQljdHJsIHw9IEZMRVhDQU5fTUJfQ05UX1JUUjsNCiANCisJaWYgKHBy
aXYtPmNhbi5jdHJsbW9kZSAmIENBTl9DVFJMTU9ERV9GRCkgew0KKwkJaWYgKGNhbl9pc19jYW5m
ZF9za2Ioc2tiKSkNCisJCQljdHJsIHw9IEZMRVhDQU5fTUJfQ05UX0VETDsNCisJfQ0KKw0KIAlm
b3IgKGkgPSAwOyBpIDwgY2YtPmxlbjsgaSArPSBzaXplb2YodTMyKSkgew0KIAkJZGF0YSA9IGJl
MzJfdG9fY3B1cCgoX19iZTMyICopJmNmLT5kYXRhW2ldKTsNCiAJCXByaXYtPndyaXRlKGRhdGEs
ICZwcml2LT50eF9tYi0+ZGF0YVtpIC8gc2l6ZW9mKHUzMildKTsNCkBAIC04MjgsOCArODY4LDEz
IEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQgZmxleGNhbl9tYWlsYm94X3JlYWQoc3RydWN0IGNhbl9y
eF9vZmZsb2FkICpvZmZsb2FkLCBib29sIGRyDQogCQlyZWdfY3RybCA9IHByaXYtPnJlYWQoJm1i
LT5jYW5fY3RybCk7DQogCX0NCiANCi0JaWYgKCFkcm9wKQ0KLQkJKnNrYiA9IGFsbG9jX2Nhbl9z
a2Iob2ZmbG9hZC0+ZGV2LCAoc3RydWN0IGNhbl9mcmFtZSAqKikmY2YpOw0KKwlpZiAoIWRyb3Ap
IHsNCisJCWlmIChyZWdfY3RybCAmIEZMRVhDQU5fTUJfQ05UX0VETCkNCisJCQkqc2tiID0gYWxs
b2NfY2FuZmRfc2tiKG9mZmxvYWQtPmRldiwgJmNmKTsNCisJCWVsc2UNCisJCQkqc2tiID0gYWxs
b2NfY2FuX3NrYihvZmZsb2FkLT5kZXYsDQorCQkJCQkgICAgIChzdHJ1Y3QgY2FuX2ZyYW1lICoq
KSZjZik7DQorCX0NCiANCiAJaWYgKCpza2IpIHsNCiAJCS8qIGluY3JlYXNlIHRpbXN0YW1wIHRv
IGZ1bGwgMzIgYml0ICovDQpAQCAtODQxLDkgKzg4NiwxOSBAQCBzdGF0aWMgdW5zaWduZWQgaW50
IGZsZXhjYW5fbWFpbGJveF9yZWFkKHN0cnVjdCBjYW5fcnhfb2ZmbG9hZCAqb2ZmbG9hZCwgYm9v
bCBkcg0KIAkJZWxzZQ0KIAkJCWNmLT5jYW5faWQgPSAocmVnX2lkID4+IDE4KSAmIENBTl9TRkZf
TUFTSzsNCiANCi0JCWlmIChyZWdfY3RybCAmIEZMRVhDQU5fTUJfQ05UX1JUUikNCi0JCQljZi0+
Y2FuX2lkIHw9IENBTl9SVFJfRkxBRzsNCi0JCWNmLT5sZW4gPSBnZXRfY2FuX2RsYygocmVnX2N0
cmwgPj4gMTYpICYgMHgwRik7DQorCQlpZiAocmVnX2N0cmwgJiBGTEVYQ0FOX01CX0NOVF9FREwp
IHsNCisJCQljZi0+bGVuID0gY2FuX2RsYzJsZW4oKHJlZ19jdHJsID4+IDE2KSAmIDB4MEYpOw0K
KwkJfSBlbHNlIHsNCisJCQljZi0+bGVuID0gZ2V0X2Nhbl9kbGMoKHJlZ19jdHJsID4+IDE2KSAm
IDB4MEYpOw0KKw0KKwkJCWlmIChyZWdfY3RybCAmIEZMRVhDQU5fTUJfQ05UX1JUUikNCisJCQkJ
Y2YtPmNhbl9pZCB8PSBDQU5fUlRSX0ZMQUc7DQorCQl9DQorDQorCQlpZiAocmVnX2N0cmwgJiBG
TEVYQ0FOX01CX0NOVF9FU0kpIHsNCisJCQljZi0+ZmxhZ3MgfD0gQ0FORkRfRVNJOw0KKwkJCW5l
dGRldl93YXJuKHByaXYtPmNhbi5kZXYsICJFU0kgRXJyb3JcbiIpOw0KKwkJfQ0KIA0KIAkJZm9y
IChpID0gMDsgaSA8IGNmLT5sZW47IGkgKz0gc2l6ZW9mKHUzMikpIHsNCiAJCQlfX2JlMzIgZGF0
YSA9IGNwdV90b19iZTMyKHByaXYtPnJlYWQoJm1iLT5kYXRhW2kgLyBzaXplb2YodTMyKV0pKTsN
CkBAIC05OTEsOCArMTA0Niw5IEBAIHN0YXRpYyB2b2lkIGZsZXhjYW5fc2V0X2JpdHRpbWluZyhz
dHJ1Y3QgbmV0X2RldmljZSAqZGV2KQ0KIHsNCiAJY29uc3Qgc3RydWN0IGZsZXhjYW5fcHJpdiAq
cHJpdiA9IG5ldGRldl9wcml2KGRldik7DQogCWNvbnN0IHN0cnVjdCBjYW5fYml0dGltaW5nICpi
dCA9ICZwcml2LT5jYW4uYml0dGltaW5nOw0KKwljb25zdCBzdHJ1Y3QgY2FuX2JpdHRpbWluZyAq
ZGJ0ID0gJnByaXYtPmNhbi5kYXRhX2JpdHRpbWluZzsNCiAJc3RydWN0IGZsZXhjYW5fcmVncyBf
X2lvbWVtICpyZWdzID0gcHJpdi0+cmVnczsNCi0JdTMyIHJlZzsNCisJdTMyIHJlZywgcmVnX2Zk
Y2J0Ow0KIA0KIAlyZWcgPSBwcml2LT5yZWFkKCZyZWdzLT5jdHJsKTsNCiAJcmVnICY9IH4oRkxF
WENBTl9DVFJMX1BSRVNESVYoMHhmZikgfA0KQEAgLTEwMjAsNiArMTA3NiwyMiBAQCBzdGF0aWMg
dm9pZCBmbGV4Y2FuX3NldF9iaXR0aW1pbmcoc3RydWN0IG5ldF9kZXZpY2UgKmRldikNCiAJbmV0
ZGV2X2RiZyhkZXYsICJ3cml0aW5nIGN0cmw9MHglMDh4XG4iLCByZWcpOw0KIAlwcml2LT53cml0
ZShyZWcsICZyZWdzLT5jdHJsKTsNCiANCisJaWYgKHByaXYtPmNhbi5jdHJsbW9kZSAmIENBTl9D
VFJMTU9ERV9GRCkgew0KKwkJcmVnX2ZkY2J0ID0gcHJpdi0+cmVhZCgmcmVncy0+ZmRjYnQpOw0K
KwkJcmVnX2ZkY2J0ICY9IH4oRkxFWENBTl9GRENCVF9GUFJFU0RJVigweDNmZikgfA0KKwkJCSAg
ICAgICBGTEVYQ0FOX0ZEQ0JUX0ZQU0VHMSgweDA3KSB8DQorCQkJICAgICAgIEZMRVhDQU5fRkRD
QlRfRlBTRUcyKDB4MDcpIHwNCisJCQkgICAgICAgRkxFWENBTl9GRENCVF9GUkpXKDB4MDcpIHwN
CisJCQkgICAgICAgRkxFWENBTl9GRENCVF9GUFJPUFNFRygweDFmKSk7DQorDQorCQlyZWdfZmRj
YnQgPSBGTEVYQ0FOX0ZEQ0JUX0ZQUkVTRElWKGRidC0+YnJwIC0gMSkgfA0KKwkJCQlGTEVYQ0FO
X0ZEQ0JUX0ZQU0VHMShkYnQtPnBoYXNlX3NlZzEgLSAxKSB8DQorCQkJCUZMRVhDQU5fRkRDQlRf
RlBTRUcyKGRidC0+cGhhc2Vfc2VnMiAtIDEpIHwNCisJCQkJRkxFWENBTl9GRENCVF9GUkpXKGRi
dC0+c2p3IC0gMSkgfA0KKwkJCQlGTEVYQ0FOX0ZEQ0JUX0ZQUk9QU0VHKGRidC0+cHJvcF9zZWcp
Ow0KKwkJcHJpdi0+d3JpdGUocmVnX2ZkY2J0LCAmcmVncy0+ZmRjYnQpOw0KKwl9DQorDQogCS8q
IHByaW50IGNoaXAgc3RhdHVzICovDQogCW5ldGRldl9kYmcoZGV2LCAiJXM6IG1jcj0weCUwOHgg
Y3RybD0weCUwOHhcbiIsIF9fZnVuY19fLA0KIAkJICAgcHJpdi0+cmVhZCgmcmVncy0+bWNyKSwg
cHJpdi0+cmVhZCgmcmVncy0+Y3RybCkpOw0KQEAgLTEwMzQsNyArMTEwNiw3IEBAIHN0YXRpYyBp
bnQgZmxleGNhbl9jaGlwX3N0YXJ0KHN0cnVjdCBuZXRfZGV2aWNlICpkZXYpDQogew0KIAlzdHJ1
Y3QgZmxleGNhbl9wcml2ICpwcml2ID0gbmV0ZGV2X3ByaXYoZGV2KTsNCiAJc3RydWN0IGZsZXhj
YW5fcmVncyBfX2lvbWVtICpyZWdzID0gcHJpdi0+cmVnczsNCi0JdTMyIHJlZ19tY3IsIHJlZ19j
dHJsLCByZWdfY3RybDIsIHJlZ19tZWNyOw0KKwl1MzIgcmVnX21jciwgcmVnX2N0cmwsIHJlZ19j
dHJsMiwgcmVnX21lY3IsIHJlZ19mZGN0cmw7DQogCXU2NCByZWdfaW1hc2s7DQogCWludCBlcnIs
IGk7DQogCXN0cnVjdCBmbGV4Y2FuX21iIF9faW9tZW0gKm1iOw0KQEAgLTExMzEsNiArMTIwMywy
OCBAQCBzdGF0aWMgaW50IGZsZXhjYW5fY2hpcF9zdGFydChzdHJ1Y3QgbmV0X2RldmljZSAqZGV2
KQ0KIAluZXRkZXZfZGJnKGRldiwgIiVzOiB3cml0aW5nIGN0cmw9MHglMDh4IiwgX19mdW5jX18s
IHJlZ19jdHJsKTsNCiAJcHJpdi0+d3JpdGUocmVnX2N0cmwsICZyZWdzLT5jdHJsKTsNCiANCisJ
LyogRkRDVFJMICovDQorCWlmIChwcml2LT5jYW4uY3RybG1vZGVfc3VwcG9ydGVkICYgQ0FOX0NU
UkxNT0RFX0ZEKSB7DQorCQlyZWdfZmRjdHJsID0gcHJpdi0+cmVhZCgmcmVncy0+ZmRjdHJsKSAm
IH5GTEVYQ0FOX0ZEQ1RSTF9GRFJBVEU7DQorCQlyZWdfZmRjdHJsICY9IH4oRkxFWENBTl9GRENU
UkxfTUJEU1IzKDB4MykgfCBGTEVYQ0FOX0ZEQ1RSTF9NQkRTUjIoMHgzKSB8DQorCQkJCUZMRVhD
QU5fRkRDVFJMX01CRFNSMSgweDMpIHwgRkxFWENBTl9GRENUUkxfTUJEU1IwKDB4MykpOw0KKwkJ
cmVnX21jciA9IHByaXYtPnJlYWQoJnJlZ3MtPm1jcikgJiB+RkxFWENBTl9NQ1JfRkRFTjsNCisN
CisJCS8qIHN1cHBvcnQgQlJTIHdoZW4gc2V0IENBTiBGRCBtb2RlDQorCQkgKiA2NCBieXRlcyBw
YXlsb2FkIHBlciBNQiBhbmQgNyBNQnMgcGVyIFJBTSBibG9jayBieSBkZWZhdWx0DQorCQkgKiBl
bmFibGUgQ0FOIEZEIG1vZGUNCisJCSAqLw0KKwkJaWYgKHByaXYtPmNhbi5jdHJsbW9kZSAmIENB
Tl9DVFJMTU9ERV9GRCkgew0KKwkJCXJlZ19mZGN0cmwgfD0gRkxFWENBTl9GRENUUkxfRkRSQVRF
Ow0KKwkJCXJlZ19mZGN0cmwgfD0gRkxFWENBTl9GRENUUkxfTUJEU1IzKDB4MykgfCBGTEVYQ0FO
X0ZEQ1RSTF9NQkRTUjIoMHgzKSB8DQorCQkJCQlGTEVYQ0FOX0ZEQ1RSTF9NQkRTUjEoMHgzKSB8
IEZMRVhDQU5fRkRDVFJMX01CRFNSMCgweDMpOw0KKwkJCXJlZ19tY3IgfD0gRkxFWENBTl9NQ1Jf
RkRFTjsNCisJCX0NCisNCisJCXByaXYtPndyaXRlKHJlZ19mZGN0cmwsICZyZWdzLT5mZGN0cmwp
Ow0KKwkJcHJpdi0+d3JpdGUocmVnX21jciwgJnJlZ3MtPm1jcik7DQorCX0NCisNCiAJaWYgKChw
cml2LT5kZXZ0eXBlX2RhdGEtPnF1aXJrcyAmIEZMRVhDQU5fUVVJUktfRU5BQkxFX0VBQ0VOX1JS
UykpIHsNCiAJCXJlZ19jdHJsMiA9IHByaXYtPnJlYWQoJnJlZ3MtPmN0cmwyKTsNCiAJCXJlZ19j
dHJsMiB8PSBGTEVYQ0FOX0NUUkwyX0VBQ0VOIHwgRkxFWENBTl9DVFJMMl9SUlM7DQpAQCAtMTI1
NSw2ICsxMzQ5LDEyIEBAIHN0YXRpYyBpbnQgZmxleGNhbl9vcGVuKHN0cnVjdCBuZXRfZGV2aWNl
ICpkZXYpDQogCXN0cnVjdCBmbGV4Y2FuX3ByaXYgKnByaXYgPSBuZXRkZXZfcHJpdihkZXYpOw0K
IAlpbnQgZXJyOw0KIA0KKwlpZiAoKHByaXYtPmNhbi5jdHJsbW9kZSAmIENBTl9DVFJMTU9ERV8z
X1NBTVBMRVMpICYmDQorCSAgICAocHJpdi0+Y2FuLmN0cmxtb2RlICYgQ0FOX0NUUkxNT0RFX0ZE
KSkgew0KKwkJbmV0ZGV2X2VycihkZXYsICJ0aHJlZSBzYW1wbGVzIG1vZGUgYW5kIGZkIG1vZGUg
Y2FuJ3QgYmUgdXNlZCB0b2dldGhlclxuIik7DQorCQlyZXR1cm4gLUVJTlZBTDsNCisJfQ0KKw0K
IAllcnIgPSBwbV9ydW50aW1lX2dldF9zeW5jKHByaXYtPmRldik7DQogCWlmIChlcnIgPCAwKQ0K
IAkJcmV0dXJuIGVycjsNCkBAIC0xMjY3LDcgKzEzNjcsMTAgQEAgc3RhdGljIGludCBmbGV4Y2Fu
X29wZW4oc3RydWN0IG5ldF9kZXZpY2UgKmRldikNCiAJaWYgKGVycikNCiAJCWdvdG8gb3V0X2Ns
b3NlOw0KIA0KLQlwcml2LT5tYl9zaXplID0gc2l6ZW9mKHN0cnVjdCBmbGV4Y2FuX21iKSArIENB
Tl9NQVhfRExFTjsNCisJaWYgKHByaXYtPmNhbi5jdHJsbW9kZSAmIENBTl9DVFJMTU9ERV9GRCkN
CisJCXByaXYtPm1iX3NpemUgPSBzaXplb2Yoc3RydWN0IGZsZXhjYW5fbWIpICsgQ0FORkRfTUFY
X0RMRU47DQorCWVsc2UNCisJCXByaXYtPm1iX3NpemUgPSBzaXplb2Yoc3RydWN0IGZsZXhjYW5f
bWIpICsgQ0FOX01BWF9ETEVOOw0KIAlwcml2LT5tYl9jb3VudCA9IChzaXplb2YocHJpdi0+cmVn
cy0+bWJbMF0pIC8gcHJpdi0+bWJfc2l6ZSkgKw0KIAkJCSAoc2l6ZW9mKHByaXYtPnJlZ3MtPm1i
WzFdKSAvIHByaXYtPm1iX3NpemUpOw0KIA0KQEAgLTE2MDcsNiArMTcxMCwxNyBAQCBzdGF0aWMg
aW50IGZsZXhjYW5fcHJvYmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikNCiAJcHJpdi0+
ZGV2dHlwZV9kYXRhID0gZGV2dHlwZV9kYXRhOw0KIAlwcml2LT5yZWdfeGNlaXZlciA9IHJlZ194
Y2VpdmVyOw0KIA0KKwlpZiAocHJpdi0+ZGV2dHlwZV9kYXRhLT5xdWlya3MgJiBGTEVYQ0FOX1FV
SVJLX1RJTUVTVEFNUF9TVVBQT1JUX0ZEKSB7DQorCQlpZiAocHJpdi0+ZGV2dHlwZV9kYXRhLT5x
dWlya3MgJiBGTEVYQ0FOX1FVSVJLX1VTRV9PRkZfVElNRVNUQU1QKSB7DQorCQkJcHJpdi0+Y2Fu
LmN0cmxtb2RlX3N1cHBvcnRlZCB8PSBDQU5fQ1RSTE1PREVfRkQ7DQorCQkJcHJpdi0+Y2FuLmRh
dGFfYml0dGltaW5nX2NvbnN0ID0gJmZsZXhjYW5fZmRfZGF0YV9iaXR0aW1pbmdfY29uc3Q7DQor
CQl9IGVsc2Ugew0KKwkJCWRldl9lcnIoJnBkZXYtPmRldiwgImNhbiBmZCBtb2RlIGNhbid0IHdv
cmsgb24gZmlmbyBtb2RlXG4iKTsNCisJCQllcnIgPSAtRUlOVkFMOw0KKwkJCWdvdG8gZmFpbGVk
X3JlZ2lzdGVyOw0KKwkJfQ0KKwl9DQorDQogCXBtX3J1bnRpbWVfZ2V0X25vcmVzdW1lKCZwZGV2
LT5kZXYpOw0KIAlwbV9ydW50aW1lX3NldF9hY3RpdmUoJnBkZXYtPmRldik7DQogCXBtX3J1bnRp
bWVfZW5hYmxlKCZwZGV2LT5kZXYpOw0KLS0gDQoyLjE3LjENCg0K
