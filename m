Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 14ECE3E1D4C
	for <lists+netdev@lfdr.de>; Thu,  5 Aug 2021 22:21:33 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S240628AbhHEUVp (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Thu, 5 Aug 2021 16:21:45 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:39348 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S229771AbhHEUVo (ORCPT
        <rfc822;netdev@vger.kernel.org>); Thu, 5 Aug 2021 16:21:44 -0400
Received: from mail-pj1-x102a.google.com (mail-pj1-x102a.google.com [IPv6:2607:f8b0:4864:20::102a])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 15023C061765
        for <netdev@vger.kernel.org>; Thu,  5 Aug 2021 13:21:30 -0700 (PDT)
Received: by mail-pj1-x102a.google.com with SMTP id mt6so11734789pjb.1
        for <netdev@vger.kernel.org>; Thu, 05 Aug 2021 13:21:30 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=google.com; s=20161025;
        h=mime-version:references:in-reply-to:from:date:message-id:subject:to
         :cc;
        bh=JHi0w/ljYHmjAeAr4kIJ462c16iIMIj8NU0G3lUi7nk=;
        b=rsc9HqY/Qytp9p92+9WoaOWX7RhdKe6coxEHYKH5S4oK2hMDNtu79RqQ94+YsCKeTx
         6WVNC6Jg+R5QVBOD6LG4r7A/m1ueeD48a97Fjr9EimOdM3Dvq0LCyl/T3gXysxPduBco
         vCI0E9ERWe2c0bSFA9+V6lgf8dVHA5LLsYNSSt5RxhzdH3H9TVjwt6VRqmks8tX4iP3h
         5rSG4N4ouyk5BFsJvhb/zEqmy7hexSnUIrhDBuYt/92sjHzQ08duitxOsYlYmIfRQCbS
         Xe7WyXGrU7C7oOEYXDhWCb4MnhJglHFkSVKwuuvx0K49cWwbtAmpWt3Tq0JB99ftAWNW
         811A==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:references:in-reply-to:from:date
         :message-id:subject:to:cc;
        bh=JHi0w/ljYHmjAeAr4kIJ462c16iIMIj8NU0G3lUi7nk=;
        b=Jc37DLxZQWdQGaq4kSg1j0iTQ02aX2+PcYItxpXjHURPW+V4K7flCGLmTBVtS9BaH7
         st4hKBOcd6KD3s73W6e2X0Bwt5hpl4J3IOf/VTvC5h9ijZl3+7a2PJyOcVNgAQpfnSaR
         tiJ6OH71KGu+Tdp8dQyZ91pKmJvbwyRqXOlFhurAF3fu0rTsSYQf8Ez3C3bMONolHdIZ
         Wxa1OdzCsdOL+1arFzoNc5WFf5/HoT+k4wZdrJFE8gUGfST+EQWCbhmieqFdO0PFtLO9
         IT5g2bXUkVM1TmjNi7ipWQOsBndZxuI7/Yi+DKomsOgUUuaU5MymxB+1fYwVeqmzvd5l
         RYYQ==
X-Gm-Message-State: AOAM533f2mF5j27SYyhkVTLvtYhChFVRF6OPTuH5FTAeIGiwtQDYwQnV
        pDNQXB/hT5R16iK/58vGSvN5pqS5GPiaEp8wat3D6w==
X-Google-Smtp-Source: ABdhPJzCrN3eaN7IitGoJNKdtoOS3EFoGd41Nfud7d+OqalUMjBLvsM9xBW+c2Dab7UPeJi6F10OwcYktkVv9Iuvifg=
X-Received: by 2002:a17:902:e843:b029:12c:d520:453e with SMTP id
 t3-20020a170902e843b029012cd520453emr5751518plg.50.1628194889281; Thu, 05 Aug
 2021 13:21:29 -0700 (PDT)
MIME-Version: 1.0
References: <20210805073641.3533280-1-lixiaoyan@google.com>
 <20210805073641.3533280-2-lixiaoyan@google.com> <6595b716cb0b37e9daf4202163b4567116d4b4e2.camel@redhat.com>
In-Reply-To: <6595b716cb0b37e9daf4202163b4567116d4b4e2.camel@redhat.com>
From:   Coco Li <lixiaoyan@google.com>
Date:   Thu, 5 Aug 2021 13:21:18 -0700
Message-ID: <CADjXwjimPFM4Ut0Zv0cZh0DviwW=CrAb=XV5zLeX+4d__OayDg@mail.gmail.com>
Subject: Re: [PATCH net-next 1/2] selftests/net: GRO coalesce test
To:     Paolo Abeni <pabeni@redhat.com>
Cc:     netdev@vger.kernel.org, davem@davemloft.net, kuba@kernel.org,
        Willem de Bruijn <willemb@google.com>,
        Tanner Love <tannerlove@google.com>
Content-Type: text/plain; charset="UTF-8"
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

On Thu, Aug 5, 2021 at 4:16 AM Paolo Abeni <pabeni@redhat.com> wrote:
>
> Hello,
>
> On Thu, 2021-08-05 at 07:36 +0000, Coco Li wrote:
> > Implement a GRO testsuite that expects Linux kernel GRO behavior.
> > All tests pass with the kernel software GRO stack. Run against a device
> > with hardware GRO to verify that it matches the software stack.
> >
> > gro.c generates packets and sends them out through a packet socket. The
> > receiver in gro.c (run separately) receives the packets on a packet
> > socket, filters them by destination ports using BPF and checks the
> > packet geometry to see whether GRO was applied.
> >
> > gro.sh provides a wrapper to run the gro.c in NIC loopback mode.
> > It is not included in continuous testing because it modifies network
> > configuration around a physical NIC: gro.sh sets the NIC in loopback
> > mode, creates macvlan devices on the physical device in separate
> > namespaces, and sends traffic generated by gro.c between the two
> > namespaces to observe coalescing behavior.
>
> I like this idea a lot!
>
> Have you considered additionally run the same test of top of a veth
> pair, and have such tests always enabled, so we could have some
> coverage regardless of specific H/W available?
>
> To do the above you should disable TSO on the veth sender peer and
> enable GRO on the other end.

Thanks for the suggestion! To make sure I understand you correctly,
would this be another script that creates the veth pair separate from
the gro.sh wrapper?
