Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 79FE2F51D3
	for <lists+netdev@lfdr.de>; Fri,  8 Nov 2019 18:00:19 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1729981AbfKHRAP (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Fri, 8 Nov 2019 12:00:15 -0500
Received: from us-smtp-delivery-1.mimecast.com ([207.211.31.120]:20598 "EHLO
        us-smtp-1.mimecast.com" rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org
        with ESMTP id S1725970AbfKHRAP (ORCPT
        <rfc822;netdev@vger.kernel.org>); Fri, 8 Nov 2019 12:00:15 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
        s=mimecast20190719; t=1573232414;
        h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
         to:to:cc:cc:mime-version:mime-version:content-type:content-type:
         content-transfer-encoding:content-transfer-encoding;
        bh=VwA2WCFcUAjH7MRfPsy8BpX4p7tdzURG6p5MYCIe2yM=;
        b=CpiT+Yzbpiw8A5z9Pktf6s2oCdUVTzHYBK5WH7vf9oUvmm22ZV0giasWr6gmNSlk1apY44
        HXhvtrt9iNg31CxkNfZV/vMA2FOM7yz0oxH8OXDWHWLlpCypDf8UJABs2DATz4+xUaQYED
        /Y3ciI/uNcaSH6f9+U/J3gaE0xZjY00=
Received: from mail-wr1-f70.google.com (mail-wr1-f70.google.com
 [209.85.221.70]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-381-kD2e9_PlNJKZkdreotkueA-1; Fri, 08 Nov 2019 12:00:12 -0500
Received: by mail-wr1-f70.google.com with SMTP id h7so3338823wrb.2
        for <netdev@vger.kernel.org>; Fri, 08 Nov 2019 09:00:12 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:date:from:to:cc:subject:message-id:mime-version
         :content-disposition:user-agent;
        bh=I/ULzgaIFbUNF+P+L0MszJ67ZEw7IB12oNuKCjME1GQ=;
        b=Ypvv4v2oken0SZB8htN9bCcMRp5F6q3ulFh5t9MihfOn7Mfg9H92UniXQsxNetBop3
         UZjmMYhfKT7JnDrMdcIgxryQdUhy007vafdPHnf7HsG7FErQrXMBaRC1TTbRUBM9f4ZJ
         D66BesvRJhwW9YUcrvLL2s3Bagl8Z3t7fr9ZaO61OfzB1+6Ze500KB3P3TRsXPDafV+j
         xlN0dciFKOTHLWg5gtLkJ8ep0/squ/fLf/2yv94Au4/HQFY+l/r7DfqlYPE5d3v6zZFR
         DGqs784v2TKWclwHbJpyHhIokdpKNt11JYpqRJS8Szb7MmFMdz7N5i0vwNAtsC+pH5Jc
         OP6w==
X-Gm-Message-State: APjAAAU4I+vCsUxGNOOtOcjWA6/Pp3B9sSUvLYtHcZyzVkA7/Y+c4KQf
        DanJg+RtX6qFVkwsBJ2/AQ+svqvmZ071jVQjhzm5B0QggPWRHeYmbuDpwsPThwNn2/4YZnMbcPZ
        8rfJJyNbJU98EUOL/
X-Received: by 2002:adf:df09:: with SMTP id y9mr7045312wrl.25.1573232411098;
        Fri, 08 Nov 2019 09:00:11 -0800 (PST)
X-Google-Smtp-Source: APXvYqxfquLl5S7f0Rug2OFq+lryb+BuxulorDeBsX245ggo5gGFzl9IVfgP5F39lsijRWnBjqYs5w==
X-Received: by 2002:adf:df09:: with SMTP id y9mr7045296wrl.25.1573232410942;
        Fri, 08 Nov 2019 09:00:10 -0800 (PST)
Received: from linux.home (2a01cb058918ce00dd1a5a4f9908f2d5.ipv6.abo.wanadoo.fr. [2a01:cb05:8918:ce00:dd1a:5a4f:9908:f2d5])
        by smtp.gmail.com with ESMTPSA id r15sm6289518wrc.5.2019.11.08.09.00.10
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Fri, 08 Nov 2019 09:00:10 -0800 (PST)
Date:   Fri, 8 Nov 2019 18:00:08 +0100
From:   Guillaume Nault <gnault@redhat.com>
To:     David Ahern <dsahern@gmail.com>
Cc:     netdev@vger.kernel.org, Nicolas Dichtel <nicolas.dichtel@6wind.com>
Subject: [PATCH iproute2-next 0/5] ipnetns: cleanup and harden processing of
 netns ids
Message-ID: <cover.1573231189.git.gnault@redhat.com>
MIME-Version: 1.0
User-Agent: Mutt/1.12.1 (2019-06-15)
X-MC-Unique: kD2e9_PlNJKZkdreotkueA-1
X-Mimecast-Spam-Score: 0
Content-Type: text/plain; charset=WINDOWS-1252
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline
Sender: netdev-owner@vger.kernel.org
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

It's currently hard to review ipnetns. The netns ids are inconsistently
treated as signed or unsigned and most helper functions aren't prepared
to use negative ids.

Netns id attributes can be negative: NETNSA_NSID_NOT_ASSIGNED =3D=3D -1.
So let's consistently treat nsids as signed and also reject negative
values in functions that are supposed to only handle assigned netns
ids.

While there, let's drop the extra blank line generated by some command
line parsing errors (patch 5/5).

Guillaume Nault (5):
  ipnetns: treat NETNSA_NSID and NETNSA_CURRENT_NSID as signed
  ipnetns: fix misleading comment about 'ip monitor nsid'
  ipnetns: harden helper functions wrt. negative netns ids
  ipnetns: don't print unassigned nsid in json export
  ipnetns: remove blank lines printed by invarg() messages

 ip/ipnetns.c | 49 +++++++++++++++++++++++++++++--------------------
 1 file changed, 29 insertions(+), 20 deletions(-)

--=20
2.21.0

