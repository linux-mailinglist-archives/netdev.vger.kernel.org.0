Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 897833F3A08
	for <lists+netdev@lfdr.de>; Sat, 21 Aug 2021 11:50:57 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S233787AbhHUJvd (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Sat, 21 Aug 2021 05:51:33 -0400
Received: from mail.kernel.org ([198.145.29.99]:58706 "EHLO mail.kernel.org"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S233286AbhHUJvb (ORCPT <rfc822;netdev@vger.kernel.org>);
        Sat, 21 Aug 2021 05:51:31 -0400
Received: from disco-boy.misterjones.org (disco-boy.misterjones.org [51.254.78.96])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by mail.kernel.org (Postfix) with ESMTPSA id 2D9A861040;
        Sat, 21 Aug 2021 09:50:52 +0000 (UTC)
Received: from sofa.misterjones.org ([185.219.108.64] helo=wait-a-minute.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.94.2)
        (envelope-from <maz@kernel.org>)
        id 1mHNeM-006Lq1-48; Sat, 21 Aug 2021 10:50:50 +0100
Date:   Sat, 21 Aug 2021 10:50:41 +0100
Message-ID: <878s0vqg7i.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     Jakub Kicinski <kuba@kernel.org>
Cc:     netdev@vger.kernel.org, kernel-team@android.com,
        linux-kernel@vger.kernel.org,
        Matteo Croce <mcroce@linux.microsoft.com>,
        "David S. Miller" <davem@davemloft.net>,
        Eric Dumazet <eric.dumazet@gmail.com>,
        Giuseppe Cavallaro <peppe.cavallaro@st.com>,
        Alexandre Torgue <alexandre.torgue@foss.st.com>
Subject: Re: [PATCH net] stmmac: Revert "stmmac: align RX buffers"
In-Reply-To: <20210820144610.7576c36a@kicinski-fedora-pc1c0hjn.dhcp.thefacebook.com>
References: <20210820183002.457226-1-maz@kernel.org>
        <20210820144610.7576c36a@kicinski-fedora-pc1c0hjn.dhcp.thefacebook.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/27.1
 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: kuba@kernel.org, netdev@vger.kernel.org, kernel-team@android.com, linux-kernel@vger.kernel.org, mcroce@linux.microsoft.com, davem@davemloft.net, eric.dumazet@gmail.com, peppe.cavallaro@st.com, alexandre.torgue@foss.st.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

On Fri, 20 Aug 2021 22:46:10 +0100,
Jakub Kicinski <kuba@kernel.org> wrote:
> 
> On Fri, 20 Aug 2021 19:30:02 +0100 Marc Zyngier wrote:
> > This reverts commit a955318fe67e ("stmmac: align RX buffers"),
> > which breaks at least one platform (Nvidia Jetson-X1), causing
> > packet corruption. This is 100% reproducible, and reverting
> > the patch results in a working system again.
> > 
> > Given that it is "only" a performance optimisation, let's
> > return to a known working configuration until we can have a
> > good understanding of what is happening here.
> 
> Seems reasonable. Hopefully it wont discourage Matteo from revisiting
> the optimization. Applied, thanks!

That's my hope too. As I pointed out at the end of the towards the end
of the discussion I linked to, this buys us time to work out exactly
where is the gap in our understanding of the buffer allocation for
this particular driver.

Once we clearly understand why it fails on some systems and not some
others (which on its own could cover a multitude of sins), I'd be glad
to see this optimisation brought back in, and I'm willing to help with
it.

Thanks,

	M.

-- 
Without deviation from the norm, progress is not possible.
