Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 8A25541191C
	for <lists+netdev@lfdr.de>; Mon, 20 Sep 2021 18:12:48 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S242862AbhITQOH (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Mon, 20 Sep 2021 12:14:07 -0400
Received: from mail-bn7nam10on2055.outbound.protection.outlook.com ([40.107.92.55]:31296
        "EHLO NAM10-BN7-obe.outbound.protection.outlook.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S242661AbhITQNu (ORCPT <rfc822;netdev@vger.kernel.org>);
        Mon, 20 Sep 2021 12:13:50 -0400
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=XP7/cJrcHZecIdgKC9bZ4DIe8OS40PSz0j07ZlgTzdPrFMUJEg9G2B0OYmxGOSZT+sb1VJTZWHQiyFxBlRO20z9kkKpFBWP+srBOWZFOSAsqDvgbFqG6Q3AYU/COCGN88PrVHV86fP8KfLkE4Ikl+eKTKUkPeJ7Wp1ImOY2xm1lblEGQODpDAHRh8fG9xWaA3GP7IKnDmaMFLeRPgjorJDbbTiipFpgHIUb5OTl79uL6oHPsOh0qfMOoNDZ1TIzOUCbVJJFMk4FWiVTrIBnTn8okwSKmXgQCFilQtG0nFZ9S0/uIEOnNe97oU6I+5gSeT0hF/wzughz7+lfRYM5dXQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector9901; h=From:Date:Subject:Message-ID:Content-Type:MIME-Version;
 bh=agdAC3VUVrwvu6B1Coi2+jA/vJB6/tC0zCloVaIaojU=;
 b=M14Wp+hHRf/C6o1Voulz4iiKtl6OUc6aMYrkWHDuah7TBMb7wW/njzc5+7Uh1pTv5r2E+xhk5YlWzw0Wn5fdHG6/6PGEYSecyM2kJgpqcqinhik5GOMIO/tg6PhpxndyQW/eBnclB2p1xLCJ5COj4vyHoZGxiejMEjjwL3n94VVVlI7VsipeZ0RCHwASyuS10B2a7jJrnaJiuBTVY5uD1eWC/H7ITvUt+Ap9xovsxLqakYcZ91t2RjWYK+jBPtQLwZ0tIr7ODNPgNnhhakFUiZrSQ7w6+sL6szhIne/LGLUDQrx3uLzjiu4jrDOYYZmzb4HTYHTQ2b4dWwIA7JuDJg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=silabs.com; dmarc=pass action=none header.from=silabs.com;
 dkim=pass header.d=silabs.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=silabs.onmicrosoft.com; s=selector2-silabs-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=agdAC3VUVrwvu6B1Coi2+jA/vJB6/tC0zCloVaIaojU=;
 b=QwP2Vvx8tPpRt10pQuN0WiU0EPz5Tpqlm6yKPhS0BYzMPKvIxCwU87yfim+1RmGsZryF3NLav8H4FhN6NGXWOTx2YRaeHXsBXPhGXpsrW173GnvBdLjer4mAwf1KuaTKjzuOOxDdbZKf13qor5Sy5QDj1OaWX3ZGLcuKhqE7VHQ=
Authentication-Results: vger.kernel.org; dkim=none (message not signed)
 header.d=none;vger.kernel.org; dmarc=none action=none header.from=silabs.com;
Received: from SN6PR11MB2718.namprd11.prod.outlook.com (2603:10b6:805:63::18)
 by SA2PR11MB5002.namprd11.prod.outlook.com (2603:10b6:806:fb::8) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.4523.16; Mon, 20 Sep
 2021 16:12:10 +0000
Received: from SN6PR11MB2718.namprd11.prod.outlook.com
 ([fe80::7050:a0a:415:2ccd]) by SN6PR11MB2718.namprd11.prod.outlook.com
 ([fe80::7050:a0a:415:2ccd%7]) with mapi id 15.20.4523.018; Mon, 20 Sep 2021
 16:12:10 +0000
From:   Jerome Pouiller <Jerome.Pouiller@silabs.com>
To:     linux-wireless@vger.kernel.org, netdev@vger.kernel.org,
        Kalle Valo <kvalo@codeaurora.org>
Cc:     devel@driverdev.osuosl.org, linux-kernel@vger.kernel.org,
        Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
        "David S . Miller" <davem@davemloft.net>,
        devicetree@vger.kernel.org, Rob Herring <robh+dt@kernel.org>,
        linux-mmc@vger.kernel.org,
        =?UTF-8?q?Pali=20Roh=C3=A1r?= <pali@kernel.org>,
        Ulf Hansson <ulf.hansson@linaro.org>,
        =?UTF-8?q?J=C3=A9r=C3=B4me=20Pouiller?= 
        <jerome.pouiller@silabs.com>
Subject: [PATCH v7 07/24] wfx: add bus_spi.c
Date:   Mon, 20 Sep 2021 18:11:19 +0200
Message-Id: <20210920161136.2398632-8-Jerome.Pouiller@silabs.com>
X-Mailer: git-send-email 2.33.0
In-Reply-To: <20210920161136.2398632-1-Jerome.Pouiller@silabs.com>
References: <20210920161136.2398632-1-Jerome.Pouiller@silabs.com>
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: base64
X-ClientProxiedBy: SA0PR11CA0064.namprd11.prod.outlook.com
 (2603:10b6:806:d2::9) To SN6PR11MB2718.namprd11.prod.outlook.com
 (2603:10b6:805:63::18)
MIME-Version: 1.0
Received: from pc-42.silabs.com (2a01:e34:ecb5:66a0:9876:e1d7:65be:d294) by SA0PR11CA0064.namprd11.prod.outlook.com (2603:10b6:806:d2::9) with Microsoft SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.4523.14 via Frontend Transport; Mon, 20 Sep 2021 16:12:08 +0000
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 64cba47c-47f5-4dad-7680-08d97c516685
X-MS-TrafficTypeDiagnostic: SA2PR11MB5002:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <SA2PR11MB5002D2FD8DFA5014EC4460C693A09@SA2PR11MB5002.namprd11.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:2733;
X-MS-Exchange-SenderADCheck: 1
X-MS-Exchange-AntiSpam-Relay: 0
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: 0t5vd3oCG1NrPdHf97NukwSvn4nLuR4YzXUG3B8aw63F8mRhBnWa/s9ny+daQiRBar6I72l3GFGQSGhWsUvAIbT206jJbzBxz9NZ0n6jcUROwGbYf9kkuxTiJ5HgW8Qzi7/aZF5t853xXwAUxLX20DcB7ODpKlNmjz+TZqChTCp8yd6V7V6iXsL/bVF0Z3EuGzOrkvZh5Aqg2ojwD00D7G4zH5ohfH8rQkOyh2U5hQAlrvyPURqitLyP9aUz5VmmbCOX7oAYT9FaYEG9KopB+1tP12YByBuVYkED/8Ao1Vnj8QVMGdvFO1VMSMH4TW8lKtUO3A868Nqt4ozJEB0pj9YtYAG7j7odAjUGgzAYiw84je17XKSRU6atLVJA/zp156vzQ8hzillpRQPpNVx2wAmNLW+FEqh+T4htuBncWzyYDPg5TP0agL09JnbVifk4gLElMF6fyfGyjQpRycwMkcqLQnPFW1u2FUb3GeK7oeFVh8zyQB2ZGg2A9WrjfRcvTsiJm61tFhVnokMpzspZXwjX/tFfjlVqX5ouB4SHh9+jOLS6TU6HhqI/mmRLPy9OSNa00zrblgmhQQspXfpo+dXjDmYGySnWYjZOTaJPwC52q+aQUFkJLISBqEA4alMDc3B4M7YUMc5E8Kt/80zr5Q==
X-Forefront-Antispam-Report: CIP:255.255.255.255;CTRY:;LANG:en;SCL:1;SRV:;IPV:NLI;SFV:NSPM;H:SN6PR11MB2718.namprd11.prod.outlook.com;PTR:;CAT:NONE;SFS:(366004)(66476007)(36756003)(2616005)(66556008)(107886003)(186003)(54906003)(5660300002)(6486002)(66574015)(66946007)(52116002)(38100700002)(83380400001)(7696005)(6916009)(2906002)(1076003)(4326008)(8936002)(316002)(8676002)(508600001)(86362001)(6666004)(7416002);DIR:OUT;SFP:1101;
X-MS-Exchange-AntiSpam-MessageData-ChunkCount: 1
X-MS-Exchange-AntiSpam-MessageData-0: 7kCobPDItjEN7DDCBeF6TF23+HXVwK5qhWUSfhdSHqs/WnsT8Cl4xXoLxWPpEz3OLLbaVdikoyyCFRKO+e7vicwBgnpxQB1rGJrkL01T/JyhZZZvIRR4QiyL0f2yp4u5cCLE4++MU7bRQxJAHlpg8Fk9lYlOyOuf8BmOg+sY1n1+1R9Un4bEXBEzCK+J1LiHd6OyQrPV4yJVvpEzCqviFHKpoKyW0Cs2xXn04IDRoV2EoLlNWKibX4mYAWg3dCmf9pRRInUhWalZSseYFJzckze2DCPGhPmZ/sDSIKrz0nLv+4mvmlQWze4SoaOc3UqueP7b4pQTov1pT7f1vG5e3rgIqTILm+KRazq1cQGcRutVUOoL39AzBsVSk4pNtWtBnXzU/7wKcQ59G/Kbshl9rNrcB+epomeS3qkb1KajEE4qyrNQY4zlyvAnKTY9WV/DityXEp+p+MkOj9clvis+Xlh3f0jDNuKNoYPsoArVLZV3KbfBAXB9MbSJLweDb5hrJHwWMFpVttUycymCBuL7pqJsWA9ldtmsAUFuz2rzc9AUzdLnj+UceCJVTfHQPx5PkES0u/9t7CQo1eWhyrgLdaOQcyMF+Pf39Z5tHMp5fMo+JZ1FHsifyl6on19TPT9EekqC2u5FFy/PWCgKvWXdcXjdVOEoDTkIyM9iVwzo2epy8N1s3xgdnYdeDoRdj+20QQucZm2/y3MWr7ISkhi0KNZ8d4UGplmZR+DCMWRIsElGr2q9LGgkOJD4DqLeJE9PMMZGgkHDwa6/5vuM+0sr94SoNnLFp1ID33vq7O+k59d7hK88GoE423dztXum+9kL
X-OriginatorOrg: silabs.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 64cba47c-47f5-4dad-7680-08d97c516685
X-MS-Exchange-CrossTenant-AuthSource: SN6PR11MB2718.namprd11.prod.outlook.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 20 Sep 2021 16:12:10.6352
 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 54dbd822-5231-4b20-944d-6f4abcd541fb
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: x6mv1mbzsjjV7dCUz9dpS8aUE1jIZY+1f2owwz9Co3s6YhXcSZoE6VBdWNbpJzoYHx7rgBKFtdMaD9KHP/iF7A==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: SA2PR11MB5002
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

RnJvbTogSsOpcsO0bWUgUG91aWxsZXIgPGplcm9tZS5wb3VpbGxlckBzaWxhYnMuY29tPgoKU2ln
bmVkLW9mZi1ieTogSsOpcsO0bWUgUG91aWxsZXIgPGplcm9tZS5wb3VpbGxlckBzaWxhYnMuY29t
PgotLS0KIGRyaXZlcnMvbmV0L3dpcmVsZXNzL3NpbGFicy93ZngvYnVzX3NwaS5jIHwgMjcxICsr
KysrKysrKysrKysrKysrKysrKysKIDEgZmlsZSBjaGFuZ2VkLCAyNzEgaW5zZXJ0aW9ucygrKQog
Y3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvbmV0L3dpcmVsZXNzL3NpbGFicy93ZngvYnVzX3Nw
aS5jCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9uZXQvd2lyZWxlc3Mvc2lsYWJzL3dmeC9idXNfc3Bp
LmMgYi9kcml2ZXJzL25ldC93aXJlbGVzcy9zaWxhYnMvd2Z4L2J1c19zcGkuYwpuZXcgZmlsZSBt
b2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjU1ZmZjZDdjNDJlMgotLS0gL2Rldi9udWxs
CisrKyBiL2RyaXZlcnMvbmV0L3dpcmVsZXNzL3NpbGFicy93ZngvYnVzX3NwaS5jCkBAIC0wLDAg
KzEsMjcxIEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1vbmx5CisvKgor
ICogU1BJIGludGVyZmFjZS4KKyAqCisgKiBDb3B5cmlnaHQgKGMpIDIwMTctMjAyMCwgU2lsaWNv
biBMYWJvcmF0b3JpZXMsIEluYy4KKyAqIENvcHlyaWdodCAoYykgMjAxMSwgU2FncmFkIEluYy4K
KyAqIENvcHlyaWdodCAoYykgMjAxMCwgU1QtRXJpY3Nzb24KKyAqLworI2luY2x1ZGUgPGxpbnV4
L21vZHVsZS5oPgorI2luY2x1ZGUgPGxpbnV4L2RlbGF5Lmg+CisjaW5jbHVkZSA8bGludXgvZ3Bp
by9jb25zdW1lci5oPgorI2luY2x1ZGUgPGxpbnV4L3NwaS9zcGkuaD4KKyNpbmNsdWRlIDxsaW51
eC9pbnRlcnJ1cHQuaD4KKyNpbmNsdWRlIDxsaW51eC9pcnEuaD4KKyNpbmNsdWRlIDxsaW51eC9v
Zi5oPgorCisjaW5jbHVkZSAiYnVzLmgiCisjaW5jbHVkZSAid2Z4LmgiCisjaW5jbHVkZSAiaHdp
by5oIgorI2luY2x1ZGUgIm1haW4uaCIKKyNpbmNsdWRlICJiaC5oIgorCisjZGVmaW5lIFNFVF9X
UklURSAweDdGRkYgICAgICAgIC8qIHVzYWdlOiBhbmQgb3BlcmF0aW9uICovCisjZGVmaW5lIFNF
VF9SRUFEIDB4ODAwMCAgICAgICAgIC8qIHVzYWdlOiBvciBvcGVyYXRpb24gKi8KKworI2RlZmlu
ZSBXRlhfUkVTRVRfSU5WRVJURUQgMQorCitzdGF0aWMgY29uc3Qgc3RydWN0IHdmeF9wbGF0Zm9y
bV9kYXRhIHdmeF9zcGlfcGRhdGEgPSB7CisJLmZpbGVfZncgPSAid2ZtX3dmMjAwIiwKKwkuZmls
ZV9wZHMgPSAid2YyMDAucGRzIiwKKwkudXNlX3Jpc2luZ19jbGsgPSB0cnVlLAorfTsKKworc3Ry
dWN0IHdmeF9zcGlfcHJpdiB7CisJc3RydWN0IHNwaV9kZXZpY2UgKmZ1bmM7CisJc3RydWN0IHdm
eF9kZXYgKmNvcmU7CisJc3RydWN0IGdwaW9fZGVzYyAqZ3Bpb19yZXNldDsKKwlib29sIG5lZWRf
c3dhYjsKK307CisKKy8qIFRoZSBjaGlwIHJlYWRzIDE2Yml0cyBvZiBkYXRhIGF0IHRpbWUgYW5k
IHBsYWNlIHRoZW0gZGlyZWN0bHkgaW50byAobGl0dGxlCisgKiBlbmRpYW4pIENQVSByZWdpc3Rl
ci4gU28sIHRoZSBjaGlwIGV4cGVjdHMgYnl0ZXMgb3JkZXIgdG8gYmUgIkIxIEIwIEIzIEIyIgor
ICogKHdoaWxlIExFIGlzICJCMCBCMSBCMiBCMyIgYW5kIEJFIGlzICJCMyBCMiBCMSBCMCIpCisg
KgorICogQSBsaXR0bGUgZW5kaWFuIGhvc3Qgd2l0aCBiaXRzX3Blcl93b3JkID09IDE2IHNob3Vs
ZCBkbyB0aGUgcmlnaHQgam9iCisgKiBuYXRpdmVseS4gVGhlIGNvZGUgYmVsb3cgdG8gc3VwcG9y
dCBiaWcgZW5kaWFuIGhvc3QgYW5kIGNvbW1vbmx5IHVzZWQgU1BJCisgKiA4Yml0cy4KKyAqLwor
c3RhdGljIGludCB3Znhfc3BpX2NvcHlfZnJvbV9pbyh2b2lkICpwcml2LCB1bnNpZ25lZCBpbnQg
YWRkciwKKwkJCQl2b2lkICpkc3QsIHNpemVfdCBjb3VudCkKK3sKKwlzdHJ1Y3Qgd2Z4X3NwaV9w
cml2ICpidXMgPSBwcml2OworCXUxNiByZWdhZGRyID0gKGFkZHIgPDwgMTIpIHwgKGNvdW50IC8g
MikgfCBTRVRfUkVBRDsKKwlzdHJ1Y3Qgc3BpX21lc3NhZ2UgICAgICBtOworCXN0cnVjdCBzcGlf
dHJhbnNmZXIgICAgIHRfYWRkciA9IHsKKwkJLnR4X2J1ZiAgICAgICAgID0gJnJlZ2FkZHIsCisJ
CS5sZW4gICAgICAgICAgICA9IHNpemVvZihyZWdhZGRyKSwKKwl9OworCXN0cnVjdCBzcGlfdHJh
bnNmZXIgICAgIHRfbXNnID0geworCQkucnhfYnVmICAgICAgICAgPSBkc3QsCisJCS5sZW4gICAg
ICAgICAgICA9IGNvdW50LAorCX07CisJdTE2ICpkc3QxNiA9IGRzdDsKKwlpbnQgcmV0LCBpOwor
CisJV0FSTihjb3VudCAlIDIsICJidWZmZXIgc2l6ZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgMiIp
OworCisJY3B1X3RvX2xlMTZzKCZyZWdhZGRyKTsKKwlpZiAoYnVzLT5uZWVkX3N3YWIpCisJCXN3
YWIxNnMoJnJlZ2FkZHIpOworCisJc3BpX21lc3NhZ2VfaW5pdCgmbSk7CisJc3BpX21lc3NhZ2Vf
YWRkX3RhaWwoJnRfYWRkciwgJm0pOworCXNwaV9tZXNzYWdlX2FkZF90YWlsKCZ0X21zZywgJm0p
OworCXJldCA9IHNwaV9zeW5jKGJ1cy0+ZnVuYywgJm0pOworCisJaWYgKGJ1cy0+bmVlZF9zd2Fi
ICYmIGFkZHIgPT0gV0ZYX1JFR19DT05GSUcpCisJCWZvciAoaSA9IDA7IGkgPCBjb3VudCAvIDI7
IGkrKykKKwkJCXN3YWIxNnMoJmRzdDE2W2ldKTsKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMg
aW50IHdmeF9zcGlfY29weV90b19pbyh2b2lkICpwcml2LCB1bnNpZ25lZCBpbnQgYWRkciwKKwkJ
CSAgICAgIGNvbnN0IHZvaWQgKnNyYywgc2l6ZV90IGNvdW50KQoreworCXN0cnVjdCB3Znhfc3Bp
X3ByaXYgKmJ1cyA9IHByaXY7CisJdTE2IHJlZ2FkZHIgPSAoYWRkciA8PCAxMikgfCAoY291bnQg
LyAyKTsKKwkvKiBGSVhNRTogdXNlIGEgYm91bmNlIGJ1ZmZlciAqLworCXUxNiAqc3JjMTYgPSAo
dm9pZCAqKXNyYzsKKwlpbnQgcmV0LCBpOworCXN0cnVjdCBzcGlfbWVzc2FnZSAgICAgIG07CisJ
c3RydWN0IHNwaV90cmFuc2ZlciAgICAgdF9hZGRyID0geworCQkudHhfYnVmICAgICAgICAgPSAm
cmVnYWRkciwKKwkJLmxlbiAgICAgICAgICAgID0gc2l6ZW9mKHJlZ2FkZHIpLAorCX07CisJc3Ry
dWN0IHNwaV90cmFuc2ZlciAgICAgdF9tc2cgPSB7CisJCS50eF9idWYgICAgICAgICA9IHNyYywK
KwkJLmxlbiAgICAgICAgICAgID0gY291bnQsCisJfTsKKworCVdBUk4oY291bnQgJSAyLCAiYnVm
ZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDIiKTsKKwlXQVJOKHJlZ2FkZHIgJiBTRVRf
UkVBRCwgImJhZCBhZGRyIG9yIHNpemUgb3ZlcmZsb3ciKTsKKworCWNwdV90b19sZTE2cygmcmVn
YWRkcik7CisKKwkvKiBSZWdpc3RlciBhZGRyZXNzIGFuZCBDT05GSUcgY29udGVudCBhbHdheXMg
dXNlIDE2Yml0IGJpZyBlbmRpYW4KKwkgKiAoIkJBREMiIG9yZGVyKQorCSAqLworCWlmIChidXMt
Pm5lZWRfc3dhYikKKwkJc3dhYjE2cygmcmVnYWRkcik7CisJaWYgKGJ1cy0+bmVlZF9zd2FiICYm
IGFkZHIgPT0gV0ZYX1JFR19DT05GSUcpCisJCWZvciAoaSA9IDA7IGkgPCBjb3VudCAvIDI7IGkr
KykKKwkJCXN3YWIxNnMoJnNyYzE2W2ldKTsKKworCXNwaV9tZXNzYWdlX2luaXQoJm0pOworCXNw
aV9tZXNzYWdlX2FkZF90YWlsKCZ0X2FkZHIsICZtKTsKKwlzcGlfbWVzc2FnZV9hZGRfdGFpbCgm
dF9tc2csICZtKTsKKwlyZXQgPSBzcGlfc3luYyhidXMtPmZ1bmMsICZtKTsKKworCWlmIChidXMt
Pm5lZWRfc3dhYiAmJiBhZGRyID09IFdGWF9SRUdfQ09ORklHKQorCQlmb3IgKGkgPSAwOyBpIDwg
Y291bnQgLyAyOyBpKyspCisJCQlzd2FiMTZzKCZzcmMxNltpXSk7CisJcmV0dXJuIHJldDsKK30K
Kworc3RhdGljIHZvaWQgd2Z4X3NwaV9sb2NrKHZvaWQgKnByaXYpCit7Cit9CisKK3N0YXRpYyB2
b2lkIHdmeF9zcGlfdW5sb2NrKHZvaWQgKnByaXYpCit7Cit9CisKK3N0YXRpYyBpcnFyZXR1cm5f
dCB3Znhfc3BpX2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKnByaXYpCit7CisJc3RydWN0IHdm
eF9zcGlfcHJpdiAqYnVzID0gcHJpdjsKKworCXdmeF9iaF9yZXF1ZXN0X3J4KGJ1cy0+Y29yZSk7
CisJcmV0dXJuIElSUV9IQU5ETEVEOworfQorCitzdGF0aWMgaW50IHdmeF9zcGlfaXJxX3N1YnNj
cmliZSh2b2lkICpwcml2KQoreworCXN0cnVjdCB3Znhfc3BpX3ByaXYgKmJ1cyA9IHByaXY7CisJ
dTMyIGZsYWdzOworCisJZmxhZ3MgPSBpcnFfZ2V0X3RyaWdnZXJfdHlwZShidXMtPmZ1bmMtPmly
cSk7CisJaWYgKCFmbGFncykKKwkJZmxhZ3MgPSBJUlFGX1RSSUdHRVJfSElHSDsKKwlmbGFncyB8
PSBJUlFGX09ORVNIT1Q7CisJcmV0dXJuIGRldm1fcmVxdWVzdF90aHJlYWRlZF9pcnEoJmJ1cy0+
ZnVuYy0+ZGV2LCBidXMtPmZ1bmMtPmlycSwgTlVMTCwKKwkJCQkJIHdmeF9zcGlfaXJxX2hhbmRs
ZXIsIElSUUZfT05FU0hPVCwKKwkJCQkJICJ3ZngiLCBidXMpOworfQorCitzdGF0aWMgaW50IHdm
eF9zcGlfaXJxX3Vuc3Vic2NyaWJlKHZvaWQgKnByaXYpCit7CisJc3RydWN0IHdmeF9zcGlfcHJp
diAqYnVzID0gcHJpdjsKKworCWRldm1fZnJlZV9pcnEoJmJ1cy0+ZnVuYy0+ZGV2LCBidXMtPmZ1
bmMtPmlycSwgYnVzKTsKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHNpemVfdCB3Znhfc3BpX2Fs
aWduX3NpemUodm9pZCAqcHJpdiwgc2l6ZV90IHNpemUpCit7CisJLyogTW9zdCBvZiBTUEkgY29u
dHJvbGxlcnMgYXZvaWQgRE1BIGlmIGJ1ZmZlciBzaXplIGlzIG5vdCAzMmJpdCBhbGlnbmVkCisJ
ICovCisJcmV0dXJuIEFMSUdOKHNpemUsIDQpOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGh3
YnVzX29wcyB3Znhfc3BpX2h3YnVzX29wcyA9IHsKKwkuY29weV9mcm9tX2lvID0gd2Z4X3NwaV9j
b3B5X2Zyb21faW8sCisJLmNvcHlfdG9faW8gPSB3Znhfc3BpX2NvcHlfdG9faW8sCisJLmlycV9z
dWJzY3JpYmUgPSB3Znhfc3BpX2lycV9zdWJzY3JpYmUsCisJLmlycV91bnN1YnNjcmliZSA9IHdm
eF9zcGlfaXJxX3Vuc3Vic2NyaWJlLAorCS5sb2NrCQkJPSB3Znhfc3BpX2xvY2ssCisJLnVubG9j
awkJCT0gd2Z4X3NwaV91bmxvY2ssCisJLmFsaWduX3NpemUJCT0gd2Z4X3NwaV9hbGlnbl9zaXpl
LAorfTsKKworc3RhdGljIGludCB3Znhfc3BpX3Byb2JlKHN0cnVjdCBzcGlfZGV2aWNlICpmdW5j
KQoreworCXN0cnVjdCB3Znhfc3BpX3ByaXYgKmJ1czsKKwlpbnQgcmV0OworCisJaWYgKCFmdW5j
LT5iaXRzX3Blcl93b3JkKQorCQlmdW5jLT5iaXRzX3Blcl93b3JkID0gMTY7CisJcmV0ID0gc3Bp
X3NldHVwKGZ1bmMpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisJLyogVHJhY2UgYmVsb3cg
aXMgYWxzbyBkaXNwbGF5ZWQgYnkgc3BpX3NldHVwKCkgaWYgY29tcGlsZWQgd2l0aCBERUJVRyAq
LworCWRldl9kYmcoJmZ1bmMtPmRldiwgIlNQSSBwYXJhbXM6IENTPSVkLCBtb2RlPSVkIGJpdHMv
d29yZD0lZCBzcGVlZD0lZFxuIiwKKwkJZnVuYy0+Y2hpcF9zZWxlY3QsIGZ1bmMtPm1vZGUsIGZ1
bmMtPmJpdHNfcGVyX3dvcmQsCisJCWZ1bmMtPm1heF9zcGVlZF9oeik7CisJaWYgKGZ1bmMtPmJp
dHNfcGVyX3dvcmQgIT0gMTYgJiYgZnVuYy0+Yml0c19wZXJfd29yZCAhPSA4KQorCQlkZXZfd2Fy
bigmZnVuYy0+ZGV2LCAidW51c3VhbCBiaXRzL3dvcmQgdmFsdWU6ICVkXG4iLAorCQkJIGZ1bmMt
PmJpdHNfcGVyX3dvcmQpOworCWlmIChmdW5jLT5tYXhfc3BlZWRfaHogPiA1MDAwMDAwMCkKKwkJ
ZGV2X3dhcm4oJmZ1bmMtPmRldiwgIiVkSHogaXMgYSB2ZXJ5IGhpZ2ggc3BlZWRcbiIsCisJCQkg
ZnVuYy0+bWF4X3NwZWVkX2h6KTsKKworCWJ1cyA9IGRldm1fa3phbGxvYygmZnVuYy0+ZGV2LCBz
aXplb2YoKmJ1cyksIEdGUF9LRVJORUwpOworCWlmICghYnVzKQorCQlyZXR1cm4gLUVOT01FTTsK
KwlidXMtPmZ1bmMgPSBmdW5jOworCWlmIChmdW5jLT5iaXRzX3Blcl93b3JkID09IDggfHwgSVNf
RU5BQkxFRChDT05GSUdfQ1BVX0JJR19FTkRJQU4pKQorCQlidXMtPm5lZWRfc3dhYiA9IHRydWU7
CisJc3BpX3NldF9kcnZkYXRhKGZ1bmMsIGJ1cyk7CisKKwlidXMtPmdwaW9fcmVzZXQgPSBkZXZt
X2dwaW9kX2dldF9vcHRpb25hbCgmZnVuYy0+ZGV2LCAicmVzZXQiLAorCQkJCQkJICBHUElPRF9P
VVRfTE9XKTsKKwlpZiAoSVNfRVJSKGJ1cy0+Z3Bpb19yZXNldCkpCisJCXJldHVybiBQVFJfRVJS
KGJ1cy0+Z3Bpb19yZXNldCk7CisJaWYgKCFidXMtPmdwaW9fcmVzZXQpIHsKKwkJZGV2X3dhcm4o
JmZ1bmMtPmRldiwKKwkJCSAiZ3BpbyByZXNldCBpcyBub3QgZGVmaW5lZCwgdHJ5aW5nIHRvIGxv
YWQgZmlybXdhcmUgYW55d2F5XG4iKTsKKwl9IGVsc2UgeworCQlncGlvZF9zZXRfY29uc3VtZXJf
bmFtZShidXMtPmdwaW9fcmVzZXQsICJ3ZnggcmVzZXQiKTsKKwkJaWYgKHNwaV9nZXRfZGV2aWNl
X2lkKGZ1bmMpLT5kcml2ZXJfZGF0YSAmIFdGWF9SRVNFVF9JTlZFUlRFRCkKKwkJCWdwaW9kX3Rv
Z2dsZV9hY3RpdmVfbG93KGJ1cy0+Z3Bpb19yZXNldCk7CisJCWdwaW9kX3NldF92YWx1ZV9jYW5z
bGVlcChidXMtPmdwaW9fcmVzZXQsIDEpOworCQl1c2xlZXBfcmFuZ2UoMTAwLCAxNTApOworCQln
cGlvZF9zZXRfdmFsdWVfY2Fuc2xlZXAoYnVzLT5ncGlvX3Jlc2V0LCAwKTsKKwkJdXNsZWVwX3Jh
bmdlKDIwMDAsIDI1MDApOworCX0KKworCWJ1cy0+Y29yZSA9IHdmeF9pbml0X2NvbW1vbigmZnVu
Yy0+ZGV2LCAmd2Z4X3NwaV9wZGF0YSwKKwkJCQkgICAgJndmeF9zcGlfaHdidXNfb3BzLCBidXMp
OworCWlmICghYnVzLT5jb3JlKQorCQlyZXR1cm4gLUVJTzsKKworCXJldHVybiB3ZnhfcHJvYmUo
YnVzLT5jb3JlKTsKK30KKworc3RhdGljIGludCB3Znhfc3BpX3JlbW92ZShzdHJ1Y3Qgc3BpX2Rl
dmljZSAqZnVuYykKK3sKKwlzdHJ1Y3Qgd2Z4X3NwaV9wcml2ICpidXMgPSBzcGlfZ2V0X2RydmRh
dGEoZnVuYyk7CisKKwl3ZnhfcmVsZWFzZShidXMtPmNvcmUpOworCXJldHVybiAwOworfQorCisv
KiBGb3IgZHluYW1pYyBkcml2ZXIgYmluZGluZywga2VybmVsIGRvZXMgbm90IHVzZSBPRiB0byBt
YXRjaCBkcml2ZXIuIEl0IG9ubHkKKyAqIHVzZSBtb2RhbGlhcyBhbmQgbW9kYWxpYXMgaXMgYSBj
b3B5IG9mICdjb21wYXRpYmxlJyBEVCBub2RlIHdpdGggdmVuZG9yCisgKiBzdHJpcHBlZC4KKyAq
Lworc3RhdGljIGNvbnN0IHN0cnVjdCBzcGlfZGV2aWNlX2lkIHdmeF9zcGlfaWRbXSA9IHsKKwl7
ICJ3Zngtc3BpIiwgV0ZYX1JFU0VUX0lOVkVSVEVEIH0sCisJeyAid2YyMDAiLCAwIH0sCisJeyB9
LAorfTsKK01PRFVMRV9ERVZJQ0VfVEFCTEUoc3BpLCB3Znhfc3BpX2lkKTsKKworI2lmZGVmIENP
TkZJR19PRgorc3RhdGljIGNvbnN0IHN0cnVjdCBvZl9kZXZpY2VfaWQgd2Z4X3NwaV9vZl9tYXRj
aFtdID0geworCXsgLmNvbXBhdGlibGUgPSAic2lsYWJzLHdmeC1zcGkiLCAuZGF0YSA9ICh2b2lk
ICopV0ZYX1JFU0VUX0lOVkVSVEVEIH0sCisJeyAuY29tcGF0aWJsZSA9ICJzaWxhYnMsd2YyMDAi
IH0sCisJeyB9LAorfTsKK01PRFVMRV9ERVZJQ0VfVEFCTEUob2YsIHdmeF9zcGlfb2ZfbWF0Y2gp
OworI2VuZGlmCisKK3N0cnVjdCBzcGlfZHJpdmVyIHdmeF9zcGlfZHJpdmVyID0geworCS5kcml2
ZXIgPSB7CisJCS5uYW1lID0gIndmeC1zcGkiLAorCQkub2ZfbWF0Y2hfdGFibGUgPSBvZl9tYXRj
aF9wdHIod2Z4X3NwaV9vZl9tYXRjaCksCisJfSwKKwkuaWRfdGFibGUgPSB3Znhfc3BpX2lkLAor
CS5wcm9iZSA9IHdmeF9zcGlfcHJvYmUsCisJLnJlbW92ZSA9IHdmeF9zcGlfcmVtb3ZlLAorfTsK
LS0gCjIuMzMuMAoK
