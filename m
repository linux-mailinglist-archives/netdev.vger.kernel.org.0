Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 3D82713C63
	for <lists+netdev@lfdr.de>; Sun,  5 May 2019 02:33:29 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727378AbfEEAd1 (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Sat, 4 May 2019 20:33:27 -0400
Received: from mail-eopbgr70082.outbound.protection.outlook.com ([40.107.7.82]:14048
        "EHLO EUR04-HE1-obe.outbound.protection.outlook.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1727331AbfEEAd0 (ORCPT <rfc822;netdev@vger.kernel.org>);
        Sat, 4 May 2019 20:33:26 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=Mellanox.com;
 s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=DoBcTBDuDHLJ9Fr4spIbK7TineiaeoBmt7+aFEmWr/Y=;
 b=lrcJehqAqcpBJMlXy468CgJ8QsZ2V00iOZeBAmAsKNqeEsR2fyF/79QEr/I5B97MzxObr40Mp6JBl9LvP7tbgAPRbuV5ftZUt8Lt76ehtjCNcPDdIguu/dfiQY8LzDmTSKwdkv37IHEDq/A/a3mSwQ7CbkAzPM4t1HrHGEZ/jAs=
Received: from DB8PR05MB5898.eurprd05.prod.outlook.com (20.179.9.32) by
 DB8PR05MB5881.eurprd05.prod.outlook.com (20.179.10.21) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.1856.11; Sun, 5 May 2019 00:33:04 +0000
Received: from DB8PR05MB5898.eurprd05.prod.outlook.com
 ([fe80::ed24:8317:76e4:1a07]) by DB8PR05MB5898.eurprd05.prod.outlook.com
 ([fe80::ed24:8317:76e4:1a07%5]) with mapi id 15.20.1856.012; Sun, 5 May 2019
 00:33:04 +0000
From:   Saeed Mahameed <saeedm@mellanox.com>
To:     "David S. Miller" <davem@davemloft.net>
CC:     "netdev@vger.kernel.org" <netdev@vger.kernel.org>,
        Jiri Pirko <jiri@mellanox.com>,
        Feras Daoud <ferasda@mellanox.com>,
        Moshe Shemesh <moshe@mellanox.com>,
        Daniel Jurgens <danielj@mellanox.com>,
        Alex Vesker <valex@mellanox.com>,
        Saeed Mahameed <saeedm@mellanox.com>
Subject: [net-next 05/15] net/mlx5: Handle SW reset of FW in error flow
Thread-Topic: [net-next 05/15] net/mlx5: Handle SW reset of FW in error flow
Thread-Index: AQHVAtoaopT79Pn7jUeLSf7j5Ci6Jg==
Date:   Sun, 5 May 2019 00:33:04 +0000
Message-ID: <20190505003207.1353-6-saeedm@mellanox.com>
References: <20190505003207.1353-1-saeedm@mellanox.com>
In-Reply-To: <20190505003207.1353-1-saeedm@mellanox.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-mailer: git-send-email 2.20.1
x-originating-ip: [73.15.39.150]
x-clientproxiedby: BY5PR13CA0008.namprd13.prod.outlook.com
 (2603:10b6:a03:180::21) To DB8PR05MB5898.eurprd05.prod.outlook.com
 (2603:10a6:10:a4::32)
authentication-results: spf=none (sender IP is )
 smtp.mailfrom=saeedm@mellanox.com; 
x-ms-exchange-messagesentrepresentingtype: 1
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 8e5de6f7-0321-4e9c-36e9-08d6d0f13ca5
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0;PCL:0;RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600141)(711020)(4605104)(4618075)(2017052603328)(7193020);SRVR:DB8PR05MB5881;
x-ms-traffictypediagnostic: DB8PR05MB5881:
x-microsoft-antispam-prvs: <DB8PR05MB588130A58A1196D24798363ABE370@DB8PR05MB5881.eurprd05.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:7691;
x-forefront-prvs: 00286C0CA6
x-forefront-antispam-report: SFV:NSPM;SFS:(10009020)(346002)(376002)(366004)(39850400004)(136003)(396003)(199004)(189003)(305945005)(52116002)(76176011)(36756003)(316002)(25786009)(6486002)(478600001)(14454004)(446003)(50226002)(476003)(11346002)(2616005)(26005)(7736002)(4326008)(99286004)(86362001)(6916009)(53936002)(66476007)(186003)(68736007)(66446008)(64756008)(66556008)(6436002)(66946007)(73956011)(6512007)(14444005)(30864003)(1076003)(66066001)(71190400001)(71200400001)(54906003)(256004)(102836004)(81156014)(81166006)(8936002)(3846002)(6506007)(386003)(107886003)(2906002)(8676002)(5660300002)(6116002)(486006);DIR:OUT;SFP:1101;SCL:1;SRVR:DB8PR05MB5881;H:DB8PR05MB5898.eurprd05.prod.outlook.com;FPR:;SPF:None;LANG:en;PTR:InfoNoRecords;A:1;MX:1;
received-spf: None (protection.outlook.com: mellanox.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: ZEvjCi8QLnTg6zellZ1TgX/wo2VL5j+4b06InMntIfE0KQBYKsVhi46lb7BccL9RpxsBo8F7by9GF0QECQWkYTYR1Eb/jXWQ4MIdZd2eEYEuo8UhRA2DKxGM5rIKw60OloK8jkh4NzIRWZlGlJjlAehVjUDytTim/ft6IR5MCCALs2pLUeDr9zu3G2dpVmhpOX5dQCSGKHNPRbVm3q3xiw1yfRzPYN5HKB82rnrd7mJKjxNjFw8UhPNEGdEq6xMCwjqRvot8q2Wlhkdj1UPEbrdG5fWqCpuo8lWr9hkqNGjQq7UfcHnSe11Si7uApfNsd4kyaEo8d2ruG4YjUrH5Nolyv9hbMcnpaJdUZnf6pXo8hGgqrQ4NdiVJcEVRF0qbskrDf4lISUhbagSJ1ddtVTrsUix2laVRwUmtdBknn1g=
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-OriginatorOrg: Mellanox.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 8e5de6f7-0321-4e9c-36e9-08d6d0f13ca5
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 May 2019 00:33:04.5852
 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: a652971c-7d2e-4d9b-a6a4-d149256f461b
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DB8PR05MB5881
Sender: netdev-owner@vger.kernel.org
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

RnJvbTogRmVyYXMgRGFvdWQgPGZlcmFzZGFAbWVsbGFub3guY29tPg0KDQpOZXcgbWx4NSBhZGFw
dGVycyBhbGxvdyB0aGUgZHJpdmVyIHRvIHJlc2V0IHRoZSBGVyBpbiB0aGUgZXZlbnQgb2YgYW4N
CmVycm9yLCB0aGlzIGFjdGlvbiBjYWxsZWQgIlNXIFJlc2V0Ii4gV2hlbiBhbiBTVyByZXNldCBp
cyBpc3N1ZWQgb24gYW55DQpQRiBhbGwgUEZzIGVudGVyIHJlc2V0IHN0YXRlIHdoaWNoIGlzIGEg
cmVjb3ZlcmFibGUgY29uZGl0aW9uLiBUaGUNCmV4aXN0aW5nIHJlY292ZXJ5IGZsb3cgd2FzIGRl
c2lnbmVkIHRvIGFsbG93IHRoZSByZWNvdmVyeSBvZiBhIFZGIGFmdGVyDQphIFBGIGRyaXZlciBy
ZWxvYWQuIFRoaXMgcGF0Y2ggYWRkcyB0aGUgc3cgcmVzZXQgdG8gdGhlIE5JQyBzdGF0ZXMNCmFz
IGEgcHJlcGFyYXRpb24gZm9yIHN3IHJlc2V0IGhhbmRsaW5nLg0KDQpXaGVuIGEgc29mdHdhcmUg
cmVzZXQgaXMgaXNzdWVkIHRoZSBmb2xsb3dpbmcgb2NjdXJzOg0KMS4gVGhlIE5JQyBpbnRlcmZh
Y2UgbW9kZSBpcyBzZXQgdG8gNyB3aGlsZSB0aGUgcmVzZXQgaXMgaW4gcHJvZ3Jlc3MuDQoyLiBP
bmNlIHRoZSByZXNldCBjb21wbGV0ZXMgdGhlIE5JQyBpbnRlcmZhY2UgbW9kZSBpcyBzZXQgdG8g
MS4NCg0KU2lnbmVkLW9mZi1ieTogRmVyYXMgRGFvdWQgPGZlcmFzZGFAbWVsbGFub3guY29tPg0K
U2lnbmVkLW9mZi1ieTogTW9zaGUgU2hlbWVzaCA8bW9zaGVAbWVsbGFub3guY29tPg0KU2lnbmVk
LW9mZi1ieTogRGFuaWVsIEp1cmdlbnMgPGRhbmllbGpAbWVsbGFub3guY29tPg0KUmV2aWV3ZWQt
Ynk6IEFsZXggVmVza2VyIDx2YWxleEBtZWxsYW5veC5jb20+DQpTaWduZWQtb2ZmLWJ5OiBTYWVl
ZCBNYWhhbWVlZCA8c2FlZWRtQG1lbGxhbm94LmNvbT4NCi0tLQ0KIC4uLi9ldGhlcm5ldC9tZWxs
YW5veC9tbHg1L2NvcmUvZW5fc2VsZnRlc3QuYyB8ICAgMiArLQ0KIC4uLi9uZXQvZXRoZXJuZXQv
bWVsbGFub3gvbWx4NS9jb3JlL2hlYWx0aC5jICB8IDEwNSArKysrKysrKy0tLS0tLS0tLS0NCiAu
Li4vbmV0L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9tYWluLmMgICAgfCAgIDIgKy0NCiAu
Li4vZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL21seDVfY29yZS5oICAgfCAgIDIgKy0NCiBp
bmNsdWRlL2xpbnV4L21seDUvZHJpdmVyLmggICAgICAgICAgICAgICAgICAgfCAgIDMgKy0NCiA1
IGZpbGVzIGNoYW5nZWQsIDQ4IGluc2VydGlvbnMoKyksIDY2IGRlbGV0aW9ucygtKQ0KDQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2VuX3NlbGZ0
ZXN0LmMgYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1L2NvcmUvZW5fc2VsZnRl
c3QuYw0KaW5kZXggNDM4MmVmODU0ODhjLi44NDBlYzk0NWNjYmEgMTAwNjQ0DQotLS0gYS9kcml2
ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1L2NvcmUvZW5fc2VsZnRlc3QuYw0KKysrIGIv
ZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2VuX3NlbGZ0ZXN0LmMNCkBA
IC02NCw3ICs2NCw3IEBAIHN0YXRpYyBpbnQgbWx4NWVfdGVzdF9oZWFsdGhfaW5mbyhzdHJ1Y3Qg
bWx4NWVfcHJpdiAqcHJpdikNCiB7DQogCXN0cnVjdCBtbHg1X2NvcmVfaGVhbHRoICpoZWFsdGgg
PSAmcHJpdi0+bWRldi0+cHJpdi5oZWFsdGg7DQogDQotCXJldHVybiBoZWFsdGgtPnNpY2sgPyAx
IDogMDsNCisJcmV0dXJuIGhlYWx0aC0+ZmF0YWxfZXJyb3IgPyAxIDogMDsNCiB9DQogDQogc3Rh
dGljIGludCBtbHg1ZV90ZXN0X2xpbmtfc3RhdGUoc3RydWN0IG1seDVlX3ByaXYgKnByaXYpDQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2hlYWx0
aC5jIGIvZHJpdmVycy9uZXQvZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2hlYWx0aC5jDQpp
bmRleCA5MGYzZGE2ZGE3ZjkuLmFkYjQwZmUwZjZlYyAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvbmV0
L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9oZWFsdGguYw0KKysrIGIvZHJpdmVycy9uZXQv
ZXRoZXJuZXQvbWVsbGFub3gvbWx4NS9jb3JlL2hlYWx0aC5jDQpAQCAtNjIsMTIgKzYyLDE4IEBA
IGVudW0gew0KIA0KIGVudW0gew0KIAlNTFg1X0RST1BfTkVXX0hFQUxUSF9XT1JLLA0KLQlNTFg1
X0RST1BfTkVXX1JFQ09WRVJZX1dPUkssDQorfTsNCisNCitlbnVtICB7DQorCU1MWDVfU0VOU09S
X05PX0VSUgkJPSAwLA0KKwlNTFg1X1NFTlNPUl9QQ0lfQ09NTV9FUlIJPSAxLA0KKwlNTFg1X1NF
TlNPUl9OSUNfRElTQUJMRUQJPSAyLA0KKwlNTFg1X1NFTlNPUl9OSUNfU1dfUkVTRVQJPSAzLA0K
IH07DQogDQogdTggbWx4NV9nZXRfbmljX3N0YXRlKHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYp
DQogew0KLQlyZXR1cm4gKGlvcmVhZDMyYmUoJmRldi0+aXNlZy0+Y21kcV9hZGRyX2xfc3opID4+
IDgpICYgMzsNCisJcmV0dXJuIChpb3JlYWQzMmJlKCZkZXYtPmlzZWctPmNtZHFfYWRkcl9sX3N6
KSA+PiA4KSAmIDc7DQogfQ0KIA0KIHZvaWQgbWx4NV9zZXRfbmljX3N0YXRlKHN0cnVjdCBtbHg1
X2NvcmVfZGV2ICpkZXYsIHU4IHN0YXRlKQ0KQEAgLTgwLDE4ICs4NiwyNSBAQCB2b2lkIG1seDVf
c2V0X25pY19zdGF0ZShzdHJ1Y3QgbWx4NV9jb3JlX2RldiAqZGV2LCB1OCBzdGF0ZSkNCiAJCSAg
ICAmZGV2LT5pc2VnLT5jbWRxX2FkZHJfbF9zeik7DQogfQ0KIA0KLXN0YXRpYyBpbnQgaW5fZmF0
YWwoc3RydWN0IG1seDVfY29yZV9kZXYgKmRldikNCitzdGF0aWMgYm9vbCBzZW5zb3JfcGNpX25v
dF93b3JraW5nKHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYpDQogew0KIAlzdHJ1Y3QgbWx4NV9j
b3JlX2hlYWx0aCAqaGVhbHRoID0gJmRldi0+cHJpdi5oZWFsdGg7DQogCXN0cnVjdCBoZWFsdGhf
YnVmZmVyIF9faW9tZW0gKmggPSBoZWFsdGgtPmhlYWx0aDsNCiANCi0JaWYgKG1seDVfZ2V0X25p
Y19zdGF0ZShkZXYpID09IE1MWDVfTklDX0lGQ19ESVNBQkxFRCkNCi0JCXJldHVybiAxOw0KKwkv
KiBPZmZsaW5lIFBDSSByZWFkcyByZXR1cm4gMHhmZmZmZmZmZiAqLw0KKwlyZXR1cm4gKGlvcmVh
ZDMyYmUoJmgtPmZ3X3ZlcikgPT0gMHhmZmZmZmZmZik7DQorfQ0KIA0KLQlpZiAoaW9yZWFkMzJi
ZSgmaC0+ZndfdmVyKSA9PSAweGZmZmZmZmZmKQ0KLQkJcmV0dXJuIDE7DQorc3RhdGljIHUzMiBj
aGVja19mYXRhbF9zZW5zb3JzKHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYpDQorew0KKwlpZiAo
c2Vuc29yX3BjaV9ub3Rfd29ya2luZyhkZXYpKQ0KKwkJcmV0dXJuIE1MWDVfU0VOU09SX1BDSV9D
T01NX0VSUjsNCisJaWYgKG1seDVfZ2V0X25pY19zdGF0ZShkZXYpID09IE1MWDVfTklDX0lGQ19E
SVNBQkxFRCkNCisJCXJldHVybiBNTFg1X1NFTlNPUl9OSUNfRElTQUJMRUQ7DQorCWlmIChtbHg1
X2dldF9uaWNfc3RhdGUoZGV2KSA9PSBNTFg1X05JQ19JRkNfU1dfUkVTRVQpDQorCQlyZXR1cm4g
TUxYNV9TRU5TT1JfTklDX1NXX1JFU0VUOw0KIA0KLQlyZXR1cm4gMDsNCisJcmV0dXJuIE1MWDVf
U0VOU09SX05PX0VSUjsNCiB9DQogDQogdm9pZCBtbHg1X2VudGVyX2Vycm9yX3N0YXRlKHN0cnVj
dCBtbHg1X2NvcmVfZGV2ICpkZXYsIGJvb2wgZm9yY2UpDQpAQCAtMTAxLDcgKzExNCw4IEBAIHZv
aWQgbWx4NV9lbnRlcl9lcnJvcl9zdGF0ZShzdHJ1Y3QgbWx4NV9jb3JlX2RldiAqZGV2LCBib29s
IGZvcmNlKQ0KIAkJZ290byB1bmxvY2s7DQogDQogCW1seDVfY29yZV9lcnIoZGV2LCAic3RhcnRc
biIpOw0KLQlpZiAocGNpX2NoYW5uZWxfb2ZmbGluZShkZXYtPnBkZXYpIHx8IGluX2ZhdGFsKGRl
dikgfHwgZm9yY2UpIHsNCisJaWYgKHBjaV9jaGFubmVsX29mZmxpbmUoZGV2LT5wZGV2KSB8fA0K
KwkgICAgZGV2LT5wcml2LmhlYWx0aC5mYXRhbF9lcnJvciAhPSBNTFg1X1NFTlNPUl9OT19FUlIg
fHwgZm9yY2UpIHsNCiAJCWRldi0+c3RhdGUgPSBNTFg1X0RFVklDRV9TVEFURV9JTlRFUk5BTF9F
UlJPUjsNCiAJCW1seDVfY21kX2ZsdXNoKGRldik7DQogCX0NCkBAIC0xMzcsMzggKzE1MSwxNCBA
QCBzdGF0aWMgdm9pZCBtbHg1X2hhbmRsZV9iYWRfc3RhdGUoc3RydWN0IG1seDVfY29yZV9kZXYg
KmRldikNCiAJbWx4NV9kaXNhYmxlX2RldmljZShkZXYpOw0KIH0NCiANCi1zdGF0aWMgdm9pZCBo
ZWFsdGhfcmVjb3ZlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspDQotew0KLQlzdHJ1Y3QgbWx4
NV9jb3JlX2hlYWx0aCAqaGVhbHRoOw0KLQlzdHJ1Y3QgZGVsYXllZF93b3JrICpkd29yazsNCi0J
c3RydWN0IG1seDVfY29yZV9kZXYgKmRldjsNCi0Jc3RydWN0IG1seDVfcHJpdiAqcHJpdjsNCi0J
dTggbmljX3N0YXRlOw0KLQ0KLQlkd29yayA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgZGVs
YXllZF93b3JrLCB3b3JrKTsNCi0JaGVhbHRoID0gY29udGFpbmVyX29mKGR3b3JrLCBzdHJ1Y3Qg
bWx4NV9jb3JlX2hlYWx0aCwgcmVjb3Zlcl93b3JrKTsNCi0JcHJpdiA9IGNvbnRhaW5lcl9vZiho
ZWFsdGgsIHN0cnVjdCBtbHg1X3ByaXYsIGhlYWx0aCk7DQotCWRldiA9IGNvbnRhaW5lcl9vZihw
cml2LCBzdHJ1Y3QgbWx4NV9jb3JlX2RldiwgcHJpdik7DQotDQotCW5pY19zdGF0ZSA9IG1seDVf
Z2V0X25pY19zdGF0ZShkZXYpOw0KLQlpZiAobmljX3N0YXRlID09IE1MWDVfTklDX0lGQ19JTlZB
TElEKSB7DQotCQltbHg1X2NvcmVfZXJyKGRldiwgImhlYWx0aCByZWNvdmVyeSBmbG93IGFib3J0
ZWQgc2luY2UgdGhlIG5pYyBzdGF0ZSBpcyBpbnZhbGlkXG4iKTsNCi0JCXJldHVybjsNCi0JfQ0K
LQ0KLQltbHg1X2NvcmVfZXJyKGRldiwgInN0YXJ0aW5nIGhlYWx0aCByZWNvdmVyeSBmbG93XG4i
KTsNCi0JbWx4NV9yZWNvdmVyX2RldmljZShkZXYpOw0KLX0NCi0NCiAvKiBIb3cgbXVjaCB0aW1l
IHRvIHdhaXQgdW50aWwgaGVhbHRoIHJlc2V0dGluZyB0aGUgZHJpdmVyIChpbiBtc2VjcykgKi8N
Ci0jZGVmaW5lIE1MWDVfUkVDT1ZFUllfREVMQVlfTVNFQ1MgNjAwMDANCisjZGVmaW5lIE1MWDVf
UkVDT1ZFUllfV0FJVF9NU0VDUyA2MDAwMA0KIHN0YXRpYyB2b2lkIGhlYWx0aF9jYXJlKHN0cnVj
dCB3b3JrX3N0cnVjdCAqd29yaykNCiB7DQotCXVuc2lnbmVkIGxvbmcgcmVjb3Zlcl9kZWxheSA9
IG1zZWNzX3RvX2ppZmZpZXMoTUxYNV9SRUNPVkVSWV9ERUxBWV9NU0VDUyk7DQogCXN0cnVjdCBt
bHg1X2NvcmVfaGVhbHRoICpoZWFsdGg7DQogCXN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXY7DQog
CXN0cnVjdCBtbHg1X3ByaXYgKnByaXY7DQotCXVuc2lnbmVkIGxvbmcgZmxhZ3M7DQorCXVuc2ln
bmVkIGxvbmcgZW5kOw0KIA0KIAloZWFsdGggPSBjb250YWluZXJfb2Yod29yaywgc3RydWN0IG1s
eDVfY29yZV9oZWFsdGgsIHdvcmspOw0KIAlwcml2ID0gY29udGFpbmVyX29mKGhlYWx0aCwgc3Ry
dWN0IG1seDVfcHJpdiwgaGVhbHRoKTsNCkBAIC0xNzYsMTMgKzE2NiwxOCBAQCBzdGF0aWMgdm9p
ZCBoZWFsdGhfY2FyZShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspDQogCW1seDVfY29yZV93YXJu
KGRldiwgImhhbmRsaW5nIGJhZCBkZXZpY2UgaGVyZVxuIik7DQogCW1seDVfaGFuZGxlX2JhZF9z
dGF0ZShkZXYpOw0KIA0KLQlzcGluX2xvY2tfaXJxc2F2ZSgmaGVhbHRoLT53cV9sb2NrLCBmbGFn
cyk7DQotCWlmICghdGVzdF9iaXQoTUxYNV9EUk9QX05FV19SRUNPVkVSWV9XT1JLLCAmaGVhbHRo
LT5mbGFncykpDQotCQlzY2hlZHVsZV9kZWxheWVkX3dvcmsoJmhlYWx0aC0+cmVjb3Zlcl93b3Jr
LCByZWNvdmVyX2RlbGF5KTsNCi0JZWxzZQ0KLQkJbWx4NV9jb3JlX2VycihkZXYsDQotCQkJICAg
ICAgIm5ldyBoZWFsdGggd29ya3MgYXJlIG5vdCBwZXJtaXR0ZWQgYXQgdGhpcyBzdGFnZVxuIik7
DQotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmhlYWx0aC0+d3FfbG9jaywgZmxhZ3MpOw0KKwll
bmQgPSBqaWZmaWVzICsgbXNlY3NfdG9famlmZmllcyhNTFg1X1JFQ09WRVJZX1dBSVRfTVNFQ1Mp
Ow0KKwl3aGlsZSAoc2Vuc29yX3BjaV9ub3Rfd29ya2luZyhkZXYpKSB7DQorCQlpZiAodGltZV9h
ZnRlcihqaWZmaWVzLCBlbmQpKSB7DQorCQkJbWx4NV9jb3JlX2VycihkZXYsDQorCQkJCSAgICAg
ICJoZWFsdGggcmVjb3ZlcnkgZmxvdyBhYm9ydGVkLCBQQ0kgcmVhZHMgc3RpbGwgbm90IHdvcmtp
bmdcbiIpOw0KKwkJCXJldHVybjsNCisJCX0NCisJCW1zbGVlcCgxMDApOw0KKwl9DQorDQorCW1s
eDVfY29yZV9lcnIoZGV2LCAic3RhcnRpbmcgaGVhbHRoIHJlY292ZXJ5IGZsb3dcbiIpOw0KKwlt
bHg1X3JlY292ZXJfZGV2aWNlKGRldik7DQogfQ0KIA0KIHN0YXRpYyBjb25zdCBjaGFyICpoc3lu
ZF9zdHIodTggc3luZCkNCkBAIC0yNzQsNiArMjY5LDcgQEAgc3RhdGljIHZvaWQgcG9sbF9oZWFs
dGgoc3RydWN0IHRpbWVyX2xpc3QgKnQpDQogew0KIAlzdHJ1Y3QgbWx4NV9jb3JlX2RldiAqZGV2
ID0gZnJvbV90aW1lcihkZXYsIHQsIHByaXYuaGVhbHRoLnRpbWVyKTsNCiAJc3RydWN0IG1seDVf
Y29yZV9oZWFsdGggKmhlYWx0aCA9ICZkZXYtPnByaXYuaGVhbHRoOw0KKwl1MzIgZmF0YWxfZXJy
b3I7DQogCXUzMiBjb3VudDsNCiANCiAJaWYgKGRldi0+c3RhdGUgPT0gTUxYNV9ERVZJQ0VfU1RB
VEVfSU5URVJOQUxfRVJST1IpDQpAQCAtMjkxLDggKzI4NywxMSBAQCBzdGF0aWMgdm9pZCBwb2xs
X2hlYWx0aChzdHJ1Y3QgdGltZXJfbGlzdCAqdCkNCiAJCXByaW50X2hlYWx0aF9pbmZvKGRldik7
DQogCX0NCiANCi0JaWYgKGluX2ZhdGFsKGRldikgJiYgIWhlYWx0aC0+c2ljaykgew0KLQkJaGVh
bHRoLT5zaWNrID0gdHJ1ZTsNCisJZmF0YWxfZXJyb3IgPSBjaGVja19mYXRhbF9zZW5zb3JzKGRl
dik7DQorDQorCWlmIChmYXRhbF9lcnJvciAmJiAhaGVhbHRoLT5mYXRhbF9lcnJvcikgew0KKwkJ
bWx4NV9jb3JlX2VycihkZXYsICJGYXRhbCBlcnJvciAldSBkZXRlY3RlZFxuIiwgZmF0YWxfZXJy
b3IpOw0KKwkJZGV2LT5wcml2LmhlYWx0aC5mYXRhbF9lcnJvciA9IGZhdGFsX2Vycm9yOw0KIAkJ
cHJpbnRfaGVhbHRoX2luZm8oZGV2KTsNCiAJCW1seDVfdHJpZ2dlcl9oZWFsdGhfd29yayhkZXYp
Ow0KIAl9DQpAQCAtMzA2LDkgKzMwNSw4IEBAIHZvaWQgbWx4NV9zdGFydF9oZWFsdGhfcG9sbChz
dHJ1Y3QgbWx4NV9jb3JlX2RldiAqZGV2KQ0KIAlzdHJ1Y3QgbWx4NV9jb3JlX2hlYWx0aCAqaGVh
bHRoID0gJmRldi0+cHJpdi5oZWFsdGg7DQogDQogCXRpbWVyX3NldHVwKCZoZWFsdGgtPnRpbWVy
LCBwb2xsX2hlYWx0aCwgMCk7DQotCWhlYWx0aC0+c2ljayA9IDA7DQorCWhlYWx0aC0+ZmF0YWxf
ZXJyb3IgPSBNTFg1X1NFTlNPUl9OT19FUlI7DQogCWNsZWFyX2JpdChNTFg1X0RST1BfTkVXX0hF
QUxUSF9XT1JLLCAmaGVhbHRoLT5mbGFncyk7DQotCWNsZWFyX2JpdChNTFg1X0RST1BfTkVXX1JF
Q09WRVJZX1dPUkssICZoZWFsdGgtPmZsYWdzKTsNCiAJaGVhbHRoLT5oZWFsdGggPSAmZGV2LT5p
c2VnLT5oZWFsdGg7DQogCWhlYWx0aC0+aGVhbHRoX2NvdW50ZXIgPSAmZGV2LT5pc2VnLT5oZWFs
dGhfY291bnRlcjsNCiANCkBAIC0zMjQsNyArMzIyLDYgQEAgdm9pZCBtbHg1X3N0b3BfaGVhbHRo
X3BvbGwoc3RydWN0IG1seDVfY29yZV9kZXYgKmRldiwgYm9vbCBkaXNhYmxlX2hlYWx0aCkNCiAJ
aWYgKGRpc2FibGVfaGVhbHRoKSB7DQogCQlzcGluX2xvY2tfaXJxc2F2ZSgmaGVhbHRoLT53cV9s
b2NrLCBmbGFncyk7DQogCQlzZXRfYml0KE1MWDVfRFJPUF9ORVdfSEVBTFRIX1dPUkssICZoZWFs
dGgtPmZsYWdzKTsNCi0JCXNldF9iaXQoTUxYNV9EUk9QX05FV19SRUNPVkVSWV9XT1JLLCAmaGVh
bHRoLT5mbGFncyk7DQogCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZoZWFsdGgtPndxX2xvY2ss
IGZsYWdzKTsNCiAJfQ0KIA0KQEAgLTMzOCwyMyArMzM1LDEwIEBAIHZvaWQgbWx4NV9kcmFpbl9o
ZWFsdGhfd3Eoc3RydWN0IG1seDVfY29yZV9kZXYgKmRldikNCiANCiAJc3Bpbl9sb2NrX2lycXNh
dmUoJmhlYWx0aC0+d3FfbG9jaywgZmxhZ3MpOw0KIAlzZXRfYml0KE1MWDVfRFJPUF9ORVdfSEVB
TFRIX1dPUkssICZoZWFsdGgtPmZsYWdzKTsNCi0Jc2V0X2JpdChNTFg1X0RST1BfTkVXX1JFQ09W
RVJZX1dPUkssICZoZWFsdGgtPmZsYWdzKTsNCiAJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaGVh
bHRoLT53cV9sb2NrLCBmbGFncyk7DQotCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmaGVhbHRo
LT5yZWNvdmVyX3dvcmspOw0KIAljYW5jZWxfd29ya19zeW5jKCZoZWFsdGgtPndvcmspOw0KIH0N
CiANCi12b2lkIG1seDVfZHJhaW5faGVhbHRoX3JlY292ZXJ5KHN0cnVjdCBtbHg1X2NvcmVfZGV2
ICpkZXYpDQotew0KLQlzdHJ1Y3QgbWx4NV9jb3JlX2hlYWx0aCAqaGVhbHRoID0gJmRldi0+cHJp
di5oZWFsdGg7DQotCXVuc2lnbmVkIGxvbmcgZmxhZ3M7DQotDQotCXNwaW5fbG9ja19pcnFzYXZl
KCZoZWFsdGgtPndxX2xvY2ssIGZsYWdzKTsNCi0Jc2V0X2JpdChNTFg1X0RST1BfTkVXX1JFQ09W
RVJZX1dPUkssICZoZWFsdGgtPmZsYWdzKTsNCi0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaGVh
bHRoLT53cV9sb2NrLCBmbGFncyk7DQotCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmZGV2LT5w
cml2LmhlYWx0aC5yZWNvdmVyX3dvcmspOw0KLX0NCi0NCiB2b2lkIG1seDVfaGVhbHRoX2ZsdXNo
KHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYpDQogew0KIAlzdHJ1Y3QgbWx4NV9jb3JlX2hlYWx0
aCAqaGVhbHRoID0gJmRldi0+cHJpdi5oZWFsdGg7DQpAQCAtMzg3LDcgKzM3MSw2IEBAIGludCBt
bHg1X2hlYWx0aF9pbml0KHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYpDQogCQlyZXR1cm4gLUVO
T01FTTsNCiAJc3Bpbl9sb2NrX2luaXQoJmhlYWx0aC0+d3FfbG9jayk7DQogCUlOSVRfV09SSygm
aGVhbHRoLT53b3JrLCBoZWFsdGhfY2FyZSk7DQotCUlOSVRfREVMQVlFRF9XT1JLKCZoZWFsdGgt
PnJlY292ZXJfd29yaywgaGVhbHRoX3JlY292ZXIpOw0KIAloZWFsdGgtPmNyZHVtcCA9IE5VTEw7
DQogDQogCXJldHVybiAwOw0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvbmV0L2V0aGVybmV0L21lbGxh
bm94L21seDUvY29yZS9tYWluLmMgYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1
L2NvcmUvbWFpbi5jDQppbmRleCA0M2Y1NDg3ZGU0YzMuLmM5NGVhYTQ5ZDFmNiAxMDA2NDQNCi0t
LSBhL2RyaXZlcnMvbmV0L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9tYWluLmMNCisrKyBi
L2RyaXZlcnMvbmV0L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9tYWluLmMNCkBAIC0xMTg1
LDcgKzExODUsNyBAQCBzdGF0aWMgaW50IG1seDVfdW5sb2FkX29uZShzdHJ1Y3QgbWx4NV9jb3Jl
X2RldiAqZGV2LCBib29sIGNsZWFudXApDQogCWludCBlcnIgPSAwOw0KIA0KIAlpZiAoY2xlYW51
cCkNCi0JCW1seDVfZHJhaW5faGVhbHRoX3JlY292ZXJ5KGRldik7DQorCQltbHg1X2RyYWluX2hl
YWx0aF93cShkZXYpOw0KIA0KIAltdXRleF9sb2NrKCZkZXYtPmludGZfc3RhdGVfbXV0ZXgpOw0K
IAlpZiAoIXRlc3RfYml0KE1MWDVfSU5URVJGQUNFX1NUQVRFX1VQLCAmZGV2LT5pbnRmX3N0YXRl
KSkgew0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvbmV0L2V0aGVybmV0L21lbGxhbm94L21seDUvY29y
ZS9tbHg1X2NvcmUuaCBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9t
bHg1X2NvcmUuaA0KaW5kZXggMjJlNjlkNDgxM2U0Li5kMzFiNzdhZDUzM2QgMTAwNjQ0DQotLS0g
YS9kcml2ZXJzL25ldC9ldGhlcm5ldC9tZWxsYW5veC9tbHg1L2NvcmUvbWx4NV9jb3JlLmgNCisr
KyBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L21lbGxhbm94L21seDUvY29yZS9tbHg1X2NvcmUuaA0K
QEAgLTIxMyw3ICsyMTMsNyBAQCBlbnVtIHsNCiAJTUxYNV9OSUNfSUZDX0ZVTEwJCT0gMCwNCiAJ
TUxYNV9OSUNfSUZDX0RJU0FCTEVECQk9IDEsDQogCU1MWDVfTklDX0lGQ19OT19EUkFNX05JQwk9
IDIsDQotCU1MWDVfTklDX0lGQ19JTlZBTElECQk9IDMNCisJTUxYNV9OSUNfSUZDX1NXX1JFU0VU
CQk9IDcNCiB9Ow0KIA0KIHU4IG1seDVfZ2V0X25pY19zdGF0ZShzdHJ1Y3QgbWx4NV9jb3JlX2Rl
diAqZGV2KTsNCmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L21seDUvZHJpdmVyLmggYi9pbmNs
dWRlL2xpbnV4L21seDUvZHJpdmVyLmgNCmluZGV4IGRkZjZmNDFhNzVkMy4uMDg2ZmFhNGQyMmJm
IDEwMDY0NA0KLS0tIGEvaW5jbHVkZS9saW51eC9tbHg1L2RyaXZlci5oDQorKysgYi9pbmNsdWRl
L2xpbnV4L21seDUvZHJpdmVyLmgNCkBAIC00MzYsNyArNDM2LDcgQEAgc3RydWN0IG1seDVfY29y
ZV9oZWFsdGggew0KIAlzdHJ1Y3QgdGltZXJfbGlzdAkJdGltZXI7DQogCXUzMgkJCQlwcmV2Ow0K
IAlpbnQJCQkJbWlzc19jb3VudGVyOw0KLQlib29sCQkJCXNpY2s7DQorCXUzMgkJCQlmYXRhbF9l
cnJvcjsNCiAJLyogd3Egc3BpbmxvY2sgdG8gc3luY2hyb25pemUgZHJhaW5pbmcgKi8NCiAJc3Bp
bmxvY2tfdAkJCXdxX2xvY2s7DQogCXN0cnVjdCB3b3JrcXVldWVfc3RydWN0CSAgICAgICAqd3E7
DQpAQCAtOTA3LDcgKzkwNyw2IEBAIHZvaWQgbWx4NV9zdGFydF9oZWFsdGhfcG9sbChzdHJ1Y3Qg
bWx4NV9jb3JlX2RldiAqZGV2KTsNCiB2b2lkIG1seDVfc3RvcF9oZWFsdGhfcG9sbChzdHJ1Y3Qg
bWx4NV9jb3JlX2RldiAqZGV2LCBib29sIGRpc2FibGVfaGVhbHRoKTsNCiB2b2lkIG1seDVfZHJh
aW5faGVhbHRoX3dxKHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYpOw0KIHZvaWQgbWx4NV90cmln
Z2VyX2hlYWx0aF93b3JrKHN0cnVjdCBtbHg1X2NvcmVfZGV2ICpkZXYpOw0KLXZvaWQgbWx4NV9k
cmFpbl9oZWFsdGhfcmVjb3Zlcnkoc3RydWN0IG1seDVfY29yZV9kZXYgKmRldik7DQogaW50IG1s
eDVfYnVmX2FsbG9jX25vZGUoc3RydWN0IG1seDVfY29yZV9kZXYgKmRldiwgaW50IHNpemUsDQog
CQkJc3RydWN0IG1seDVfZnJhZ19idWYgKmJ1ZiwgaW50IG5vZGUpOw0KIGludCBtbHg1X2J1Zl9h
bGxvYyhzdHJ1Y3QgbWx4NV9jb3JlX2RldiAqZGV2LA0KLS0gDQoyLjIwLjENCg0K
