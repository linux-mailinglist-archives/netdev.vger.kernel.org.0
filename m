Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 85F8A1D4866
	for <lists+netdev@lfdr.de>; Fri, 15 May 2020 10:34:43 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1728079AbgEOIeE (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Fri, 15 May 2020 04:34:04 -0400
Received: from mail-dm6nam11on2086.outbound.protection.outlook.com ([40.107.223.86]:6138
        "EHLO NAM11-DM6-obe.outbound.protection.outlook.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1728015AbgEOIeD (ORCPT <rfc822;netdev@vger.kernel.org>);
        Fri, 15 May 2020 04:34:03 -0400
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=TpkibvZ71J4dIkCBQJhw3yWeGefBLq1nNS/VPhhOO4g/vIfBUDYpxfWmIK57STWUxBwNHhXkHPYnl0IM9tl0CiIIqQau8F5mFAYi5eJ5toXPUxudzzMFPjb7/2m0SuOpRRwfSWYC6COmnipOKoITh59P2CoKMtDW9gPURU2VqvoUfNkn6hFZ/fDL5hpizxeB+FUjq6MuJ/O4wfrG0rDWBtZp3ekEzfmsnWyTRxXhwu0AXklDpggW2eCXOb+E3Xad/GJBOhNM0QdRRZKN0aJRdIrIABz8uUKRP7pdz1u4t3rj7cFI2K8rVH0uX+PvaxPu6SB79sFp2ZGMU30CL5M28A==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=gUUFM756JXmxwyceH0imV4Uq4UE4xaRnUvhSWgljqwY=;
 b=es8L4ZNb0Zj0SvlyJPFPNtlSRnpmLvGvAv5zX4EV8IMrtSsKiKqWZwf7/220HaE2IAD1DtgiRhIGAUIubZFPcITjwQ+WXHFXa1D+fQhjArdZrfQTPmpgilozmVWzr/7X7fyCkYLf/b77KnJlgRGTlNz4J1fKcuj9taLaqtbFIyOPZ1ovazf0+kjR8L0O95xVgIcNY1N7+zACLWwoCFbaO1Pg1k3A6XB1bygxIF5OgyLCgqlzwXzb7hEFgJ43z8P88/o+aBTVF9dn6jcAzaJ6ODhu/AbJxHh9KW2bIRmfjjThO3xzheBbcu5vgdTo8dtboghX1ixYn6WG/tn16OmqLg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=silabs.com; dmarc=pass action=none header.from=silabs.com;
 dkim=pass header.d=silabs.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=silabs.onmicrosoft.com; s=selector2-silabs-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=gUUFM756JXmxwyceH0imV4Uq4UE4xaRnUvhSWgljqwY=;
 b=YjiIkmVJIM5Uv9WWiF4EGceAt1g21Yz8CRU1gJOrA5okJJa+mNloAqqGPLcRsv1ieit/P8/WOSk2IbCAfQpP//O37HjWKcsLHi4wWDrJ4q2wghgewlCT7MEorax+ckBHIIMa6DJqlWTTZMjq4V4WqNJKGHnLcwHRHljPCCkrLNs=
Authentication-Results: driverdev.osuosl.org; dkim=none (message not signed)
 header.d=none;driverdev.osuosl.org; dmarc=none action=none
 header.from=silabs.com;
Received: from MWHPR11MB1775.namprd11.prod.outlook.com (2603:10b6:300:10e::14)
 by MWHPR11MB1310.namprd11.prod.outlook.com (2603:10b6:300:28::12) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2979.26; Fri, 15 May
 2020 08:33:54 +0000
Received: from MWHPR11MB1775.namprd11.prod.outlook.com
 ([fe80::e055:3e6d:ff4:56da]) by MWHPR11MB1775.namprd11.prod.outlook.com
 ([fe80::e055:3e6d:ff4:56da%5]) with mapi id 15.20.3000.022; Fri, 15 May 2020
 08:33:54 +0000
From:   Jerome Pouiller <Jerome.Pouiller@silabs.com>
To:     devel@driverdev.osuosl.org, linux-wireless@vger.kernel.org
Cc:     netdev@vger.kernel.org, linux-kernel@vger.kernel.org,
        Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
        Kalle Valo <kvalo@codeaurora.org>,
        "David S . Miller" <davem@davemloft.net>,
        =?UTF-8?q?J=C3=A9r=C3=B4me=20Pouiller?= 
        <jerome.pouiller@silabs.com>,
        Dan Carpenter <dan.carpenter@oracle.com>
Subject: [PATCH 03/19] staging: wfx: check pointers returned by allocations
Date:   Fri, 15 May 2020 10:33:09 +0200
Message-Id: <20200515083325.378539-4-Jerome.Pouiller@silabs.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20200515083325.378539-1-Jerome.Pouiller@silabs.com>
References: <20200515083325.378539-1-Jerome.Pouiller@silabs.com>
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: base64
X-ClientProxiedBy: PR0P264CA0076.FRAP264.PROD.OUTLOOK.COM
 (2603:10a6:100:18::16) To MWHPR11MB1775.namprd11.prod.outlook.com
 (2603:10b6:300:10e::14)
MIME-Version: 1.0
X-MS-Exchange-MessageSentRepresentingType: 1
Received: from pc-42.home (82.67.86.106) by PR0P264CA0076.FRAP264.PROD.OUTLOOK.COM (2603:10a6:100:18::16) with Microsoft SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.3000.24 via Frontend Transport; Fri, 15 May 2020 08:33:52 +0000
X-Mailer: git-send-email 2.26.2
X-Originating-IP: [82.67.86.106]
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 25e9ad93-f6aa-477b-a8d6-08d7f8aab3bc
X-MS-TrafficTypeDiagnostic: MWHPR11MB1310:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <MWHPR11MB131073FE46636DDDAD0CB61B93BD0@MWHPR11MB1310.namprd11.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:109;
X-Forefront-PRVS: 04041A2886
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: FLRmaPrFR66IoO0pAxMYHXEZCjzcX/QrAXudOW1o8Hn7wuW/enUF0PYhhs1N88iEJTi7MasXm8ghdSfo4J13SZW27WuEGVkpFDAkK8/ftG4/P2khXM5ZPo26vqFhGKFhLX0eRrhwMoWRAEzt8wfFGJZtGf93INxDXFyyARBHbpsuMwHjZ00nix7Wmuihl3Upg+UZLfjoj7WvaSD77ZHAZIABEOBtRcnoG5Cp0bXc5mm9A61qG+2ypbxfNxtWDDiANss3NQkBARiKLDZTVV4eVbAPIFPHThObvjMxrGEmNvh9CmJZuWXD6XF9R3VnxG/OzSHOf0voKhxv/8qIEXIVrc3H4E4ExaEdtjce9jlpp9EDB9iR8exlb5zMAl/0om+7EYWZF0gCtyqXsBe0jnMsFQ+dSwD14963gY/BHBnkWHjc/wdsAXbeg4NWbuWwj5zrAElybfE1NhuWlkgD+rEw7QiDQvyBBVY1Hs8t9GK37TewIyAV2xD7LLwnYnCEqx42WwuQZKRJtQSzFiMO6Ja5UQ==
X-Forefront-Antispam-Report: CIP:255.255.255.255;CTRY:;LANG:en;SCL:1;SRV:;IPV:NLI;SFV:NSPM;H:MWHPR11MB1775.namprd11.prod.outlook.com;PTR:;CAT:NONE;SFTY:;SFS:(346002)(136003)(376002)(366004)(39850400004)(396003)(8886007)(66556008)(186003)(6512007)(66946007)(966005)(6506007)(36756003)(316002)(66476007)(26005)(52116002)(16526019)(6666004)(54906003)(2906002)(2616005)(478600001)(66574014)(956004)(8936002)(86362001)(8676002)(6486002)(5660300002)(4326008)(1076003);DIR:OUT;SFP:1101;
X-MS-Exchange-AntiSpam-MessageData: Qgr5o1s4VthL720BE1UX9vjTTrHrVy2iWQQ+bEb0wBnCf9AEDtKCtduoMzQKnj/GoLAhpLBO3TcWVpxVE6ImNTKJ6mOBNCLpNOJRkqIMtiSwvO+D8rcuuCwWnaw+Aj+UgyVM9leips5HJbdhSH6ToM22OWzTlj6Sm5/KVbI0T3N8+ExBBOP0hK7dsh9Mf2nybrWSOTan691ixYEiukUuQ6y04PmNPuD2IE2nCcRc8Mv3n4G4SCxmuguOUh5U4PVYf9bV7RWwoeyIqUZ2HuMsZfIlaeGda3EEm4p6TjEcIbFkw8mos0m52V44OPkKWhzOiyjfoXrVLGE8wC4oWcFjYqfvpLFRejoFKEUTxB0lapULZ3/ycIzdJznU68uT2hvzjnngF1XN7cn9IJtkea2HrC2ENrAlU7SK6iKVbScFU3v+kmBb3K3Navanmdv5HN15cRuIVkUMHloyvQWQHTOKCYQi6geplIduEQPejVycQ64=
X-OriginatorOrg: silabs.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 25e9ad93-f6aa-477b-a8d6-08d7f8aab3bc
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 15 May 2020 08:33:54.0988
 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 54dbd822-5231-4b20-944d-6f4abcd541fb
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: N3RxXwmsGbRVC4kGAv/lAtFC2bJNvuEr2EZ6s2UEx7klkVU/NlSzmFZcQ96JDhqUyFux5U3GjmOGYxXmj7yQNA==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: MWHPR11MB1310
Sender: netdev-owner@vger.kernel.org
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

RnJvbTogSsOpcsO0bWUgUG91aWxsZXIgPGplcm9tZS5wb3VpbGxlckBzaWxhYnMuY29tPgoKVW50
aWwgbm93LCB0aGUgZHJpdmVyIGRpZCBub3QgYWx3YXlzIGNoZWNrIGlmIHRoZSBhbGxvY2F0aW9u
cyBzdWNjZXNzLgoKVGhlIGlzc3VlIHdhcyBkaXNjdXNzZWQgaGVyZToKICAgaHR0cHM6Ly9sb3Jl
Lmtlcm5lbC5vcmcvbmV0ZGV2LzIwMjY0NzYuUUxpWFhFR0ZDZkBwYy00Mi8KClJlcG9ydGVkLWJ5
OiBEYW4gQ2FycGVudGVyIDxkYW4uY2FycGVudGVyQG9yYWNsZS5jb20+ClNpZ25lZC1vZmYtYnk6
IErDqXLDtG1lIFBvdWlsbGVyIDxqZXJvbWUucG91aWxsZXJAc2lsYWJzLmNvbT4KLS0tCiBkcml2
ZXJzL3N0YWdpbmcvd2Z4L2hpZl90eC5jICAgICB8IDQzICsrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrCiBkcml2ZXJzL3N0YWdpbmcvd2Z4L2hpZl90eF9taWIuYyB8ICAyICsrCiAyIGZp
bGVzIGNoYW5nZWQsIDQ1IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL3N0YWdp
bmcvd2Z4L2hpZl90eC5jIGIvZHJpdmVycy9zdGFnaW5nL3dmeC9oaWZfdHguYwppbmRleCA1OGFk
ZmFmODA2NmQuLjFjYjcxZjBhZDgwNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9zdGFnaW5nL3dmeC9o
aWZfdHguYworKysgYi9kcml2ZXJzL3N0YWdpbmcvd2Z4L2hpZl90eC5jCkBAIC0xMzQsNiArMTM0
LDggQEAgaW50IGhpZl9zaHV0ZG93bihzdHJ1Y3Qgd2Z4X2RldiAqd2RldikKIAlpZiAod2Rldi0+
Y2hpcF9mcm96ZW4pCiAJCXJldHVybiAwOwogCXdmeF9hbGxvY19oaWYoMCwgJmhpZik7CisJaWYg
KCFoaWYpCisJCXJldHVybiAtRU5PTUVNOwogCXdmeF9maWxsX2hlYWRlcihoaWYsIC0xLCBISUZf
UkVRX0lEX1NIVVRfRE9XTiwgMCk7CiAJcmV0ID0gd2Z4X2NtZF9zZW5kKHdkZXYsIGhpZiwgTlVM
TCwgMCwgdHJ1ZSk7CiAJLy8gQWZ0ZXIgdGhpcyBjb21tYW5kLCBjaGlwIHdvbid0IHJlcGx5LiBC
ZSBzdXJlIHRvIGdpdmUgZW5vdWdoIHRpbWUgdG8KQEAgLTE1Nyw2ICsxNTksOCBAQCBpbnQgaGlm
X2NvbmZpZ3VyYXRpb24oc3RydWN0IHdmeF9kZXYgKndkZXYsIGNvbnN0IHU4ICpjb25mLCBzaXpl
X3QgbGVuKQogCXN0cnVjdCBoaWZfbXNnICpoaWY7CiAJc3RydWN0IGhpZl9yZXFfY29uZmlndXJh
dGlvbiAqYm9keSA9IHdmeF9hbGxvY19oaWYoYnVmX2xlbiwgJmhpZik7CiAKKwlpZiAoIWhpZikK
KwkJcmV0dXJuIC1FTk9NRU07CiAJYm9keS0+bGVuZ3RoID0gY3B1X3RvX2xlMTYobGVuKTsKIAlt
ZW1jcHkoYm9keS0+cGRzX2RhdGEsIGNvbmYsIGxlbik7CiAJd2Z4X2ZpbGxfaGVhZGVyKGhpZiwg
LTEsIEhJRl9SRVFfSURfQ09ORklHVVJBVElPTiwgYnVmX2xlbik7CkBAIC0xNzEsNiArMTc1LDgg
QEAgaW50IGhpZl9yZXNldChzdHJ1Y3Qgd2Z4X3ZpZiAqd3ZpZiwgYm9vbCByZXNldF9zdGF0KQog
CXN0cnVjdCBoaWZfbXNnICpoaWY7CiAJc3RydWN0IGhpZl9yZXFfcmVzZXQgKmJvZHkgPSB3Znhf
YWxsb2NfaGlmKHNpemVvZigqYm9keSksICZoaWYpOwogCisJaWYgKCFoaWYpCisJCXJldHVybiAt
RU5PTUVNOwogCWJvZHktPnJlc2V0X2ZsYWdzLnJlc2V0X3N0YXQgPSByZXNldF9zdGF0OwogCXdm
eF9maWxsX2hlYWRlcihoaWYsIHd2aWYtPmlkLCBISUZfUkVRX0lEX1JFU0VULCBzaXplb2YoKmJv
ZHkpKTsKIAlyZXQgPSB3ZnhfY21kX3NlbmQod3ZpZi0+d2RldiwgaGlmLCBOVUxMLCAwLCBmYWxz
ZSk7CkBAIC0xODcsNiArMTkzLDEwIEBAIGludCBoaWZfcmVhZF9taWIoc3RydWN0IHdmeF9kZXYg
KndkZXYsIGludCB2aWZfaWQsIHUxNiBtaWJfaWQsCiAJc3RydWN0IGhpZl9yZXFfcmVhZF9taWIg
KmJvZHkgPSB3ZnhfYWxsb2NfaGlmKHNpemVvZigqYm9keSksICZoaWYpOwogCXN0cnVjdCBoaWZf
Y25mX3JlYWRfbWliICpyZXBseSA9IGttYWxsb2MoYnVmX2xlbiwgR0ZQX0tFUk5FTCk7CiAKKwlp
ZiAoIWJvZHkgfHwgIXJlcGx5KSB7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gb3V0OworCX0K
IAlib2R5LT5taWJfaWQgPSBjcHVfdG9fbGUxNihtaWJfaWQpOwogCXdmeF9maWxsX2hlYWRlciho
aWYsIHZpZl9pZCwgSElGX1JFUV9JRF9SRUFEX01JQiwgc2l6ZW9mKCpib2R5KSk7CiAJcmV0ID0g
d2Z4X2NtZF9zZW5kKHdkZXYsIGhpZiwgcmVwbHksIGJ1Zl9sZW4sIGZhbHNlKTsKQEAgLTIwNCw2
ICsyMTQsNyBAQCBpbnQgaGlmX3JlYWRfbWliKHN0cnVjdCB3ZnhfZGV2ICp3ZGV2LCBpbnQgdmlm
X2lkLCB1MTYgbWliX2lkLAogCQltZW1jcHkodmFsLCAmcmVwbHktPm1pYl9kYXRhLCBsZTE2X3Rv
X2NwdShyZXBseS0+bGVuZ3RoKSk7CiAJZWxzZQogCQltZW1zZXQodmFsLCAweEZGLCB2YWxfbGVu
KTsKK291dDoKIAlrZnJlZShoaWYpOwogCWtmcmVlKHJlcGx5KTsKIAlyZXR1cm4gcmV0OwpAQCAt
MjE3LDYgKzIyOCw4IEBAIGludCBoaWZfd3JpdGVfbWliKHN0cnVjdCB3ZnhfZGV2ICp3ZGV2LCBp
bnQgdmlmX2lkLCB1MTYgbWliX2lkLAogCWludCBidWZfbGVuID0gc2l6ZW9mKHN0cnVjdCBoaWZf
cmVxX3dyaXRlX21pYikgKyB2YWxfbGVuOwogCXN0cnVjdCBoaWZfcmVxX3dyaXRlX21pYiAqYm9k
eSA9IHdmeF9hbGxvY19oaWYoYnVmX2xlbiwgJmhpZik7CiAKKwlpZiAoIWhpZikKKwkJcmV0dXJu
IC1FTk9NRU07CiAJYm9keS0+bWliX2lkID0gY3B1X3RvX2xlMTYobWliX2lkKTsKIAlib2R5LT5s
ZW5ndGggPSBjcHVfdG9fbGUxNih2YWxfbGVuKTsKIAltZW1jcHkoJmJvZHktPm1pYl9kYXRhLCB2
YWwsIHZhbF9sZW4pOwpAQCAtMjQxLDYgKzI1NCw4IEBAIGludCBoaWZfc2NhbihzdHJ1Y3Qgd2Z4
X3ZpZiAqd3ZpZiwgc3RydWN0IGNmZzgwMjExX3NjYW5fcmVxdWVzdCAqcmVxLAogCiAJY29tcGls
ZXRpbWVfYXNzZXJ0KElFRUU4MDIxMV9NQVhfU1NJRF9MRU4gPT0gSElGX0FQSV9TU0lEX1NJWkUs
CiAJCQkgICAiQVBJIGluY29uc2lzdGVuY3kiKTsKKwlpZiAoIWhpZikKKwkJcmV0dXJuIC1FTk9N
RU07CiAJZm9yIChpID0gMDsgaSA8IHJlcS0+bl9zc2lkczsgaSsrKSB7CiAJCW1lbWNweShib2R5
LT5zc2lkX2RlZltpXS5zc2lkLCByZXEtPnNzaWRzW2ldLnNzaWQsCiAJCSAgICAgICBJRUVFODAy
MTFfTUFYX1NTSURfTEVOKTsKQEAgLTI4OCw2ICszMDMsOCBAQCBpbnQgaGlmX3N0b3Bfc2Nhbihz
dHJ1Y3Qgd2Z4X3ZpZiAqd3ZpZikKIAkvLyBib2R5IGFzc29jaWF0ZWQgdG8gSElGX1JFUV9JRF9T
VE9QX1NDQU4gaXMgZW1wdHkKIAl3ZnhfYWxsb2NfaGlmKDAsICZoaWYpOwogCisJaWYgKCFoaWYp
CisJCXJldHVybiAtRU5PTUVNOwogCXdmeF9maWxsX2hlYWRlcihoaWYsIHd2aWYtPmlkLCBISUZf
UkVRX0lEX1NUT1BfU0NBTiwgMCk7CiAJcmV0ID0gd2Z4X2NtZF9zZW5kKHd2aWYtPndkZXYsIGhp
ZiwgTlVMTCwgMCwgZmFsc2UpOwogCWtmcmVlKGhpZik7CkBAIC0zMDUsNiArMzIyLDggQEAgaW50
IGhpZl9qb2luKHN0cnVjdCB3ZnhfdmlmICp3dmlmLCBjb25zdCBzdHJ1Y3QgaWVlZTgwMjExX2Jz
c19jb25mICpjb25mLAogCVdBUk5fT04oIWNvbmYtPmJhc2ljX3JhdGVzKTsKIAlXQVJOX09OKHNp
emVvZihib2R5LT5zc2lkKSA8IHNzaWRsZW4pOwogCVdBUk4oIWNvbmYtPmlic3Nfam9pbmVkICYm
ICFzc2lkbGVuLCAiam9pbmluZyBhbiB1bmtub3duIEJTUyIpOworCWlmICghaGlmKQorCQlyZXR1
cm4gLUVOT01FTTsKIAlib2R5LT5pbmZyYXN0cnVjdHVyZV9ic3NfbW9kZSA9ICFjb25mLT5pYnNz
X2pvaW5lZDsKIAlib2R5LT5zaG9ydF9wcmVhbWJsZSA9IGNvbmYtPnVzZV9zaG9ydF9wcmVhbWJs
ZTsKIAlpZiAoY2hhbm5lbCAmJiBjaGFubmVsLT5mbGFncyAmIElFRUU4MDIxMV9DSEFOX05PX0lS
KQpAQCAtMzMzLDYgKzM1Miw4IEBAIGludCBoaWZfc2V0X2Jzc19wYXJhbXMoc3RydWN0IHdmeF92
aWYgKnd2aWYsIGludCBhaWQsIGludCBiZWFjb25fbG9zdF9jb3VudCkKIAlzdHJ1Y3QgaGlmX3Jl
cV9zZXRfYnNzX3BhcmFtcyAqYm9keSA9CiAJCXdmeF9hbGxvY19oaWYoc2l6ZW9mKCpib2R5KSwg
JmhpZik7CiAKKwlpZiAoIWhpZikKKwkJcmV0dXJuIC1FTk9NRU07CiAJYm9keS0+YWlkID0gY3B1
X3RvX2xlMTYoYWlkKTsKIAlib2R5LT5iZWFjb25fbG9zdF9jb3VudCA9IGJlYWNvbl9sb3N0X2Nv
dW50OwogCXdmeF9maWxsX2hlYWRlcihoaWYsIHd2aWYtPmlkLCBISUZfUkVRX0lEX1NFVF9CU1Nf
UEFSQU1TLApAQCAtMzQ5LDYgKzM3MCw4IEBAIGludCBoaWZfYWRkX2tleShzdHJ1Y3Qgd2Z4X2Rl
diAqd2RldiwgY29uc3Qgc3RydWN0IGhpZl9yZXFfYWRkX2tleSAqYXJnKQogCS8vIEZJWE1FOiBv
bmx5IHNlbmQgbmVjZXNzYXJ5IGJpdHMKIAlzdHJ1Y3QgaGlmX3JlcV9hZGRfa2V5ICpib2R5ID0g
d2Z4X2FsbG9jX2hpZihzaXplb2YoKmJvZHkpLCAmaGlmKTsKIAorCWlmICghaGlmKQorCQlyZXR1
cm4gLUVOT01FTTsKIAkvLyBGSVhNRTogc3dhcCBieXRlcyBhcyBuZWNlc3NhcnkgaW4gYm9keQog
CW1lbWNweShib2R5LCBhcmcsIHNpemVvZigqYm9keSkpOwogCWlmICh3ZnhfYXBpX29sZGVyX3Ro
YW4od2RldiwgMSwgNSkpCkBAIC0zNjksNiArMzkyLDggQEAgaW50IGhpZl9yZW1vdmVfa2V5KHN0
cnVjdCB3ZnhfZGV2ICp3ZGV2LCBpbnQgaWR4KQogCXN0cnVjdCBoaWZfbXNnICpoaWY7CiAJc3Ry
dWN0IGhpZl9yZXFfcmVtb3ZlX2tleSAqYm9keSA9IHdmeF9hbGxvY19oaWYoc2l6ZW9mKCpib2R5
KSwgJmhpZik7CiAKKwlpZiAoIWhpZikKKwkJcmV0dXJuIC1FTk9NRU07CiAJYm9keS0+ZW50cnlf
aW5kZXggPSBpZHg7CiAJd2Z4X2ZpbGxfaGVhZGVyKGhpZiwgLTEsIEhJRl9SRVFfSURfUkVNT1ZF
X0tFWSwgc2l6ZW9mKCpib2R5KSk7CiAJcmV0ID0gd2Z4X2NtZF9zZW5kKHdkZXYsIGhpZiwgTlVM
TCwgMCwgZmFsc2UpOwpAQCAtMzg4LDYgKzQxMyw4IEBAIGludCBoaWZfc2V0X2VkY2FfcXVldWVf
cGFyYW1zKHN0cnVjdCB3ZnhfdmlmICp3dmlmLCB1MTYgcXVldWUsCiAJCXJldHVybiAtRU5PTUVN
OwogCiAJV0FSTl9PTihhcmctPmFpZnMgPiAyNTUpOworCWlmICghaGlmKQorCQlyZXR1cm4gLUVO
T01FTTsKIAlib2R5LT5haWZzbiA9IGFyZy0+YWlmczsKIAlib2R5LT5jd19taW4gPSBjcHVfdG9f
bGUxNihhcmctPmN3X21pbik7CiAJYm9keS0+Y3dfbWF4ID0gY3B1X3RvX2xlMTYoYXJnLT5jd19t
YXgpOwpAQCAtNDE0LDYgKzQ0MSw4IEBAIGludCBoaWZfc2V0X3BtKHN0cnVjdCB3ZnhfdmlmICp3
dmlmLCBib29sIHBzLCBpbnQgZHluYW1pY19wc190aW1lb3V0KQogCWlmICghYm9keSkKIAkJcmV0
dXJuIC1FTk9NRU07CiAKKwlpZiAoIWhpZikKKwkJcmV0dXJuIC1FTk9NRU07CiAJaWYgKHBzKSB7
CiAJCWJvZHktPnBtX21vZGUuZW50ZXJfcHNtID0gMTsKIAkJLy8gRmlybXdhcmUgZG9lcyBub3Qg
c3VwcG9ydCBtb3JlIHRoYW4gMTI4bXMKQEAgLTQzNSw2ICs0NjQsOCBAQCBpbnQgaGlmX3N0YXJ0
KHN0cnVjdCB3ZnhfdmlmICp3dmlmLCBjb25zdCBzdHJ1Y3QgaWVlZTgwMjExX2Jzc19jb25mICpj
b25mLAogCXN0cnVjdCBoaWZfcmVxX3N0YXJ0ICpib2R5ID0gd2Z4X2FsbG9jX2hpZihzaXplb2Yo
KmJvZHkpLCAmaGlmKTsKIAogCVdBUk5fT04oIWNvbmYtPmJlYWNvbl9pbnQpOworCWlmICghaGlm
KQorCQlyZXR1cm4gLUVOT01FTTsKIAlib2R5LT5kdGltX3BlcmlvZCA9IGNvbmYtPmR0aW1fcGVy
aW9kOwogCWJvZHktPnNob3J0X3ByZWFtYmxlID0gY29uZi0+dXNlX3Nob3J0X3ByZWFtYmxlOwog
CWJvZHktPmNoYW5uZWxfbnVtYmVyID0gY2hhbm5lbC0+aHdfdmFsdWU7CkBAIC00NTYsNiArNDg3
LDggQEAgaW50IGhpZl9iZWFjb25fdHJhbnNtaXQoc3RydWN0IHdmeF92aWYgKnd2aWYsIGJvb2wg
ZW5hYmxlKQogCXN0cnVjdCBoaWZfcmVxX2JlYWNvbl90cmFuc21pdCAqYm9keSA9IHdmeF9hbGxv
Y19oaWYoc2l6ZW9mKCpib2R5KSwKIAkJCQkJCQkgICAgICZoaWYpOwogCisJaWYgKCFoaWYpCisJ
CXJldHVybiAtRU5PTUVNOwogCWJvZHktPmVuYWJsZV9iZWFjb25pbmcgPSBlbmFibGUgPyAxIDog
MDsKIAl3ZnhfZmlsbF9oZWFkZXIoaGlmLCB3dmlmLT5pZCwgSElGX1JFUV9JRF9CRUFDT05fVFJB
TlNNSVQsCiAJCQlzaXplb2YoKmJvZHkpKTsKQEAgLTQ3MCw2ICs1MDMsOCBAQCBpbnQgaGlmX21h
cF9saW5rKHN0cnVjdCB3ZnhfdmlmICp3dmlmLCB1OCAqbWFjX2FkZHIsIGludCBmbGFncywgaW50
IHN0YV9pZCkKIAlzdHJ1Y3QgaGlmX21zZyAqaGlmOwogCXN0cnVjdCBoaWZfcmVxX21hcF9saW5r
ICpib2R5ID0gd2Z4X2FsbG9jX2hpZihzaXplb2YoKmJvZHkpLCAmaGlmKTsKIAorCWlmICghaGlm
KQorCQlyZXR1cm4gLUVOT01FTTsKIAlpZiAobWFjX2FkZHIpCiAJCWV0aGVyX2FkZHJfY29weShi
b2R5LT5tYWNfYWRkciwgbWFjX2FkZHIpOwogCWJvZHktPm1hcF9saW5rX2ZsYWdzID0gKihzdHJ1
Y3QgaGlmX21hcF9saW5rX2ZsYWdzICopJmZsYWdzOwpAQCAtNDg3LDYgKzUyMiw4IEBAIGludCBo
aWZfdXBkYXRlX2llX2JlYWNvbihzdHJ1Y3Qgd2Z4X3ZpZiAqd3ZpZiwgY29uc3QgdTggKmllcywg
c2l6ZV90IGllc19sZW4pCiAJaW50IGJ1Zl9sZW4gPSBzaXplb2Yoc3RydWN0IGhpZl9yZXFfdXBk
YXRlX2llKSArIGllc19sZW47CiAJc3RydWN0IGhpZl9yZXFfdXBkYXRlX2llICpib2R5ID0gd2Z4
X2FsbG9jX2hpZihidWZfbGVuLCAmaGlmKTsKIAorCWlmICghaGlmKQorCQlyZXR1cm4gLUVOT01F
TTsKIAlib2R5LT5pZV9mbGFncy5iZWFjb24gPSAxOwogCWJvZHktPm51bV9pZXMgPSBjcHVfdG9f
bGUxNigxKTsKIAltZW1jcHkoYm9keS0+aWUsIGllcywgaWVzX2xlbik7CkBAIC01MDQsNiArNTQx
LDggQEAgaW50IGhpZl9zbF9zZW5kX3B1Yl9rZXlzKHN0cnVjdCB3ZnhfZGV2ICp3ZGV2LAogCXN0
cnVjdCBoaWZfcmVxX3NsX2V4Y2hhbmdlX3B1Yl9rZXlzICpib2R5ID0gd2Z4X2FsbG9jX2hpZihz
aXplb2YoKmJvZHkpLAogCQkJCQkJCQkgICZoaWYpOwogCisJaWYgKCFoaWYpCisJCXJldHVybiAt
RU5PTUVNOwogCWJvZHktPmFsZ29yaXRobSA9IEhJRl9TTF9DVVJWRTI1NTE5OwogCW1lbWNweShi
b2R5LT5ob3N0X3B1Yl9rZXksIHB1YmtleSwgc2l6ZW9mKGJvZHktPmhvc3RfcHViX2tleSkpOwog
CW1lbWNweShib2R5LT5ob3N0X3B1Yl9rZXlfbWFjLCBwdWJrZXlfaG1hYywKQEAgLTUyNCw2ICs1
NjMsOCBAQCBpbnQgaGlmX3NsX2NvbmZpZyhzdHJ1Y3Qgd2Z4X2RldiAqd2RldiwgY29uc3QgdW5z
aWduZWQgbG9uZyAqYml0bWFwKQogCXN0cnVjdCBoaWZfbXNnICpoaWY7CiAJc3RydWN0IGhpZl9y
ZXFfc2xfY29uZmlndXJlICpib2R5ID0gd2Z4X2FsbG9jX2hpZihzaXplb2YoKmJvZHkpLCAmaGlm
KTsKIAorCWlmICghaGlmKQorCQlyZXR1cm4gLUVOT01FTTsKIAltZW1jcHkoYm9keS0+ZW5jcl9i
bXAsIGJpdG1hcCwgc2l6ZW9mKGJvZHktPmVuY3JfYm1wKSk7CiAJd2Z4X2ZpbGxfaGVhZGVyKGhp
ZiwgLTEsIEhJRl9SRVFfSURfU0xfQ09ORklHVVJFLCBzaXplb2YoKmJvZHkpKTsKIAlyZXQgPSB3
ZnhfY21kX3NlbmQod2RldiwgaGlmLCBOVUxMLCAwLCBmYWxzZSk7CkBAIC01MzgsNiArNTc5LDgg
QEAgaW50IGhpZl9zbF9zZXRfbWFjX2tleShzdHJ1Y3Qgd2Z4X2RldiAqd2RldiwgY29uc3QgdTgg
KnNsa19rZXksIGludCBkZXN0aW5hdGlvbikKIAlzdHJ1Y3QgaGlmX3JlcV9zZXRfc2xfbWFjX2tl
eSAqYm9keSA9IHdmeF9hbGxvY19oaWYoc2l6ZW9mKCpib2R5KSwKIAkJCQkJCQkgICAgJmhpZik7
CiAKKwlpZiAoIWhpZikKKwkJcmV0dXJuIC1FTk9NRU07CiAJbWVtY3B5KGJvZHktPmtleV92YWx1
ZSwgc2xrX2tleSwgc2l6ZW9mKGJvZHktPmtleV92YWx1ZSkpOwogCWJvZHktPm90cF9vcl9yYW0g
PSBkZXN0aW5hdGlvbjsKIAl3ZnhfZmlsbF9oZWFkZXIoaGlmLCAtMSwgSElGX1JFUV9JRF9TRVRf
U0xfTUFDX0tFWSwgc2l6ZW9mKCpib2R5KSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL3N0YWdpbmcv
d2Z4L2hpZl90eF9taWIuYyBiL2RyaXZlcnMvc3RhZ2luZy93ZngvaGlmX3R4X21pYi5jCmluZGV4
IDU2N2M2MWQxZmUyZS4uMTY4OWNiNDJhY2MwIDEwMDY0NAotLS0gYS9kcml2ZXJzL3N0YWdpbmcv
d2Z4L2hpZl90eF9taWIuYworKysgYi9kcml2ZXJzL3N0YWdpbmcvd2Z4L2hpZl90eF9taWIuYwpA
QCAtMjIyLDYgKzIyMiw4IEBAIGludCBoaWZfc2V0X3R4X3JhdGVfcmV0cnlfcG9saWN5KHN0cnVj
dCB3ZnhfdmlmICp3dmlmLAogCWludCByZXQ7CiAKIAlhcmcgPSBremFsbG9jKHNpemUsIEdGUF9L
RVJORUwpOworCWlmICghYXJnKQorCQlyZXR1cm4gLUVOT01FTTsKIAlhcmctPm51bV90eF9yYXRl
X3BvbGljaWVzID0gMTsKIAlhcmctPnR4X3JhdGVfcmV0cnlfcG9saWN5WzBdLnBvbGljeV9pbmRl
eCA9IHBvbGljeV9pbmRleDsKIAlhcmctPnR4X3JhdGVfcmV0cnlfcG9saWN5WzBdLnNob3J0X3Jl
dHJ5X2NvdW50ID0gMjU1OwotLSAKMi4yNi4yCgo=
