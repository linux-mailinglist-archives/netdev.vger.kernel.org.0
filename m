Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 8332215C896
	for <lists+netdev@lfdr.de>; Thu, 13 Feb 2020 17:51:44 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727963AbgBMQvm (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Thu, 13 Feb 2020 11:51:42 -0500
Received: from mga09.intel.com ([134.134.136.24]:46824 "EHLO mga09.intel.com"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1727752AbgBMQvm (ORCPT <rfc822;netdev@vger.kernel.org>);
        Thu, 13 Feb 2020 11:51:42 -0500
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
  by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 13 Feb 2020 08:51:40 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,437,1574150400"; 
   d="scan'208";a="228191264"
Received: from orsmsx109.amr.corp.intel.com ([10.22.240.7])
  by fmsmga008.fm.intel.com with ESMTP; 13 Feb 2020 08:51:40 -0800
Received: from orsmsx160.amr.corp.intel.com (10.22.226.43) by
 ORSMSX109.amr.corp.intel.com (10.22.240.7) with Microsoft SMTP Server (TLS)
 id 14.3.439.0; Thu, 13 Feb 2020 08:51:40 -0800
Received: from orsmsx115.amr.corp.intel.com ([169.254.4.100]) by
 ORSMSX160.amr.corp.intel.com ([169.254.13.167]) with mapi id 14.03.0439.000;
 Thu, 13 Feb 2020 08:51:39 -0800
From:   "Boeuf, Sebastien" <sebastien.boeuf@intel.com>
To:     "sgarzare@redhat.com" <sgarzare@redhat.com>,
        "stefanha@redhat.com" <stefanha@redhat.com>
CC:     "netdev@vger.kernel.org" <netdev@vger.kernel.org>,
        "davem@davemloft.net" <davem@davemloft.net>
Subject: Re: [PATCH] net: virtio_vsock: Fix race condition between bind and
 listen
Thread-Topic: [PATCH] net: virtio_vsock: Fix race condition between bind and
 listen
Thread-Index: AQHV4k47o+FvdyeZdUa5OLpq2zu4PqgZZQkAgAAC0ACAAAitgIAABgwAgAAPhoCAABfKAIAAP1OA
Date:   Thu, 13 Feb 2020 16:51:39 +0000
Message-ID: <ee9a929c3b9c5b958bf6399a5048a3c9b6ea4aae.camel@intel.com>
References: <668b0eda8823564cd604b1663dc53fbaece0cd4e.camel@intel.com>
         <20200213094130.vehzkr4a3pnoiogr@steredhat>
         <3448e588f11dad913e93dfce8031fbd60ba4c85b.camel@intel.com>
         <20200213102237.uyhfv5g2td5ayg2b@steredhat>
         <1d4c3958d8b75756341548e7d51ccf42397c2d27.camel@intel.com>
         <20200213113949.GA544499@stefanha-x1.localdomain>
         <20200213130458.ugu6rx6cv4k6v5rh@steredhat>
In-Reply-To: <20200213130458.ugu6rx6cv4k6v5rh@steredhat>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [10.252.24.191]
Content-Type: text/plain; charset="utf-8"
Content-ID: <9887E39E2A67B843B61F5B862328F626@intel.com>
MIME-Version: 1.0
Content-Transfer-Encoding: base64
Sender: netdev-owner@vger.kernel.org
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

T24gVGh1LCAyMDIwLTAyLTEzIGF0IDE0OjA0ICswMTAwLCBTdGVmYW5vIEdhcnphcmVsbGEgd3Jv
dGU6DQo+IE9uIFRodSwgRmViIDEzLCAyMDIwIGF0IDExOjM5OjQ5QU0gKzAwMDAsIFN0ZWZhbiBI
YWpub2N6aSB3cm90ZToNCj4gPiBPbiBUaHUsIEZlYiAxMywgMjAyMCBhdCAxMDo0NDoxOEFNICsw
MDAwLCBCb2V1ZiwgU2ViYXN0aWVuIHdyb3RlOg0KPiA+ID4gT24gVGh1LCAyMDIwLTAyLTEzIGF0
IDExOjIyICswMTAwLCBTdGVmYW5vIEdhcnphcmVsbGEgd3JvdGU6DQo+ID4gPiA+IE9uIFRodSwg
RmViIDEzLCAyMDIwIGF0IDA5OjUxOjM2QU0gKzAwMDAsIEJvZXVmLCBTZWJhc3RpZW4NCj4gPiA+
ID4gd3JvdGU6DQo+ID4gPiA+ID4gSGkgU3RlZmFubywNCj4gPiA+ID4gPiANCj4gPiA+ID4gPiBP
biBUaHUsIDIwMjAtMDItMTMgYXQgMTA6NDEgKzAxMDAsIFN0ZWZhbm8gR2FyemFyZWxsYSB3cm90
ZToNCj4gPiA+ID4gPiA+IEhpIFNlYmFzdGllbiwNCj4gPiA+ID4gPiA+IA0KPiA+ID4gPiA+ID4g
T24gVGh1LCBGZWIgMTMsIDIwMjAgYXQgMDk6MTY6MTFBTSArMDAwMCwgQm9ldWYsIFNlYmFzdGll
bg0KPiA+ID4gPiA+ID4gd3JvdGU6DQo+ID4gPiA+ID4gPiA+IEZyb20gMmYxMjc2ZDAyZjVhMTJk
ODVhZWM1YWRjMTFkZmUxZWFiN2UxNjBkNiBNb24gU2VwIDE3DQo+ID4gPiA+ID4gPiA+IDAwOjAw
OjAwDQo+ID4gPiA+ID4gPiA+IDIwMDENCj4gPiA+ID4gPiA+ID4gRnJvbTogU2ViYXN0aWVuIEJv
ZXVmIDxzZWJhc3RpZW4uYm9ldWZAaW50ZWwuY29tPg0KPiA+ID4gPiA+ID4gPiBEYXRlOiBUaHUs
IDEzIEZlYiAyMDIwIDA4OjUwOjM4ICswMTAwDQo+ID4gPiA+ID4gPiA+IFN1YmplY3Q6IFtQQVRD
SF0gbmV0OiB2aXJ0aW9fdnNvY2s6IEZpeCByYWNlIGNvbmRpdGlvbg0KPiA+ID4gPiA+ID4gPiBi
ZXR3ZWVuDQo+ID4gPiA+ID4gPiA+IGJpbmQNCj4gPiA+ID4gPiA+ID4gYW5kIGxpc3Rlbg0KPiA+
ID4gPiA+ID4gPiANCj4gPiA+ID4gPiA+ID4gV2hlbmV2ZXIgdGhlIHZzb2NrIGJhY2tlbmQgb24g
dGhlIGhvc3Qgc2VuZHMgYSBwYWNrZXQNCj4gPiA+ID4gPiA+ID4gdGhyb3VnaA0KPiA+ID4gPiA+
ID4gPiB0aGUNCj4gPiA+ID4gPiA+ID4gUlgNCj4gPiA+ID4gPiA+ID4gcXVldWUsIGl0IGV4cGVj
dHMgYW4gYW5zd2VyIG9uIHRoZSBUWCBxdWV1ZS4NCj4gPiA+ID4gPiA+ID4gVW5mb3J0dW5hdGVs
eSwNCj4gPiA+ID4gPiA+ID4gdGhlcmUNCj4gPiA+ID4gPiA+ID4gaXMgb25lDQo+ID4gPiA+ID4g
PiA+IGNhc2Ugd2hlcmUgdGhlIGhvc3Qgc2lkZSB3aWxsIGhhbmcgd2FpdGluZyBmb3IgdGhlIGFu
c3dlcg0KPiA+ID4gPiA+ID4gPiBhbmQNCj4gPiA+ID4gPiA+ID4gd2lsbA0KPiA+ID4gPiA+ID4g
PiBlZmZlY3RpdmVseSBuZXZlciByZWNvdmVyLg0KPiA+ID4gPiA+ID4gDQo+ID4gPiA+ID4gPiBE
byB5b3UgaGF2ZSBhIHRlc3QgY2FzZT8NCj4gPiA+ID4gPiANCj4gPiA+ID4gPiBZZXMgSSBkby4g
VGhpcyBoYXMgYmVlbiBhIGJ1ZyB3ZSd2ZSBiZWVuIGludmVzdGlnYXRpbmcgb24NCj4gPiA+ID4g
PiBLYXRhDQo+ID4gPiA+ID4gQ29udGFpbmVycyBmb3IgcXVpdGUgc29tZSB0aW1lIG5vdy4gVGhp
cyB3YXMgaGFwcGVuaW5nIHdoZW4NCj4gPiA+ID4gPiB1c2luZw0KPiA+ID4gPiA+IEthdGENCj4g
PiA+ID4gPiBhbG9uZyB3aXRoIENsb3VkLUh5cGVydmlzb3IgKHdoaWNoIHJlbHkgb24gdGhlIGh5
YnJpZCB2c29jaw0KPiA+ID4gPiA+IGltcGxlbWVudGF0aW9uIGZyb20gRmlyZWNyYWNrZXIpLiBU
aGUgdGhpbmcgaXMsIHRoaXMgYnVnIGlzDQo+ID4gPiA+ID4gdmVyeQ0KPiA+ID4gPiA+IGhhcmQN
Cj4gPiA+ID4gPiB0byByZXByb2R1Y2UgYW5kIHdhcyBoYXBwZW5pbmcgZm9yIEthdGEgYmVjYXVz
ZSBvZiB0aGUNCj4gPiA+ID4gPiBjb25uZWN0aW9uDQo+ID4gPiA+ID4gc3RyYXRlZ3kuIFRoZSBr
YXRhLXJ1bnRpbWUgdHJpZXMgdG8gY29ubmVjdCBhIG1pbGxpb24gdGltZXMNCj4gPiA+ID4gPiBh
ZnRlcg0KPiA+ID4gPiA+IGl0DQo+ID4gPiA+ID4gc3RhcnRlZCB0aGUgVk0sIGp1c3QgaG9waW5n
IHRoZSBrYXRhLWFnZW50IHdpbGwgc3RhcnQgdG8NCj4gPiA+ID4gPiBsaXN0ZW4NCj4gPiA+ID4g
PiBmcm9tDQo+ID4gPiA+ID4gdGhlIGd1ZXN0IHNpZGUgYXQgc29tZSBwb2ludC4NCj4gPiA+ID4g
DQo+ID4gPiA+IE1heWJlIGlzIHJlbGF0ZWQgdG8gc29tZXRoaW5nIGVsc2UuIEkgdHJpZWQgdGhl
IGZvbGxvd2luZyB3aGljaA0KPiA+ID4gPiBzaG91bGQgYmUNCj4gPiA+ID4geW91ciBjYXNlIHNp
bXBsaWZpZWQgKElJVUMpOg0KPiA+ID4gPiANCj4gPiA+ID4gZ3Vlc3QkIHB5dGhvbg0KPiA+ID4g
PiAgICAgaW1wb3J0IHNvY2tldA0KPiA+ID4gPiAgICAgcyA9IHNvY2tldC5zb2NrZXQoc29ja2V0
LkFGX1ZTT0NLLCBzb2NrZXQuU09DS19TVFJFQU0pDQo+ID4gPiA+ICAgICBzLmJpbmQoKHNvY2tl
dC5WTUFERFJfQ0lEX0FOWSwgMTIzNCkpDQo+ID4gPiA+IA0KPiA+ID4gPiBob3N0JCBweXRob24N
Cj4gPiA+ID4gICAgIGltcG9ydCBzb2NrZXQNCj4gPiA+ID4gICAgIHMgPSBzb2NrZXQuc29ja2V0
KHNvY2tldC5BRl9WU09DSywgc29ja2V0LlNPQ0tfU1RSRUFNKQ0KPiA+ID4gPiAgICAgcy5jb25u
ZWN0KCgzLCAxMjM0KSkNCj4gPiA+ID4gDQo+ID4gPiA+IFRyYWNlYmFjayAobW9zdCByZWNlbnQg
Y2FsbCBsYXN0KToNCj4gPiA+ID4gICBGaWxlICI8c3RkaW4+IiwgbGluZSAxLCBpbiA8bW9kdWxl
Pg0KPiA+ID4gPiBUaW1lb3V0RXJyb3I6IFtFcnJubyAxMTBdIENvbm5lY3Rpb24gdGltZWQgb3V0
DQo+ID4gPiANCj4gPiA+IFllcyB0aGlzIGlzIGV4YWN0bHkgdGhlIHNpbXBsaWZpZWQgY2FzZS4g
QnV0IHRoYXQncyB0aGUgcG9pbnQsIEkNCj4gPiA+IGRvbid0DQo+ID4gPiB0aGluayB0aGUgdGlt
ZW91dCBpcyB0aGUgYmVzdCB3YXkgdG8gZ28gaGVyZS4gQmVjYXVzZSB0aGlzIG1lYW5zDQo+ID4g
PiB0aGF0DQo+ID4gPiB3aGVuIHdlIHJ1biBpbnRvIHRoaXMgY2FzZSwgdGhlIGhvc3Qgc2lkZSB3
aWxsIHdhaXQgZm9yIHF1aXRlDQo+ID4gPiBzb21lIHRpbWUNCj4gPiA+IGJlZm9yZSByZXRyeWlu
Zywgd2hpY2ggY2FuIGNhdXNlIGEgdmVyeSBsb25nIGRlbGF5IGJlZm9yZSB0aGUNCj4gPiA+IGNv
bW11bmljYXRpb24gd2l0aCB0aGUgZ3Vlc3QgaXMgZXN0YWJsaXNoZWQuIEJ5IHNpbXBseSBhbnN3
ZXJpbmcNCj4gPiA+IHRoZQ0KPiA+ID4gaG9zdCB3aXRoIGEgUlNUIHBhY2tldCwgd2UgaW5mb3Jt
IGl0IHRoYXQgbm9ib2R5J3MgbGlzdGVuaW5nIG9uDQo+ID4gPiB0aGUNCj4gPiA+IGd1ZXN0IHNp
ZGUgeWV0LCB0aGVyZWZvcmUgdGhlIGhvc3Qgc2lkZSB3aWxsIGNsb3NlIGFuZCB0cnkgYWdhaW4u
DQo+ID4gDQo+ID4gTXkgZXhwZWN0YXRpb24gaXMgdGhhdCBUQ1AvSVAgd2lsbCBwcm9kdWNlIEVD
T05OUkVGVVNFRCBpbiB0aGlzDQo+ID4gY2FzZSBidXQNCj4gPiBJIGhhdmVuJ3QgY2hlY2tlZC4g
IFRpbWluZyBvdXQgaXMgd2VpcmQgYmVoYXZpb3IuDQo+IA0KPiBJIGp1c3QgdHJpZWQgYW5kIHll
cywgVENQL0lQIHByb2R1Y2VzIEVDT05OUkVGVVNFRC4gVGhlIHNhbWUgZXJyb3INCj4gcmV0dXJu
ZWQNCj4gd2hlbiBubyBvbmUncyBib3VuZCB0byB0aGUgcG9ydC4NCj4gDQo+IEluc3RlYWQgdmly
dGlvLXZzb2NrIHJldHVybnMgRUNPTk5SRVNFVCBpbiB0aGUgbGFzdCBjYXNlLg0KPiBJJ20gbm90
IHN1cmUgaXQncyBjb3JyZWN0IChsb29raW5nIGF0IHRoZSBtYW4gcGFnZSBjb25uZWN0KDIpIGl0
DQo+IHdvdWxkDQo+IHNlZW0gbm90KSwgYnV0IGlmIEkgdW5kZXJzdG9vZCBjb3JyZWN0bHkgVk1D
SSByZXR1cm5zIHRoZSBzYW1lDQo+IEVDT05OUkVTRVQgaW4gdGhpcyBjYXNlLg0KPiANCj4gPiBJ
biBhbnkgY2FzZSwgdGhlIHJlZmVyZW5jZSBmb3IgdmlydGlvLXZzb2NrIHNlbWFudGljcyBpczoN
Cj4gPiAxLiBIb3cgZG9lcyBWTUNJIChWTXdhcmUpIHZzb2NrIGJlaGF2ZT8gIFdlIHN0cml2ZSB0
byBiZSBjb21wYXRpYmxlDQo+ID4gd2l0aA0KPiA+IHRoZSBWTUNJIHRyYW5zcG9ydC4NCj4gDQo+
IExvb2tpbmcgYXQgdGhlIGNvZGUsIGl0IGxvb2tzIGxpa2UgVk1DSSByZXR1cm5zIEVDT05OUkVT
RVQgaW4gdGhpcw0KPiBjYXNlLA0KPiBzbyB0aGlzIHBhdGNoIHNob3VsZCBiZSBva2F5LiAoSSBo
YXZlbid0IHRyaWVkIGl0KQ0KPiANCj4gPiAyLiBJZiB0aGVyZSBpcyBubyBjbGVhciBWTUNJIGJl
aGF2aW9yLCB0aGVuIHdlIGxvb2sgYXQgVENQL0lQDQo+ID4gYmVjYXVzZQ0KPiA+IHRob3NlIHNl
bWFudGljcyBhcmUgZXhwZWN0ZWQgYnkgbW9zdCBhcHBsaWNhdGlvbnMuDQo+ID4gDQo+ID4gVGhp
cyBidWcgbmVlZHMgYSB0ZXN0IGNhc2UgaW4gdG9vbHMvdGVzdGluZ3MvdnNvY2svIGFuZCB0aGF0
IHRlc3QNCj4gPiBjYXNlDQo+ID4gd2lsbCBydW4gYWdhaW5zdCBWTUNJLCB2aXJ0aW8tdnNvY2ss
IGFuZCBIeXBlci1WLiAgRG9pbmcgdGhhdCB3aWxsDQo+ID4gYW5zd2VyIHRoZSBxdWVzdGlvbiBv
ZiBob3cgVk1DSSBoYW5kbGVzIHRoaXMgY2FzZS4NCj4gDQo+IEkgYWdyZWUuDQoNCkknbSB0cnlp
bmcgdG8gd3JpdGUgdGhlIHRlc3QgYnV0IEknbSBraW5kYSBzdHVjayBhcyBJIGhhdmUgbm8gd2F5
IHRvDQplbnN1cmUgdGhlIHByb3BlciB0aW1pbmcgYmV0d2VlbiB0aGUgdGVzdCBvbiB0aGUgc2Vy
dmVyKGd1ZXN0KSBhbmQgdGhlDQp0ZXN0IG9uIGZyb20gdGhlIGNsaWVudChob3N0KS4NCg0KQmFz
aWNhbGx5IEkgd2FzIHRoaW5raW5nIGFib3V0IGNyZWF0aW5nIGEgbmV3IHRlc3QgcmV1c2luZw0K
dGVzdF9zdHJlYW1fY29ubmVjdGlvbl9yZXNldCgpIGZyb20gdnNvY2tfdGVzdC5jLiBUaGUgcmV1
c2VkIGZ1bmN0aW9uDQp3b3VsZCBiZSB1c2VkIGZvciB0aGUgcnVuX2NsaWVudCBjYWxsYmFjaywg
d2hpbGUgSSB3b3VsZCBkZWZpbmUgYSBuZXcNCmZ1bmN0aW9uIGZvciB0aGUgcnVuX3NlcnZlci4g
SSB3YW50ZWQgdG8gYmFzaWNhbGx5IGRvIGEgYmluZCBvbmx5LCBhbmQNCmRvbid0IGdvIHVwIHRv
IHRoZSBsaXN0ZW4vYWNjZXB0IGNhbGxzLg0KUHJvYmxlbSBpcywgdGhlIHNlcnZlciB3b24ndCBi
bG9jayBhZnRlciB0aGUgYmluZCBpcyBkb25lLCBhbmQgSSBkb24ndA0Ka25vdyBob3cgbXVjaCB0
aGUgdGVzdCBzaG91bGQgd2FpdCBiZXR3ZWVuIHRoZSBiaW5kIGFuZCB0aGUgZW5kLg0KSSB3b3Vs
ZCBsaWtlIHRvIHNob3cgdGhhdCBldmVuIHdoZW4gdGhlIHNlcnZlciByZWFjaGVzIHRoZSBwb2lu
dCB3aGVyZQ0KdGhlIHNvY2tldCBpcyBib3VuZCwgdGhlIGNvbm5lY3Qgd2lsbCBzdGlsbCByZXR1
cm4gd2l0aCBFQ09OTlJFU0VULiBUaGUNCnNhbWUgdGVzdCB3aXRob3V0IHRoZSBwYXRjaCB3b3Vs
ZCBzaW1wbHkgaGFuZyB0aWxsIHdlIGhpdCB0aGUgdGltZW91dA0Kb24gdGhlIGNsaWVudCBzaWRl
Lg0KRG9lcyB0aGF0IG1ha2Ugc2Vuc2U/IEFuZCBob3cgbXVjaCB0aW1lIHNob3VsZCBJIHdhaXQg
Zm9yIGFmdGVyIHRoZQ0KYmluZCBvbiB0aGUgc2VydmVyIHNpZGU/DQoNClRoYW5rcywNClNlYmFz
dGllbg0KDQo+IA0KPiBUaGFua3MsDQo+IFN0ZWZhbm8NCj4gDQotLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KSW50ZWwg
Q29ycG9yYXRpb24gU0FTIChGcmVuY2ggc2ltcGxpZmllZCBqb2ludCBzdG9jayBjb21wYW55KQpS
ZWdpc3RlcmVkIGhlYWRxdWFydGVyczogIkxlcyBNb250YWxldHMiLSAyLCBydWUgZGUgUGFyaXMs
IAo5MjE5NiBNZXVkb24gQ2VkZXgsIEZyYW5jZQpSZWdpc3RyYXRpb24gTnVtYmVyOiAgMzAyIDQ1
NiAxOTkgUi5DLlMuIE5BTlRFUlJFCkNhcGl0YWw6IDQsNTcyLDAwMCBFdXJvcwoKVGhpcyBlLW1h
aWwgYW5kIGFueSBhdHRhY2htZW50cyBtYXkgY29udGFpbiBjb25maWRlbnRpYWwgbWF0ZXJpYWwg
Zm9yCnRoZSBzb2xlIHVzZSBvZiB0aGUgaW50ZW5kZWQgcmVjaXBpZW50KHMpLiBBbnkgcmV2aWV3
IG9yIGRpc3RyaWJ1dGlvbgpieSBvdGhlcnMgaXMgc3RyaWN0bHkgcHJvaGliaXRlZC4gSWYgeW91
IGFyZSBub3QgdGhlIGludGVuZGVkCnJlY2lwaWVudCwgcGxlYXNlIGNvbnRhY3QgdGhlIHNlbmRl
ciBhbmQgZGVsZXRlIGFsbCBjb3BpZXMuCg==

