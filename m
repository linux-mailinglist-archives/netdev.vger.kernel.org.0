Return-Path: <netdev-owner@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 1904141195A
	for <lists+netdev@lfdr.de>; Mon, 20 Sep 2021 18:14:35 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S242329AbhITQP7 (ORCPT <rfc822;lists+netdev@lfdr.de>);
        Mon, 20 Sep 2021 12:15:59 -0400
Received: from mail-bn7nam10on2055.outbound.protection.outlook.com ([40.107.92.55]:31296
        "EHLO NAM10-BN7-obe.outbound.protection.outlook.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S242382AbhITQOP (ORCPT <rfc822;netdev@vger.kernel.org>);
        Mon, 20 Sep 2021 12:14:15 -0400
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=OzGcdXR8/fALP3nQjZkrG/BKVLDWGKFDBCQi1oSTTiMiSaVAVE1p4q7JzZprVzaywgJE9B9Nyi7I1lMXayiqUY1gssZY+DeND+VTmxdqHHg7PaqQj8SxR79ESp1Jzha7e1wAtkIzuJez3tBPeOQlg+qL2OJ0a3F1VKkEHpVIh7kYSsj5dfMS0VzTyUDAgX47UAQtA8diyxFBPpXTZrQQUWk4fGQxwueJgPOYJI/jvWqAnw5K9tjktW6cvaj4n47+2469jSxey9Qo1qsf7xNuC5Ade2N1zBNVI1WnwvgF/mEiO2YPRJiTeOlZtpWnPRZ8CXCiLwmew+W4gIGl7qXbWg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector9901; h=From:Date:Subject:Message-ID:Content-Type:MIME-Version;
 bh=lquym0q6CMbsfLPbe1AK9mls78xc1jS4/BFzqXVswKE=;
 b=eEtVkaX7X7vrpn9NGwuBVHw+bQSpHuZIvV8RzVgnCj4rgvINmGFqm1XERxGgm3wOnurhoKgzRiVl5B26+dDSe9XGKNMXXi4mnJumHcvEMUb8J8vg2ICc5AA9ZGj4fyRat9AICyfhGvFNO413sYvZVsfIlAjy+i9W5164AJDuw/blVvdq0RqBIbCDijtpt5SXejlMZQscTEE1v6+jLOEBJiUALW68Gsk4rnOjhgTAMrjvU/M6MHhURi3ofZAPpURLdg9tLZmZ8yl+4G0soR25KAAiO0so6MKVK1WHS67/IEK/xRJuYX5kHGbScgx228vdXXaYH870alGk74dlLqGb5Q==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=silabs.com; dmarc=pass action=none header.from=silabs.com;
 dkim=pass header.d=silabs.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=silabs.onmicrosoft.com; s=selector2-silabs-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=lquym0q6CMbsfLPbe1AK9mls78xc1jS4/BFzqXVswKE=;
 b=H0/hBmwCAf4URiYlYN5RHm45k1VXmW8o/IA9eYtRWEkrhb7AWeHQXQ/SsE/beQRyBtrGM+nQsdmfx422nKP08FO4l/N7YJaXLeykmbwzrxYD+oXFWIi2r+u/GoWoLRAEf25A/0t/zbUuNVmAjrq6Hq3K/Hi7307AljhqdaTXEu0=
Authentication-Results: vger.kernel.org; dkim=none (message not signed)
 header.d=none;vger.kernel.org; dmarc=none action=none header.from=silabs.com;
Received: from SN6PR11MB2718.namprd11.prod.outlook.com (2603:10b6:805:63::18)
 by SA2PR11MB5002.namprd11.prod.outlook.com (2603:10b6:806:fb::8) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.4523.16; Mon, 20 Sep
 2021 16:12:20 +0000
Received: from SN6PR11MB2718.namprd11.prod.outlook.com
 ([fe80::7050:a0a:415:2ccd]) by SN6PR11MB2718.namprd11.prod.outlook.com
 ([fe80::7050:a0a:415:2ccd%7]) with mapi id 15.20.4523.018; Mon, 20 Sep 2021
 16:12:20 +0000
From:   Jerome Pouiller <Jerome.Pouiller@silabs.com>
To:     linux-wireless@vger.kernel.org, netdev@vger.kernel.org,
        Kalle Valo <kvalo@codeaurora.org>
Cc:     devel@driverdev.osuosl.org, linux-kernel@vger.kernel.org,
        Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
        "David S . Miller" <davem@davemloft.net>,
        devicetree@vger.kernel.org, Rob Herring <robh+dt@kernel.org>,
        linux-mmc@vger.kernel.org,
        =?UTF-8?q?Pali=20Roh=C3=A1r?= <pali@kernel.org>,
        Ulf Hansson <ulf.hansson@linaro.org>,
        =?UTF-8?q?J=C3=A9r=C3=B4me=20Pouiller?= 
        <jerome.pouiller@silabs.com>
Subject: [PATCH v7 11/24] wfx: add bh.c/bh.h
Date:   Mon, 20 Sep 2021 18:11:23 +0200
Message-Id: <20210920161136.2398632-12-Jerome.Pouiller@silabs.com>
X-Mailer: git-send-email 2.33.0
In-Reply-To: <20210920161136.2398632-1-Jerome.Pouiller@silabs.com>
References: <20210920161136.2398632-1-Jerome.Pouiller@silabs.com>
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: base64
X-ClientProxiedBy: SA0PR11CA0064.namprd11.prod.outlook.com
 (2603:10b6:806:d2::9) To SN6PR11MB2718.namprd11.prod.outlook.com
 (2603:10b6:805:63::18)
MIME-Version: 1.0
Received: from pc-42.silabs.com (2a01:e34:ecb5:66a0:9876:e1d7:65be:d294) by SA0PR11CA0064.namprd11.prod.outlook.com (2603:10b6:806:d2::9) with Microsoft SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.4523.14 via Frontend Transport; Mon, 20 Sep 2021 16:12:18 +0000
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: c624894b-ec7c-4c29-f81c-08d97c516c40
X-MS-TrafficTypeDiagnostic: SA2PR11MB5002:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <SA2PR11MB5002B1AB74AE5F6473FF7D8393A09@SA2PR11MB5002.namprd11.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:9508;
X-MS-Exchange-SenderADCheck: 1
X-MS-Exchange-AntiSpam-Relay: 0
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: jNV6WoFrzP8xvrzd09e9tq72/ribMVSpPx3uC+4W57vqnblD3rq3j9qCYuIyEqKTiCReWMjcECAjmrbyf1MIy2HeU7VMk4XS+/OokREF/rO4CNE/ODBPA8fs89HPTgt+bfNfQO6srq/t1hRCKVsxcgU6vfcW9ptbW+gxM2dqjksPE14TFRcU1JiKCUWObmt1afKlrHwAzfZnjqjxhUUTLGr9BTzkgIBG1GJlUrNfwGl7DPUFop4IJTInrffzvC3gLYMoUu7Wxf7Wj7LXhR+nNopbiPxwSJpyUraXT9k5JPC8rHVf6W0X45E3huUj5qMAVtmiqESmBWyTgfecmX1OjSTwoB9Uz+xxpZJYFnW4z7MIrMfviyWXHtz5wGidKjgo3vJc/zl0WE5ZAsu7kzu1d3esgNqjys+/C6E8RkNQlYgCjU4RdkJHD5JiL8tCV/iWT5+tFBuWCGpb3oKKtrb2HngAj5K0FgN2niDBqJj7Fo6iz65UDl1ser/yIc6V6YtdBe4DO9codIwNfNO3cKMfmRoo+hPRSO0l2FEsUby/No8dLlIe6GHqE2XPwD1wSeWhv3d9j7QmiZyeTeDY7IxAlUJsyMXh6Y3rBw/cE+pLITLUvxmUhwWKmYG3rmRriJopB8jkSFQuOfwmLt2vsrjSiA==
X-Forefront-Antispam-Report: CIP:255.255.255.255;CTRY:;LANG:en;SCL:1;SRV:;IPV:NLI;SFV:NSPM;H:SN6PR11MB2718.namprd11.prod.outlook.com;PTR:;CAT:NONE;SFS:(366004)(66476007)(36756003)(2616005)(66556008)(107886003)(186003)(54906003)(5660300002)(6486002)(66574015)(66946007)(52116002)(38100700002)(83380400001)(7696005)(6916009)(2906002)(1076003)(4326008)(8936002)(316002)(8676002)(508600001)(86362001)(30864003)(6666004)(7416002);DIR:OUT;SFP:1101;
X-MS-Exchange-AntiSpam-MessageData-ChunkCount: 1
X-MS-Exchange-AntiSpam-MessageData-0: LbkQ4MGodi/YVi6/ywH1P0zh7GkW/xuJKpJfgxEtzd+CSP98JVVbEpSHGWufblfyQolqucSfnaFGp7J4o5hmxV5NJ4ZcNU4T/6w6S1R9RFgfMRB6edSAeNUws/7aN8XLaklm6I7XZK3TjPRWLrtj2ijDZDy8cf1RxfdWS0eXxIPXk6dqIG+/LnjXyZBkyEjq0nmOJazRL9GIUHfZi6IsXc0htsF0yaniU0LU1GBAe5Fb5XIpqvzqiVIYXsyZX+8DLhuyyA1Ukz/6WZsyEGkiGLYN5KtFkFujB8+gM8iFguLLuVVxyV1iRZLbOdTAbm+PF/E/0axN/au+0t9JI6qs29KF9aL3CeVqnbnh5PGXGiLC+oeshmrYHG7DoyiV1mM/589AreKkdNFsr8rykAOXqBjq7x+s8ZTynSBV1p9GiwMkaCxhUKMe2deHgw7Z/BQ5hOvPrOrtIJ8bYdrlITekeICXDyg+6afPaX4dWXN1sxVjUoEPE2KfL09N8bQfnVJk2/DAKyiyziHBbh6mgAJbunuy1pz/WL1eICQCwdsPmL73WfpRWLsiFzIOXvxaphpWFx1d7gvSqW4i1jVBuVzInegW+aFQ8gA4FPpdW+IUkIbOqmElX5wRPlTe6AqYIM7u7265Bh7YO0rxHmwbNkWaZpC0bkPeg1drQFavfofeJVL0ga0nP+t+cI5DQHMOiZF14FRPc2l1tCkJ1rTqQsBwjtBv3TACOxcYvsCQ+8KksWed7y1H8oP7u6PVNbPt9uh9Tibo9lmegArmXGpZ5fk7GjnNBopGEjFXyyLZQ1K8nyQWUqRqo71MJZnD0dRsHOtZ
X-OriginatorOrg: silabs.com
X-MS-Exchange-CrossTenant-Network-Message-Id: c624894b-ec7c-4c29-f81c-08d97c516c40
X-MS-Exchange-CrossTenant-AuthSource: SN6PR11MB2718.namprd11.prod.outlook.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 20 Sep 2021 16:12:20.2786
 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 54dbd822-5231-4b20-944d-6f4abcd541fb
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: 0/L9vR67b4XzJgV5BpOu4n2YsojGqWd/F9a8IIISN0RmPf4SN0uOTlA/97bSUvPYl4d5k0ANBfKr/+DfrdzJOg==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: SA2PR11MB5002
Precedence: bulk
List-ID: <netdev.vger.kernel.org>
X-Mailing-List: netdev@vger.kernel.org

RnJvbTogSsOpcsO0bWUgUG91aWxsZXIgPGplcm9tZS5wb3VpbGxlckBzaWxhYnMuY29tPgoKU2ln
bmVkLW9mZi1ieTogSsOpcsO0bWUgUG91aWxsZXIgPGplcm9tZS5wb3VpbGxlckBzaWxhYnMuY29t
PgotLS0KIGRyaXZlcnMvbmV0L3dpcmVsZXNzL3NpbGFicy93ZngvYmguYyB8IDMyOSArKysrKysr
KysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvbmV0L3dpcmVsZXNzL3NpbGFicy93ZngvYmgu
aCB8ICAzMyArKysKIDIgZmlsZXMgY2hhbmdlZCwgMzYyIGluc2VydGlvbnMoKykKIGNyZWF0ZSBt
b2RlIDEwMDY0NCBkcml2ZXJzL25ldC93aXJlbGVzcy9zaWxhYnMvd2Z4L2JoLmMKIGNyZWF0ZSBt
b2RlIDEwMDY0NCBkcml2ZXJzL25ldC93aXJlbGVzcy9zaWxhYnMvd2Z4L2JoLmgKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL25ldC93aXJlbGVzcy9zaWxhYnMvd2Z4L2JoLmMgYi9kcml2ZXJzL25ldC93
aXJlbGVzcy9zaWxhYnMvd2Z4L2JoLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MDAwMDAwLi5hNWRhZjM5M2Y1YWEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL25ldC93aXJl
bGVzcy9zaWxhYnMvd2Z4L2JoLmMKQEAgLTAsMCArMSwzMjkgQEAKKy8vIFNQRFgtTGljZW5zZS1J
ZGVudGlmaWVyOiBHUEwtMi4wLW9ubHkKKy8qCisgKiBJbnRlcnJ1cHQgYm90dG9tIGhhbGYgKEJI
KS4KKyAqCisgKiBDb3B5cmlnaHQgKGMpIDIwMTctMjAyMCwgU2lsaWNvbiBMYWJvcmF0b3JpZXMs
IEluYy4KKyAqIENvcHlyaWdodCAoYykgMjAxMCwgU1QtRXJpY3Nzb24KKyAqLworI2luY2x1ZGUg
PGxpbnV4L2dwaW8vY29uc3VtZXIuaD4KKyNpbmNsdWRlIDxuZXQvbWFjODAyMTEuaD4KKworI2lu
Y2x1ZGUgImJoLmgiCisjaW5jbHVkZSAid2Z4LmgiCisjaW5jbHVkZSAiaHdpby5oIgorI2luY2x1
ZGUgInRyYWNlcy5oIgorI2luY2x1ZGUgImhpZl9yeC5oIgorI2luY2x1ZGUgImhpZl9hcGlfY21k
LmgiCisKK3N0YXRpYyB2b2lkIGRldmljZV93YWtldXAoc3RydWN0IHdmeF9kZXYgKndkZXYpCit7
CisJaW50IG1heF9yZXRyeSA9IDM7CisKKwlpZiAoIXdkZXYtPnBkYXRhLmdwaW9fd2FrZXVwKQor
CQlyZXR1cm47CisJaWYgKGdwaW9kX2dldF92YWx1ZV9jYW5zbGVlcCh3ZGV2LT5wZGF0YS5ncGlv
X3dha2V1cCkgPiAwKQorCQlyZXR1cm47CisKKwlpZiAod2Z4X2FwaV9vbGRlcl90aGFuKHdkZXYs
IDEsIDQpKSB7CisJCWdwaW9kX3NldF92YWx1ZV9jYW5zbGVlcCh3ZGV2LT5wZGF0YS5ncGlvX3dh
a2V1cCwgMSk7CisJCWlmICghY29tcGxldGlvbl9kb25lKCZ3ZGV2LT5oaWYuY3RybF9yZWFkeSkp
CisJCQl1c2xlZXBfcmFuZ2UoMjAwMCwgMjUwMCk7CisJCXJldHVybjsKKwl9CisJZm9yICg7Oykg
eworCQlncGlvZF9zZXRfdmFsdWVfY2Fuc2xlZXAod2Rldi0+cGRhdGEuZ3Bpb193YWtldXAsIDEp
OworCQkvKiBjb21wbGV0aW9uLmggZG9lcyBub3QgcHJvdmlkZSBhbnkgZnVuY3Rpb24gdG8gd2Fp
dAorCQkgKiBjb21wbGV0aW9uIHdpdGhvdXQgY29uc3VtZSBpdCAoYSBraW5kIG9mCisJCSAqIHdh
aXRfZm9yX2NvbXBsZXRpb25fZG9uZV90aW1lb3V0KCkpLiBTbyB3ZSBoYXZlIHRvIGVtdWxhdGUK
KwkJICogaXQuCisJCSAqLworCQlpZiAod2FpdF9mb3JfY29tcGxldGlvbl90aW1lb3V0KCZ3ZGV2
LT5oaWYuY3RybF9yZWFkeSwKKwkJCQkJCW1zZWNzX3RvX2ppZmZpZXMoMikpKSB7CisJCQljb21w
bGV0ZSgmd2Rldi0+aGlmLmN0cmxfcmVhZHkpOworCQkJcmV0dXJuOworCQl9IGVsc2UgaWYgKG1h
eF9yZXRyeS0tID4gMCkgeworCQkJLyogT2xkZXIgZmlybXdhcmVzIGhhdmUgYSByYWNlIGluIHNs
ZWVwL3dha2UtdXAgcHJvY2Vzcy4KKwkJCSAqIFJlZG8gdGhlIHByb2Nlc3MgaXMgc3VmZmljaWVu
dCB0byB1bmZyZWV6ZSB0aGUKKwkJCSAqIGNoaXAuCisJCQkgKi8KKwkJCWRldl9lcnIod2Rldi0+
ZGV2LCAidGltZW91dCB3aGlsZSB3YWtlIHVwIGNoaXBcbiIpOworCQkJZ3Bpb2Rfc2V0X3ZhbHVl
X2NhbnNsZWVwKHdkZXYtPnBkYXRhLmdwaW9fd2FrZXVwLCAwKTsKKwkJCXVzbGVlcF9yYW5nZSgy
MDAwLCAyNTAwKTsKKwkJfSBlbHNlIHsKKwkJCWRldl9lcnIod2Rldi0+ZGV2LCAibWF4IHdha2Ut
dXAgcmV0cmllcyByZWFjaGVkXG4iKTsKKwkJCXJldHVybjsKKwkJfQorCX0KK30KKworc3RhdGlj
IHZvaWQgZGV2aWNlX3JlbGVhc2Uoc3RydWN0IHdmeF9kZXYgKndkZXYpCit7CisJaWYgKCF3ZGV2
LT5wZGF0YS5ncGlvX3dha2V1cCkKKwkJcmV0dXJuOworCisJZ3Bpb2Rfc2V0X3ZhbHVlX2NhbnNs
ZWVwKHdkZXYtPnBkYXRhLmdwaW9fd2FrZXVwLCAwKTsKK30KKworc3RhdGljIGludCByeF9oZWxw
ZXIoc3RydWN0IHdmeF9kZXYgKndkZXYsIHNpemVfdCByZWFkX2xlbiwgaW50ICppc19jbmYpCit7
CisJc3RydWN0IHNrX2J1ZmYgKnNrYjsKKwlzdHJ1Y3QgaGlmX21zZyAqaGlmOworCXNpemVfdCBh
bGxvY19sZW47CisJc2l6ZV90IGNvbXB1dGVkX2xlbjsKKwlpbnQgcmVsZWFzZV9jb3VudDsKKwlp
bnQgcGlnZ3liYWNrID0gMDsKKworCVdBUk4ocmVhZF9sZW4gPiByb3VuZF9kb3duKDB4RkZGLCAy
KSAqIHNpemVvZih1MTYpLCAicmVxdWVzdCBleGNlZWQgdGhlIGNoaXAgY2FwYWJpbGl0eSIpOwor
CisJLyogQWRkIDIgdG8gdGFrZSBpbnRvIGFjY291bnQgcGlnZ3liYWNrIHNpemUgKi8KKwlhbGxv
Y19sZW4gPSB3ZGV2LT5od2J1c19vcHMtPmFsaWduX3NpemUod2Rldi0+aHdidXNfcHJpdiwgcmVh
ZF9sZW4gKyAyKTsKKwlza2IgPSBkZXZfYWxsb2Nfc2tiKGFsbG9jX2xlbik7CisJaWYgKCFza2Ip
CisJCXJldHVybiAtRU5PTUVNOworCisJaWYgKHdmeF9kYXRhX3JlYWQod2Rldiwgc2tiLT5kYXRh
LCBhbGxvY19sZW4pKQorCQlnb3RvIGVycjsKKworCXBpZ2d5YmFjayA9IGxlMTZfdG9fY3B1cCgo
X19sZTE2ICopKHNrYi0+ZGF0YSArIGFsbG9jX2xlbiAtIDIpKTsKKwlfdHJhY2VfcGlnZ3liYWNr
KHBpZ2d5YmFjaywgZmFsc2UpOworCisJaGlmID0gKHN0cnVjdCBoaWZfbXNnICopc2tiLT5kYXRh
OworCVdBUk4oaGlmLT5lbmNyeXB0ZWQgJiAweDMsICJlbmNyeXB0aW9uIGlzIHVuc3VwcG9ydGVk
Iik7CisJaWYgKFdBUk4ocmVhZF9sZW4gPCBzaXplb2Yoc3RydWN0IGhpZl9tc2cpLCAiY29ycnVw
dGVkIHJlYWQiKSkKKwkJZ290byBlcnI7CisJY29tcHV0ZWRfbGVuID0gbGUxNl90b19jcHUoaGlm
LT5sZW4pOworCWNvbXB1dGVkX2xlbiA9IHJvdW5kX3VwKGNvbXB1dGVkX2xlbiwgMik7CisJaWYg
KGNvbXB1dGVkX2xlbiAhPSByZWFkX2xlbikgeworCQlkZXZfZXJyKHdkZXYtPmRldiwgImluY29u
c2lzdGVudCBtZXNzYWdlIGxlbmd0aDogJXp1ICE9ICV6dVxuIiwKKwkJCWNvbXB1dGVkX2xlbiwg
cmVhZF9sZW4pOworCQlwcmludF9oZXhfZHVtcChLRVJOX0lORk8sICJoaWY6ICIsIERVTVBfUFJF
RklYX09GRlNFVCwgMTYsIDEsCisJCQkgICAgICAgaGlmLCByZWFkX2xlbiwgdHJ1ZSk7CisJCWdv
dG8gZXJyOworCX0KKworCWlmICghKGhpZi0+aWQgJiBISUZfSURfSVNfSU5ESUNBVElPTikpIHsK
KwkJKCppc19jbmYpKys7CisJCWlmIChoaWYtPmlkID09IEhJRl9DTkZfSURfTVVMVElfVFJBTlNN
SVQpCisJCQlyZWxlYXNlX2NvdW50ID0gKChzdHJ1Y3QgaGlmX2NuZl9tdWx0aV90cmFuc21pdCAq
KWhpZi0+Ym9keSktPm51bV90eF9jb25mczsKKwkJZWxzZQorCQkJcmVsZWFzZV9jb3VudCA9IDE7
CisJCVdBUk4od2Rldi0+aGlmLnR4X2J1ZmZlcnNfdXNlZCA8IHJlbGVhc2VfY291bnQsICJjb3Jy
dXB0ZWQgYnVmZmVyIGNvdW50ZXIiKTsKKwkJd2Rldi0+aGlmLnR4X2J1ZmZlcnNfdXNlZCAtPSBy
ZWxlYXNlX2NvdW50OworCX0KKwlfdHJhY2VfaGlmX3JlY3YoaGlmLCB3ZGV2LT5oaWYudHhfYnVm
ZmVyc191c2VkKTsKKworCWlmIChoaWYtPmlkICE9IEhJRl9JTkRfSURfRVhDRVBUSU9OICYmIGhp
Zi0+aWQgIT0gSElGX0lORF9JRF9FUlJPUikgeworCQlpZiAoaGlmLT5zZXFudW0gIT0gd2Rldi0+
aGlmLnJ4X3NlcW51bSkKKwkJCWRldl93YXJuKHdkZXYtPmRldiwgIndyb25nIG1lc3NhZ2Ugc2Vx
dWVuY2U6ICVkICE9ICVkXG4iLAorCQkJCSBoaWYtPnNlcW51bSwgd2Rldi0+aGlmLnJ4X3NlcW51
bSk7CisJCXdkZXYtPmhpZi5yeF9zZXFudW0gPSAoaGlmLT5zZXFudW0gKyAxKSAlIChISUZfQ09V
TlRFUl9NQVggKyAxKTsKKwl9CisKKwlza2JfcHV0KHNrYiwgbGUxNl90b19jcHUoaGlmLT5sZW4p
KTsKKwkvKiB3ZnhfaGFuZGxlX3J4IHRha2VzIGNhcmUgb24gU0tCIGxpdmV0aW1lICovCisJd2Z4
X2hhbmRsZV9yeCh3ZGV2LCBza2IpOworCWlmICghd2Rldi0+aGlmLnR4X2J1ZmZlcnNfdXNlZCkK
KwkJd2FrZV91cCgmd2Rldi0+aGlmLnR4X2J1ZmZlcnNfZW1wdHkpOworCisJcmV0dXJuIHBpZ2d5
YmFjazsKKworZXJyOgorCWlmIChza2IpCisJCWRldl9rZnJlZV9za2Ioc2tiKTsKKwlyZXR1cm4g
LUVJTzsKK30KKworc3RhdGljIGludCBiaF93b3JrX3J4KHN0cnVjdCB3ZnhfZGV2ICp3ZGV2LCBp
bnQgbWF4X21zZywgaW50ICpudW1fY25mKQoreworCXNpemVfdCBsZW47CisJaW50IGk7CisJaW50
IGN0cmxfcmVnLCBwaWdneWJhY2s7CisKKwlwaWdneWJhY2sgPSAwOworCWZvciAoaSA9IDA7IGkg
PCBtYXhfbXNnOyBpKyspIHsKKwkJaWYgKHBpZ2d5YmFjayAmIENUUkxfTkVYVF9MRU5fTUFTSykK
KwkJCWN0cmxfcmVnID0gcGlnZ3liYWNrOworCQllbHNlIGlmICh0cnlfd2FpdF9mb3JfY29tcGxl
dGlvbigmd2Rldi0+aGlmLmN0cmxfcmVhZHkpKQorCQkJY3RybF9yZWcgPSBhdG9taWNfeGNoZygm
d2Rldi0+aGlmLmN0cmxfcmVnLCAwKTsKKwkJZWxzZQorCQkJY3RybF9yZWcgPSAwOworCQlpZiAo
IShjdHJsX3JlZyAmIENUUkxfTkVYVF9MRU5fTUFTSykpCisJCQlyZXR1cm4gaTsKKwkJLyogY3Ry
bF9yZWcgdW5pdHMgYXJlIDE2Yml0cyB3b3JkcyAqLworCQlsZW4gPSAoY3RybF9yZWcgJiBDVFJM
X05FWFRfTEVOX01BU0spICogMjsKKwkJcGlnZ3liYWNrID0gcnhfaGVscGVyKHdkZXYsIGxlbiwg
bnVtX2NuZik7CisJCWlmIChwaWdneWJhY2sgPCAwKQorCQkJcmV0dXJuIGk7CisJCWlmICghKHBp
Z2d5YmFjayAmIENUUkxfV0xBTl9SRUFEWSkpCisJCQlkZXZfZXJyKHdkZXYtPmRldiwgInVuZXhw
ZWN0ZWQgcGlnZ3liYWNrIHZhbHVlOiByZWFkeSBiaXQgbm90IHNldDogJTA0eFxuIiwKKwkJCQlw
aWdneWJhY2spOworCX0KKwlpZiAocGlnZ3liYWNrICYgQ1RSTF9ORVhUX0xFTl9NQVNLKSB7CisJ
CWN0cmxfcmVnID0gYXRvbWljX3hjaGcoJndkZXYtPmhpZi5jdHJsX3JlZywgcGlnZ3liYWNrKTsK
KwkJY29tcGxldGUoJndkZXYtPmhpZi5jdHJsX3JlYWR5KTsKKwkJaWYgKGN0cmxfcmVnKQorCQkJ
ZGV2X2Vycih3ZGV2LT5kZXYsICJ1bmV4cGVjdGVkIElSUSBoYXBwZW5lZDogJTA0eC8lMDR4XG4i
LAorCQkJCWN0cmxfcmVnLCBwaWdneWJhY2spOworCX0KKwlyZXR1cm4gaTsKK30KKworc3RhdGlj
IHZvaWQgdHhfaGVscGVyKHN0cnVjdCB3ZnhfZGV2ICp3ZGV2LCBzdHJ1Y3QgaGlmX21zZyAqaGlm
KQoreworCWludCByZXQ7CisJdm9pZCAqZGF0YTsKKwlib29sIGlzX2VuY3J5cHRlZCA9IGZhbHNl
OworCXNpemVfdCBsZW4gPSBsZTE2X3RvX2NwdShoaWYtPmxlbik7CisKKwlXQVJOKGxlbiA8IHNp
emVvZigqaGlmKSwgInRyeSB0byBzZW5kIGNvcnJ1cHRlZCBkYXRhIik7CisKKwloaWYtPnNlcW51
bSA9IHdkZXYtPmhpZi50eF9zZXFudW07CisJd2Rldi0+aGlmLnR4X3NlcW51bSA9ICh3ZGV2LT5o
aWYudHhfc2VxbnVtICsgMSkgJSAoSElGX0NPVU5URVJfTUFYICsgMSk7CisKKwlkYXRhID0gaGlm
OworCVdBUk4obGVuID4gd2Rldi0+aHdfY2Fwcy5zaXplX2lucF9jaF9idWYsCisJICAgICAicmVx
dWVzdCBleGNlZWQgdGhlIGNoaXAgY2FwYWJpbGl0eTogJXp1ID4gJWRcbiIsCisJICAgICBsZW4s
IHdkZXYtPmh3X2NhcHMuc2l6ZV9pbnBfY2hfYnVmKTsKKwlsZW4gPSB3ZGV2LT5od2J1c19vcHMt
PmFsaWduX3NpemUod2Rldi0+aHdidXNfcHJpdiwgbGVuKTsKKwlyZXQgPSB3ZnhfZGF0YV93cml0
ZSh3ZGV2LCBkYXRhLCBsZW4pOworCWlmIChyZXQpCisJCWdvdG8gZW5kOworCisJd2Rldi0+aGlm
LnR4X2J1ZmZlcnNfdXNlZCsrOworCV90cmFjZV9oaWZfc2VuZChoaWYsIHdkZXYtPmhpZi50eF9i
dWZmZXJzX3VzZWQpOworZW5kOgorCWlmIChpc19lbmNyeXB0ZWQpCisJCWtmcmVlKGRhdGEpOwor
fQorCitzdGF0aWMgaW50IGJoX3dvcmtfdHgoc3RydWN0IHdmeF9kZXYgKndkZXYsIGludCBtYXhf
bXNnKQoreworCXN0cnVjdCBoaWZfbXNnICpoaWY7CisJaW50IGk7CisKKwlmb3IgKGkgPSAwOyBp
IDwgbWF4X21zZzsgaSsrKSB7CisJCWhpZiA9IE5VTEw7CisJCWlmICh3ZGV2LT5oaWYudHhfYnVm
ZmVyc191c2VkIDwgd2Rldi0+aHdfY2Fwcy5udW1faW5wX2NoX2J1ZnMpIHsKKwkJCWlmICh0cnlf
d2FpdF9mb3JfY29tcGxldGlvbigmd2Rldi0+aGlmX2NtZC5yZWFkeSkpIHsKKwkJCQlXQVJOKCFt
dXRleF9pc19sb2NrZWQoJndkZXYtPmhpZl9jbWQubG9jayksICJkYXRhIGxvY2tpbmcgZXJyb3Ii
KTsKKwkJCQloaWYgPSB3ZGV2LT5oaWZfY21kLmJ1Zl9zZW5kOworCQkJfSBlbHNlIHsKKwkJCQlo
aWYgPSB3ZnhfdHhfcXVldWVzX2dldCh3ZGV2KTsKKwkJCX0KKwkJfQorCQlpZiAoIWhpZikKKwkJ
CXJldHVybiBpOworCQl0eF9oZWxwZXIod2RldiwgaGlmKTsKKwl9CisJcmV0dXJuIGk7Cit9CisK
Ky8qIEluIFNESU8gbW9kZSwgaXQgaXMgbmVjZXNzYXJ5IHRvIG1ha2UgYW4gYWNjZXNzIHRvIGEg
cmVnaXN0ZXIgdG8gYWNrbm93bGVkZ2UKKyAqIGxhc3QgcmVjZWl2ZWQgbWVzc2FnZS4gSXQgY291
bGQgYmUgcG9zc2libGUgdG8gcmVzdHJpY3QgdGhpcyBhY2tub3dsZWRnZSB0bworICogU0RJTyBt
b2RlIGFuZCBvbmx5IGlmIGxhc3Qgb3BlcmF0aW9uIHdhcyByeC4KKyAqLworc3RhdGljIHZvaWQg
YWNrX3NkaW9fZGF0YShzdHJ1Y3Qgd2Z4X2RldiAqd2RldikKK3sKKwl1MzIgY2ZnX3JlZzsKKwor
CWNvbmZpZ19yZWdfcmVhZCh3ZGV2LCAmY2ZnX3JlZyk7CisJaWYgKGNmZ19yZWcgJiAweEZGKSB7
CisJCWRldl93YXJuKHdkZXYtPmRldiwgImNoaXAgcmVwb3J0cyBlcnJvcnM6ICUwMnhcbiIsCisJ
CQkgY2ZnX3JlZyAmIDB4RkYpOworCQljb25maWdfcmVnX3dyaXRlX2JpdHMod2RldiwgMHhGRiwg
MHgwMCk7CisJfQorfQorCitzdGF0aWMgdm9pZCBiaF93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAq
d29yaykKK3sKKwlzdHJ1Y3Qgd2Z4X2RldiAqd2RldiA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1
Y3Qgd2Z4X2RldiwgaGlmLmJoKTsKKwlpbnQgc3RhdHNfcmVxID0gMCwgc3RhdHNfY25mID0gMCwg
c3RhdHNfaW5kID0gMDsKKwlib29sIHJlbGVhc2VfY2hpcCA9IGZhbHNlLCBsYXN0X29wX2lzX3J4
ID0gZmFsc2U7CisJaW50IG51bV90eCwgbnVtX3J4OworCisJZGV2aWNlX3dha2V1cCh3ZGV2KTsK
KwlkbyB7CisJCW51bV90eCA9IGJoX3dvcmtfdHgod2RldiwgMzIpOworCQlzdGF0c19yZXEgKz0g
bnVtX3R4OworCQlpZiAobnVtX3R4KQorCQkJbGFzdF9vcF9pc19yeCA9IGZhbHNlOworCQludW1f
cnggPSBiaF93b3JrX3J4KHdkZXYsIDMyLCAmc3RhdHNfY25mKTsKKwkJc3RhdHNfaW5kICs9IG51
bV9yeDsKKwkJaWYgKG51bV9yeCkKKwkJCWxhc3Rfb3BfaXNfcnggPSB0cnVlOworCX0gd2hpbGUg
KG51bV9yeCB8fCBudW1fdHgpOworCXN0YXRzX2luZCAtPSBzdGF0c19jbmY7CisKKwlpZiAobGFz
dF9vcF9pc19yeCkKKwkJYWNrX3NkaW9fZGF0YSh3ZGV2KTsKKwlpZiAoIXdkZXYtPmhpZi50eF9i
dWZmZXJzX3VzZWQgJiYgIXdvcmtfcGVuZGluZyh3b3JrKSkgeworCQlkZXZpY2VfcmVsZWFzZSh3
ZGV2KTsKKwkJcmVsZWFzZV9jaGlwID0gdHJ1ZTsKKwl9CisJX3RyYWNlX2JoX3N0YXRzKHN0YXRz
X2luZCwgc3RhdHNfcmVxLCBzdGF0c19jbmYsCisJCQl3ZGV2LT5oaWYudHhfYnVmZmVyc191c2Vk
LCByZWxlYXNlX2NoaXApOworfQorCisvKiBBbiBJUlEgZnJvbSBjaGlwIGRpZCBvY2N1ciAqLwor
dm9pZCB3ZnhfYmhfcmVxdWVzdF9yeChzdHJ1Y3Qgd2Z4X2RldiAqd2RldikKK3sKKwl1MzIgY3Vy
LCBwcmV2OworCisJY29udHJvbF9yZWdfcmVhZCh3ZGV2LCAmY3VyKTsKKwlwcmV2ID0gYXRvbWlj
X3hjaGcoJndkZXYtPmhpZi5jdHJsX3JlZywgY3VyKTsKKwljb21wbGV0ZSgmd2Rldi0+aGlmLmN0
cmxfcmVhZHkpOworCXF1ZXVlX3dvcmsoc3lzdGVtX2hpZ2hwcmlfd3EsICZ3ZGV2LT5oaWYuYmgp
OworCisJaWYgKCEoY3VyICYgQ1RSTF9ORVhUX0xFTl9NQVNLKSkKKwkJZGV2X2Vycih3ZGV2LT5k
ZXYsICJ1bmV4cGVjdGVkIGNvbnRyb2wgcmVnaXN0ZXIgdmFsdWU6IGxlbmd0aCBmaWVsZCBpcyAw
OiAlMDR4XG4iLAorCQkJY3VyKTsKKwlpZiAocHJldiAhPSAwKQorCQlkZXZfZXJyKHdkZXYtPmRl
diwgInJlY2VpdmVkIElSUSBidXQgcHJldmlvdXMgZGF0YSB3YXMgbm90ICh5ZXQpIHJlYWQ6ICUw
NHgvJTA0eFxuIiwKKwkJCXByZXYsIGN1cik7Cit9CisKKy8qIERyaXZlciB3YW50IHRvIHNlbmQg
ZGF0YSAqLwordm9pZCB3ZnhfYmhfcmVxdWVzdF90eChzdHJ1Y3Qgd2Z4X2RldiAqd2RldikKK3sK
KwlxdWV1ZV93b3JrKHN5c3RlbV9oaWdocHJpX3dxLCAmd2Rldi0+aGlmLmJoKTsKK30KKworLyog
SWYgSVJRIGlzIG5vdCBhdmFpbGFibGUsIHRoaXMgZnVuY3Rpb24gYWxsb3cgdG8gbWFudWFsbHkg
cG9sbCB0aGUgY29udHJvbAorICogcmVnaXN0ZXIgYW5kIHNpbXVsYXRlIGFuIElSUSBhaGVuIGFu
IGV2ZW50IGhhcHBlbmVkLgorICoKKyAqIE5vdGUgdGhhdCB0aGUgZGV2aWNlIGhhcyBhIGJ1Zzog
SWYgYW4gSVJRIHJhaXNlIHdoaWxlIGhvc3QgcmVhZCBjb250cm9sCisgKiByZWdpc3RlciwgdGhl
IElSUSBpcyBsb3N0LiBTbywgdXNlIHRoaXMgZnVuY3Rpb24gY2FyZWZ1bGx5IChvbmx5IGR1aW5n
CisgKiBkZXZpY2UgaW5pdGlhbGlzYXRpb24pLgorICovCit2b2lkIHdmeF9iaF9wb2xsX2lycShz
dHJ1Y3Qgd2Z4X2RldiAqd2RldikKK3sKKwlrdGltZV90IG5vdywgc3RhcnQ7CisJdTMyIHJlZzsK
KworCVdBUk4oIXdkZXYtPnBvbGxfaXJxLCAidW5leHBlY3RlZCBJUlEgcG9sbGluZyBjYW4gbWFz
ayBJUlEiKTsKKwlzdGFydCA9IGt0aW1lX2dldCgpOworCWZvciAoOzspIHsKKwkJY29udHJvbF9y
ZWdfcmVhZCh3ZGV2LCAmcmVnKTsKKwkJbm93ID0ga3RpbWVfZ2V0KCk7CisJCWlmIChyZWcgJiAw
eEZGRikKKwkJCWJyZWFrOworCQlpZiAoa3RpbWVfYWZ0ZXIobm93LCBrdGltZV9hZGRfbXMoc3Rh
cnQsIDEwMDApKSkgeworCQkJZGV2X2Vycih3ZGV2LT5kZXYsICJ0aW1lIG91dCB3aGlsZSBwb2xs
aW5nIGNvbnRyb2wgcmVnaXN0ZXJcbiIpOworCQkJcmV0dXJuOworCQl9CisJCXVkZWxheSgyMDAp
OworCX0KKwl3ZnhfYmhfcmVxdWVzdF9yeCh3ZGV2KTsKK30KKwordm9pZCB3ZnhfYmhfcmVnaXN0
ZXIoc3RydWN0IHdmeF9kZXYgKndkZXYpCit7CisJSU5JVF9XT1JLKCZ3ZGV2LT5oaWYuYmgsIGJo
X3dvcmspOworCWluaXRfY29tcGxldGlvbigmd2Rldi0+aGlmLmN0cmxfcmVhZHkpOworCWluaXRf
d2FpdHF1ZXVlX2hlYWQoJndkZXYtPmhpZi50eF9idWZmZXJzX2VtcHR5KTsKK30KKwordm9pZCB3
ZnhfYmhfdW5yZWdpc3RlcihzdHJ1Y3Qgd2Z4X2RldiAqd2RldikKK3sKKwlmbHVzaF93b3JrKCZ3
ZGV2LT5oaWYuYmgpOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9uZXQvd2lyZWxlc3Mvc2lsYWJz
L3dmeC9iaC5oIGIvZHJpdmVycy9uZXQvd2lyZWxlc3Mvc2lsYWJzL3dmeC9iaC5oCm5ldyBmaWxl
IG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uNmMxMjFjZTRkZDNmCi0tLSAvZGV2L251
bGwKKysrIGIvZHJpdmVycy9uZXQvd2lyZWxlc3Mvc2lsYWJzL3dmeC9iaC5oCkBAIC0wLDAgKzEs
MzMgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wLW9ubHkgKi8KKy8qCisg
KiBJbnRlcnJ1cHQgYm90dG9tIGhhbGYgKEJIKS4KKyAqCisgKiBDb3B5cmlnaHQgKGMpIDIwMTct
MjAyMCwgU2lsaWNvbiBMYWJvcmF0b3JpZXMsIEluYy4KKyAqIENvcHlyaWdodCAoYykgMjAxMCwg
U1QtRXJpY3Nzb24KKyAqLworI2lmbmRlZiBXRlhfQkhfSAorI2RlZmluZSBXRlhfQkhfSAorCisj
aW5jbHVkZSA8bGludXgvYXRvbWljLmg+CisjaW5jbHVkZSA8bGludXgvd2FpdC5oPgorI2luY2x1
ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPgorCitzdHJ1Y3Qgd2Z4X2RldjsKKworc3RydWN0IHdmeF9o
aWYgeworCXN0cnVjdCB3b3JrX3N0cnVjdCBiaDsKKwlzdHJ1Y3QgY29tcGxldGlvbiBjdHJsX3Jl
YWR5OworCXdhaXRfcXVldWVfaGVhZF90IHR4X2J1ZmZlcnNfZW1wdHk7CisJYXRvbWljX3QgY3Ry
bF9yZWc7CisJaW50IHJ4X3NlcW51bTsKKwlpbnQgdHhfc2VxbnVtOworCWludCB0eF9idWZmZXJz
X3VzZWQ7Cit9OworCit2b2lkIHdmeF9iaF9yZWdpc3RlcihzdHJ1Y3Qgd2Z4X2RldiAqd2Rldik7
Cit2b2lkIHdmeF9iaF91bnJlZ2lzdGVyKHN0cnVjdCB3ZnhfZGV2ICp3ZGV2KTsKK3ZvaWQgd2Z4
X2JoX3JlcXVlc3Rfcngoc3RydWN0IHdmeF9kZXYgKndkZXYpOwordm9pZCB3ZnhfYmhfcmVxdWVz
dF90eChzdHJ1Y3Qgd2Z4X2RldiAqd2Rldik7Cit2b2lkIHdmeF9iaF9wb2xsX2lycShzdHJ1Y3Qg
d2Z4X2RldiAqd2Rldik7CisKKyNlbmRpZgotLSAKMi4zMy4wCgo=
